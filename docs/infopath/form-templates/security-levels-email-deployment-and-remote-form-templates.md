---
title: 安全级别、 电子邮件部署和远程表单模板
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: 7fc438ad-ae26-3632-3444-371537eaecb3
description: Microsoft InfoPath 支持到另一个移动表单模板从一个位置，将其发送作为附件转发到电子邮件，并创建完全信任的表单模板进行数字签名或安装。
ms.openlocfilehash: ea0145eb45f6a03dc8637ba5ec1dc1c80d240006
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/11/2018
ms.locfileid: "19774084"
---
# <a name="security-levels-email-deployment-and-remote-form-templates"></a>安全级别、 电子邮件部署和远程表单模板

Microsoft InfoPath 支持到另一个移动表单模板从一个位置，将其发送作为附件转发到电子邮件，并创建完全信任的表单模板进行数字签名或安装。
  
## <a name="security-levels"></a>安全级别

表单模板可以具有三种不同安全级别中的一种，具体取决于表单所在的位置。以下各节分别介绍了这三种安全级别： 
  
### <a name="restricted"></a>受限

"受限"安全级别不允许在表单模板外部进行任何通信。此安全级别用于防止有害的表单将您计算机上的任何数据传输给恶意攻击者。在此安全模式下运行时，下列功能将不起作用：
  
- HTML 任务窗格  
- SharePoint 查询
- SharePoint 提交
- XML 文件查询
- 数据库查询
- 数据库提交
- Web 服务查询
- Web 服务提交
- 自定义代码提交
- 宿主环境提交
- ActiveX 控件
- 角色
- SharePoint 工作流
- 打开新文档的规则
- 托管代码
- 外部打印视图
- 链接图像
    
### <a name="domain"></a>域

"域"安全级别将表单操作限制在特定的 Internet 域中，将表单权限限制为只能进行该域所在的区域的 Internet Explorer 设置。允许表单与其所在域中的其他数据源进行通信，但通常不允许它从其他域检索数据，除非相应区域允许进行跨域通信。对于浏览器兼容的表单模板，这是所允许的最低安全级别。
  
### <a name="full-trust"></a>完全信任

通过"完全信任"安全级别，您可以在将使用表单的计算机上以完全信任方式运行该表单。仅当您使用位于服务器上的表单，并且该表单的签名与您计算机上受信任根的发布者相符时，或者只有在安装表单时，才能使用这一安全级别。这两种方法均需要将 **requireFullTrust** 属性设置为"yes"。使用该设置时，表单可以访问对象模型调用（如文件保存），并且在以更严格的安全级别运行时所出现的某些安全提示将被禁用。 
  
> [!NOTE]
> [!注释] 在 InfoPath Designer 中生成的所有表单都具有与其相关的安全级别。InfoPath 会在其相关的安全级别下打开表单。如果与表单相关的安全级别高于可以授予该表单的安全级别，则表单将不会打开。 
  
只能为已安装或已签名的表单模板设置"完全信任"安全级别；其他情况下的最高信任级别是"域"。InfoPath 不会自动将安全级别设置为"完全信任"。
  
表单的安全级别是基于它的打开位置而授予的。
  
## <a name="trust-levels"></a>信任级别

可授予表单模板的最高信任级别由"打开位置"和其他验证代码决定（如下表中所述）。 中列出的属性表 （例如，HTTP、 UNC、 *requireFullTrust*） 是用于确定的可以授予窗体，并将应用于在 InfoPath 客户端中打开的表单的信任级别的条目。 
  
|授予的最高信任级别|完全信任|客户端计算机（沙盒安全机制）|Intranet（沙盒安全机制）|Internet（沙盒安全机制）|受限|
|:-----|:-----:|:-----:|:-----:|:-----:|:-----:|
|**文件：访问路径=打开位置** <br/> |||X  <br/> |||
|**文件：访问路径\<\>打开位置或无访问路径（无论表单位于何处）** <br/> |||||X  <br/> |
|**打开位置：Intranet HTTP 或 HTTPS** <br/> |||X  <br/> |||
|**打开位置：Internet HTTP 或 HTTPS** <br/> ||||X  <br/> ||
|**打开位置：UNC** <br/> |||X  <br/> |||
|**安装的模板 (requireFullTrust="yes")** <br/> |X  <br/> |||||
|**安装的模板 (requireFullTrust="no")** <br/> ||X  <br/> ||||
|**具有受信任发布者证书的模板** <br/> |X  <br/> |||||
|**导出的表单文件** <br/> |||X  <br/> |||
   
## <a name="form-open-behavior"></a>表单打开行为

在 InfoPath 编辑器中打开的所有表单文件都受一组条件的约束，这些条件将决定表单在哪种安全级别打开以及是否打开。在编辑器中打开某 InfoPath 表单时，将使用相应的安全级别，否则将无法加载该表单。如果表单请求的安全级别高于可以授予它的安全级别（表单可以使用 **trustLevel** 或 **requireFullTrust** 属性来请求特定安全级别），系统将不允许加载该表单。另外，也可能以该表单所请求的安全级别加载它。如果不允许以请求的安全级别来打开表单模板，则用户将无法打开该表单并将收到错误消息。 
  
下表描述在各个安全级别下打开表单时所需的条件，以及用户尝试打开表单时所出现的相关情况。
  
|编辑器打开/失败|完全信任 (requireFullTrust="yes")|域信任（trustLevel="Domain" 或空白）|受限 (trustLevel="Restricted")|
|:-----|:-----|:-----|:-----|
|**受信任（安装的或受信任的证书）** <br/> |在"完全信任"级别打开编辑器  <br/> |N/A  <br/> |N/A  <br/> |
|**域信任：客户端计算机** <br/> |无法打开  <br/> |在"域"级别打开编辑器  <br/> |在"受限"级别打开编辑器  <br/> |
|**域信任：Intranet** <br/> |无法打开  <br/> |在"域"级别打开编辑器  <br/> |在"受限"级别打开编辑器  <br/> |
|**域信任：Internet** <br/> |无法打开  <br/> |在"域"级别打开编辑器  <br/> |在"受限"级别打开编辑器  <br/> |
|**受限** <br/> |无法打开  <br/> |无法打开  <br/> |在"受限"级别打开编辑器  <br/> |
   
## <a name="specifying-a-security-level"></a>指定安全级别

InfoPath 表单设计器将根据您要在表单中使用的功能来自动选择相应的安全级别（"受限"或"域"）。安全设置始终要尽可能地具有限制性（从"受限"开始），以帮助确保您和您的数据得到较高级别的保护。通过执行以下这些步骤，用户可以手动覆盖这一自动设置以选择更适合表单的安全级别：
  
1. 单击“文件”**** 选项卡，然后单击“信息”**** 选项卡上的“表单选项”****。 
    
2. 在“类别”**** 列表中，单击“安全和信任”****。
    
3. 取消选中“自动确定安全级别(推荐)”**** 复选框。 
    
4. 选择需要的安全级别。
    
## <a name="mail-deployment-and-browser-enabled-form-templates"></a>邮件部署和启用浏览器功能的表单模板

InfoPath 允许您作为电子邮件的附件发送的表单模板并将其从一个位置移动到另一个。 邮件部署是一种便捷而有效的方式，它可以在办公室之间分发表单以供使用，也可以将表单部署到远程用户。
  
此外，如果您具有包含 InfoPath Forms Services 的 Microsoft SharePoint Server 2010，则可以创建表单模板以便未安装 InfoPath 的用户可以在 Web 浏览器中填写表单。
  
## <a name="understanding-form-identity"></a>了解表单标识

InfoPath Designer 中的所有表单都是通过标识来创建的。此标识信息可帮助 InfoPath 将表单与缓存中的表单模板相关联，而且在将表单张贴到共享位置时，还可帮助检索对表单的更新。默认情况下，InfoPath 可为表单模板创建两种标识：表单 ID 和访问路径。 
  
### <a name="form-id"></a>表单 ID

表单 ID 是基于前缀、表单名称和表单命名空间的唯一标识符。标识符应该是可用于将表单文件与客户端计算机缓存中的相关表单模板正确关联的唯一名称。表单 ID 指定为表单定义文件 (.xsf) 中的名称属性（例如  `name="urn:MyForm:MyCompany:Template1:myXSD-1583-78-G3V94-23-47"`）。 
  
### <a name="access-path"></a>访问路径

访问路径是一种位置标识符，用于确定表单模板的正确位置和接收更新的位置。保存或发布表单模板时，保存或发布位置将成为默认访问路径。每次在客户端计算机上打开表单时，该表单都会尝试将自身与缓存表单相关联。它将尝试按照下列顺序进行关联：
  
1. 通过匹配的表单 ID 查找完全信任的表单模板。
    
2. 通过匹配的访问路径来查找缓存中的表单模板。
    
3. 通过匹配的表单 ID 来查找缓存中的表单模板。
    
完成匹配后，将通过相关的表单模板来打开表单。如果是通过访问路径进行的匹配，InfoPath 将使用访问路径来检索对表单模板的更新。此方法简化了企业管理、维护及表单更新过程。如果无法进行匹配且信任级别为"域"，该表单将不会打开。访问路径指定为表单定义文件 (.xsf) 中的 **publishUrl** 属性。 
  
正如每个表单模板都有两个标识属性一样，还存在一组启发方式，它们根据表单模板的条件（是具有访问路径、表单 ID，还是两者都具有）和网络连接的状态来专门确定缓存中的结果条目。
  
## <a name="designing-a-form-to-send-as-an-attachment-to-an-email-message"></a>设计表单作为电子邮件附件发送

在 InfoPath 设计器中创建的所有窗体可以作为至的电子邮件附件发送给用户。 电子邮件部署是一种轻松、 有效的方式，以分发表单以便使用以及将表单部署到远程用户。
  
### <a name="to-mail-a-form-template-to-other-users"></a>通过邮件向其他用户发送表单模板

1. 单击**文件**选项卡，单击**发布**，然后单击**电子邮件**按钮。 
    
2. 通过在每页后单击“下一步”**** 继续，来填写“发布向导”**** 中的相邻两页，然后单击“发布”****。
    
3. 这样可以填写收件人和您可以为他们的任何其他说明的列表显示电子邮件。
    
4. 完成后，单击“发送”****。表单和表单模板将附加到该邮件中。
    
## <a name="email-deployment-restricted-domain-and-full-trust-form-templates"></a>电子邮件部署： 受限、 域和完全信任表单模板

受限的表单模板的电子邮件部署允许没有数据连接以从任何位置打开的动态表单。 收件人可以打开直接从 Microsoft Outlook 2010 或从哪里收件人已保存附件作为电子邮件附件发送的表单模板。 此外，Outlook 2010 还允许用户直接在邮件中编辑表单。
  
必须从其发布的位置，打开表单模板具有域信任级别，但通过发布到的发布向导中的电子邮件收件人列表，它们可以作为附件进行发送至的电子邮件。 当打开附件时，它作为模板的实际的已发布位置的链接。 在该位置的表单模板是什么实际 InfoPath 编辑器中打开。
  
使用发送电子邮件附件类似于使用任何其他类型的文档; 如域级别的表单模板例如，Microsoft Excel 工作簿或 Microsoft Word 文档。 用户只需单击表单即可打开并使用它。 此外，用户还可以获得"域"级别更新的所有好处。
  
您可以电子邮件请求完全信任的访问的表单模板，但这些模板必须进行签名或它们将不允许打开。 表单模板请求域或受限访问没有签署作为电子邮件附件发送。 除非要查看能否自动更新模板，否则 InfoPath 不会检查或验证签名，即使对模板进行了签名也是如此。 您可以对"域"或"受限"表单模板进行数字签名，并且仍能够进行自动更新。 在这种情况下，数字签名将阻止显示任何缓存冲突消息。
  
## <a name="sharing-forms-by-email-message-or-from-a-common-shared-location"></a>通过电子邮件或从常用共享位置共享表单

创建将通过电子邮件部署窗体时应考虑某些特定问题。
  
- **是否要定期更新表单？** 如果要开发必须定期更新的表单，则应在将表单发送给其他用户之前，将其发布到共享位置。这将允许您通过将更新的版本发布到共享位置来更新表单，还允许您即时将表单模板分发给那些对共享位置可能没有访问权限的用户。 
    
   如果窗体是更新，并通过电子邮件来分发，用户在尝试打开新表单中，如果拥有旧版本在其计算机上存储和访问路径已更改时将获得缓存冲突消息。 系统将提示用户选择要使用的版本。 即使已更新的表单与用户计算机上的表单相同，用户仍然会收到缓存冲突消息，同时系统会提示用户选择要使用哪一份表单。 后面一种情况下的最佳实践是改为从共享位置来共享表单。
    
- **您的表单是否访问数据连接或使用"受限"安全级别所不支持的其他功能？** 如果开发请求"域"安全级别的表单，InfoPath 会要求您将该表单发布到共享位置以便用户能够打开它。 表单模板将仅在所请求的安全级别打开，因为如果 InfoPath 无法授予域级安全性，也不会打开一封电子邮件直接从打开的表单。 
    
## <a name="benefits-of-using-signed-form-templates"></a>使用已签名的表单模板的好处

- 允许使用"完全信任"安全级别打开表单模板。
    
- 如果将表单移至新位置，还可避免出现缓存冲突消息。
    
此外，如果对表单模板进行了签名，则还可以受益于自动更新功能。有关详细信息，请参阅[部署已签署的 InfoPath 表单模板](deploying-signed-infopath-form-templates.md)。
  
### <a name="example-updating-domain-or-restricted-templates"></a>示例： 更新域或受限模板

下面的示例演示请求域或受限访问更新的签名表单模板如何覆盖较旧的副本： 
  
1. "A"将签名的表单模板发送到"B"。
    
2. "B"打开该表单模板。
    
3. "A"更新该表单模板（例如，添加更多域）。
    
4. "A"将更新的表单模板发送到"B"。
    
5. "B"打开更新的表单模板。
    
### <a name="example-deploying-restricted-form-templates-on-an-extranet"></a>在 extranet 上的示例： 部署受限表单模板
  
1. 将"域"表单模板保存到运行 Microsoft SharePoint Foundation 2010 的网站。
    
2. 将该表单模板的安全级别更改为"受限"。
    
3. 将该表单模板保存到您的计算机桌面上。
    
4. 删除 URL（仅在用户能够访问原始发布位置时才需要这样做）。
    
5. 向 Extranet 用户发送该表单。
    
6. 要求用户安装该表单。
    
7. 要求用户在填写表单后将其返回给您。
    
8. 将表单保存回运行 SharePoint Foundation 2010 的网站，并通过使用**表单库设置**页中的**重新链接到此库的文档**选项重新链接该表单。 
    
## <a name="signature-verification-failure"></a>签名验证失败

请求"完全信任"访问权限，但无法验证其签名的已签名表单模板将无法打开。签名验证会由于以下原因而失败：
  
- 根证书不在受信任的根证书存储区内。
    
- 用于对表单模板进行签名的证书已过期。
    
- 用于对表单模板进行签名的证书已被吊销。
    
- 表单模板上的签名已损坏（有可能是在签名表单模板后更改了该模板）。
    
如果已签名的表单模板请求"域"或"受限"访问权限，那么除非是要确定该模板能否自动更新，否则 InfoPath 将不会检查或验证签名。
  
## <a name="infrastructure-registry-keys-for-form-migration-open-behavior"></a>基础结构注册表项，针对表单迁移打开行为

如果用户尝试打开某表单，而该表单是按其表单 ID 与表单模板进行匹配的，那么当表单模板具有"域"信任级别，而该域与表单的  *href*  属性不匹配时，InfoPath 将显示一则错误消息。这将阻止打开未使用表单模板明确创建的表单。 
  
InfoPath 不允许具有同一表单 ID 的表单模板共存。系统管理员可借助另外四个注册表项来让用户选择是否允许依据表单模板打开 XML 文件。该模型还允许管理员设置所需的表单打开行为。
  
下表描述了这些注册表项的默认设置。如果缺少这些注册表项，则会强制使用该表中指定的默认值。
  
"名称"值对应于 Internet Explorer 域设置。这些值确定这些安全区域中的表单打开行为，即，阻止或允许打开表单，或者让用户选择是否打开表单。
  
|**"名称"值**|**阻止**|**用户界面**|**允许**|
|:-----|:-----|:-----|:-----|
|**Internet** <br/> |X  <br/> |||
|**Intranet** <br/> ||X  <br/> ||
|**客户端计算机** <br/> |||X  <br/> |
|**受信任的站点** <br/> |||X  <br/> |
   
注册表项路径是`HKEY_CURRENT_USER\Software\Microsoft\Office\14.0\InfoPath\Open Behaviors`。

表单打开行为按如下所示定义：
  
- `Block [REG_DWORD = 0]`- 将显示一个包含"帮助"按钮的错误对话框。当表单运行在指定安全区域且与模板所在域不匹配时，InfoPath 将不允许打开 XML 文件。 
    
- `User Interface [REG_DWORD = 1]`- 将显示"是/否"对话框。当表单运行在指定安全区域且与模板所在域不匹配时，InfoPath 将提示用户依据表单模板打开 XML 文件。 
    
- `Allow [REG_DWORD = 2]`- XML 文件将打开，并且不显示错误或警告对话框。当表单运行在指定安全区域且与模板所在域不匹配时，InfoPath 将允许打开 XML 文件。 
    
如果依据在"域"安全级别运行的表单模板打开表单，并且该模板的"缓存位置"（即，表单的缓存位置）所在的安全域与表单的 **href** 属性不匹配，InfoPath 将检查注册表以定义表单打开行为。允许的行为基于模板所在的安全区域（  *CachedFromLocation*  值）。 
  
例如，如果根据表单 ID 而不是访问路径，将表单与表单模板进行匹配，并且从 Internet 位置缓存了该表单模板，InfoPath 将显示一则包含"帮助"按钮的错误对话框。
  
> [!NOTE]
> [!注释] 如果域是 Internet Explorer"受限"域，InfoPath 表单将不会打开；因此，没有 Internet Explorer"受限"站点的相关注册表项。 
  

