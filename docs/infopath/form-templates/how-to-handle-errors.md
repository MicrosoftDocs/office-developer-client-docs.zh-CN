---
title: 处理错误
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
keywords:
- errors [infopath 2007], handling,FormErrorCollection [InfoPath 2007],InfoPath 2007, error handling,FormError [InfoPath 2007],error handling [InfoPath 2007]
localization_priority: Normal
ms.assetid: 132cb698-d9a5-4767-b3d1-5dd1343a1ff4
description: 创建自定义应用程序时，开发人员必须经常执行错误处理，这包括通过编写程序代码，检查是否存在应用程序引起的错误，或者创建和引发自定义错误。Microsoft.Office.InfoPath 命名空间提供的 InfoPath 对象模型支持通过使用与 FormErrorCollection 类关联的 FormError 类来处理错误。
ms.openlocfilehash: 30cf649188b7e4cbc35469d2a50540bb13ecb38d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "33410775"
---
# <a name="handle-errors"></a><span data-ttu-id="96c0a-105">处理错误</span><span class="sxs-lookup"><span data-stu-id="96c0a-105">Handle Errors</span></span>

<span data-ttu-id="96c0a-p102">创建自定义应用程序时，开发人员必须经常执行错误处理，这包括通过编写程序代码，检查是否存在应用程序引起的错误，或者创建和引发自定义错误。[Microsoft.Office.InfoPath](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.aspx) 命名空间提供的 InfoPath 对象模型支持通过使用与 [FormErrorCollection](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.aspx) 类关联的 [FormError](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.aspx) 类来处理错误。</span><span class="sxs-lookup"><span data-stu-id="96c0a-p102">When creating custom applications, developers must often perform error handling that involves writing programming code to check for errors raised by the application or to create and raise custom errors. The InfoPath object model provided by the [Microsoft.Office.InfoPath](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.aspx) namespace supports error handling through the use of the [FormError](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.aspx) class in association with the [FormErrorCollection](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.aspx) class.</span></span> 
  
<span data-ttu-id="96c0a-108">在 InfoPath 中，发生错误的原因包括：</span><span class="sxs-lookup"><span data-stu-id="96c0a-108">In InfoPath, errors can occur for the following reasons:</span></span>
  
- <span data-ttu-id="96c0a-109">输入到表单的数据未通过 XML 架构的验证。</span><span class="sxs-lookup"><span data-stu-id="96c0a-109">When data entered into a form fails XML schema validation.</span></span>
    
- <span data-ttu-id="96c0a-110">自定义验证约束失败。</span><span class="sxs-lookup"><span data-stu-id="96c0a-110">When a custom validation constraint fails.</span></span>
    
- <span data-ttu-id="96c0a-111">错误由 [XmlValidatingEventArgs](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlValidatingEventArgs.ReportError.aspx) 事件对象的 [ReportError](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlValidatingEventArgs.aspx) 方法生成。</span><span class="sxs-lookup"><span data-stu-id="96c0a-111">When an error is generated by the [ReportError](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlValidatingEventArgs.ReportError.aspx) method of the [XmlValidatingEventArgs](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlValidatingEventArgs.aspx) event object.</span></span> 
    
- <span data-ttu-id="96c0a-112">使用 [FormErrorCollection](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Add.aspx) 类的 [Add](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.aspx) 方法时引发了用户定义的错误。</span><span class="sxs-lookup"><span data-stu-id="96c0a-112">When a user-defined error is created using the [Add](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Add.aspx) method of the [FormErrorCollection](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.aspx) class.</span></span> 
    
## <a name="overview-of-the-formerrorcollection-class"></a><span data-ttu-id="96c0a-113">FormErrorCollection 类概述</span><span class="sxs-lookup"><span data-stu-id="96c0a-113">Overview of the FormErrorCollection Class</span></span>

<span data-ttu-id="96c0a-114">[FormErrorCollection](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.aspx) 类提供了下列方法和属性，表单开发人员可使用这些属性和方法来管理该集合包含的 [FormError](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.aspx) 对象。</span><span class="sxs-lookup"><span data-stu-id="96c0a-114">The [FormErrorCollection](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.aspx) class provides the following methods and properties, which form developers can use to manage the [FormError](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.aspx) objects that the collection contains.</span></span> 
  
|<span data-ttu-id="96c0a-115">**名称**</span><span class="sxs-lookup"><span data-stu-id="96c0a-115">**Name**</span></span>|<span data-ttu-id="96c0a-116">**说明**</span><span class="sxs-lookup"><span data-stu-id="96c0a-116">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="96c0a-117">[Add](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Add.aspx) 方法（+3 个重载）</span><span class="sxs-lookup"><span data-stu-id="96c0a-117">[Add](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Add.aspx) method (+3 overloads)</span></span>  <br/> |<span data-ttu-id="96c0a-118">创建一个 **FormError** 对象，并将其添加到集合中。</span><span class="sxs-lookup"><span data-stu-id="96c0a-118">Creates a **FormError** object and adds it to the collection.</span></span>  <br/> |
|<span data-ttu-id="96c0a-119">[Delete](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Delete.aspx) 方法（+1 个重载）</span><span class="sxs-lookup"><span data-stu-id="96c0a-119">[Delete](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Delete.aspx) method (+1 overload)</span></span>  <br/> |<span data-ttu-id="96c0a-120">从集合中删除指定的用户定义错误。</span><span class="sxs-lookup"><span data-stu-id="96c0a-120">Deletes the specified user-defined error from the collection.</span></span>  <br/> |
|<span data-ttu-id="96c0a-121">[DeleteAll](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.DeleteAll.aspx) 方法</span><span class="sxs-lookup"><span data-stu-id="96c0a-121">[DeleteAll](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.DeleteAll.aspx) method</span></span>  <br/> |<span data-ttu-id="96c0a-122">删除包含在集合中的所有 **FormError** 对象。</span><span class="sxs-lookup"><span data-stu-id="96c0a-122">Deletes all **FormError** objects contained in the collection.</span></span>  <br/> |
|<span data-ttu-id="96c0a-123">[GetErrors](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.GetErrors.aspx) （+1 个重载）</span><span class="sxs-lookup"><span data-stu-id="96c0a-123">[GetErrors](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.GetErrors.aspx) (+1 overload)</span></span>  <br/> |<span data-ttu-id="96c0a-124">从集合中返回指定名称或类型的所有 **FormError** 对象。</span><span class="sxs-lookup"><span data-stu-id="96c0a-124">Returns all **FormError** objects of the specified name or type from the collection.</span></span>  <br/> |
|<span data-ttu-id="96c0a-125">[Count](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Count.aspx) 属性</span><span class="sxs-lookup"><span data-stu-id="96c0a-125">[Count](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Count.aspx) property</span></span>  <br/> |<span data-ttu-id="96c0a-126">获取集合中包含的 **FormError** 对象的数目。</span><span class="sxs-lookup"><span data-stu-id="96c0a-126">Gets a count of the number of **FormError** objects contained in the collection.</span></span>  <br/> |
|<span data-ttu-id="96c0a-127">[Item](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Item.aspx) 属性</span><span class="sxs-lookup"><span data-stu-id="96c0a-127">[Item](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Item.aspx) property</span></span>  <br/> |<span data-ttu-id="96c0a-128">基于指定的索引编号获取对 **FormError** 对象的引用。</span><span class="sxs-lookup"><span data-stu-id="96c0a-128">Gets a reference to an **FormError** object based on the specified index number.</span></span>  <br/> |
   
## <a name="overview-of-the-formerror-class"></a><span data-ttu-id="96c0a-129">FormError 类概述</span><span class="sxs-lookup"><span data-stu-id="96c0a-129">Overview of the FormError Class</span></span>

<span data-ttu-id="96c0a-130">[FormError](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.aspx) 类提供了以下属性，表单开发人员可以使用这些属性来访问有关所引发的错误的信息。</span><span class="sxs-lookup"><span data-stu-id="96c0a-130">The [FormError](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.aspx) class provides the following properties, which form developers can use to access information about the error that was raised.</span></span> 
  
|<span data-ttu-id="96c0a-131">**名称**</span><span class="sxs-lookup"><span data-stu-id="96c0a-131">**Name**</span></span>|<span data-ttu-id="96c0a-132">**说明**</span><span class="sxs-lookup"><span data-stu-id="96c0a-132">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="96c0a-133">[DetailedMessage](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.DetailedMessage.aspx) 属性</span><span class="sxs-lookup"><span data-stu-id="96c0a-133">[DetailedMessage](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.DetailedMessage.aspx) property</span></span>  <br/> |<span data-ttu-id="96c0a-134">获取或设置 **FormError** 对象的详细错误消息。</span><span class="sxs-lookup"><span data-stu-id="96c0a-134">Gets or sets the detailed error message of the **FormError** object.</span></span>  <br/> |
|<span data-ttu-id="96c0a-135">[ErrorCode](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.ErrorCode.aspx) 属性</span><span class="sxs-lookup"><span data-stu-id="96c0a-135">[ErrorCode](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.ErrorCode.aspx) property</span></span>  <br/> |<span data-ttu-id="96c0a-136">获取或设置 **FormError** 对象的错误代码。</span><span class="sxs-lookup"><span data-stu-id="96c0a-136">Gets or sets the error code of the **FormError** object.</span></span>  <br/> |
|<span data-ttu-id="96c0a-137">[Site](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.Site.aspx) 属性</span><span class="sxs-lookup"><span data-stu-id="96c0a-137">[Site](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.Site.aspx) property</span></span>  <br/> |<span data-ttu-id="96c0a-138">获取位于与 **FormError** 对象关联的节点中的 **XPathNavigator** 对象。</span><span class="sxs-lookup"><span data-stu-id="96c0a-138">Gets an **XPathNavigator** object that is positioned at the node associated with the **FormError** object.</span></span>  <br/> |
|<span data-ttu-id="96c0a-139">[Message](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.Message.aspx) 属性</span><span class="sxs-lookup"><span data-stu-id="96c0a-139">[Message](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.Message.aspx) property</span></span>  <br/> |<span data-ttu-id="96c0a-140">获取或设置 **FormError** 对象的短错误消息。</span><span class="sxs-lookup"><span data-stu-id="96c0a-140">Gets or sets the short error message of the **FormError** object.</span></span>  <br/> |
|<span data-ttu-id="96c0a-141">[FormErrorType](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.FormErrorType.aspx) 属性</span><span class="sxs-lookup"><span data-stu-id="96c0a-141">[FormErrorType](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormError.FormErrorType.aspx) property</span></span>  <br/> |<span data-ttu-id="96c0a-142">获取 **FormError** 对象的类型。</span><span class="sxs-lookup"><span data-stu-id="96c0a-142">Gets the type of the **FormError** object.</span></span>  <br/> |
   
## <a name="using-the-formerrorcollection-and-formerror-classes"></a><span data-ttu-id="96c0a-143">使用 FormErrorCollection 和 FormError 类</span><span class="sxs-lookup"><span data-stu-id="96c0a-143">Using the FormErrorCollection and FormError Classes</span></span>

<span data-ttu-id="96c0a-p103">通过使用 **XmlForm** 对象的 [Errors](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlForm.Errors.aspx) 属性可以访问与表单关联的 [FormErrorCollection](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlForm.aspx) 对象。 **FormErrorCollection** 对象与表单的基础 XML 文件相关联，这样，当发生错误时，可以在当前 XML 文档内访问和管理该错误及其他所有错误。下面的示例演示如何使用循环来检查表单的基础 XML 文档中可能存在的错误。如果存在错误，函数将循环遍历每个错误，并使用 **FormError** 对象的 **Message** 属性向用户显示一个消息框。</span><span class="sxs-lookup"><span data-stu-id="96c0a-p103">The **FormErrorCollection** object associated with a form is accessed through the [Errors](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlForm.Errors.aspx) property of the [XmlForm](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlForm.aspx) object. The **FormErrorCollection** object is associated with a form's underlying XML document so that when an error occurs, it and any additional errors can be accessed and managed within the current XML document. The following example demonstrates how a loop can be used to check the errors that may exist in a form's underlying XML document. If there are errors, the function loops through each of them, and, using the **Message** property of the **FormError** object, displays a message box to the user.</span></span> 
  
```cs
public void CheckErrors(XPathNavigator xmlNode)
{
   foreach(FormError err in this.Errors)
   {
      if(xmlNode.InnerXml == err.Site.InnerXml)
         MessageBox.Show("The following error has occured: "
             + err.Message);
   }
}
```

```vb
Public Sub CheckErrors(ByVal xmlNode As XPathNavigator)
   Dim err As FormError
   For Each err In Me.Errors
      If xmlNode.InnerXml = err.Site.InnerXml Then
         MessageBox.Show("The following error has occured: " _
             &amp; err.Message)
   End If
End Sub
```

<span data-ttu-id="96c0a-p104">可以通过表单的数据验证事件处理程序之一来调用前面的函数。例如，当在表单中某个域的 [Changed](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlEvent.Changed.aspx) 事件的事件处理程序中使用时，对该函数的调用将使用 [XmlEventArgs](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlEventArgs.Site.aspx) 事件对象的 [Site](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlEventArgs.aspx) 属性来传递 XML 节点参数，如下所示：</span><span class="sxs-lookup"><span data-stu-id="96c0a-p104">The preceding function could be called from one of the form's data validation event handlers. For example, when used in the event handler for the [Changed](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlEvent.Changed.aspx) event of a field in the form, the call to the function would pass the XML node argument using the [Site](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlEventArgs.Site.aspx) property of the [XmlEventArgs](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlEventArgs.aspx) event object as follows.</span></span> 
  
```cs
CheckErrors(e.Site);
```

```vb
CheckErrors(e.Site)
```

<span data-ttu-id="96c0a-p105">除了处理由 InfoPath 生成的错误以外，表单开发人员还可以通过使用 [ReportError(XPathNavigator, Boolean, String)](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlValidatingEventArgs.ReportError.aspx) 事件对象的 [XmlValidatingEventArgs](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlValidatingEventArgs.aspx) 方法，或者通过使用 [Add](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Add.aspx) 类的 [FormErrorCollection](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.aspx) 方法来生成自定义错误。有关使用 [ReportError(XPathNavigator, Boolean, String)](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlValidatingEventArgs.ReportError.aspx) 或 [Add](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Add.aspx) 方法的信息，请单击本主题开头这些方法的链接。</span><span class="sxs-lookup"><span data-stu-id="96c0a-p105">In addition to handling errors generated by InfoPath, form developers can also generate custom errors by using the [ReportError(XPathNavigator, Boolean, String)](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlValidatingEventArgs.ReportError.aspx) method of the [XmlValidatingEventArgs](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlValidatingEventArgs.aspx) event object, or by using the [Add](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Add.aspx) method of the [FormErrorCollection](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.aspx) class. For information about using the [ReportError(XPathNavigator, Boolean, String)](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlValidatingEventArgs.ReportError.aspx) or [Add](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.FormErrorCollection.Add.aspx) methods, click the links for those methods at the beginning of this topic.</span></span> 
  
## <a name="handling-managed-code-exceptions"></a><span data-ttu-id="96c0a-152">处理托管代码异常</span><span class="sxs-lookup"><span data-stu-id="96c0a-152">Handling Managed-Code Exceptions</span></span>

<span data-ttu-id="96c0a-153">可以使用 try-catch 异常处理方法来处理在托管代码表单模板中引发的异常，如以下代码示例所示。</span><span class="sxs-lookup"><span data-stu-id="96c0a-153">You can use try-catch exception handling to handle exceptions raised in managed-code form template as shown in the following code example.</span></span>
  
```cs
FileQueryConnection queryXMLFile = 
   (FileQueryConnection)this.DataConnections["form1"];
// Perform the query.
try
{
   queryXMLFile.Execute();
}
catch (Exception ex)
{
   MessageBox.Show("Failed to query." + System.Environment.NewLine 
      + ex.Message);
}
```

```vb
Dim queryXMLFile As FileQueryConnection = _
   DirectCast(Me.DataConnections("form1"), FileQueryConnection)
' Perform the query.
Try
   queryXMLFile.Execute();
Catch ex As Exception
   MessageBox.Show("Failed to query." &amp; System.Environment.NewLine 
      &amp; ex.Message)
End Try
```

<span data-ttu-id="96c0a-p106">如果在表单代码中不使用 try-catch 异常处理方法，则在调试和预览过程中，InfoPath 将在 InfoPath 错误对话框中显示有关未处理的异常的信息。此外，默认情况下，当您部署托管代码表单模板时，未处理的异常不会在运行时显示在 InfoPath 错误对话框中。要在运行时显示有关未处理的异常的信息，请执行以下过程。</span><span class="sxs-lookup"><span data-stu-id="96c0a-p106">If you do not use try-catch exception handling in your form code, InfoPath will display information about unhandled exceptions in the InfoPath error dialog box while debugging and previewing. Additionally, by default, unhandled exceptions are not displayed in the InfoPath error dialog box at run time when you deploy your managed-code form template. To display information about unhandled exceptions at run time, use the following procedure.</span></span>
  
### <a name="enable-notifications-for-unhandled-managed-code-exceptions-at-run-time"></a><span data-ttu-id="96c0a-157">在运行时针对未处理的托管代码异常启用通知</span><span class="sxs-lookup"><span data-stu-id="96c0a-157">Enable notifications for unhandled managed-code exceptions at run time</span></span>

1. <span data-ttu-id="96c0a-158">打开 InfoPath Designer，然后单击“文件”选项卡。</span><span class="sxs-lookup"><span data-stu-id="96c0a-158">Open the InfoPath designer, and then click the **File** tab.</span></span> 
    
2. <span data-ttu-id="96c0a-159">单击“选项”，然后单击“常规”类别下的“InfoPath 选项”。</span><span class="sxs-lookup"><span data-stu-id="96c0a-159">Click **Options**, and then click **InfoPath Options** under the **General** category.</span></span> 
    
3. <span data-ttu-id="96c0a-160">在“高级”选项卡上，选中“显示 Visual Basic 和 C# 代码错误的通知”复选框。</span><span class="sxs-lookup"><span data-stu-id="96c0a-160">On the **Advanced** tab, select the **Show a notification for Visual Basic and C# code errors** check box.</span></span> 
    

