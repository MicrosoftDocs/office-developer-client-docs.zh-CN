---
title: 关于具有代码的表单模板的安全模型
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
keywords:
- infopath 2007, security,code access security [InfoPath 2007],security [InfoPath 2007], security model for managed code,security [InfoPath 2007], levels,CAS [InfoPath 2007],InfoPath 2003-compatible form templates, security,permissions [InfoPath 2007]
localization_priority: Normal
ms.assetid: 5e1c1c72-f98d-4871-9c57-82c315277aa1
description: InfoPath 托管代码表单模板与非托管表单模板中运行的脚本支持相同的安全级别，它们还支持适用于 .NET Framework 公共语言运行库 (CLR) 下运行的托管代码的其他代码访问安全功能。
ms.openlocfilehash: 97f0239a5bd6699b539ddaebf4d1d2ed7d1394db
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "32303764"
---
# <a name="about-the-security-model-for-form-templates-with-code"></a><span data-ttu-id="c16ab-104">关于具有代码的表单模板的安全模型</span><span class="sxs-lookup"><span data-stu-id="c16ab-104">About the Security Model for Form Templates with Code</span></span>

<span data-ttu-id="c16ab-105">InfoPath 托管代码表单模板与非托管表单模板中运行的脚本支持相同的安全级别，它们还支持适用于 .NET Framework 公共语言运行库 (CLR) 下运行的托管代码的其他代码访问安全功能。</span><span class="sxs-lookup"><span data-stu-id="c16ab-105">InfoPath managed code form templates support the same security levels as script running in unmanaged form templates, and they also support additional code access security features that apply to managed code running under the common language runtime (CLR) of the .NET Framework.</span></span>
  
## <a name="infopath-managed-object-model-security-levels"></a><span data-ttu-id="c16ab-106">InfoPath 托管对象模型安全级别</span><span class="sxs-lookup"><span data-stu-id="c16ab-106">InfoPath Managed Object Model Security Levels</span></span>

<span data-ttu-id="c16ab-107">下表说明脚本对象模型成员的安全级别与在托管代码表单模板中使用对象模型成员时每个级别所需的相应权限集之间的关系。</span><span class="sxs-lookup"><span data-stu-id="c16ab-107">The following table describes the relationship between the security levels for script object model members and the corresponding permission set that is demanded for each level when the object model member is used in a managed code form template.</span></span>
  
|<span data-ttu-id="c16ab-108">**对象模型安全级别**</span><span class="sxs-lookup"><span data-stu-id="c16ab-108">**Object Model Security Level**</span></span>|<span data-ttu-id="c16ab-109">**说明**</span><span class="sxs-lookup"><span data-stu-id="c16ab-109">**Description**</span></span>|<span data-ttu-id="c16ab-110">**所需的权限集**</span><span class="sxs-lookup"><span data-stu-id="c16ab-110">**Permission Set Demanded**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="c16ab-111">0</span><span class="sxs-lookup"><span data-stu-id="c16ab-111">0</span></span>  <br/> |<span data-ttu-id="c16ab-112">可以无限制访问。</span><span class="sxs-lookup"><span data-stu-id="c16ab-112">Can be accessed without restrictions.</span></span>  <br/> |<span data-ttu-id="c16ab-113">无</span><span class="sxs-lookup"><span data-stu-id="c16ab-113">None</span></span>  <br/> |
|<span data-ttu-id="c16ab-114">双面</span><span class="sxs-lookup"><span data-stu-id="c16ab-114">2</span></span>  <br/> |<span data-ttu-id="c16ab-115">只能由与当前打开的表单运行在相同域中的表单或者已被授予跨域权限的表单访问。</span><span class="sxs-lookup"><span data-stu-id="c16ab-115">Can be accessed only by forms running in the same domain as the currently open form, or by forms that have been granted cross-domain permissions.</span></span>  <br/> |<span data-ttu-id="c16ab-116">无</span><span class="sxs-lookup"><span data-stu-id="c16ab-116">None</span></span>  <br/> |
|<span data-ttu-id="c16ab-117">第三章</span><span class="sxs-lookup"><span data-stu-id="c16ab-117">3</span></span>  <br/> |<span data-ttu-id="c16ab-118">只能由完全受信任的表单访问。</span><span class="sxs-lookup"><span data-stu-id="c16ab-118">Can be accessed only by fully trusted forms.</span></span>  <br/> |<span data-ttu-id="c16ab-119">FullTrust</span><span class="sxs-lookup"><span data-stu-id="c16ab-119">FullTrust</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="c16ab-120">安全级别"1"未由当前 InfoPath COM 服务器使用，而是保留以供将来使用。</span><span class="sxs-lookup"><span data-stu-id="c16ab-120">The security level "1" is not used by the current InfoPath COM server and is reserved for future use.</span></span> 
  
> [!IMPORTANT]
> <span data-ttu-id="c16ab-121">虽然对象模型级别 0 和 2 不需要任何权限集，但由于它们包含托管代码，它们的行为将与为 Domain 域访问安全级别（下一节对此进行了说明）定义的行为相同。</span><span class="sxs-lookup"><span data-stu-id="c16ab-121">Even though object model levels 0 and 2 do not demand any permission set, because they contain managed code, they behave as defined for the Domain domain access security level that is described in the following section.</span></span> 
  
<span data-ttu-id="c16ab-122">由 Microsoft.Office.InfoPath 和 Microsoft.Office.Interop.InfoPath.SemiTrust 程序集公开的每个对象模型成员的安全级别，在介绍 [Microsoft.Office.InfoPath](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.aspx) 和 [Microsoft.Office.Interop.InfoPath.SemiTrust](https://msdn.microsoft.com/library/Microsoft.Office.Interop.InfoPath.SemiTrust.aspx) 命名空间中该成员的主题的"备注"一节指定。</span><span class="sxs-lookup"><span data-stu-id="c16ab-122">The security level of each object model member exposed by the Microsoft.Office.InfoPath and Microsoft.Office.Interop.InfoPath.SemiTrust assemblies is specified in the Remarks section of the topic that documents that member in the [Microsoft.Office.InfoPath](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.aspx) and [Microsoft.Office.Interop.InfoPath.SemiTrust](https://msdn.microsoft.com/library/Microsoft.Office.Interop.InfoPath.SemiTrust.aspx) namespaces.</span></span> 
  
## <a name="infopath-domain-access-security-levels"></a><span data-ttu-id="c16ab-123">InfoPath 域访问安全级别</span><span class="sxs-lookup"><span data-stu-id="c16ab-123">InfoPath Domain Access Security Levels</span></span>

<span data-ttu-id="c16ab-p101">连同由 InfoPath 应用程序公开的 COM 服务器强制执行的对象模型安全级别，InfoPath 定义了三个安全级别，其应用情况取决于表单模板的位置、表单的部署方式以及设计模式中配置的设置。下表对这三个安全级别进行了定义。</span><span class="sxs-lookup"><span data-stu-id="c16ab-p101">In conjunction with the object model security levels that are enforced by the COM server exposed by the InfoPath application, InfoPath defines three security levels that are applied depending on where the form template is located, how the form is deployed, and settings configured in design mode. These three security levels are defined in the following table.</span></span>
  
|<span data-ttu-id="c16ab-126">**域访问安全级别**</span><span class="sxs-lookup"><span data-stu-id="c16ab-126">**Domain Access Security Level**</span></span>|<span data-ttu-id="c16ab-127">**说明**</span><span class="sxs-lookup"><span data-stu-id="c16ab-127">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="c16ab-128">受限</span><span class="sxs-lookup"><span data-stu-id="c16ab-128">Restricted</span></span>  <br/> |<span data-ttu-id="c16ab-129">不允许在表单模板外进行任何通信。</span><span class="sxs-lookup"><span data-stu-id="c16ab-129">Does not permit any communication outside of the form template.</span></span> <span data-ttu-id="c16ab-130">此安全级别旨在防止有害的表单将任何数据从计算机传输到恶意攻击者。</span><span class="sxs-lookup"><span data-stu-id="c16ab-130">This security level is intended to prevent harmful forms from transmitting any data from your computer to a malicious attacker.</span></span> <span data-ttu-id="c16ab-131">在此安全模式下运行时，下列功能将无法工作：自定义任务窗格、数据连接（电子邮件提交除外）、ActiveX 控件、托管代码表单代码、角色和工作流。</span><span class="sxs-lookup"><span data-stu-id="c16ab-131">When running in this security mode, the following features will not work: Custom Task Pane, Data Connections (except email submit), ActiveX controls, managed code form code, Roles, and Workflow.</span></span> <span data-ttu-id="c16ab-132">无法在受限制的域中运行托管代码表单模板。</span><span class="sxs-lookup"><span data-stu-id="c16ab-132">Managed code form templates cannot run in the Restricted domain.</span></span> <span data-ttu-id="c16ab-133">将托管代码表单模板设置为“表单选项”\*\*\*\* 对话框的“安全和信任”\*\*\*\* 类别中的“自动确定安全级别”\*\*\*\* 时，表单模板将始终需要至少域安全访问级别才能运行代码。</span><span class="sxs-lookup"><span data-stu-id="c16ab-133">When a managed code form template is set to the **Automatically determine security level** setting in the **Security and Trust** category of the **Form Options** dialog box, the form template will always require at least the Domain security access level to run code.</span></span>  <br/><br/><span data-ttu-id="c16ab-134">**重要说明**：从受限制的域打开表单时（例如从作为电子邮件附件发送的 InfoPath 表单打开），为托管代码表单模板创建的托管代码程序集将不会加载或运行。</span><span class="sxs-lookup"><span data-stu-id="c16ab-134">**IMPORTANT**: The managed code assembly created for a managed code form template will not load and run when a form is opened from a Restricted domain, for example, from an InfoPath form sent as an email attachment.</span></span> <span data-ttu-id="c16ab-135">想要以电子邮件附件形式部署任何表单模板则必须省略以上列出的功能，且如果表单模板包含表单代码，则必须在 JScript 或 VBScript 中执行表单代码并且必须只使用安全级别为 0（零）的对象模型成员。</span><span class="sxs-lookup"><span data-stu-id="c16ab-135">Any form template you wish to deploy as an email attachment must omit the features listed above, and if the form template contains form code, form code must be implemented in JScript or VBScript, and must only utilize object model members with a security level of 0 (zero).</span></span>           |
|<span data-ttu-id="c16ab-136">域</span><span class="sxs-lookup"><span data-stu-id="c16ab-136">Domain</span></span>  <br/> |<span data-ttu-id="c16ab-p104">根据表单在由 Microsoft Internet Explorer 定义的其中某个安全区域的位置来限制表单。例如，如果表单位于"本地 Intranet"区域，则允许表单与它所在域中的其他数据进行通信，但不允许从其他域中检索数据。Microsoft Internet Explorer 安全区域中的位置还将决定是否允许运行对脚本标记为不安全的 ActiveX 控件。</span><span class="sxs-lookup"><span data-stu-id="c16ab-p104">Restricts a form based on its location in one of the security zones defined by Microsoft Internet Explorer. For example, if the form is located in the Local Intranet zone, it is allowed to communicate with other data inside its own domain but it is not permitted to retrieve data from other domains. The location in a Microsoft Internet Explorer security zone also determines whether ActiveX controls that are marked as unsafe for scripting will be allowed to run.</span></span>  <br/> |
|<span data-ttu-id="c16ab-140">完全信任</span><span class="sxs-lookup"><span data-stu-id="c16ab-140">Full Trust</span></span>  <br/> |<span data-ttu-id="c16ab-p105">允许在将要使用表单的计算机上以完全信任方式运行表单。仅当对所用表单进行数字签名的签名与计算机上受信任的根发布者匹配时，或当创建的安装程序安装表单并在表单定义文件 (.xsf) 中将 **xDocumentClass** 元素的 **requireFullTrust** 属性设置为"yes"时，才能使用此安全级别。通过使用此设置，您的表单可以访问需要对象模型安全级别 3 的对象模型调用，例如，访问文件系统的属性和方法，您可以禁用在更严格的安全级别运行时出现的某些安全提示。  </span><span class="sxs-lookup"><span data-stu-id="c16ab-p105">Allows you to run a form with full trust on the computer where the form will be used. This security level can only be used when working with a form that is digitally signed with a signature that matches a trusted root publisher on your computer, or by creating an installation program that installs the form and sets the **requireFullTrust** attribute of the **xDocumentClass** element to "yes" in the form definition file (.xsf). By using this setting, your form can access object model calls that require object model security level 3, such as properties and methods that access the file system, and you can disable certain security prompts that appear when running at a more restrictive security level.  </span></span><br/> |
   
<span data-ttu-id="c16ab-144">默认情况下，InfoPath 表单配置为自动选择"受限"安全级别或"域"安全级别，具体取决于在表单模板中使用的功能以及表单模板的部署位置和部署方式。</span><span class="sxs-lookup"><span data-stu-id="c16ab-144">By default, an InfoPath form is configured to select automatically either the Restricted or Domain security level depending on the features that are being used in the form template, and where and how the form template is deployed.</span></span> <span data-ttu-id="c16ab-145">例如，以电子邮件附件形式部署的表单模板将自动配置为“受限”安全级别。</span><span class="sxs-lookup"><span data-stu-id="c16ab-145">For example, a form template deployed as an email attachment is automatically configured to the Restricted security level.</span></span> <span data-ttu-id="c16ab-146">安全设置始终是尽量严格（从"受限"开始），以确保对您和您的数据提供更高级别的保护。</span><span class="sxs-lookup"><span data-stu-id="c16ab-146">The security setting is always as restrictive as possible, starting at Restricted, to ensure a greater level of protection for you and your data.</span></span> <span data-ttu-id="c16ab-147">将包含托管代码的表单模板设置为自动选择安全级别时，该表单模板将始终至少需要"域"安全访问级别才能运行代码。</span><span class="sxs-lookup"><span data-stu-id="c16ab-147">When a form template that contains managed code is set to automatically select the security level, the form template will always require at least the Domain security access level before code can run.</span></span> <span data-ttu-id="c16ab-148">您可以使用以下过程在设计时手动覆盖此设置，以选择更适合该表单的安全级别。</span><span class="sxs-lookup"><span data-stu-id="c16ab-148">You can manually override this setting at design time to select a level of security that is more appropriate for the form by using the following procedure.</span></span> 
  
### <a name="specify-a-forms-security-level"></a><span data-ttu-id="c16ab-149">指定表单的安全级别</span><span class="sxs-lookup"><span data-stu-id="c16ab-149">Specify a form's security level</span></span>

1. <span data-ttu-id="c16ab-150">在 InfoPath 表单设计器中打开表单，依次单击“文件”\*\*\*\* 选项卡、“信息”\*\*\*\* 和“表单选项”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="c16ab-150">Open the form in the InfoPath form designer, click the **File** tab, click **Info**, and then click **Form Options**.</span></span>
    
2. <span data-ttu-id="c16ab-151">在“表单选项”\*\*\*\* 对话框中单击“安全和信任”\*\*\*\* 类别。</span><span class="sxs-lookup"><span data-stu-id="c16ab-151">In the **Form Options** dialog box, click the **Security and Trust** category.</span></span> 
    
3. <span data-ttu-id="c16ab-152">清除“自动确定安全级别(推荐)”\*\*\*\* 复选框。</span><span class="sxs-lookup"><span data-stu-id="c16ab-152">Clear the **Automatically determine security level (recommended)** check box.</span></span> 
    
4. <span data-ttu-id="c16ab-153">选择需要的安全级别。</span><span class="sxs-lookup"><span data-stu-id="c16ab-153">Select the desired security level.</span></span>
    
> [!NOTE] 
> - <span data-ttu-id="c16ab-154">如果为托管代码表单模板选择“受限”\*\*\*\* 安全级别，则无论表单代码中使用了哪些对象模型成员，都不会加载和运行表单背后的代码。</span><span class="sxs-lookup"><span data-stu-id="c16ab-154">If you the select the **Restricted** security level for a managed code form template, the code behind the form will not load and run regardless of which object model members are used in the form code.</span></span> <span data-ttu-id="c16ab-155">此安全级别主要针对使用电子邮件部署的 InfoPath 表单而设计。</span><span class="sxs-lookup"><span data-stu-id="c16ab-155">This security level is primarily designed for InfoPath forms that are deployed using email.</span></span>     
> - <span data-ttu-id="c16ab-156">如果选择“完全信任”\*\*\*\* 安全级别，则需要对表单进行数字签名或安装并注册表单。</span><span class="sxs-lookup"><span data-stu-id="c16ab-156">If you select the **Full Trust** security level, you need to digitally sign or install and register the form.</span></span> <span data-ttu-id="c16ab-157">有关详细信息，请参阅[部署具有代码的 InfoPath 表单模板](how-to-deploy-infopath-form-templates-with-code.md)。</span><span class="sxs-lookup"><span data-stu-id="c16ab-157">For more information, see [Deploy InfoPath Form Templates with Code](how-to-deploy-infopath-form-templates-with-code.md).</span></span>
    
<span data-ttu-id="c16ab-p109">下表总结了 InfoPath 安全模型。第一列列出为表单指定的级别或表单所需的级别。第二列和第三列指定表单的位置是具有 URN 还是 URL 标识符。剩余的列指定允许运行的内容。有关托管代码表单模板的部署方案和权限集的详细信息，请参阅本主题后面的"公共语言运行库代码访问安全功能"一节。</span><span class="sxs-lookup"><span data-stu-id="c16ab-p109">The following table summarizes the InfoPath security model. The first column lists the level specified for or required by the form. The second and third columns specify whether the form has a URN or URL identifier for its location. The remaining columns specify what is allowed to run. For more information on deployment scenarios and permission sets for managed code form templates, see the "Common Language Runtime Code Access Security Features" section later in this topic.</span></span>
  
|<span data-ttu-id="c16ab-163">**表单所需的级别**</span><span class="sxs-lookup"><span data-stu-id="c16ab-163">**Level Required by form**</span></span>|<span data-ttu-id="c16ab-164">**具有 URN 标识符**</span><span class="sxs-lookup"><span data-stu-id="c16ab-164">**Has URN Identifier**</span></span>|<span data-ttu-id="c16ab-165">**具有 URL 标识符**</span><span class="sxs-lookup"><span data-stu-id="c16ab-165">**Has URL Identifier**</span></span>|<span data-ttu-id="c16ab-166">**对脚本标记为不安全的 ActiveX**</span><span class="sxs-lookup"><span data-stu-id="c16ab-166">**ActiveX marked unsafe for scripting**</span></span>|<span data-ttu-id="c16ab-167">**跨域访问**</span><span class="sxs-lookup"><span data-stu-id="c16ab-167">**Cross-Domain Access**</span></span>|<span data-ttu-id="c16ab-168">**托管代码**</span><span class="sxs-lookup"><span data-stu-id="c16ab-168">**Managed code**</span></span>|<span data-ttu-id="c16ab-169">**对象模型安全**</span><span class="sxs-lookup"><span data-stu-id="c16ab-169">**Object Model Security**</span></span>|
|:-----|:-----|:-----|:-----|:-----|:-----|:-----|
|<span data-ttu-id="c16ab-170">受限</span><span class="sxs-lookup"><span data-stu-id="c16ab-170">Restricted</span></span>  <br/> ||<span data-ttu-id="c16ab-171">X</span><span class="sxs-lookup"><span data-stu-id="c16ab-171">X</span></span>  <br/> |<span data-ttu-id="c16ab-172">根本没有 ActiveX</span><span class="sxs-lookup"><span data-stu-id="c16ab-172">No ActiveX at all</span></span>  <br/> |<span data-ttu-id="c16ab-173">失败</span><span class="sxs-lookup"><span data-stu-id="c16ab-173">Fail</span></span>  <br/> |<span data-ttu-id="c16ab-174">加载表单，但不运行托管代码</span><span class="sxs-lookup"><span data-stu-id="c16ab-174">Form loads, but managed code won't run</span></span>  <br/> |<span data-ttu-id="c16ab-175">0</span><span class="sxs-lookup"><span data-stu-id="c16ab-175">0</span></span>  <br/> |
|<span data-ttu-id="c16ab-176">域（Internet Explorer **受限制的站点**区域）</span><span class="sxs-lookup"><span data-stu-id="c16ab-176">Domain (Internet Explorer **Restricted sites** zone)</span></span>  <br/> |<span data-ttu-id="c16ab-177">根本不运行</span><span class="sxs-lookup"><span data-stu-id="c16ab-177">Won't run at all</span></span>  <br/> |<span data-ttu-id="c16ab-178">根本不运行</span><span class="sxs-lookup"><span data-stu-id="c16ab-178">Won't run at all</span></span>  <br/> |<span data-ttu-id="c16ab-179">根本不运行</span><span class="sxs-lookup"><span data-stu-id="c16ab-179">Won't run at all</span></span>  <br/> |<span data-ttu-id="c16ab-180">根本不运行</span><span class="sxs-lookup"><span data-stu-id="c16ab-180">Won't run at all</span></span>  <br/> |<span data-ttu-id="c16ab-181">根本不运行</span><span class="sxs-lookup"><span data-stu-id="c16ab-181">Won't run at all</span></span>  <br/> |<span data-ttu-id="c16ab-182">根本不运行</span><span class="sxs-lookup"><span data-stu-id="c16ab-182">Won't run at all</span></span>  <br/> |
|<span data-ttu-id="c16ab-183">域（Internet Explorer **Internet** 区域）</span><span class="sxs-lookup"><span data-stu-id="c16ab-183">Domain (Internet Explorer **Internet** zone)</span></span>  <br/> |<span data-ttu-id="c16ab-184">X</span><span class="sxs-lookup"><span data-stu-id="c16ab-184">X</span></span>  <br/> ||<span data-ttu-id="c16ab-185">失败</span><span class="sxs-lookup"><span data-stu-id="c16ab-185">Fail</span></span>  <br/> |<span data-ttu-id="c16ab-186">失败</span><span class="sxs-lookup"><span data-stu-id="c16ab-186">Fail</span></span>  <br/> |<span data-ttu-id="c16ab-187">根本不运行</span><span class="sxs-lookup"><span data-stu-id="c16ab-187">Won't run at all</span></span>  <br/> |<span data-ttu-id="c16ab-188">0</span><span class="sxs-lookup"><span data-stu-id="c16ab-188">0</span></span>  <br/> |
|<span data-ttu-id="c16ab-189">域（Internet Explorer **本地 Intranet** 区域）</span><span class="sxs-lookup"><span data-stu-id="c16ab-189">Domain (Internet Explorer **Local intranet** zone)</span></span>  <br/> |<span data-ttu-id="c16ab-190">X</span><span class="sxs-lookup"><span data-stu-id="c16ab-190">X</span></span>  <br/> ||<span data-ttu-id="c16ab-191">失败</span><span class="sxs-lookup"><span data-stu-id="c16ab-191">Fail</span></span>  <br/> |<span data-ttu-id="c16ab-192">Prompt</span><span class="sxs-lookup"><span data-stu-id="c16ab-192">Prompt</span></span>  <br/> |<span data-ttu-id="c16ab-193">托管代码使用**本地 Intranet** 权限运行。</span><span class="sxs-lookup"><span data-stu-id="c16ab-193">Managed code runs with **Local intranet** permissions.</span></span>  <br/> |<span data-ttu-id="c16ab-194">双面</span><span class="sxs-lookup"><span data-stu-id="c16ab-194">2</span></span>  <br/> |
|<span data-ttu-id="c16ab-195">域（Internet Explorer **受信任的站点**区域）</span><span class="sxs-lookup"><span data-stu-id="c16ab-195">Domain (Internet Explorer **Trusted sites** zone)</span></span>  <br/> |<span data-ttu-id="c16ab-196">X</span><span class="sxs-lookup"><span data-stu-id="c16ab-196">X</span></span>  <br/> ||<span data-ttu-id="c16ab-197">提示</span><span class="sxs-lookup"><span data-stu-id="c16ab-197">Prompt</span></span>  <br/> |<span data-ttu-id="c16ab-198">确定</span><span class="sxs-lookup"><span data-stu-id="c16ab-198">OK</span></span>  <br/> |<span data-ttu-id="c16ab-p110">Managed code runs with **Internet** permissions. Cross-domain access is allowed. Note that even though the form is in the **Trusted sites** zone, **Internet** zone permissions are applied.  </span><span class="sxs-lookup"><span data-stu-id="c16ab-p110">Managed code runs with **Internet** permissions. Cross-domain access is allowed. Note that even though the form is in the **Trusted sites** zone, **Internet** zone permissions are applied.  </span></span><br/> |<span data-ttu-id="c16ab-202">双面</span><span class="sxs-lookup"><span data-stu-id="c16ab-202">2</span></span>  <br/> |
|<span data-ttu-id="c16ab-203">域（Internet Explorer **本地计算机**区域）</span><span class="sxs-lookup"><span data-stu-id="c16ab-203">Domain (Internet Explorer **Local computer** zone)</span></span>  <br/> |<span data-ttu-id="c16ab-204">X</span><span class="sxs-lookup"><span data-stu-id="c16ab-204">X</span></span>  <br/> |<span data-ttu-id="c16ab-205">X</span><span class="sxs-lookup"><span data-stu-id="c16ab-205">X</span></span>  <br/> |<span data-ttu-id="c16ab-206">提示</span><span class="sxs-lookup"><span data-stu-id="c16ab-206">Prompt</span></span>  <br/> |<span data-ttu-id="c16ab-207">失败</span><span class="sxs-lookup"><span data-stu-id="c16ab-207">Fail</span></span>  <br/> |<span data-ttu-id="c16ab-208">托管代码使用**本地 Intranet** 权限运行。</span><span class="sxs-lookup"><span data-stu-id="c16ab-208">Managed code runs with **Local intranet** permissions.</span></span>  <br/> |<span data-ttu-id="c16ab-209">双面</span><span class="sxs-lookup"><span data-stu-id="c16ab-209">2</span></span>  <br/> |
|<span data-ttu-id="c16ab-210">完全信任</span><span class="sxs-lookup"><span data-stu-id="c16ab-210">Full Trust</span></span>  <br/> |<span data-ttu-id="c16ab-211">X</span><span class="sxs-lookup"><span data-stu-id="c16ab-211">X</span></span>  <br/> |<span data-ttu-id="c16ab-212">X</span><span class="sxs-lookup"><span data-stu-id="c16ab-212">X</span></span>  <br/> |<span data-ttu-id="c16ab-213">确定</span><span class="sxs-lookup"><span data-stu-id="c16ab-213">OK</span></span>  <br/> |<span data-ttu-id="c16ab-214">确定</span><span class="sxs-lookup"><span data-stu-id="c16ab-214">OK</span></span>  <br/> |<span data-ttu-id="c16ab-215">完全信任</span><span class="sxs-lookup"><span data-stu-id="c16ab-215">Full Trust</span></span>  <br/> |<span data-ttu-id="c16ab-216">第三章</span><span class="sxs-lookup"><span data-stu-id="c16ab-216">3</span></span>  <br/> |
   
> [!IMPORTANT]
> <span data-ttu-id="c16ab-p111">The descriptions above in the "ActiveX marked unsafe for scripting" and "Cross-Domain Access" columns assume the default security settings for Microsoft Internet Explorer. If a user changes their security settings, InfoPath will behave accordingly. For example, if in the **Local intranet** zone, **Access data sources across domains** is set to **Enable**, then users will not be prompted to allow cross-domain access as described in the table.</span><span class="sxs-lookup"><span data-stu-id="c16ab-p111">The descriptions above in the "ActiveX marked unsafe for scripting" and "Cross-Domain Access" columns assume the default security settings for Microsoft Internet Explorer. If a user changes their security settings, InfoPath will behave accordingly. For example, if in the **Local intranet** zone, **Access data sources across domains** is set to **Enable**, then users will not be prompted to allow cross-domain access as described in the table.</span></span> 
  
## <a name="common-language-runtime-code-access-security-features"></a><span data-ttu-id="c16ab-220">公共语言运行库代码访问安全功能</span><span class="sxs-lookup"><span data-stu-id="c16ab-220">Common Language Runtime Code Access Security Features</span></span>

<span data-ttu-id="c16ab-221">编译 InfoPath 托管代码表单模板时，将创建一个包含表单代码逻辑实现的专用托管代码程序集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-221">When an InfoPath managed code form template is compiled, a private managed code assembly is created that contains the implementation of the form code logic.</span></span>
  
<span data-ttu-id="c16ab-p112">在 .NET Framework 中，默认情况下，托管代码程序集在本地计算机上运行时具有"完全信任"权限，而在 Intranet 上运行时不被授予"完全信任"权限。为提供对安全策略更加细化的控制，并提供在 Intranet 中将 InfoPath 托管代码表单模板作为完全受信的表单运行的选项，InfoPath 实现了以下安全体系结构。</span><span class="sxs-lookup"><span data-stu-id="c16ab-p112">In the .NET Framework, by default, a managed code assembly has Full Trust permissions when running on the local machine, and is not granted Full Trust permissions when running on the Intranet. To provide more fine-grained control over security policy, and to provide the option to run InfoPath managed code form templates as fully trusted forms from the Intranet, InfoPath implements the following security architecture.</span></span>
  
- <span data-ttu-id="c16ab-224">InfoPath 应用程序承载 .NET Framework 公共语言运行库 (CLR)。</span><span class="sxs-lookup"><span data-stu-id="c16ab-224">The InfoPath application hosts the .NET Framework common language runtime (CLR).</span></span>
    
- <span data-ttu-id="c16ab-225">在由 InfoPath 承载的 CLR 内，每个托管代码表单模板都在单独的应用程序域中运行。应用程序域是一种为执行托管代码提供隔离、卸载和安全范围的环境。</span><span class="sxs-lookup"><span data-stu-id="c16ab-225">Within the CLR hosted by InfoPath, each managed code form template runs in a separate application domain, which is an environment that provides isolation, unloading, and security boundaries for executing managed code.</span></span>
    
- <span data-ttu-id="c16ab-226">InfoPath 根据与表单模板及其位置的 URL 关联的信任级别来设置应用程序域的默认安全策略。</span><span class="sxs-lookup"><span data-stu-id="c16ab-226">InfoPath sets a default security policy on the application domain depending on the level of trust associated with the form template and the URL of its location.</span></span>
    
- <span data-ttu-id="c16ab-p113">默认情况下，在本地计算机（"我的计算机区域"代码组）上运行的托管代码表单模板将获得低于"完全信任"（"本地 Intranet 区域"权限）的权限级别。要获得"完全信任"权限，必须注册表单或使用受信任的证书为其进行数字签名。</span><span class="sxs-lookup"><span data-stu-id="c16ab-p113">By default, a managed code form template running on the local computer (the My Computer Zone code group) gets a lower level of permissions than Full Trust (Local Intranet Zone permissions). To have Full Trust permissions, the form must be registered or digitally signed with a trusted certificate.</span></span>
    
<span data-ttu-id="c16ab-p114">托管代码表单模板所在的应用程序域的默认安全策略集可确保强制执行 InfoPath 域访问安全级别以及任何其他 .NET 安全限制。若要提供更多灵活性，InfoPath 安全系统可识别名为"InfoPath 表单模板"的 .NET 代码访问安全代码组。如果此代码组存在于用户的计算机上，则该组的安全配置以及其所有子代码组的安全配置都将应用于应用程序域。</span><span class="sxs-lookup"><span data-stu-id="c16ab-p114">The default security policy set for the application domain of a managed code form template ensures that the InfoPath domain access security levels as well as any additional .NET security restrictions are enforced. To provide additional flexibility, the InfoPath security system recognizes a .NET code access security code group named "InfoPath Form Templates". If this code group is present on a user's computer, its security configuration, and those of any child code groups within it will be applied to the application domain.</span></span>
  
> [!IMPORTANT] 
> - <span data-ttu-id="c16ab-p115">InfoPath 表单模板代码组仅适用于托管代码表单代码程序集本身。因此，如果您对 InfoPath 托管代码表单代码授予"完全信任"权限集，但未安装和注册（或数字签名）表单模板本身（安装和注册表单模板或对表单模板进行数字签名可将整个表单模板设置为完全受信），则表单代码中对安全级别为 3 的对象模型成员的调用仍将失败。</span><span class="sxs-lookup"><span data-stu-id="c16ab-p115">The InfoPath Form Templates code group applies only to the managed code form code assembly itself. As a result, if you grant the Full Trust permission set to InfoPath managed code form code, but you have not installed and registered (or digitally signed) the form template itself (which makes the entire form template fully trusted), calls in the form code to security level 3 object model members will still fail.</span></span>   
> - <span data-ttu-id="c16ab-234">即使您通过哈希、强名称或发布者证据引用或显式加载 (Assembly.Load) 使用受限权限集配置的程序集，以此来确定该程序集在表单模板项目中的成员资格条件，该表单模板仍将加载并执行该程序集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-234">If you reference or explicitly load (Assembly.Load) an assembly that is configured with a restricted permission set using Hash, Strong Name, or Publisher evidence to determine its membership condition in a form template project, the assembly will nonetheless be loaded and executed by the form template.</span></span>
    
<span data-ttu-id="c16ab-235">有关如何创建和配置 InfoPath 表单模板代码组的信息，请参阅[为具有代码的表单模板配置安全设置](how-to-configure-security-settings-for-form-templates-with-code.md)。</span><span class="sxs-lookup"><span data-stu-id="c16ab-235">For information on how to create and configure the InfoPath Form Templates code group, see [Configure Security Settings for Form Templates with Code](how-to-configure-security-settings-for-form-templates-with-code.md).</span></span>
  
<span data-ttu-id="c16ab-236">下表汇总了应用于托管代码表单模板的部署方案和权限集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-236">The following table summarizes the deployment scenarios and permission sets that apply to managed code form templates.</span></span>
  
|<span data-ttu-id="c16ab-237">**部署方案**</span><span class="sxs-lookup"><span data-stu-id="c16ab-237">**Deployment Scenario**</span></span>|<span data-ttu-id="c16ab-238">**权限集**</span><span class="sxs-lookup"><span data-stu-id="c16ab-238">**Permission Set**</span></span>|<span data-ttu-id="c16ab-239">**备注**</span><span class="sxs-lookup"><span data-stu-id="c16ab-239">**Notes**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="c16ab-240">表单模板在本地计算机上发布，开发人员使用 Visual Studio 编写和调试表单代码。</span><span class="sxs-lookup"><span data-stu-id="c16ab-240">The form template is published on the local computer, and the developer is using Visual Studio to write and debug form code.</span></span>  <br/> |<span data-ttu-id="c16ab-241">本地 Intranet 权限集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-241">Local Intranet permission set.</span></span>  <br/> <span data-ttu-id="c16ab-242">全局程序集缓存 (GAC) 中安装的程序集以及标记有 **AllowPartiallyTrustedCallersAttribute** 属性的程序集将被授予"完全信任"权限集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-242">Assemblies installed in the Global Assembly Cache (GAC) and marked with the **AllowPartiallyTrustedCallersAttribute** attribute are granted the Full Trust permission set.</span></span>  <br/> |<span data-ttu-id="c16ab-243">默认情况下，从本地计算机运行的表单模板未被授予完全信任权限集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-243">By default, form templates running from the local computer are not granted the Full Trust permission set.</span></span> <span data-ttu-id="c16ab-244">当要开发的表单模板使用需要“完全信任”权限的功能和对象模型成员调用时，可以使用[预览和调试需要完全信任的表单模板](how-to-preview-and-debug-form-templates-that-require-full-trust.md)中介绍的过程。</span><span class="sxs-lookup"><span data-stu-id="c16ab-244">While developing form templates that use features and calls to object model members that require Full Trust permissions, you can use the procedure described in [Preview and Debug Form Templates that Require Full Trust](how-to-preview-and-debug-form-templates-that-require-full-trust.md).</span></span>  <br/> |
|<span data-ttu-id="c16ab-245">表单模板在本地计算机上发布，并引用本地计算机上要求"完全信任"权限集的自定义程序集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-245">The form template is published on the local computer and references a custom assembly that requests the Full Trust permission set on the local computer.</span></span>  <br/> |<span data-ttu-id="c16ab-246">本地 Intranet 权限集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-246">Local Intranet permission set.</span></span>  <br/> <span data-ttu-id="c16ab-p117">全局程序集缓存 (GAC) 中安装的程序集以及标记有 **AllowPartiallyTrustedCallersAttribute** 属性的程序集将被授予"完全信任"权限集。自定义程序集将被授予"本地 Intranet"权限集。  </span><span class="sxs-lookup"><span data-stu-id="c16ab-p117">Assemblies installed in the Global Assembly Cache (GAC) and marked with the **AllowPartiallyTrustedCallersAttribute** attribute are granted the Full Trust permission set. The custom assembly is granted the Local Intranet permission set.  </span></span><br/> |<span data-ttu-id="c16ab-p118">若要引用要在表单模板代码中使用的外部程序集，开发人员必须使用 InfoPath 表单模板代码组将"完全信任"（或适当的权限集）权限集授予表单模板代码中引用的外部程序集。InfoPath 不会进行任何有关外部程序集（安装在全局程序集缓存 (GAC) 中的外部程序集除外）的假设。开发人员必须使用 InfoPath 表单模板代码组向该程序集显式授予必需的权限，即使在该程序集已通过 My_Computer_Zone 代码组授予的权限变为可信时也不例外。</span><span class="sxs-lookup"><span data-stu-id="c16ab-p118">To reference external assemblies for use in the form template's code, the developer must use the InfoPath Form Templates code group to grant Full Trust (or the appropriate permission set) to the external assembly referenced in the form template's code. InfoPath does not make any assumptions about external assemblies other than those installed in the Global Assembly Cache (GAC). The developer must explicitly grant the assembly the necessary permissions using the InfoPath Form Templates code group even if the assembly is already trusted though permissions granted in the My_Computer_Zone code group.</span></span>  <br/> |
|<span data-ttu-id="c16ab-252">表单模板在本地 Intranet 中的共享位置（例如，文件共享）、SharePoint 表单库或 Web 服务器上发布。</span><span class="sxs-lookup"><span data-stu-id="c16ab-252">The form template is published on a shared location in the local intranet, such as a file share, SharePoint Form library, or a Web server.</span></span>  <br/> |<span data-ttu-id="c16ab-253">本地 Intranet 权限集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-253">Local Intranet permission set.</span></span>  <br/> <span data-ttu-id="c16ab-254">全局程序集缓存 (GAC) 中安装的程序集以及标记有 **AllowPartiallyTrustedCallersAttribute** 属性的程序集将被授予"完全信任"权限集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-254">Assemblies installed in the Global Assembly Cache (GAC) and marked with the **AllowPartiallyTrustedCallersAttribute** attribute are granted the Full Trust permission set.</span></span>  <br/> ||
|<span data-ttu-id="c16ab-255">表单模板在本地 Intranet 中的共享位置（例如，文件共享）、SharePoint 表单库或指定为 Internet Explorer 中受信任站点的 Web 服务器上发布。</span><span class="sxs-lookup"><span data-stu-id="c16ab-255">The form template is published on a shared location in the local intranet, such as a file share, SharePoint Form library, or a Web server that is designated as a Trusted site in Internet Explorer.</span></span>  <br/> |<span data-ttu-id="c16ab-256">Internet 权限集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-256">Internet permission set.</span></span>  <br/> <span data-ttu-id="c16ab-257">经 Microsoft 和 ECMA 签名的程序集将被授予"完全信任"权限集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-257">Assemblies signed by Microsoft and ECMA are granted the Full Trust permission set.</span></span>  <br/> |<span data-ttu-id="c16ab-p119">CLR 代码访问安全性仅向 Internet Explorer 中指定为"受信任的站点"的网站授予"Internet"权限集。InfoPath 将遵守此策略。请注意，它与在表单代码中使用脚本的 InfoPath 表单模板不同，当在"受信任的站点"区域中发布时，后者将收到更高的权限级别。</span><span class="sxs-lookup"><span data-stu-id="c16ab-p119">CLR code access security grants only the Internet permission set to sites that are designated as Trusted sites in Internet Explorer. InfoPath respects this policy. Note that this is unlike an InfoPath form template that uses script for form code, which receives a higher level of permissions when published in a Trusted sites zone.</span></span>  <br/> |
|<span data-ttu-id="c16ab-261">表单模板从 Internet 位置下载或复制。</span><span class="sxs-lookup"><span data-stu-id="c16ab-261">The form template is downloaded or copied from an Internet location.</span></span>  <br/> |<span data-ttu-id="c16ab-p120">无（默认情况）。将不加载和运行表单模板的托管代码程序集。</span><span class="sxs-lookup"><span data-stu-id="c16ab-p120">By default, none. The managed code assembly for the form template is not loaded and does not run.</span></span>  <br/> ||
   
## <a name="see-also"></a><span data-ttu-id="c16ab-264">另请参阅</span><span class="sxs-lookup"><span data-stu-id="c16ab-264">See also</span></span>

- [<span data-ttu-id="c16ab-265">为包含代码的表单模板配置安全设置</span><span class="sxs-lookup"><span data-stu-id="c16ab-265">Configure Security Settings for Form Templates with Code</span></span>](how-to-configure-security-settings-for-form-templates-with-code.md)
- [<span data-ttu-id="c16ab-266">预览和调试需要完全信任的表单模板</span><span class="sxs-lookup"><span data-stu-id="c16ab-266">Preview and Debug Form Templates that Require Full Trust</span></span>](how-to-preview-and-debug-form-templates-that-require-full-trust.md)

