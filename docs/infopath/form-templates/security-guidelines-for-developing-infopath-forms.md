---
title: 开发 InfoPath 表单的安全指南
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
ms.assetid: 4690028e-20ac-297b-4651-801f5159c747
description: 阅读本主题之前，请先参阅 更多 InfoPath 表单安全性概念，以便对 InfoPath 安全模型有一个大概了解。
ms.openlocfilehash: 5108d8b1967b72ac4805f892bcf3bbae3aecccbe
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "33437810"
---
# <a name="security-guidelines-for-developing-infopath-forms"></a><span data-ttu-id="16d36-103">开发 InfoPath 表单的安全指南</span><span class="sxs-lookup"><span data-stu-id="16d36-103">Security Guidelines for Developing InfoPath Forms</span></span>

<span data-ttu-id="16d36-104">阅读本主题之前，请先参阅 [更多 InfoPath 表单安全性概念](additional-infopath-form-security-concepts.md)，以便对 InfoPath 安全模型有一个大概了解。</span><span class="sxs-lookup"><span data-stu-id="16d36-104">Before reading this topic, see [Additional InfoPath Form Security Concepts](additional-infopath-form-security-concepts.md) for a general understanding of the InfoPath security model.</span></span> 
  
## <a name="security-issues-for-users-of-infopath-forms"></a><span data-ttu-id="16d36-105">InfoPath 表单用户关注的安全问题</span><span class="sxs-lookup"><span data-stu-id="16d36-105">Security Issues for Users of InfoPath Forms</span></span>

<span data-ttu-id="16d36-p101">Microsoft InfoPath 用户所关注的主要安全问题与在 Internet Explorer 中运行的 Web 应用程序所面临的问题类似。但是应当注意，为表单提供的安全级别只取决于表单模板所在的位置，而与用户在何处存储或打开其创建的结果 XML 文档无关。用户可以通过查看 InfoPath 中的状态栏，判断正在使用的表单模板的位置。</span><span class="sxs-lookup"><span data-stu-id="16d36-p101">The primary security concerns for users of Microsoft InfoPath are similar to those for Web applications running in Internet Explorer. You should note, however, that the security level provided to a form depends only on where the form template is located and not on where users store or open the resulting XML documents they create. Users can determine the location of the form template they are working with by looking at the status bar in InfoPath.</span></span>
  
<span data-ttu-id="16d36-109">InfoPath 可帮助用户抵御由恶意编写的表单模板所引发的下列潜在威胁：</span><span class="sxs-lookup"><span data-stu-id="16d36-109">InfoPath helps protect users against the following potential threats posed by maliciously authored form templates:</span></span>
  
- <span data-ttu-id="16d36-110">可能泄露本地计算机或远程数据源中的敏感信息。</span><span class="sxs-lookup"><span data-stu-id="16d36-110">The potential for disclosure of sensitive information from the local computer or remote data sources.</span></span>
    
- <span data-ttu-id="16d36-111">恶意使用 ActiveX 控件。</span><span class="sxs-lookup"><span data-stu-id="16d36-111">The malicious use of ActiveX controls.</span></span>
    
- <span data-ttu-id="16d36-112">恶意使用 InfoPath 对象模型中的属性和方法。</span><span class="sxs-lookup"><span data-stu-id="16d36-112">The malicious use of properties and methods from the InfoPath object model.</span></span>
    
## <a name="disclosure-of-sensitive-information"></a><span data-ttu-id="16d36-113">泄露敏感信息</span><span class="sxs-lookup"><span data-stu-id="16d36-113">Disclosure of Sensitive Information</span></span>

<span data-ttu-id="16d36-114">如果某个恶意表单编写者创建了一个表单，该表单利用当前用户的安全凭据访问某个域上的数据源，而该域并非部署该表单所在的域，这时，就会发生最为常见的敏感信息泄露情况。</span><span class="sxs-lookup"><span data-stu-id="16d36-114">The most common scenario for the disclosure of sensitive information can occur if a malicious form author creates a form that uses the current user's security credentials to access a data source on a domain other than the one on which the form itself was deployed.</span></span> <span data-ttu-id="16d36-115">例如，一个恶意用户可能通过电子邮件或使用 URL（指向私人共享或 Web 服务器上的表单）发送一个表单。</span><span class="sxs-lookup"><span data-stu-id="16d36-115">For example, a malicious user could send a form by email message or by using a URL to a form on a private share or Web server.</span></span> <span data-ttu-id="16d36-116">该表单中可能含有脚本，该脚本利用当前用户的凭据执行数据访问请求，从该恶意用户原本无权访问的另一个域中的数据源（例如薪资或其他敏感信息的数据库）中检索数据。</span><span class="sxs-lookup"><span data-stu-id="16d36-116">The form could contain script that performs a data access request by using the current user's credentials to retrieve data from a data source in another domain that the malicious user would not otherwise have access to, such as a database of payroll or other sensitive information.</span></span> <span data-ttu-id="16d36-117">此类安全风险情况被称为跨域访问数据。</span><span class="sxs-lookup"><span data-stu-id="16d36-117">This class of security risk scenarios is referred to as cross-domain data access.</span></span>
  
<span data-ttu-id="16d36-p103">InfoPath 建立在 Internet Explorer 安全模型基础之上。该模型提供了一项称为“跨域访问数据源”\*\*\*\* 的设置，默认情况下，该设置禁止对位于“Internet”\*\*\*\* 和“受限制的站点”\*\*\*\* 安全区域内的 InfoPath 表单执行跨域访问。此外，该设置还提示用户允许或禁止对位于“本地 Intranet”\*\*\*\* 安全区域内的 InfoPath 表单执行跨域访问，它允许对位于“受信任的站点”\*\*\*\* 或“本地计算机”\*\*\*\* 区域内的 InfoPath 表单执行跨域访问。</span><span class="sxs-lookup"><span data-stu-id="16d36-p103">The Internet Explorer security model that InfoPath is built upon provides a setting called **Access data sources across domains** that, by default, disables cross-domain access for InfoPath forms that reside in the **Internet** and **Restricted sites** security zones. This setting also prompts the user to allow or disallow cross-domain access for InfoPath forms that reside in the **Local intranet** security zone, and it enables cross-domain access for InfoPath forms that reside in the **Trusted sites** or **Local Machine** zones.</span></span> 
  
## <a name="malicious-use-of-activex-controls"></a><span data-ttu-id="16d36-120">恶意使用 ActiveX 控件</span><span class="sxs-lookup"><span data-stu-id="16d36-120">Malicious Use of ActiveX Controls</span></span>

<span data-ttu-id="16d36-p104">当恶意表单编写者针对可访问文件系统的 ActiveX 控件编写代码，以检索个人文件和密码列表、删除文件或禁用用户的系统时，主要就会发生恶意使用 ActiveX 控件的情况。InfoPath 表单只能通过业务逻辑或在任务窗格中运行的脚本来运行针对 ActiveX 控件的代码。InfoPath 不允许 InfoPath 视图中的脚本运行 ActiveX 控件。</span><span class="sxs-lookup"><span data-stu-id="16d36-p104">The primary scenario for the malicious use of ActiveX controls is when a malicious form author writes code against an ActiveX control that accesses the file system to retrieve personal files and password lists, delete files, or disable the user's system. An InfoPath form can run code against ActiveX controls only from business logic or from script running in a task pane. InfoPath does not allow scripts in InfoPath views to run ActiveX controls.</span></span>
  
<span data-ttu-id="16d36-p105">The Internet Explorer security model that InfoPath is built upon provides a setting called **Initialize and script ActiveX controls marked as unsafe**. This setting, by default, disables initializing and scripting ActiveX controls marked as unsafe for InfoPath forms that reside in the **Local intranet**, **Internet**, and **Restricted sites** security zones. It prompts the user to allow or disallow scripting of ActiveX controls marked as unsafe for InfoPath forms that reside in the **Trusted sites** or the **Local Machine** security zones, and it enables scripting of ActiveX controls marked as unsafe for InfoPath forms that are fully trusted.</span><span class="sxs-lookup"><span data-stu-id="16d36-p105">The Internet Explorer security model that InfoPath is built upon provides a setting called **Initialize and script ActiveX controls marked as unsafe**. This setting, by default, disables initializing and scripting ActiveX controls marked as unsafe for InfoPath forms that reside in the **Local intranet**, **Internet**, and **Restricted sites** security zones. It prompts the user to allow or disallow scripting of ActiveX controls marked as unsafe for InfoPath forms that reside in the **Trusted sites** or the **Local Machine** security zones, and it enables scripting of ActiveX controls marked as unsafe for InfoPath forms that are fully trusted.</span></span> 
  
<span data-ttu-id="16d36-127">此外，无论您位于哪个安全区域，也无论表单的信任级别如何，在设计模式下，您都无法在控件任务窗格中插入那些标记为不能安全地进行初始化和编写脚本的 ActiveX 控件。</span><span class="sxs-lookup"><span data-stu-id="16d36-127">In addition, you cannot insert an ActiveX control that is marked as unsafe for initializing and scripting into the controls task pane while in design mode, regardless of which security zone you are in or the trust level of the form.</span></span>
  
## <a name="malicious-use-of-infopath-object-model-code"></a><span data-ttu-id="16d36-128">恶意使用 InfoPath 对象模型代码</span><span class="sxs-lookup"><span data-stu-id="16d36-128">Malicious Use of InfoPath Object Model Code</span></span>

<span data-ttu-id="16d36-p106">同样，通过代码调用的 InfoPath 方法和属性可带来不同程度的风险。例如，可以使用 [XmlForm](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlForm.SaveAs.aspx) 类的 [SaveAs(String)](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlForm.aspx) 方法在文件系统的任何位置写入数据。为了有助于防止恶意使用这些对象模型成员，InfoPath 对象模型实施了三级安全防护，以确定如何及在何处使用特定的对象模型成员。有关该功能的详细信息，请参阅 [关于具有代码的表单模板的安全模型](about-the-security-model-for-form-templates-with-code.md)。</span><span class="sxs-lookup"><span data-stu-id="16d36-p106">Similarly, InfoPath methods and properties called from code can present different levels of risk. For example, the [SaveAs(String)](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlForm.SaveAs.aspx) method of the [XmlForm](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.XmlForm.aspx) class can be used to write data anywhere in the file system. To help protect against malicious use of these object model members, the InfoPath object model implements three levels of security that determine how and where a particular object model member can be used. For more information on this feature, see [About the Security Model for Form Templates with Code](about-the-security-model-for-form-templates-with-code.md).</span></span>
  
## <a name="best-practices-for-developers-of-infopath-forms"></a><span data-ttu-id="16d36-133">针对 InfoPath 表单开发人员的最佳实践</span><span class="sxs-lookup"><span data-stu-id="16d36-133">Best Practices for Developers of InfoPath Forms</span></span>

<span data-ttu-id="16d36-134">创建 InfoPath 表单的开发人员应知道如何实施下列最佳安全实践：</span><span class="sxs-lookup"><span data-stu-id="16d36-134">Developers creating InfoPath forms should know how to implement the following security best practices:</span></span>
  
- <span data-ttu-id="16d36-135">如何识别与表单关联的 XML 文件中潜藏的安全问题。</span><span class="sxs-lookup"><span data-stu-id="16d36-135">How to recognize potential security issues in the XML file associated with a form.</span></span>
    
- <span data-ttu-id="16d36-136">如何避免向表单用户呈现令人费解或讨厌的错误消息。</span><span class="sxs-lookup"><span data-stu-id="16d36-136">How to avoid presenting confusing or annoying error messages to form users.</span></span>
    
- <span data-ttu-id="16d36-137">如何对 ActiveX 控件的 CAB 文件进行签名。</span><span class="sxs-lookup"><span data-stu-id="16d36-137">How to sign the CAB files of ActiveX controls.</span></span>
    
- <span data-ttu-id="16d36-138">如何对以电子邮件附件形式发送的表单模板进行签名。</span><span class="sxs-lookup"><span data-stu-id="16d36-138">How to sign form templates sent as an attachment to an email message.</span></span>
    
## <a name="best-practices-for-xml-data-associated-with-a-form"></a><span data-ttu-id="16d36-139">与表单关联的 XML 数据的最佳做法</span><span class="sxs-lookup"><span data-stu-id="16d36-139">Best Practices for XML Data Associated with a Form</span></span>

<span data-ttu-id="16d36-140">请注意，可以从任何来源向 InfoPath 表单馈送 XML 数据，包括那些用户不一定信任或控制的来源。</span><span class="sxs-lookup"><span data-stu-id="16d36-140">Note that InfoPath forms can be fed XML data from any source, including those that the user does not necessarily trust or control.</span></span> <span data-ttu-id="16d36-141">例如，InfoPath 可以从网页链接中获取 XML 数据，或者从通过电子邮件发送给用户的 XML 附件中获取 XML 数据。</span><span class="sxs-lookup"><span data-stu-id="16d36-141">For example, InfoPath can get XML data from a link to a Web page or from an XML attachment sent to the user in email message.</span></span> <span data-ttu-id="16d36-142">若要缓和这些风险，请注意以下最佳做法：</span><span class="sxs-lookup"><span data-stu-id="16d36-142">To mitigate these risks, be aware of the following best practices:</span></span>
  
- <span data-ttu-id="16d36-p108">不要将从 XML 读取的不可信数据传递给任务窗格的 Microsoft JScript **eval()** 函数或 **innerHTML** 属性。这两种调用都可能用于执行恶意脚本。在任务窗格中，应使用 **innerText** 属性来替代。请注意，InfoPath 视图无法执行脚本。</span><span class="sxs-lookup"><span data-stu-id="16d36-p108">Do not pass untrusted data that is read from the XML to the Microsoft JScript **eval()** function or the **innerHTML** property of the task pane. Both of these calls could be used to execute malicious script. In a task pane, use the **innerText** property as an alternative. Note that InfoPath views cannot execute script.</span></span> 
    
- <span data-ttu-id="16d36-147">如果来自 XML 文件的数据未经验证便提交给数据库，则会给数据库带来安全风险。</span><span class="sxs-lookup"><span data-stu-id="16d36-147">Data submitted to a database from an XML file can present security risks to the database if it is not validated before submission.</span></span>
    
<span data-ttu-id="16d36-p109">如果未对数据进行验证便将其提交给数据源，则会破坏数据源中数据的完整性，或更有甚者，有可能造成缓冲区数据溢出。另外，如果您试图直接在服务器上使用不可信数据，则可能导致脚本注入或 SQL 注入。</span><span class="sxs-lookup"><span data-stu-id="16d36-p109">Data that is not validated before submitting it to a data source can damage the integrity of the data in the data source, or in more extreme cases, present the potential for buffer overruns. It is also possible to cause script injection or SQL injection if you try to use untrusted data directly on your server.</span></span>
  
## <a name="best-practices-to-avoid-presenting-confusing-error-messages"></a><span data-ttu-id="16d36-150">避免呈现令人费解的错误消息的最佳实践</span><span class="sxs-lookup"><span data-stu-id="16d36-150">Best Practices to Avoid Presenting Confusing Error Messages</span></span>

 <span data-ttu-id="16d36-151">**将表单及其数据源部署在同一域中**</span><span class="sxs-lookup"><span data-stu-id="16d36-151">**Deploy forms and their data sources on the same domain**</span></span>
  
<span data-ttu-id="16d36-p110">The security risk of cross-domain data access is not clearly understood by most users. Deploying forms that continually warn and prompt users about allowing cross-domain data access has the effect of training many users to approve all cross-domain access requests, or to add the originating domain to their **Trusted sites** list, without taking the security risks seriously. To avoid this situation, deploy InfoPath forms on the same server as any data sources on which they depend.</span><span class="sxs-lookup"><span data-stu-id="16d36-p110">The security risk of cross-domain data access is not clearly understood by most users. Deploying forms that continually warn and prompt users about allowing cross-domain data access has the effect of training many users to approve all cross-domain access requests, or to add the originating domain to their **Trusted sites** list, without taking the security risks seriously. To avoid this situation, deploy InfoPath forms on the same server as any data sources on which they depend.</span></span> 
  
 <span data-ttu-id="16d36-155">**避免使用那些没有标记为可安全编写脚本的 ActiveX 控件**</span><span class="sxs-lookup"><span data-stu-id="16d36-155">**Avoid using ActiveX controls that are not marked as safe for scripting**</span></span>
  
<span data-ttu-id="16d36-p111">ActiveX 控件或许会公开可被用来损害用户系统的属性和方法（如用于访问计算机文件系统的方法）。应尽可能只使用那些标记为可安全编写脚本的 ActiveX 控件。这些控件已经过测试，可以确保无论网页的脚本如何操纵控件的方法和属性，都不会损害用户系统或危害用户安全。同样，在创建与 InfoPath 结合使用的 ActiveX 控件时，应检查相关代码，并对 ActiveX 控件进行严格测试，然后才将其标记为可安全编写脚本。</span><span class="sxs-lookup"><span data-stu-id="16d36-p111">ActiveX controls can potentially expose properties and methods that can be used to compromise a user's system, such as methods for accessing the file system of a computer. Whenever possible, you should use only ActiveX controls that are marked safe for scripting. These are controls that have been tested to ensure they will not damage a user's system or compromise the user's security, regardless of how the control's methods and properties are manipulated by a Web page's script. Similarly, when creating ActiveX controls for use with InfoPath, inspect the code and test the ActiveX control rigorously before marking it safe for scripting.</span></span>
  
<span data-ttu-id="16d36-p112">InfoPath 使用基于 Internet Explorer 安全区域的安全模型。因此，InfoPath 表单将使用与 Internet Explorer 相同的权限。默认情况下，这些权限允许在不提示用户的情况下对标记为可安全编写脚本的 ActiveX 控件进行脚本调用。</span><span class="sxs-lookup"><span data-stu-id="16d36-p112">InfoPath uses a security model that is based on Internet Explorer's security zones. Therefore, an InfoPath form will use the same permissions as Internet Explorer, which by default enables script calls to ActiveX controls marked safe for scripting, without prompting users.</span></span>
  
## <a name="best-practices-for-managing-the-cab-files-of-activex-controls"></a><span data-ttu-id="16d36-162">管理 ActiveX 控件的 CAB 文件的最佳实践</span><span class="sxs-lookup"><span data-stu-id="16d36-162">Best Practices for Managing the CAB Files of ActiveX Controls</span></span>

<span data-ttu-id="16d36-p113">ActiveX 控件可位于专为 InfoPath 编辑器设计的表单模板中。表单模板 (.xsn) 文件中必须包括用户计算机上尚不存在的这些控件的 CAB 文件。表单模板中包含的 CAB 文件必须经过数字签名方能安装。无论信任级别或安全区域如何设置，InfoPath 都不会安装未经签名的 CAB 文件。</span><span class="sxs-lookup"><span data-stu-id="16d36-p113">ActiveX controls can be hosted in form templates designed for the InfoPath editor. CAB files for these controls that are not already present on the user's computer must be included in the form template (.xsn) file. CAB files included in form templates must be digitally signed in order for the CAB file to be installed. InfoPath will not install a CAB file that is not signed, regardless of trust level or security zone.</span></span>
  
<span data-ttu-id="16d36-p114">为了确保能够验证 CAB 文件上的数字签名，应使用特定证书签署文件，该证书应包含指向已获得信任的证书根的信任链。否则，签名无法通过身份验证，签名验证将失败，CAB 文件也将无法安装。</span><span class="sxs-lookup"><span data-stu-id="16d36-p114">To ensure that the digital signature on the CAB file can be verified, the file should be signed with a certificate that has a trust chain leading to an already trusted certificate root. Otherwise, the signature cannot be authenticated, the signature verification will fail, and the CAB file will not be installed.</span></span>
  
## <a name="best-practices-for-form-templates-sent-as-an-attachment-to-an-email-message"></a><span data-ttu-id="16d36-169">针对以电子邮件附件形式发送的表单模板的最佳做法</span><span class="sxs-lookup"><span data-stu-id="16d36-169">Best Practices for Form Templates Sent as an Attachment to an Email Message</span></span>

<span data-ttu-id="16d36-170">InfoPath 支持将表单模板部署为电子邮件的附件并将表单模板从一个位置移到另一个位置。</span><span class="sxs-lookup"><span data-stu-id="16d36-170">InfoPath supports deploying form templates as an attachment to an email message and moving form templates from one location to another.</span></span> <span data-ttu-id="16d36-171">对你设计并打算部署为电子邮件附件的表单模板进行数字签名是一个很好的安全做法。</span><span class="sxs-lookup"><span data-stu-id="16d36-171">It is good security practice to digitally sign a form template that you design and intend to deploy as an attachment to an email message.</span></span> <span data-ttu-id="16d36-172">电子邮件邮件部署的表单模板上的数字签名不仅可以确保该模板的真实性，</span><span class="sxs-lookup"><span data-stu-id="16d36-172">A digital signature on a form template deployed by email message not only ensures the authenticity of the template.</span></span> <span data-ttu-id="16d36-173">还具有允许表单模板自动更新的额外好处。</span><span class="sxs-lookup"><span data-stu-id="16d36-173">It also has the added benefit of allowing the form template to be updated automatically.</span></span>
  
<span data-ttu-id="16d36-p116">应使用特定证书签署表单模板，该证书应包含指向已获得信任的证书根的信任链。如果不使用此类证书进行签名，则会因签名无法通过身份验证而导致签名验证失败。</span><span class="sxs-lookup"><span data-stu-id="16d36-p116">The form template should be signed with a certificate that has a trust chain leading to an already trusted certificate root. If it is not signed with such a certificate, signature verification will fail, because the signature cannot be authenticated.</span></span>
  
> [!NOTE]
> <span data-ttu-id="16d36-176">如果已签名的表单模板请求域访问或受限制的访问，则 InfoPath 除了确定它能否自动更新模板外，将不会检查或验证签名。</span><span class="sxs-lookup"><span data-stu-id="16d36-176">If a signed form template requests Domain or Restricted access, InfoPath will not check or verify the signature except to determine whether InfoPath can automatically update the template.</span></span> 
  
<span data-ttu-id="16d36-177">有关电子邮件部署的详细信息，请参阅[安全级别、电子邮件部署和远程表单模板](security-levels-email-deployment-and-remote-form-templates.md)。</span><span class="sxs-lookup"><span data-stu-id="16d36-177">You can find more information about email deployment in [Security Levels, E-Mail Deployment, and Remote Form Templates](security-levels-email-deployment-and-remote-form-templates.md).</span></span>
  

