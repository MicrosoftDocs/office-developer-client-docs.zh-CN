---
title: Microsoft 365 中 Office 无人参与自动化的注意事项（针对无人参与的 RPA 环境）
ms.date: 03/30/2020
ms.audience: Developer
localization_priority: Normal
description: Microsoft 365 中 Office 无人参与自动化的注意事项（针对无人参与的 RPA 环境）。
ms.openlocfilehash: 576217fc85f2980a6d2451e3f930296ea4c11a56
ms.sourcegitcommit: 007aa2ceb4f569201c3f4372de5c83b6c61f8875
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/02/2020
ms.locfileid: "43103046"
---
# <a name="considerations-for-unattended-automation-of-office-in-the-microsoft-365-for-unattended-rpa-environment"></a><span data-ttu-id="b594d-103">Microsoft 365 中 Office 无人参与自动化的注意事项（针对无人参与的 RPA 环境）</span><span class="sxs-lookup"><span data-stu-id="b594d-103">Considerations for unattended automation of Office in the Microsoft 365 for unattended RPA environment</span></span>

<span data-ttu-id="b594d-104">尽管 Microsoft 365 for 无人参与的 RPA 提供了一个许可证，该许可证可实现 Office 自动化功能，并且所有当前版本的 Office 都设计和测试为在客户端工作站上以最终用户产品的形式运行，用户可与应用程序的接口进行交互。</span><span class="sxs-lookup"><span data-stu-id="b594d-104">Although Microsoft 365 for unattended RPA provides a license that enables the automation of Office with no user present, all current versions of Office were designed and tested to run as end-user products on a client workstation with a user present to interact with the application’s interface.</span></span> <span data-ttu-id="b594d-105">在没有用户的情况下使用应用程序导致的意外行为不存在缺陷。</span><span class="sxs-lookup"><span data-stu-id="b594d-105">Unexpected behaviors resulting from the use of applications without a user present are not defects.</span></span> <span data-ttu-id="b594d-106">如果要在此配置中运行 Office，则必须准备在应用程序逻辑中考虑这些意外行为。</span><span class="sxs-lookup"><span data-stu-id="b594d-106">If you want to run Office in this configuration, you must be prepared to account for these unexpected behaviors in your application logic.</span></span>

<span data-ttu-id="b594d-107">本文概述了 Office 无人参与自动化的一些注意事项，以帮助你使用此方法。</span><span class="sxs-lookup"><span data-stu-id="b594d-107">This article outlines some of the considerations for unattended automation of Office to help you if you use this approach.</span></span> <span data-ttu-id="b594d-108">但是，请注意，此配置中的 Office 的使用严格为 "按原样"，并且必须考虑这些意外行为。</span><span class="sxs-lookup"><span data-stu-id="b594d-108">However, note that usage of Office in this configuration is strictly “AS IS” and must account for these unexpected behaviors.</span></span> <span data-ttu-id="b594d-109">此处提供的信息并不详尽，并不保证能够解决所有客户端的所有问题。</span><span class="sxs-lookup"><span data-stu-id="b594d-109">The information provided here is not exhaustive and is not guaranteed to resolve all issues for all clients.</span></span> <span data-ttu-id="b594d-110">我们鼓励你在部署之前全面测试你的解决方案。</span><span class="sxs-lookup"><span data-stu-id="b594d-110">We encourage you to test your solution thoroughly before you deploy.</span></span>

## <a name="common-problems-in-unattended-automation"></a><span data-ttu-id="b594d-111">无人参与的自动化中的常见问题</span><span class="sxs-lookup"><span data-stu-id="b594d-111">Common problems in unattended automation</span></span>

<span data-ttu-id="b594d-112">如果要在没有用户的情况下使用 Office，请注意 Office 的行为与预期不同的以下方面。</span><span class="sxs-lookup"><span data-stu-id="b594d-112">If you want to use Office without a user present, be aware of the following areas in which Office can behave differently than expected.</span></span> <span data-ttu-id="b594d-113">若要成功运行您的解决方案，它必须解决这些问题，并尽可能最大限度地减少它们的影响。</span><span class="sxs-lookup"><span data-stu-id="b594d-113">For your solution to run successfully, it must address these issues and minimize their effects as much as possible.</span></span> <span data-ttu-id="b594d-114">生成应用程序时，请仔细考虑这些问题。</span><span class="sxs-lookup"><span data-stu-id="b594d-114">Consider these issues carefully when you build your application.</span></span>

### <a name="interactive-ui-elements"></a><span data-ttu-id="b594d-115">交互式 UI 元素</span><span class="sxs-lookup"><span data-stu-id="b594d-115">Interactive UI elements</span></span>

<span data-ttu-id="b594d-116">Office 应用程序假定它们以交互方式运行。</span><span class="sxs-lookup"><span data-stu-id="b594d-116">Office applications assume that they are being run interactively.</span></span> <span data-ttu-id="b594d-117">如果发生意外错误，或者如果需要一个未指定的参数来完成某个函数，则 Office 将向用户提示一个对话框，询问用户要继续执行的操作。</span><span class="sxs-lookup"><span data-stu-id="b594d-117">If an unexpected error occurs, or if an unspecified parameter is needed to complete a function, Office is designed to prompt the user with a dialog box that asks the user how they want to proceed.</span></span> <span data-ttu-id="b594d-118">在无人参与的自动化中，这可能会导致应用程序在应用程序停止时显示为 "挂起"，直到它接收到此输入。</span><span class="sxs-lookup"><span data-stu-id="b594d-118">In unattended automation, this might result in the application appearing to “hang” as the application stops until it receives this input.</span></span> <span data-ttu-id="b594d-119">如果您通过其公共 Api 实现 Office 自动化，则可以通过相应地配置[DisplayAlerts](https://docs.microsoft.com/office/vba/api/word.application.displayalerts)和[AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity)等属性来抑制其中的许多警报。</span><span class="sxs-lookup"><span data-stu-id="b594d-119">If you’re automating Office via its public APIs, you can suppress many of these alerts by configuring properties like [Application.DisplayAlerts](https://docs.microsoft.com/office/vba/api/word.application.displayalerts) and [Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) appropriately.</span></span> <span data-ttu-id="b594d-120">您的代码应能够随时识别和处理阻止警报。</span><span class="sxs-lookup"><span data-stu-id="b594d-120">Your code should be designed to identify and process blocking alerts at any time.</span></span>

### <a name="user-identity"></a><span data-ttu-id="b594d-121">用户标识</span><span class="sxs-lookup"><span data-stu-id="b594d-121">User identity</span></span>

<span data-ttu-id="b594d-122">运行应用程序时，Office 应用程序需要用户标识，即使应用程序是通过 "自动化" 启动的也是如此。</span><span class="sxs-lookup"><span data-stu-id="b594d-122">Office applications require a user identity when the applications are run, even when the application is started via automation.</span></span> <span data-ttu-id="b594d-123">此用户标识可能导致以下任一或所有内容：</span><span class="sxs-lookup"><span data-stu-id="b594d-123">This user identity can cause any or all of the following:</span></span>

- <span data-ttu-id="b594d-124">必须处理的其他登录 UI 是否存在。</span><span class="sxs-lookup"><span data-stu-id="b594d-124">The presence of additional sign-in UI that must be handled.</span></span>
- <span data-ttu-id="b594d-125">无法基于每个用户的访问权限打开和/或编辑的文件。</span><span class="sxs-lookup"><span data-stu-id="b594d-125">Files that cannot be opened and/or edited based on per-user access permissions.</span></span>
- <span data-ttu-id="b594d-126">对文件元数据的意外更改（例如，某些文件属性将根据自动应用程序实例的用户标识的标识进行更新）。</span><span class="sxs-lookup"><span data-stu-id="b594d-126">Unexpected changes to the metadata of the file (for example, certain file properties will be updated based on the identity of the user identity of the automated application instance).</span></span>

<span data-ttu-id="b594d-127">各种方法可帮助缓解这些问题;例如，运行[文档检查器](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector)以删除元数据。</span><span class="sxs-lookup"><span data-stu-id="b594d-127">Various approaches can help to mitigate these issues; for example, running the [Document Inspector](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector) to remove metadata.</span></span> <span data-ttu-id="b594d-128">根据您的应用场景，考虑这些方法是否适用。</span><span class="sxs-lookup"><span data-stu-id="b594d-128">Consider whether these approaches are appropriate based on your scenario.</span></span>

### <a name="server-side-security"></a><span data-ttu-id="b594d-129">服务器端安全性</span><span class="sxs-lookup"><span data-stu-id="b594d-129">Server-side security</span></span>

<span data-ttu-id="b594d-130">在运行 Office 无人参与并处理任意文件内容时，该环境中没有其他特定的保护可用于阻止加载和运行这些文件中存储的宏。</span><span class="sxs-lookup"><span data-stu-id="b594d-130">When running Office unattended and processing arbitrary file content, no additional protections specific in that environment are available to prevent macros stored in those files from loading and running.</span></span> <span data-ttu-id="b594d-131">Office 无法防止您无意中从代码运行宏，或从启动可能运行宏的另一台服务器上运行宏。</span><span class="sxs-lookup"><span data-stu-id="b594d-131">Office does not protect you from unintentionally running macros from your code, or from starting another server that might run macros.</span></span> <span data-ttu-id="b594d-132">您可以使用[AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity)之类的属性来缓解此风险，但您应确保仅加载受信任的内容。</span><span class="sxs-lookup"><span data-stu-id="b594d-132">You can use properties like [Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) to mitigate this risk, but you should ensure that you are only loading trusted content.</span></span>

<span data-ttu-id="b594d-133">此外，Office 使用可缓存客户端身份验证信息以加快处理速度的许多组件（如简单 MAPI、WinInet 和 MSDAIPP.DSO）。</span><span class="sxs-lookup"><span data-stu-id="b594d-133">Additionally, Office uses many components (such as Simple MAPI, WinInet, and MSDAIPP) that can cache client authentication information to speed processing.</span></span> <span data-ttu-id="b594d-134">当 Office 自动服务器端和处理多个文件时，如果已为该会话缓存了身份验证信息，则一个客户端可以使用其他客户端的缓存凭据。</span><span class="sxs-lookup"><span data-stu-id="b594d-134">When Office is being automated server-side and processing multiple files, if authentication information has been cached for that session, one client can use the cached credentials of another client.</span></span> <span data-ttu-id="b594d-135">因此，客户端可以通过模拟其他用户获取未授予访问权限。</span><span class="sxs-lookup"><span data-stu-id="b594d-135">Therefore, the client can gain non-granted access permissions by impersonating other users.</span></span>

### <a name="ui-changes"></a><span data-ttu-id="b594d-136">UI 更改</span><span class="sxs-lookup"><span data-stu-id="b594d-136">UI changes</span></span>

<span data-ttu-id="b594d-137">Office 中的 UI 元素在很大程度上是稳定的，但不能保证任何 UI 元素的特定位置，并且可能会随着产品设计的发展而发生变化，以合并用户反馈并满足客户需求。</span><span class="sxs-lookup"><span data-stu-id="b594d-137">The UI elements in Office are largely stable, but the specific location of any UI element is not guaranteed and might change as the product design evolves to incorporate user feedback and meet customer needs.</span></span> <span data-ttu-id="b594d-138">任何自动化的逻辑都必须考虑这一点。</span><span class="sxs-lookup"><span data-stu-id="b594d-138">The logic of any automation must account for this.</span></span> <span data-ttu-id="b594d-139">这些更改可能会导致按钮或组选项卡命名更改、命令在选项卡之间移动、添加新选项卡或在与我们的功能弃用策略相一致的情况下删除命令。</span><span class="sxs-lookup"><span data-stu-id="b594d-139">These changes might result in button or group tab naming changes, movement of commands between tabs, the addition of new tabs, or the removal of commands in alignment with our feature deprecation policies.</span></span> <span data-ttu-id="b594d-140">这些更改既可以在 UI 中进行，也可以在应用程序提供的辅助功能信息中进行，因为修改该信息以提高日常客户反馈的可用性和帐户，并且可能会在不同时间为不同的用户进行滚动。</span><span class="sxs-lookup"><span data-stu-id="b594d-140">These changes can take place in the UI as well as within the accessibility information provided by the application, as that information is modified to improve usability and account for ongoing customer feedback, and might be rolled out for different users at different times.</span></span>

<span data-ttu-id="b594d-141">即使不进行产品更改，系统环境（如屏幕大小/分辨率/DPI）之间的差异也会导致屏幕上的项目位置发生变化。</span><span class="sxs-lookup"><span data-stu-id="b594d-141">Even without product changes, differences between system environments (such as screen size/resolution/DPI) can result in changes in the location of items on screen.</span></span> <span data-ttu-id="b594d-142">任何依靠屏幕坐标模拟用户输入的方法都必须考虑这些更改并相应地进行调整。</span><span class="sxs-lookup"><span data-stu-id="b594d-142">Any approach that relies on screen coordinates to simulate user input must consider these changes and adapt accordingly.</span></span>

### <a name="single-threading"></a><span data-ttu-id="b594d-143">单线程</span><span class="sxs-lookup"><span data-stu-id="b594d-143">Single-threading</span></span>

<span data-ttu-id="b594d-144">Office 应用程序是不能重入的、基于 STA 的应用程序，旨在为单个客户端提供不同但占用资源的功能。</span><span class="sxs-lookup"><span data-stu-id="b594d-144">Office applications are non-reentrant, STA-based applications that are designed to provide diverse but resource-intensive functionality for a single client.</span></span> <span data-ttu-id="b594d-145">应用程序使用全局资源，如内存映射文件、全局外接程序或模板以及共享的自动化服务器。</span><span class="sxs-lookup"><span data-stu-id="b594d-145">The applications use global resources such as memory mapped files, global add-ins or templates, and shared automation servers.</span></span> <span data-ttu-id="b594d-146">这样可以限制可并发运行的实例数，如果应用程序在 multiclient 环境中进行配置，可能会导致出现争用条件。</span><span class="sxs-lookup"><span data-stu-id="b594d-146">This can limit the number of instances that can run concurrently and can lead to race conditions if the applications are configured in a multiclient environment.</span></span> <span data-ttu-id="b594d-147">如果打算运行多个 Office 应用程序的多个实例，则应计划在虚拟机级别隔离这些实例，以确保生成的解决方案的稳定性。</span><span class="sxs-lookup"><span data-stu-id="b594d-147">If you plan to run more than one instance of any Office application, you should plan to isolate them at the virtual machine level to ensure the stability of the resulting solution.</span></span>

### <a name="resiliency-and-stability"></a><span data-ttu-id="b594d-148">恢复能力和稳定性</span><span class="sxs-lookup"><span data-stu-id="b594d-148">Resiliency and stability</span></span>

<span data-ttu-id="b594d-149">即使在上述注意事项的情况下，如果应用程序以模拟用户输入的方式自动进行，或者对于明显超过交互使用率的会话长度，它们可能会遇到交互运行时不存在的问题。</span><span class="sxs-lookup"><span data-stu-id="b594d-149">Even with the considerations above, if the applications are automated in ways that simulate user input or for session lengths that dramatically exceed interactive usage, they might encounter issues that are not present when run interactively.</span></span> <span data-ttu-id="b594d-150">在此上下文中利用 Office 的解决方案应主动构建用于监视应用程序状态的机制，并在必要时重新启动应用程序的状态（和/或正在运行的虚拟机）。</span><span class="sxs-lookup"><span data-stu-id="b594d-150">Solutions that utilize Office in this context should proactively build mechanisms to monitor the state of the application and restart them (and/or the virtual machine on which they are running) if/as needed.</span></span>

## <a name="suggested-alternatives"></a><span data-ttu-id="b594d-151">建议的替代方法</span><span class="sxs-lookup"><span data-stu-id="b594d-151">Suggested Alternatives</span></span>

<span data-ttu-id="b594d-152">Microsoft 强烈建议一些备选方案，这些备选方案不要求安装 Office 并在服务器端运行，并且可以更高效地执行常见任务，且比此配置中的自动化更快。</span><span class="sxs-lookup"><span data-stu-id="b594d-152">Microsoft strongly recommends a few alternatives that do not require Office to be installed and run server-side, and that can perform common tasks more efficiently and more quickly than automation in this configuration.</span></span> <span data-ttu-id="b594d-153">在将 Office 作为项目中的服务器端组件之前，请考虑替代方法。</span><span class="sxs-lookup"><span data-stu-id="b594d-153">Before you involve Office as a server-side component in your project, consider alternatives.</span></span>

### <a name="microsoft-graph"></a><span data-ttu-id="b594d-154">Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="b594d-154">Microsoft Graph</span></span>

<span data-ttu-id="b594d-155">Microsoft Graph API 提供了对可供 Microsoft 云的用户和解决方案使用的服务、数据和智能的访问，包括支持无人参与自动化需求的许多服务：访问用户的邮件/日历/联系人/文件、文档转换、Excel 工作簿计算等。</span><span class="sxs-lookup"><span data-stu-id="b594d-155">The Microsoft Graph API provides access to the services, data, and intelligence that are available to users and solutions as part of the Microsoft cloud, including many services supporting the needs of unattended automation: access to users’ mail / calendar / contacts / files, document conversion, Excel workbook calculation, and more.</span></span> <span data-ttu-id="b594d-156">这些服务旨在实现无人值守的使用和高规模访问，并利用标准的 RESTful API 语法。</span><span class="sxs-lookup"><span data-stu-id="b594d-156">These services are designed for unattended use and high-scale access, and utilize a standard RESTful API syntax.</span></span> <span data-ttu-id="b594d-157">有关 Microsoft Graph 以及如何使用它来处理用户数据的详细信息，请访问以下内容：</span><span class="sxs-lookup"><span data-stu-id="b594d-157">For more information on Microsoft Graph and how to use it to work with users’ data, visit the following:</span></span>

- [<span data-ttu-id="b594d-158">Microsoft Graph 概述</span><span class="sxs-lookup"><span data-stu-id="b594d-158">Overview of Microsoft Graph</span></span>](https://docs.microsoft.com/graph/overview) 
- [<span data-ttu-id="b594d-159">Microsoft Graph 入门</span><span class="sxs-lookup"><span data-stu-id="b594d-159">Get started with Microsoft Graph</span></span>](https://developer.microsoft.com/graph/get-started)
- <span data-ttu-id="b594d-160">[下载另一种格式的文件](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http)（文件转换）</span><span class="sxs-lookup"><span data-stu-id="b594d-160">[Download a file in another format](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http) (file conversion)</span></span>
- <span data-ttu-id="b594d-161">[在 Microsoft Graph 中使用 Excel](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0) （工作簿详细信息）</span><span class="sxs-lookup"><span data-stu-id="b594d-161">[Working with Excel in Microsoft Graph](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0) (workbook details)</span></span>

### <a name="open-xml-file-formats"></a><span data-ttu-id="b594d-162">Open XML 文件格式</span><span class="sxs-lookup"><span data-stu-id="b594d-162">Open XML file formats</span></span>

<span data-ttu-id="b594d-163">许多自动化任务涉及文档创建或编辑。</span><span class="sxs-lookup"><span data-stu-id="b594d-163">Many automation tasks involve document creation or editing.</span></span> <span data-ttu-id="b594d-164">Office 支持 Open XML 文件格式，使开发人员能够使用 ISO 29500 国际标准中定义的标准 XML 和 ZIP 技术创建、编辑、读取和转换文件内容。</span><span class="sxs-lookup"><span data-stu-id="b594d-164">Office supports Open XML file formats that let developers create, edit, read, and transform file content using standard XML and ZIP technologies, defined in the ISO 29500 International Standard.</span></span> <span data-ttu-id="b594d-165">可以通过任何 ZIP/XML 工具（包括 Microsoft .NET 3 System.IO.Package.IO Framework 中的命名空间）操作这些文件格式。</span><span class="sxs-lookup"><span data-stu-id="b594d-165">These file formats can be manipulated via any ZIP/XML tools, including the System.IO.Package.IO namespace in the Microsoft .NET 3.x Framework.</span></span> <span data-ttu-id="b594d-166">若要从服务处理 Office 文件的更改，建议直接编辑文件格式。</span><span class="sxs-lookup"><span data-stu-id="b594d-166">Direct editing of the file formats is the recommended and supported method for handling changes to Office files from a service.</span></span>

<span data-ttu-id="b594d-167">Microsoft 提供了一个 SDK，用于处理 .NET 3. x Framework 中的 Open XML 文件格式。</span><span class="sxs-lookup"><span data-stu-id="b594d-167">Microsoft provides an SDK for manipulating Open XML file formats from the .NET 3.x Framework.</span></span> <span data-ttu-id="b594d-168">有关 SDK 以及如何使用 SDK 创建或编辑 Open XML 文件的详细信息，请访问以下内容：</span><span class="sxs-lookup"><span data-stu-id="b594d-168">For more information about the SDK and how to use the SDK to create or edit Open XML files, visit the following:</span></span>

- [<span data-ttu-id="b594d-169">了解 Open XML 文件格式</span><span class="sxs-lookup"><span data-stu-id="b594d-169">Understanding the Open XML file formats</span></span>](https://docs.microsoft.com/office/open-xml/understanding-the-open-xml-file-formats)
- [<span data-ttu-id="b594d-170">欢迎使用 Open XML SDK 2.5 for Office</span><span class="sxs-lookup"><span data-stu-id="b594d-170">Welcome to the Open XML SDK 2.5 for Office</span></span>](https://docs.microsoft.com/office/open-xml/open-xml-sdk)
