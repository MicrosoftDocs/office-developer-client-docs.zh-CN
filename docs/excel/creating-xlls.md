---
title: 创建 XLL
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
keywords:
- dll [excel 2007]，导入 excel，xlAutoFree 函数 [Excel 2007]，[Excel 2007],xlcall32.lib [Excel 2007]，[Excel 2007],xlcall.cpp [Excel 2007]，xlAutoRemove 函数 [Excel 2007，] xlAddInManagerInfo xlAutoRegister 函数 xlAutoFree12 函数调用函数 [Excel 2007]、 xlAutoAdd 函数 [Excel 2007]、 xlAutoOpen 函数 [Excel 2007]、 xlAutoClose 函数 [Excel 2007，] Dll [Excel 2007] 中，打开到 xll （英文），调用 Excel xlAutoRegister12 函数 [Excel 2007],xlcall.h [Excel Xll [Excel 2007]2007 年]，xlAddInManagerInfo12 函数 [Excel 2007]
localization_priority: Normal
ms.assetid: 7754998f-4e13-4a37-9724-43b6ee6c919b
description: 适用于： Excel 2013 | Office 2013 | Visual Studio
ms.openlocfilehash: de347d34768c25adf0d96642b4fade781ae26a9c
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/11/2018
ms.locfileid: "19773650"
---
# <a name="creating-xlls"></a><span data-ttu-id="d6268-104">创建 XLL</span><span class="sxs-lookup"><span data-stu-id="d6268-104">Creating XLLs</span></span>

<span data-ttu-id="d6268-105">**适用于** Excel 2013 | Office 2013 | Visual Studio</span><span class="sxs-lookup"><span data-stu-id="d6268-105">**Applies to**: Excel 2013 | Office 2013 | Visual Studio</span></span> 
  
<span data-ttu-id="d6268-106">如果您的 DLL 是独立或仅依赖其他库，您必须知道如何启用 Microsoft Excel 访问其函数和命令。</span><span class="sxs-lookup"><span data-stu-id="d6268-106">If your DLL is self-contained or relies only on other libraries, you must know how to enable Microsoft Excel to access its functions and commands.</span></span> <span data-ttu-id="d6268-107">有关详细信息，请参阅[在 Excel 中访问 Dll](how-to-access-dlls-in-excel.md)。</span><span class="sxs-lookup"><span data-stu-id="d6268-107">For more information, see [Access DLLs in Excel](how-to-access-dlls-in-excel.md).</span></span> 
  
<span data-ttu-id="d6268-108">但是，如果您的 DLL 需要访问 Excel 功能 （例如，若要获取单元格，调用工作表函数，或询问 Excel 获取工作区信息的内容），您的代码必须能够回调到 Excel。</span><span class="sxs-lookup"><span data-stu-id="d6268-108">However, if your DLL needs to access Excel functionality (for example, to get the contents of a cell, to call a worksheet function, or to interrogate Excel to obtain workspace information), your code must be able to call back into Excel.</span></span>
  
<span data-ttu-id="d6268-109">Excel C API 提供了几个启用 Dll 以回调到 Excel 的功能。</span><span class="sxs-lookup"><span data-stu-id="d6268-109">The Excel C API provides several functions that enable DLLs to call back into Excel.</span></span> <span data-ttu-id="d6268-110">若要访问这些，DLL 必须链接静态编译时与 Excel 32 位库，xlcall32.lib。</span><span class="sxs-lookup"><span data-stu-id="d6268-110">To access these, the DLL must be linked statically at compile time with the Excel 32-bit library, xlcall32.lib.</span></span> <span data-ttu-id="d6268-111">可下载的 Microsoft Excel 2013 XLL SDK，其中包含 32 位和 64 位版本该库的一部分的 microsoft 静态库。</span><span class="sxs-lookup"><span data-stu-id="d6268-111">The static library is downloadable from Microsoft as part of the Microsoft Excel 2013 XLL SDK, which includes both 32-bit and 64-bit versions of this library.</span></span>
  
## <a name="enabling-dlls-to-call-back-into-excel"></a><span data-ttu-id="d6268-112">启用呼叫回 Excel Dll</span><span class="sxs-lookup"><span data-stu-id="d6268-112">Enabling DLLs to Call Back into Excel</span></span>

<span data-ttu-id="d6268-113">Dll 为能够访问 Excel 中的功能和获取或设置工作区信息，它必须先获得**Excel4**、 **Excel4v**、 **Excel12**和**Excel12v**Excel 回调函数的地址。</span><span class="sxs-lookup"><span data-stu-id="d6268-113">For a DLL to be able to access the functionality in Excel and get or set workspace information, it must first obtain the addresses of the Excel callback functions **Excel4**, **Excel4v**, **Excel12**, and **Excel12v**.</span></span> <span data-ttu-id="d6268-114">最后两个引入 Excel 2007 中，并在以后的版本中可用。</span><span class="sxs-lookup"><span data-stu-id="d6268-114">The last two were introduced in Excel 2007 and are available in subsequent versions.</span></span> <span data-ttu-id="d6268-115">若要访问所有这些，DLL 项目必须包括对以下文件从 Excel 2013 XLL SDK 的引用。</span><span class="sxs-lookup"><span data-stu-id="d6268-115">To access all of these, the DLL project must include references to the following files from the Excel 2013 XLL SDK.</span></span> <span data-ttu-id="d6268-116">如果您想要访问仅 （中任何版本的 Excel） 的前两个回调，您的项目需要包括仅前两个文件。</span><span class="sxs-lookup"><span data-stu-id="d6268-116">If you want to access only the first two callbacks (in any version of Excel), your project needs to include only the first two files.</span></span>
  
### <a name="xlcallh"></a><span data-ttu-id="d6268-117">Xlcall.h</span><span class="sxs-lookup"><span data-stu-id="d6268-117">Xlcall.h</span></span>

<span data-ttu-id="d6268-118">Xlcall.h 文件包含以下各项：</span><span class="sxs-lookup"><span data-stu-id="d6268-118">The Xlcall.h file contains the following items:</span></span>
  
- <span data-ttu-id="d6268-119">所有的回调函数的函数原型。</span><span class="sxs-lookup"><span data-stu-id="d6268-119">Function prototypes for all callback functions.</span></span>
    
- <span data-ttu-id="d6268-120">数据类型常量定义和定义回调使用 DLL/XLL 和 Excel 之间交换数据的数据结构。</span><span class="sxs-lookup"><span data-stu-id="d6268-120">Definitions of the data structures that the callbacks use to exchange data between the DLL/XLL and Excel, and data-type constant definitions.</span></span>
    
- <span data-ttu-id="d6268-121">定义的工作表、 宏工作表函数和受支持的 Excel 命令的 C API 函数和命令等效。</span><span class="sxs-lookup"><span data-stu-id="d6268-121">Definitions of the C API function and command equivalents of the worksheet, macro sheet functions, and supported Excel commands.</span></span>
    
- <span data-ttu-id="d6268-122">定义回调函数的返回值。</span><span class="sxs-lookup"><span data-stu-id="d6268-122">Definitions of callback function return values.</span></span>
    
<span data-ttu-id="d6268-123">您应使用 **#include**指令此文件，直接或间接通过的访问 C API 或的处理 C API 使用的数据类型的所有文件中的另一个标头文件。</span><span class="sxs-lookup"><span data-stu-id="d6268-123">You should use the **#include** directive for this file, directly or indirectly via another header file, in all files that access the C API or that handle data types that the C API uses.</span></span> 
  
### <a name="xlcall32lib"></a><span data-ttu-id="d6268-124">Xlcall32.lib</span><span class="sxs-lookup"><span data-stu-id="d6268-124">Xlcall32.lib</span></span>

<span data-ttu-id="d6268-125">Xlcall32.lib 库将导出的前两个回调时， **Excel4** **Excel4v**，并还**XlCallVer**函数。</span><span class="sxs-lookup"><span data-stu-id="d6268-125">The Xlcall32.lib library exports the first two callbacks, **Excel4** and **Excel4v**, and also the **XlCallVer** function.</span></span> <span data-ttu-id="d6268-126">不到此库中项目的引用，链接器无法创建 XLL，如果您已在代码中使用任何这些回调。</span><span class="sxs-lookup"><span data-stu-id="d6268-126">Without a reference to this library in your project, the linker cannot create the XLL if you have used any of these callbacks in your code.</span></span> <span data-ttu-id="d6268-127">（您可以获取这些函数的地址的动态链接到复制到您的系统正常 Excel 安装的一部分等效 Xlcall32.dll。）</span><span class="sxs-lookup"><span data-stu-id="d6268-127">(You can obtain the addresses of these functions by linking dynamically to the equivalent Xlcall32.dll that is copied to your system as part of a normal Excel installation.)</span></span> 
  
### <a name="xlcallcpp"></a><span data-ttu-id="d6268-128">Xlcall.cpp</span><span class="sxs-lookup"><span data-stu-id="d6268-128">Xlcall.cpp</span></span>

<span data-ttu-id="d6268-129">Excel 回调**Excel12**和**Excel12v**不会在 Xlcall32.lib 中导出。</span><span class="sxs-lookup"><span data-stu-id="d6268-129">The Excel callbacks **Excel12** and **Excel12v** are not exported in Xlcall32.lib.</span></span> <span data-ttu-id="d6268-130">这样可确保您创建从 Excel 2007 XLL 项目还将使用的 Excel 的早期版本。</span><span class="sxs-lookup"><span data-stu-id="d6268-130">This ensures that XLL projects that you create starting in Excel 2007 will also work with earlier versions of Excel.</span></span> <span data-ttu-id="d6268-131">Xlcall.cpp 模块包含代码的**Excel12**和**Excel12v**函数调用 Excel 条目点开始在 Excel 2007 中，或如果您运行的早期版本的 Excel 返回安全错误值。</span><span class="sxs-lookup"><span data-stu-id="d6268-131">The Xlcall.cpp module contains code for the **Excel12** and **Excel12v** functions, which call into an Excel entry point starting in Excel 2007, or return a safe error value if you are running an earlier version of Excel.</span></span> <span data-ttu-id="d6268-132">如果您想要创建 XLL 启动 Excel 2007 中运行的并且可以使用新的处理较大网格和更长时间的 Unicode 字符串数据类型，应在项目中包括的这一模块。</span><span class="sxs-lookup"><span data-stu-id="d6268-132">You should include this module in your project if you want to create an XLL that runs starting in Excel 2007 and that is able to use the new data types that handle larger grids and longer Unicode strings.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="d6268-133">从开始 Excel 2010 SDK，可以为 32 位和 64 位 Xll 编译此文件。</span><span class="sxs-lookup"><span data-stu-id="d6268-133">Starting with the Excel 2010 SDK, this file can be compiled for both 32-bit and 64-bit XLLs.</span></span> 
  
## <a name="turning-dlls-into-xlls-add-in-manager-interface-functions"></a><span data-ttu-id="d6268-134">关闭到 Xll Dll： 加载项管理器界面函数</span><span class="sxs-lookup"><span data-stu-id="d6268-134">Turning DLLs into XLLs: Add-in Manager Interface Functions</span></span>

<span data-ttu-id="d6268-135">XLL 是导出多个过程，由 Excel 或 Excel 加载项管理器调用 DLL。</span><span class="sxs-lookup"><span data-stu-id="d6268-135">An XLL is a DLL that exports several procedures that are called by Excel or the Excel Add-in Manager.</span></span> <span data-ttu-id="d6268-136">这些过程将此处简要描述和[加载项管理器和 XLL 接口函数](add-in-manager-and-xll-interface-functions.md)中详细讨论。</span><span class="sxs-lookup"><span data-stu-id="d6268-136">These procedures are described briefly here and discussed in detail in [Add-in Manager and XLL Interface Functions](add-in-manager-and-xll-interface-functions.md).</span></span> <span data-ttu-id="d6268-137">所有这些 DLL 回调开始前缀**xlAuto**。</span><span class="sxs-lookup"><span data-stu-id="d6268-137">All of these DLL callbacks start with the prefix **xlAuto**.</span></span> <span data-ttu-id="d6268-138">这些命令**xlAutoOpen**中，只有一个是必需的。</span><span class="sxs-lookup"><span data-stu-id="d6268-138">Only one of these, the command **xlAutoOpen**, is required.</span></span> <span data-ttu-id="d6268-139">调用外接程序激活时，它通常用于将注册 XLL 函数和命令通过 Excel 并执行其他初始化任务。</span><span class="sxs-lookup"><span data-stu-id="d6268-139">It is called when the add-in is activated, and it is typically used to register XLL functions and commands with Excel and to do other initialization tasks.</span></span> <span data-ttu-id="d6268-140">后面部分中提供的函数签名和示例实现的所有**xlAuto**功能。</span><span class="sxs-lookup"><span data-stu-id="d6268-140">The function signatures and example implementations of all of the **xlAuto** functions are provided in later sections.</span></span> 
  
<span data-ttu-id="d6268-141">即使**xlAutoOpen** ，这些回调只需要的一个加载项可能也需要导出其他人根据其行为。</span><span class="sxs-lookup"><span data-stu-id="d6268-141">Even though **xlAutoOpen** is the only required one of these callbacks, your add-in may also need to export others depending on its behavior.</span></span> 
  
<span data-ttu-id="d6268-142">Excel 2007 中引入的新的数据类型， **XLOPER12**，以容纳更大的网格并支持长 Unicode 字符串。</span><span class="sxs-lookup"><span data-stu-id="d6268-142">Excel 2007 introduced a new data type, **XLOPER12**, to accommodate larger grids and to support long Unicode strings.</span></span> <span data-ttu-id="d6268-143">本主题后面描述**XLOPER12** 。</span><span class="sxs-lookup"><span data-stu-id="d6268-143">**XLOPER12** is described later in this topic.</span></span> <span data-ttu-id="d6268-144">而**xlAuto**函数执行，或返回旧的数据类型**XLOPER**，这些函数的新版本中引入 Excel 2007 中使用**XLOPER12**数据类型。</span><span class="sxs-lookup"><span data-stu-id="d6268-144">Whereas **xlAuto** functions take or return the old data type **XLOPER**, new versions of these functions were introduced in Excel 2007 that use **XLOPER12** data types.</span></span> <span data-ttu-id="d6268-145">除外**xlAutoFree12**，其中您有时必须实现以避免**XLOPER12**内存泄漏，您可以安全地忽略所有版本 12 **xlAuto**功能，在这种情况下，在 Excel 2007 中，Excel 呼叫**XLOPER**启动版本。</span><span class="sxs-lookup"><span data-stu-id="d6268-145">With the exception of **xlAutoFree12**, which you must sometimes implement to avoid **XLOPER12** memory leaks, you can safely omit all the version 12 **xlAuto** functions, in which case, starting in Excel 2007, Excel calls the **XLOPER** versions.</span></span> 
  
### <a name="xlautoopen"></a><span data-ttu-id="d6268-146">xlAutoOpen</span><span class="sxs-lookup"><span data-stu-id="d6268-146">xlAutoOpen</span></span>

<span data-ttu-id="d6268-147">每当激活 XLL，Excel 将调用[xlAutoOpen](xlautoopen.md)函数。</span><span class="sxs-lookup"><span data-stu-id="d6268-147">Excel calls the [xlAutoOpen](xlautoopen.md) function whenever the XLL is activated.</span></span> <span data-ttu-id="d6268-148">外接程序将激活的 Excel 会话的起始处如果它成功，则通常结束的最后一个 Excel 会话中处于活动状态。</span><span class="sxs-lookup"><span data-stu-id="d6268-148">The add-in will be activated at the start of an Excel session if it was active in the last Excel session that ended normally.</span></span> <span data-ttu-id="d6268-149">外接程序被激活如果 Excel 会话过程中加载。</span><span class="sxs-lookup"><span data-stu-id="d6268-149">The add-in is activated if it is loaded during an Excel session.</span></span> <span data-ttu-id="d6268-150">外接程序可以停用和重新激活 Excel 会话期间，并重新激活调用的函数。</span><span class="sxs-lookup"><span data-stu-id="d6268-150">The add-in can be deactivated and reactivated during an Excel session, and the function is called on reactivation.</span></span> 
  
<span data-ttu-id="d6268-151">您应使用**xlAutoOpen** XLL 函数和命令注册、 初始化数据结构、 自定义用户界面，等等。</span><span class="sxs-lookup"><span data-stu-id="d6268-151">You should use **xlAutoOpen** to register XLL functions and commands, initialize data structures, customize the user interface, and so on.</span></span> 
  
<span data-ttu-id="d6268-152">如果加载项实现并将导出[xlAutoRegister](xlautoregister-xlautoregister12.md)函数或[xlAutoRegister12](xlautoregister-xlautoregister12.md)函数，Excel 可能会尝试激活并在不首先调用**xlAutoOpen**函数注册函数或命令。</span><span class="sxs-lookup"><span data-stu-id="d6268-152">If your add-in implements and exports the [xlAutoRegister](xlautoregister-xlautoregister12.md) function or the [xlAutoRegister12](xlautoregister-xlautoregister12.md) function, Excel might attempt to activate and register a function or command without first calling the **xlAutoOpen** function.</span></span> <span data-ttu-id="d6268-153">在这种情况下，您应该确保的加载项已足够初始化函数或命令可以正常运行。</span><span class="sxs-lookup"><span data-stu-id="d6268-153">In this case, you should ensure that your add-in is sufficiently initialized for your function or command to work properly.</span></span> <span data-ttu-id="d6268-154">如果不是这样，您应该也会失败尝试注册的函数或命令，或执行必要的初始化。</span><span class="sxs-lookup"><span data-stu-id="d6268-154">If it is not, you should either fail the attempt to register the function or command, or carry out the necessary initialization.</span></span> 
  
### <a name="xlautoclose"></a><span data-ttu-id="d6268-155">xlAutoClose</span><span class="sxs-lookup"><span data-stu-id="d6268-155">xlAutoClose</span></span>

<span data-ttu-id="d6268-156">每当在停用 XLL，Excel 将调用[xlAutoClose](xlautoclose.md)函数。</span><span class="sxs-lookup"><span data-stu-id="d6268-156">Excel calls the [xlAutoClose](xlautoclose.md) function whenever the XLL is deactivated.</span></span> <span data-ttu-id="d6268-157">外接程序将被停用时通常 Excel 会话结束。</span><span class="sxs-lookup"><span data-stu-id="d6268-157">The add-in will be deactivated when an Excel session ends normally.</span></span> <span data-ttu-id="d6268-158">如果外接程序停用用户 Excel 会话期间，则调用函数。</span><span class="sxs-lookup"><span data-stu-id="d6268-158">If the user deactivates the add-in during an Excel session, the function is called.</span></span> 
  
<span data-ttu-id="d6268-159">您应使用**xlAutoClose**注销函数和命令、 释放资源、 撤消自定义项，等等。</span><span class="sxs-lookup"><span data-stu-id="d6268-159">You should use **xlAutoClose** to unregister functions and commands, release resources, undo customizations, and so on.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="d6268-160">没有的函数和命令的注销的已知的问题。</span><span class="sxs-lookup"><span data-stu-id="d6268-160">There is a known issue with the unregistration of functions and commands.</span></span> <span data-ttu-id="d6268-161">有关详细信息，请参阅[Excel XLL 开发中的已知问题](known-issues-in-excel-xll-development.md)。</span><span class="sxs-lookup"><span data-stu-id="d6268-161">For more information, see [Known Issues in Excel XLL Development](known-issues-in-excel-xll-development.md).</span></span> 
  
### <a name="xlautoadd"></a><span data-ttu-id="d6268-162">xlAutoAdd</span><span class="sxs-lookup"><span data-stu-id="d6268-162">xlAutoAdd</span></span>

<span data-ttu-id="d6268-163">只要用户使用加载项管理器 Excel 会话过程中激活 XLL，Excel 将调用[xlAutoAdd 函数](xlautoadd.md)。</span><span class="sxs-lookup"><span data-stu-id="d6268-163">Excel calls the [xlAutoAdd function](xlautoadd.md) whenever the user activates the XLL during an Excel session by using the Add-In Manager.</span></span> <span data-ttu-id="d6268-164">Excel 启动和加载预安装的加载项时，不会调用此函数。</span><span class="sxs-lookup"><span data-stu-id="d6268-164">This function is not called when Excel starts and loads a preinstalled add-in.</span></span> 
  
<span data-ttu-id="d6268-165">可以使用此函数，以显示自定义对话框中，告知用户的外接程序已被激活，以读取或写入注册表中，或检查许可信息。</span><span class="sxs-lookup"><span data-stu-id="d6268-165">You can use this function to display a custom dialog box that tells the user that the add-in has been activated, to read from or write to the registry, or to check licensing information.</span></span>
  
### <a name="xlautoremove"></a><span data-ttu-id="d6268-166">xlAutoRemove</span><span class="sxs-lookup"><span data-stu-id="d6268-166">xlAutoRemove</span></span>

<span data-ttu-id="d6268-167">每当用户将停用 XLL Excel 会话过程中使用加载项管理器，Excel 将调用[xlAutoRemove](xlautoremove.md)函数。</span><span class="sxs-lookup"><span data-stu-id="d6268-167">Excel calls the [xlAutoRemove](xlautoremove.md) function whenever the user deactivates the XLL during an Excel session by using the Add-In Manager.</span></span> <span data-ttu-id="d6268-168">Excel 关闭会话时，通常或异常，与安装的加载项时，不会调用此函数。</span><span class="sxs-lookup"><span data-stu-id="d6268-168">This function is not called when an Excel session closes, normally or abnormally, with the add-in installed.</span></span> 
  
<span data-ttu-id="d6268-169">您可以使用此函数显示一个自定义的对话框，通知用户外, 接程序已停用，或者从读取或写入到注册表。</span><span class="sxs-lookup"><span data-stu-id="d6268-169">You can use this function to display a custom dialog box that tells the user that the add-in has been deactivated, or to read from or write to the registry.</span></span>
  
### <a name="xladdinmanagerinfoxladdinmanagerinfo12"></a><span data-ttu-id="d6268-170">xlAddInManagerInfo/xlAddInManagerInfo12</span><span class="sxs-lookup"><span data-stu-id="d6268-170">xlAddInManagerInfo/xlAddInManagerInfo12</span></span>

<span data-ttu-id="d6268-171">Excel 会话中第一次调用的加载项管理器时，Excel 将调用[xlAddInManagerInfo](xladdinmanagerinfo-xladdinmanagerinfo12.md)函数。</span><span class="sxs-lookup"><span data-stu-id="d6268-171">Excel calls the [xlAddInManagerInfo](xladdinmanagerinfo-xladdinmanagerinfo12.md) function when the Add-in Manager is invoked for the first time in an Excel session.</span></span> <span data-ttu-id="d6268-172">如果 Excel 将传递参数等于 1，此函数应该返回的字符串 （通常的外接程序的名称）;否则，它应返回 **#VALUE ！**。</span><span class="sxs-lookup"><span data-stu-id="d6268-172">If Excel passes an argument equal to 1, this function should return a string (typically, the name of the add-in); otherwise, it should return **#VALUE!**.</span></span>
  
<span data-ttu-id="d6268-173">从 Excel 2007 开始，Excel 调用优先于**xlAddInManagerInfo**函数**xlAddInManagerInfo12**函数的操作，如果它通过 XLL 导出。</span><span class="sxs-lookup"><span data-stu-id="d6268-173">Starting in Excel 2007, Excel calls the **xlAddInManagerInfo12** function in preference to the **xlAddInManagerInfo** function if it is exported by the XLL.</span></span> <span data-ttu-id="d6268-174">**XlAddInManagerInfo12**函数应都以相同的方式为**xlAddInManagerInfo**函数以避免 XLL 的行为的特定于版本的差异。</span><span class="sxs-lookup"><span data-stu-id="d6268-174">The **xlAddInManagerInfo12** function should work in the same way as the **xlAddInManagerInfo** function to avoid version-specific differences in the behavior of the XLL.</span></span> <span data-ttu-id="d6268-175">**XlAddInManagerInfo12**函数应返回**XLOPER12**数据类型，而**xlAddInManagerInfo**函数应返回**XLOPER**数据类型。</span><span class="sxs-lookup"><span data-stu-id="d6268-175">The **xlAddInManagerInfo12** function should return an **XLOPER12** data type, whereas the **xlAddInManagerInfo** function should return an **XLOPER** data type.</span></span> 
  
### <a name="xlautoregisterxlautoregister12"></a><span data-ttu-id="d6268-176">xlAutoRegister/xlAutoRegister12</span><span class="sxs-lookup"><span data-stu-id="d6268-176">xlAutoRegister/xlAutoRegister12</span></span>

<span data-ttu-id="d6268-177">Excel 调用[xlAutoRegister](xlautoregister-xlautoregister12.md)函数，只要呼叫已**注册**，XLM 函数或 C API 等效[xlfRegister](xlfregister-form-1.md)函数，返回到和缺少要所注册的函数的参数类型。</span><span class="sxs-lookup"><span data-stu-id="d6268-177">Excel calls the [xlAutoRegister](xlautoregister-xlautoregister12.md) function whenever a call has been made to the XLM function **REGISTER**, or the C API equivalent [xlfRegister](xlfregister-form-1.md) function, with the return and argument types missing for the function being registered.</span></span> <span data-ttu-id="d6268-178">使用**xlAutoRegister**功能，XLL 搜索其内部导出的函数和命令来注册功能使用参数并返回指定的类型的列表。</span><span class="sxs-lookup"><span data-stu-id="d6268-178">The **xlAutoRegister** function allows the XLL to search its internal lists of exported functions and commands to register the function with the argument and return the specified types.</span></span> 
  
<span data-ttu-id="d6268-179">从 Excel 2007 开始，Excel 调用优先于**xlAddInRegister**函数**xlAddInRegister12**函数的操作，如果它通过 XLL 导出。</span><span class="sxs-lookup"><span data-stu-id="d6268-179">Starting in Excel 2007, Excel calls the **xlAddInRegister12** function in preference to the **xlAddInRegister** function if it is exported by the XLL.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="d6268-180">如果**xlAddInRegister**/ **xlAddInRegister12**尝试函数注册无需提供参数和返回类型，调用循环递归发生的最终溢出 call 堆栈并使 Excel 关闭或停止响应。</span><span class="sxs-lookup"><span data-stu-id="d6268-180">If **xlAddInRegister**/ **xlAddInRegister12** tries to register the function without supplying the argument and return types, a recursive calling loop occurs that eventually overflows the call stack and causes Excel to close or stop responding.</span></span> 
  
### <a name="xlautofreexlautofree12"></a><span data-ttu-id="d6268-181">xlAutoFree/xlAutoFree12</span><span class="sxs-lookup"><span data-stu-id="d6268-181">xlAutoFree/xlAutoFree12</span></span>

<span data-ttu-id="d6268-182">Excel XLL 工作表函数返回**XLOPER**后立即调用[xlAutoFree/xlAutoFree12](xlautofree-xlautofree12.md)函数/ **XLOPER12**数据类型设置一个标志来告知 Excel XLL 仍需要释放的内存。</span><span class="sxs-lookup"><span data-stu-id="d6268-182">Excel calls the [xlAutoFree/xlAutoFree12](xlautofree-xlautofree12.md) function just after an XLL worksheet function returns an **XLOPER**/ **XLOPER12** data type with a flag set that tells Excel there is memory that the XLL still needs to release.</span></span> <span data-ttu-id="d6268-183">这样，XLL 返回动态分配数组、 字符串和不内存泄漏工作表的外部引用。</span><span class="sxs-lookup"><span data-stu-id="d6268-183">This enables the XLL to return dynamically allocated arrays, strings, and external references to the worksheet without memory leaks.</span></span> <span data-ttu-id="d6268-184">从 Excel 2007 开始，支持**XLOPER12**数据类型。</span><span class="sxs-lookup"><span data-stu-id="d6268-184">Starting in Excel 2007, the **XLOPER12** data type is supported.</span></span> <span data-ttu-id="d6268-185">有关详细信息，请参阅[在 Excel 中进行内存管理](memory-management-in-excel.md)。</span><span class="sxs-lookup"><span data-stu-id="d6268-185">For more information, see [Memory Management in Excel](memory-management-in-excel.md).</span></span>
  
> [!NOTE]
> <span data-ttu-id="d6268-186">从 Excel 2007 开始，当 Excel 配置为使用多线程的工作表重新计算， **xlAutoFree**/ **xlAutoFree12**函数调用只用于调用的函数的返回它的同一线程。</span><span class="sxs-lookup"><span data-stu-id="d6268-186">Starting in Excel 2007, when Excel is configured to use multithreaded worksheet recalculation, the **xlAutoFree**/ **xlAutoFree12** function is called on the same thread that was just used to call the function that returned it.</span></span> <span data-ttu-id="d6268-187">调用**xlAutoFree**/ **xlAutoFree12**始终进行更改之前在该线程上进行评估任何后续的工作表的单元格。</span><span class="sxs-lookup"><span data-stu-id="d6268-187">The call to **xlAutoFree**/ **xlAutoFree12** is always made before any subsequent worksheet cells are evaluated on that thread.</span></span> <span data-ttu-id="d6268-188">这样可简化您 XLL 中的线程安全设计。</span><span class="sxs-lookup"><span data-stu-id="d6268-188">This simplifies thread-safe design in your XLL.</span></span> <span data-ttu-id="d6268-189">有关详细信息，请参阅[在 Excel 中的多线程重新计算](multithreaded-recalculation-in-excel.md)。</span><span class="sxs-lookup"><span data-stu-id="d6268-189">For more information, see [Multithreaded Recalculation in Excel](multithreaded-recalculation-in-excel.md).</span></span> 
  
### <a name="creating-64-bit-xlls"></a><span data-ttu-id="d6268-190">创建 64-bit xll （英文）</span><span class="sxs-lookup"><span data-stu-id="d6268-190">Creating 64-bit XLLs</span></span>

<span data-ttu-id="d6268-191">Excel 和用户定义的函数可以充分利用性能优点 32 位操作系统上的 64 位操作系统上运行。</span><span class="sxs-lookup"><span data-stu-id="d6268-191">Excel and user-defined functions can run on 64-bit operating systems to take advantage of performance benefits over 32-bit operating systems.</span></span> <span data-ttu-id="d6268-192">Excel 中包含的数据的类型信息的**XLOPER12**结构传递值。</span><span class="sxs-lookup"><span data-stu-id="d6268-192">Excel passes values in **XLOPER12** structures that include information about the types for the data.</span></span> <span data-ttu-id="d6268-193">**XLOPER12**结构中的值与本机类型，如**int**或指针以保留中更大的类型的值之间进行转换时应谨慎。</span><span class="sxs-lookup"><span data-stu-id="d6268-193">Be careful when you convert between values in the **XLOPER12** structure and native types like **int** or pointers to preserve the values in the larger type.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="d6268-194">另请参阅</span><span class="sxs-lookup"><span data-stu-id="d6268-194">See also</span></span>



[<span data-ttu-id="d6268-195">从函数向导或替换对话框调用 XLL 函数</span><span class="sxs-lookup"><span data-stu-id="d6268-195">Call XLL Functions from the Function Wizard or Replace Dialog Boxes</span></span>](how-to-call-xll-functions-from-the-function-wizard-or-replace-dialog-boxes.md)
  
[<span data-ttu-id="d6268-196">加载项管理器和 XLL 接口函数</span><span class="sxs-lookup"><span data-stu-id="d6268-196">Add-in Manager and XLL Interface Functions</span></span>](add-in-manager-and-xll-interface-functions.md)
  
[<span data-ttu-id="d6268-197">Developing Excel XLLs</span><span class="sxs-lookup"><span data-stu-id="d6268-197">Developing Excel XLLs</span></span>](developing-excel-xlls.md)

