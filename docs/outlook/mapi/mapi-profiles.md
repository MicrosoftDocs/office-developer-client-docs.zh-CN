---
title: MAPI 配置文件
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 493c87a4-317d-47ec-850b-342cac59594b
description: 上次修改时间：2015 年 3 月 9 日
ms.openlocfilehash: 7f241fde8aedeae9debc66f728ee21c1c6bed6fb
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/11/2018
ms.locfileid: "19776286"
---
# <a name="mapi-profiles"></a><span data-ttu-id="8fc78-103">MAPI 配置文件</span><span class="sxs-lookup"><span data-stu-id="8fc78-103">MAPI Profiles</span></span>

  
  
<span data-ttu-id="8fc78-104">**适用于**： Outlook</span><span class="sxs-lookup"><span data-stu-id="8fc78-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="8fc78-105">一个配置文件存储有关服务提供商和消息服务的计算机上安装的信息。</span><span class="sxs-lookup"><span data-stu-id="8fc78-105">A profile stores information about service providers and message services that are installed on a computer.</span></span> <span data-ttu-id="8fc78-106">对于每个会话，客户端登录时选择介绍要使用的提供程序和服务的一个配置文件。</span><span class="sxs-lookup"><span data-stu-id="8fc78-106">For every session, a client at logon time selects one profile that describes the providers and services to be used.</span></span> <span data-ttu-id="8fc78-107">客户端都可以选择配置文件的集合中，并如果需要，建立一个为默认值。</span><span class="sxs-lookup"><span data-stu-id="8fc78-107">A client can choose from a collection of profiles and, if desired, establish one as the default.</span></span> <span data-ttu-id="8fc78-108">当客户端启动会话和未显式指定一个配置文件时自动选择的配置文件的默认配置文件。</span><span class="sxs-lookup"><span data-stu-id="8fc78-108">The default profile is the profile that is selected automatically when a client starts a session and has not explicitly specified a profile.</span></span>
  
<span data-ttu-id="8fc78-109">此外在这些主题中，您将了解讨论昵称缓存，存储在二进制流。</span><span class="sxs-lookup"><span data-stu-id="8fc78-109">Also in these topics, you will find a discussion of the nickname cache, which is stored in a binary stream.</span></span>
  
- [<span data-ttu-id="8fc78-110">别名缓存</span><span class="sxs-lookup"><span data-stu-id="8fc78-110">Nickname cache</span></span>](nickname-cache.md)
    
- [<span data-ttu-id="8fc78-111">自动完成流</span><span class="sxs-lookup"><span data-stu-id="8fc78-111">Autocomplete Stream</span></span>](autocomplete-stream.md)
    
- [<span data-ttu-id="8fc78-112">分析的二进制文件</span><span class="sxs-lookup"><span data-stu-id="8fc78-112">Binary File Parsing</span></span>](http://portalvhds6gyn3khqwmgzd.blob.core.windows.net/files/NK2/NK2WithBinaryExample.pdf)
    
## <a name="profile-sections"></a><span data-ttu-id="8fc78-113">配置文件节</span><span class="sxs-lookup"><span data-stu-id="8fc78-113">Profile Sections</span></span>

<span data-ttu-id="8fc78-114">配置文件可分为部分的客户端和服务提供商访问向用户显示配置文件属性，或进行配置更改。</span><span class="sxs-lookup"><span data-stu-id="8fc78-114">Profiles are divided into sections that clients and service providers access to display profile properties to users or to make configuration changes.</span></span> <span data-ttu-id="8fc78-115">配置文件部分是实现**IProfSect**接口的 MAPI 对象、 派生自**IMAPIProp** ，没有任何其他方法的接口。</span><span class="sxs-lookup"><span data-stu-id="8fc78-115">A profile section is a MAPI object that implements the **IProfSect** interface, an interface that derives from **IMAPIProp** and has no additional methods.</span></span> <span data-ttu-id="8fc78-116">有关详细信息，请参阅[IProfSect: IMAPIProp](iprofsectimapiprop.md)。</span><span class="sxs-lookup"><span data-stu-id="8fc78-116">For more information, see [IProfSect : IMAPIProp](iprofsectimapiprop.md).</span></span> <span data-ttu-id="8fc78-117">其唯一用途是操作配置文件节的属性。</span><span class="sxs-lookup"><span data-stu-id="8fc78-117">Its only purpose is to manipulate the properties of a profile section.</span></span> <span data-ttu-id="8fc78-118">若要检索到特定配置文件部分**IProfSect**指针，客户端和服务提供商，请调用以下方法。</span><span class="sxs-lookup"><span data-stu-id="8fc78-118">To retrieve an **IProfSect** pointer to a particular profile section, clients and service providers call the following methods.</span></span> 
  
|||
|:-----|:-----|
|<span data-ttu-id="8fc78-119">客户端可以调用：</span><span class="sxs-lookup"><span data-stu-id="8fc78-119">Clients can call:</span></span>  <br/> |[<span data-ttu-id="8fc78-120">IMAPISession::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="8fc78-120">IMAPISession::OpenProfileSection</span></span>](imapisession-openprofilesection.md) <br/> |
|<span data-ttu-id="8fc78-121">服务提供商可以呼叫：</span><span class="sxs-lookup"><span data-stu-id="8fc78-121">Service providers can call:</span></span>  <br/> |[<span data-ttu-id="8fc78-122">IMAPISupport::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="8fc78-122">IMAPISupport::OpenProfileSection</span></span>](imapisupport-openprofilesection.md) <br/> |
|<span data-ttu-id="8fc78-123">客户端或提供程序可以呼叫：</span><span class="sxs-lookup"><span data-stu-id="8fc78-123">Either clients or providers can call:</span></span>  <br/> |[<span data-ttu-id="8fc78-124">IProviderAdmin::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="8fc78-124">IProviderAdmin::OpenProfileSection</span></span>](iprovideradmin-openprofilesection.md) <br/> |
   
<span data-ttu-id="8fc78-125">配置文件分层组织得多 MAPISVC 类似。INF 文件。</span><span class="sxs-lookup"><span data-stu-id="8fc78-125">Profiles are organized hierarchically much like the MAPISVC.INF file.</span></span> <span data-ttu-id="8fc78-126">在层次结构的顶部，有包含相关的配置文件信息的配置文件部分。</span><span class="sxs-lookup"><span data-stu-id="8fc78-126">At the top of the hierarchy, there are profile sections that contain information relevant to the profile.</span></span> <span data-ttu-id="8fc78-127">中间级别包括各节包含有关特定消息服务的信息和较低级别包括各节包含有关之一的消息服务的服务提供商信息。</span><span class="sxs-lookup"><span data-stu-id="8fc78-127">The middle level includes sections that contain information about a particular message service and the lower level includes sections that contain information about one of the service providers in a message service.</span></span> 
  
<span data-ttu-id="8fc78-128">每个配置文件具有存储在一个或多个配置文件的节中的多个必需的属性。</span><span class="sxs-lookup"><span data-stu-id="8fc78-128">Every profile has several required properties that are stored in one or more of the sections of the profile.</span></span> <span data-ttu-id="8fc78-129">例如，每个配置文件将具有**PR_PROFILE_NAME** ([PidTagProfileName](pidtagprofilename-canonical-property.md)) 和**PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) 属性。</span><span class="sxs-lookup"><span data-stu-id="8fc78-129">For example, every profile has the **PR_PROFILE_NAME** ([PidTagProfileName](pidtagprofilename-canonical-property.md)) and **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) properties.</span></span> <span data-ttu-id="8fc78-130">配置文件的搜索键设置为 MAPIGUID 中定义的值。作为 MUID_PROFILE_INSTANCE H，始终能保证所有配置文件中是唯一的。</span><span class="sxs-lookup"><span data-stu-id="8fc78-130">A profile's search key is set to the value defined in MAPIGUID.H as MUID_PROFILE_INSTANCE and is always guaranteed to be unique among all profiles.</span></span> <span data-ttu-id="8fc78-131">尽管两个配置文件可以具有相同的名称，但他们不能具有相同的搜索键。</span><span class="sxs-lookup"><span data-stu-id="8fc78-131">Although two profiles can have the same name, they cannot have the same search key.</span></span> <span data-ttu-id="8fc78-132">搜索键应视为二进制数据，而不是任何特定类型的数据。</span><span class="sxs-lookup"><span data-stu-id="8fc78-132">Search keys should be treated as binary data instead of data of any particular type.</span></span>
  
<span data-ttu-id="8fc78-133">消息存储提供程序所需的配置文件配置文件各节中包括其消息存储**PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) 属性和其消息存储提供程序并为保持同步这些条目。</span><span class="sxs-lookup"><span data-stu-id="8fc78-133">Message store providers are required to include their message store's **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) property in the profile sections for the profile and for their message store provider and to keep these entries synchronized.</span></span> <span data-ttu-id="8fc78-134">时创建的消息存储、 提供程序设置**PR_DISPLAY_NAME**基于这些配置文件各节中存储的值。</span><span class="sxs-lookup"><span data-stu-id="8fc78-134">When a message store is created, the provider sets **PR_DISPLAY_NAME** based on the value stored in these profile sections.</span></span> 
  
<span data-ttu-id="8fc78-135">有配置文件部分和继承**IMAPIProp**其他对象的两个主要区别：</span><span class="sxs-lookup"><span data-stu-id="8fc78-135">There are two major differences between profile sections and other objects that inherit from **IMAPIProp**:</span></span> 
  
- <span data-ttu-id="8fc78-136">配置文件部分不支持事务。</span><span class="sxs-lookup"><span data-stu-id="8fc78-136">Profile sections do not support transactions.</span></span>
    
- <span data-ttu-id="8fc78-137">配置文件部分不支持命名的属性，返回 MAPI_E_NO_SUPPORT 从其**IMAPIProp::GetIDsFromNames**和**IMAPIProp::GetNamesFromIDs**实现。</span><span class="sxs-lookup"><span data-stu-id="8fc78-137">Profile sections do not support named properties, returning MAPI_E_NO_SUPPORT from their **IMAPIProp::GetIDsFromNames** and **IMAPIProp::GetNamesFromIDs** implementations.</span></span> <span data-ttu-id="8fc78-138">有关详细信息，请参阅[IMAPIProp::GetIDsFromNames](imapiprop-getidsfromnames.md)和[IMAPIProp::GetNamesFromIDs](imapiprop-getnamesfromids.md)。</span><span class="sxs-lookup"><span data-stu-id="8fc78-138">For more information, see [IMAPIProp::GetIDsFromNames](imapiprop-getidsfromnames.md) and [IMAPIProp::GetNamesFromIDs](imapiprop-getnamesfromids.md).</span></span>
    
<span data-ttu-id="8fc78-139">因为配置文件部分不支持事务，通过调用**IMAPIProp::CopyProps**，所做的任何更改**CopyTo**或**SetProps**立即生效。</span><span class="sxs-lookup"><span data-stu-id="8fc78-139">Because profile sections do not support transactions, any changes made with calls to **IMAPIProp::CopyProps**, **CopyTo**, or **SetProps** immediately take effect.</span></span> <span data-ttu-id="8fc78-140">有关详细信息，请参阅[IMAPIProp::CopyProps](imapiprop-copyprops.md)。</span><span class="sxs-lookup"><span data-stu-id="8fc78-140">For more information, see [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span></span> <span data-ttu-id="8fc78-141">客户端和服务提供商可以调用配置文件节的**IMAPIProp::SaveChanges**方法和它会成功，但它不会影响的配置文件部分数据。</span><span class="sxs-lookup"><span data-stu-id="8fc78-141">Clients and service providers can call a profile section's **IMAPIProp::SaveChanges** method and it will succeed, but it does not affect the profile section data.</span></span> <span data-ttu-id="8fc78-142">有关详细信息，请参阅[IMAPIProp::SaveChanges](imapiprop-savechanges.md)。</span><span class="sxs-lookup"><span data-stu-id="8fc78-142">For more information, see [IMAPIProp::SaveChanges](imapiprop-savechanges.md).</span></span> <span data-ttu-id="8fc78-143">具有立即发生的更改会影响服务提供程序如何实现属性工作表的客户端用于向用户显示配置文件属性。</span><span class="sxs-lookup"><span data-stu-id="8fc78-143">Having changes occur immediately can affect how service providers implement the property sheets that clients use to display profile properties to users.</span></span> <span data-ttu-id="8fc78-144">希望用户能够推迟或撤消更改的服务提供商必须实现其属性表与配置文件而不是实际的节的节的副本。</span><span class="sxs-lookup"><span data-stu-id="8fc78-144">Service providers that want users to be able to postpone or undo changes must implement their property sheets with copies of profile sections instead of the real sections.</span></span> <span data-ttu-id="8fc78-145">通过使用副本，用户可以进行更改，然后更高版本取消这些更改中，保留原始的配置文件部分不变。</span><span class="sxs-lookup"><span data-stu-id="8fc78-145">By using copies, users can make changes and then later cancel those changes, leaving the original profile sections untouched.</span></span> 
  
<span data-ttu-id="8fc78-146">信息配置文件中的显示的顺序将影响 MAPI 如何配置资源和会话中进行工作分配。</span><span class="sxs-lookup"><span data-stu-id="8fc78-146">The order in which information appears in a profile affects how MAPI configures resources and makes assignments in a session.</span></span> <span data-ttu-id="8fc78-147">下面的工作分配受 profile 顺序：</span><span class="sxs-lookup"><span data-stu-id="8fc78-147">The following assignments are affected by profile order:</span></span>
  
- <span data-ttu-id="8fc78-148">默认邮件存储区</span><span class="sxs-lookup"><span data-stu-id="8fc78-148">Default message store</span></span>
    
- <span data-ttu-id="8fc78-149">个人通讯簿</span><span class="sxs-lookup"><span data-stu-id="8fc78-149">Personal address book</span></span>
    
- <span data-ttu-id="8fc78-150">默认消息存储搜索路径</span><span class="sxs-lookup"><span data-stu-id="8fc78-150">Default message store search path</span></span>
    
- <span data-ttu-id="8fc78-151">默认通讯簿搜索路径</span><span class="sxs-lookup"><span data-stu-id="8fc78-151">Default address book search path</span></span>
    
- <span data-ttu-id="8fc78-152">传输提供程序的顺序</span><span class="sxs-lookup"><span data-stu-id="8fc78-152">Transport provider order</span></span>
    
<span data-ttu-id="8fc78-153">MAPI 设置默认的邮件存储为具有其**PR_RESOURCE_FLAGS** ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md)) 属性，指示它可以是默认存储中设置 STATUS_DEFAULT_STORE 标志的配置文件中的第一个邮件存储。</span><span class="sxs-lookup"><span data-stu-id="8fc78-153">MAPI sets the default message store to be the first message store in the profile that has the STATUS_DEFAULT_STORE flag set in its **PR_RESOURCE_FLAGS** ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md)) property, which indicates that it can be the default store.</span></span> <span data-ttu-id="8fc78-154">客户端可以通过调用**IMAPISession::SetDefaultStore**覆盖此设置。</span><span class="sxs-lookup"><span data-stu-id="8fc78-154">Clients can override this setting by calling **IMAPISession::SetDefaultStore**.</span></span> <span data-ttu-id="8fc78-155">有关详细信息，请参阅[IMAPISession::SetDefaultStore](imapisession-setdefaultstore.md)。</span><span class="sxs-lookup"><span data-stu-id="8fc78-155">For more information, see [IMAPISession::SetDefaultStore](imapisession-setdefaultstore.md).</span></span>
  
<span data-ttu-id="8fc78-156">MAPI 创建用于处理传出和传入邮件传输顺序。</span><span class="sxs-lookup"><span data-stu-id="8fc78-156">MAPI creates a transport order for handling outgoing and incoming messages.</span></span> <span data-ttu-id="8fc78-157">当多个传输提供程序已注册为特定类型的一条消息时，MAPI 将使用此顺序来确定哪些提供程序应处理邮件。</span><span class="sxs-lookup"><span data-stu-id="8fc78-157">When more than one transport provider has registered for a message of a particular type, MAPI uses this order to determine which provider should handle the message.</span></span> <span data-ttu-id="8fc78-158">MAPI 设置传输顺序为其提供程序已添加到有一个例外-STATUS_XP_PREFER_LAST 标志设置其**PR_RESOURCE_FLAGS**属性中的传输配置文件传输的顺序的放置上次的顺序。</span><span class="sxs-lookup"><span data-stu-id="8fc78-158">MAPI sets the transport order to be the order in which the transport providers were added to the profile with one exception--the transports that set the STATUS_XP_PREFER_LAST flag in their **PR_RESOURCE_FLAGS** property are positioned last in the order.</span></span> <span data-ttu-id="8fc78-159">客户端可以通过调用**IMsgServiceAdmin::MsgServiceTransportOrder**设置传输顺序。</span><span class="sxs-lookup"><span data-stu-id="8fc78-159">Clients can set the transport order by calling **IMsgServiceAdmin::MsgServiceTransportOrder**.</span></span> <span data-ttu-id="8fc78-160">有关详细信息，请参阅[IMsgServiceAdmin::MsgServiceTransportOrder](imsgserviceadmin-msgservicetransportorder.md)。</span><span class="sxs-lookup"><span data-stu-id="8fc78-160">For more information, see [IMsgServiceAdmin::MsgServiceTransportOrder](imsgserviceadmin-msgservicetransportorder.md).</span></span>
  
<span data-ttu-id="8fc78-161">排序服务提供商和消息服务这些准则有时可能会发生冲突。</span><span class="sxs-lookup"><span data-stu-id="8fc78-161">These guidelines for ordering service providers and message services might sometimes conflict.</span></span> <span data-ttu-id="8fc78-162">如果没有冲突，则代码应解决冲突。</span><span class="sxs-lookup"><span data-stu-id="8fc78-162">If there is a conflict, your code should resolve the conflict.</span></span> <span data-ttu-id="8fc78-163">您可以使用邮件控制面板程序检查已创建以确定是否按预期方式已配置提供程序的配置文件。</span><span class="sxs-lookup"><span data-stu-id="8fc78-163">You can use the Mail Control Panel program to inspect a profile that you have created to determine whether the providers have been configured as expected.</span></span>
  

