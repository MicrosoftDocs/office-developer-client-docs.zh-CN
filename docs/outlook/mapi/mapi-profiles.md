---
title: MAPI 配置文件
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 493c87a4-317d-47ec-850b-342cac59594b
description: 上次修改时间：2015 年 3 月 9 日
ms.openlocfilehash: 9db1f8e163e44a44df1e798cebccb3639325275e
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "32340080"
---
# <a name="mapi-profiles"></a><span data-ttu-id="3d1aa-103">MAPI 配置文件</span><span class="sxs-lookup"><span data-stu-id="3d1aa-103">MAPI Profiles</span></span>

  
  
<span data-ttu-id="3d1aa-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="3d1aa-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="3d1aa-105">配置文件存储有关计算机上安装的服务提供商和邮件服务的信息。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-105">A profile stores information about service providers and message services that are installed on a computer.</span></span> <span data-ttu-id="3d1aa-106">对于每个会话，登录时客户端都会选择一个描述要使用的提供程序和服务的配置文件。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-106">For every session, a client at logon time selects one profile that describes the providers and services to be used.</span></span> <span data-ttu-id="3d1aa-107">客户端可以从配置文件集合中选择，如果需要，将一个配置文件设置为默认值。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-107">A client can choose from a collection of profiles and, if desired, establish one as the default.</span></span> <span data-ttu-id="3d1aa-108">默认配置文件是在客户端启动会话时自动选择的配置文件，并且尚未显式指定配置文件。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-108">The default profile is the profile that is selected automatically when a client starts a session and has not explicitly specified a profile.</span></span>
  
<span data-ttu-id="3d1aa-109">此外，在这些主题中，你将找到有关昵称缓存的讨论，该缓存存储在二进制流中。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-109">Also in these topics, you will find a discussion of the nickname cache, which is stored in a binary stream.</span></span>
  
- [<span data-ttu-id="3d1aa-110">别名缓存</span><span class="sxs-lookup"><span data-stu-id="3d1aa-110">Nickname cache</span></span>](nickname-cache.md)
    
- [<span data-ttu-id="3d1aa-111">自动完成 Stream</span><span class="sxs-lookup"><span data-stu-id="3d1aa-111">Autocomplete Stream</span></span>](autocomplete-stream.md)
    
- [<span data-ttu-id="3d1aa-112">二进制文件分析</span><span class="sxs-lookup"><span data-stu-id="3d1aa-112">Binary File Parsing</span></span>](https://portalvhds6gyn3khqwmgzd.blob.core.windows.net/files/NK2/NK2WithBinaryExample.pdf)
    
## <a name="profile-sections"></a><span data-ttu-id="3d1aa-113">配置文件节</span><span class="sxs-lookup"><span data-stu-id="3d1aa-113">Profile Sections</span></span>

<span data-ttu-id="3d1aa-114">配置文件分为多个部分，客户端和服务提供商访问这些部分向用户显示配置文件属性或更改配置。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-114">Profiles are divided into sections that clients and service providers access to display profile properties to users or to make configuration changes.</span></span> <span data-ttu-id="3d1aa-115">配置文件节是一个实现 **IProfSect** 接口的 MAPI 对象，它是一个派生自 **IMAPIProp** 且没有其他方法的接口。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-115">A profile section is a MAPI object that implements the **IProfSect** interface, an interface that derives from **IMAPIProp** and has no additional methods.</span></span> <span data-ttu-id="3d1aa-116">有关详细信息，请参阅 [IProfSect ： IMAPIProp](iprofsectimapiprop.md)。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-116">For more information, see [IProfSect : IMAPIProp](iprofsectimapiprop.md).</span></span> <span data-ttu-id="3d1aa-117">它的唯一用途是操作配置文件节的属性。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-117">Its only purpose is to manipulate the properties of a profile section.</span></span> <span data-ttu-id="3d1aa-118">若要检索指向特定配置文件节的 **IProfSect** 指针，客户端和服务提供商将调用以下方法。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-118">To retrieve an **IProfSect** pointer to a particular profile section, clients and service providers call the following methods.</span></span> 
  
|||
|:-----|:-----|
|<span data-ttu-id="3d1aa-119">客户端可以调用：</span><span class="sxs-lookup"><span data-stu-id="3d1aa-119">Clients can call:</span></span>  <br/> |[<span data-ttu-id="3d1aa-120">IMAPISession::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="3d1aa-120">IMAPISession::OpenProfileSection</span></span>](imapisession-openprofilesection.md) <br/> |
|<span data-ttu-id="3d1aa-121">服务提供商可以调用：</span><span class="sxs-lookup"><span data-stu-id="3d1aa-121">Service providers can call:</span></span>  <br/> |[<span data-ttu-id="3d1aa-122">IMAPISupport::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="3d1aa-122">IMAPISupport::OpenProfileSection</span></span>](imapisupport-openprofilesection.md) <br/> |
|<span data-ttu-id="3d1aa-123">客户端或提供程序可以调用：</span><span class="sxs-lookup"><span data-stu-id="3d1aa-123">Either clients or providers can call:</span></span>  <br/> |[<span data-ttu-id="3d1aa-124">IProviderAdmin::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="3d1aa-124">IProviderAdmin::OpenProfileSection</span></span>](iprovideradmin-openprofilesection.md) <br/> |
   
<span data-ttu-id="3d1aa-125">配置文件按层次结构进行组织，与 MAPISVC 非常类似。INF 文件。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-125">Profiles are organized hierarchically much like the MAPISVC.INF file.</span></span> <span data-ttu-id="3d1aa-126">在层次结构的顶部，有一些配置文件部分包含与配置文件有关的信息。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-126">At the top of the hierarchy, there are profile sections that contain information relevant to the profile.</span></span> <span data-ttu-id="3d1aa-127">中间级别包括包含有关特定邮件服务的信息的部分，而较低级别包括包含有关邮件服务中某个服务提供程序的信息的节。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-127">The middle level includes sections that contain information about a particular message service and the lower level includes sections that contain information about one of the service providers in a message service.</span></span> 
  
<span data-ttu-id="3d1aa-128">每个配置文件具有多个必需属性，这些属性存储在配置文件的一个或多个部分中。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-128">Every profile has several required properties that are stored in one or more of the sections of the profile.</span></span> <span data-ttu-id="3d1aa-129">例如，每个配置文件都有 PR_PROFILE_NAME  ([PidTagProfileName](pidtagprofilename-canonical-property.md)) 和 **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) 属性。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-129">For example, every profile has the **PR_PROFILE_NAME** ([PidTagProfileName](pidtagprofilename-canonical-property.md)) and **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) properties.</span></span> <span data-ttu-id="3d1aa-130">配置文件的搜索键设置为 MAPIGUID 中定义的值。H 作为MUID_PROFILE_INSTANCE，并且始终保证在所有配置文件中是唯一的。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-130">A profile's search key is set to the value defined in MAPIGUID.H as MUID_PROFILE_INSTANCE and is always guaranteed to be unique among all profiles.</span></span> <span data-ttu-id="3d1aa-131">尽管两个配置文件可以具有相同的名称，但是它们不能具有相同的搜索键。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-131">Although two profiles can have the same name, they cannot have the same search key.</span></span> <span data-ttu-id="3d1aa-132">搜索键应视为二进制数据，而不是任何特定类型的数据。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-132">Search keys should be treated as binary data instead of data of any particular type.</span></span>
  
<span data-ttu-id="3d1aa-133">邮件存储提供程序需要将邮件存储的 **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) 属性包括在配置文件及其邮件存储提供程序的配置文件部分中，并保持这些条目同步。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-133">Message store providers are required to include their message store's **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) property in the profile sections for the profile and for their message store provider and to keep these entries synchronized.</span></span> <span data-ttu-id="3d1aa-134">创建邮件存储时，提供程序PR_DISPLAY_NAME配置文件部分中存储的值设置邮件存储。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-134">When a message store is created, the provider sets **PR_DISPLAY_NAME** based on the value stored in these profile sections.</span></span> 
  
<span data-ttu-id="3d1aa-135">配置文件部分与继承自 **IMAPIProp** 的其他对象之间存在两个主要区别：</span><span class="sxs-lookup"><span data-stu-id="3d1aa-135">There are two major differences between profile sections and other objects that inherit from **IMAPIProp**:</span></span> 
  
- <span data-ttu-id="3d1aa-136">配置文件节不支持事务。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-136">Profile sections do not support transactions.</span></span>
    
- <span data-ttu-id="3d1aa-137">配置文件节不支持命名属性，它们MAPI_E_NO_SUPPORT **IMAPIProp：：GetIDsFromNames** 和 **IMAPIProp：：GetNamesFromIDs** 实现返回属性。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-137">Profile sections do not support named properties, returning MAPI_E_NO_SUPPORT from their **IMAPIProp::GetIDsFromNames** and **IMAPIProp::GetNamesFromIDs** implementations.</span></span> <span data-ttu-id="3d1aa-138">有关详细信息，请参阅 [IMAPIProp：：GetIDsFromNames](imapiprop-getidsfromnames.md) 和 [IMAPIProp：：GetNamesFromIDs](imapiprop-getnamesfromids.md)。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-138">For more information, see [IMAPIProp::GetIDsFromNames](imapiprop-getidsfromnames.md) and [IMAPIProp::GetNamesFromIDs](imapiprop-getnamesfromids.md).</span></span>
    
<span data-ttu-id="3d1aa-139">由于配置文件节不支持事务，因此通过调用 **IMAPIProp：：CopyProps、CopyTo** 或 **SetProps** 进行的任何更改将立即生效。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-139">Because profile sections do not support transactions, any changes made with calls to **IMAPIProp::CopyProps**, **CopyTo**, or **SetProps** immediately take effect.</span></span> <span data-ttu-id="3d1aa-140">有关详细信息，请参阅 [IMAPIProp：：CopyProps](imapiprop-copyprops.md)。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-140">For more information, see [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span></span> <span data-ttu-id="3d1aa-141">客户端和服务提供商可以调用配置文件节的 **IMAPIProp：：SaveChanges** 方法，该方法将成功，但不会影响配置文件节数据。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-141">Clients and service providers can call a profile section's **IMAPIProp::SaveChanges** method and it will succeed, but it does not affect the profile section data.</span></span> <span data-ttu-id="3d1aa-142">有关详细信息，请参阅 [IMAPIProp：：SaveChanges](imapiprop-savechanges.md)。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-142">For more information, see [IMAPIProp::SaveChanges](imapiprop-savechanges.md).</span></span> <span data-ttu-id="3d1aa-143">立即进行更改可能会影响服务提供商实现客户端用于向用户显示配置文件属性的属性表。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-143">Having changes occur immediately can affect how service providers implement the property sheets that clients use to display profile properties to users.</span></span> <span data-ttu-id="3d1aa-144">希望用户能够推迟或撤消更改的服务提供商必须使用配置文件节的副本（而不是实际节）来实现其属性表。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-144">Service providers that want users to be able to postpone or undo changes must implement their property sheets with copies of profile sections instead of the real sections.</span></span> <span data-ttu-id="3d1aa-145">通过使用副本，用户可以进行更改，然后取消这些更改，使原始配置文件部分保持不变。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-145">By using copies, users can make changes and then later cancel those changes, leaving the original profile sections untouched.</span></span> 
  
<span data-ttu-id="3d1aa-146">信息在配置文件中的显示顺序会影响 MAPI 在会话中配置资源和进行分配方式。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-146">The order in which information appears in a profile affects how MAPI configures resources and makes assignments in a session.</span></span> <span data-ttu-id="3d1aa-147">以下分配受配置文件顺序影响：</span><span class="sxs-lookup"><span data-stu-id="3d1aa-147">The following assignments are affected by profile order:</span></span>
  
- <span data-ttu-id="3d1aa-148">默认邮件存储</span><span class="sxs-lookup"><span data-stu-id="3d1aa-148">Default message store</span></span>
    
- <span data-ttu-id="3d1aa-149">个人通讯簿</span><span class="sxs-lookup"><span data-stu-id="3d1aa-149">Personal address book</span></span>
    
- <span data-ttu-id="3d1aa-150">默认邮件存储搜索路径</span><span class="sxs-lookup"><span data-stu-id="3d1aa-150">Default message store search path</span></span>
    
- <span data-ttu-id="3d1aa-151">默认通讯簿搜索路径</span><span class="sxs-lookup"><span data-stu-id="3d1aa-151">Default address book search path</span></span>
    
- <span data-ttu-id="3d1aa-152">传输提供程序顺序</span><span class="sxs-lookup"><span data-stu-id="3d1aa-152">Transport provider order</span></span>
    
<span data-ttu-id="3d1aa-153">MAPI 将默认邮件存储设置为配置文件中第一个邮件存储，该存储的 PR_RESOURCE_FLAGS ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md)) 属性中设置了 **STATUS_DEFAULT_STORE** 标志，指示它可以是默认存储。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-153">MAPI sets the default message store to be the first message store in the profile that has the STATUS_DEFAULT_STORE flag set in its **PR_RESOURCE_FLAGS** ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md)) property, which indicates that it can be the default store.</span></span> <span data-ttu-id="3d1aa-154">客户端可以通过调用 **IMAPISession：：SetDefaultStore 覆盖此设置**。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-154">Clients can override this setting by calling **IMAPISession::SetDefaultStore**.</span></span> <span data-ttu-id="3d1aa-155">有关详细信息，请参阅 [IMAPISession：：SetDefaultStore](imapisession-setdefaultstore.md)。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-155">For more information, see [IMAPISession::SetDefaultStore](imapisession-setdefaultstore.md).</span></span>
  
<span data-ttu-id="3d1aa-156">MAPI 创建用于处理传出和传入邮件的传输顺序。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-156">MAPI creates a transport order for handling outgoing and incoming messages.</span></span> <span data-ttu-id="3d1aa-157">当多个传输提供程序为特定类型的邮件注册时，MAPI 将按此顺序确定哪个提供程序应处理该邮件。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-157">When more than one transport provider has registered for a message of a particular type, MAPI uses this order to determine which provider should handle the message.</span></span> <span data-ttu-id="3d1aa-158">MAPI 将传输顺序设置为将传输提供程序添加到配置文件中的顺序，但一个例外是，在 **PR_RESOURCE_FLAGS** 属性中设置 STATUS_XP_PREFER_LAST 标志的传输将按顺序最后放置。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-158">MAPI sets the transport order to be the order in which the transport providers were added to the profile with one exception--the transports that set the STATUS_XP_PREFER_LAST flag in their **PR_RESOURCE_FLAGS** property are positioned last in the order.</span></span> <span data-ttu-id="3d1aa-159">客户端可以通过调用 **IMsgServiceAdmin：：MsgServiceTransportOrder 来设置传输顺序**。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-159">Clients can set the transport order by calling **IMsgServiceAdmin::MsgServiceTransportOrder**.</span></span> <span data-ttu-id="3d1aa-160">有关详细信息，请参阅 [IMsgServiceAdmin：：MsgServiceTransportOrder](imsgserviceadmin-msgservicetransportorder.md)。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-160">For more information, see [IMsgServiceAdmin::MsgServiceTransportOrder](imsgserviceadmin-msgservicetransportorder.md).</span></span>
  
<span data-ttu-id="3d1aa-161">这些排序服务提供程序和邮件服务的准则有时可能会发生冲突。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-161">These guidelines for ordering service providers and message services might sometimes conflict.</span></span> <span data-ttu-id="3d1aa-162">如果存在冲突，代码应解决冲突。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-162">If there is a conflict, your code should resolve the conflict.</span></span> <span data-ttu-id="3d1aa-163">可以使用邮件控制面板程序检查已创建的配置文件，以确定是否已根据预期配置提供程序。</span><span class="sxs-lookup"><span data-stu-id="3d1aa-163">You can use the Mail Control Panel program to inspect a profile that you have created to determine whether the providers have been configured as expected.</span></span>
  

