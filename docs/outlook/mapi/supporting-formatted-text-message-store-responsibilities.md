---
title: 支持格式化短信存储责任
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a97993c2-52e4-4b71-ac03-2c02d82447d8
description: 上次修改时间：2015 年 3 月 9 日
ms.openlocfilehash: 502ba82279664638c8e7e4ae68f74df74758918d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435514"
---
# <a name="supporting-formatted-text-message-store-responsibilities"></a><span data-ttu-id="0185c-103">支持格式化文本：邮件存储责任</span><span class="sxs-lookup"><span data-stu-id="0185c-103">Supporting Formatted Text: Message Store Responsibilities</span></span>

  
  
<span data-ttu-id="0185c-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="0185c-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="0185c-105">邮件存储提供程序使用 **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) 属性来发布它们是否可以处理 RTF 格式 (RTF) 、HTML 文本，以及（如果它们可感知 RTF）是否以压缩格式还是未压缩格式存储格式化文本。</span><span class="sxs-lookup"><span data-stu-id="0185c-105">Message store providers use the **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property to publish whether or not they can handle Rich Text Format (RTF), HTML text and, if they are RTF-aware, whether they store the formatted text in a compressed or uncompressed format.</span></span> <span data-ttu-id="0185c-106">邮件存储提供程序通过设置 STORE_RTF_OK 位来指示它们具有 RTF 感知性，并且它们通过设置未压缩STORE_UNCOMPRESSED_RTF格式存储格式化文本。</span><span class="sxs-lookup"><span data-stu-id="0185c-106">Message store providers indicate that they are RTF-aware by setting the STORE_RTF_OK bit and that they store the formatted text in an uncompressed form by setting the STORE_UNCOMPRESSED_RTF bit.</span></span> <span data-ttu-id="0185c-107">邮件存储提供程序通过设置值位来指示它们STORE_HTML_OK HTML。</span><span class="sxs-lookup"><span data-stu-id="0185c-107">Message store providers indicate they are HTML-aware by setting the STORE_HTML_OK bit.</span></span>
  
<span data-ttu-id="0185c-108">虽然 RTF 感知客户端检查 STORE_RTF_OK 位以确定邮件存储是否支持 RTF 很重要，但客户端不需要关注 RTF 感知存储格式化文本的格式。</span><span class="sxs-lookup"><span data-stu-id="0185c-108">While it is important for an RTF-aware client to check for the STORE_RTF_OK bit to determine whether or not a message store supports RTF, it is not necessary for a client to be concerned with the format of an RTF-aware store's formatted text.</span></span> 
  
<span data-ttu-id="0185c-109">所有邮件存储必须支持非 RTF 感知客户端。</span><span class="sxs-lookup"><span data-stu-id="0185c-109">All message stores must support non-RTF-aware clients.</span></span> <span data-ttu-id="0185c-110">如果客户端已更改 PR_BODY **(** [PidTagBody](pidtagbody-canonical-property.md)) 而不更新 **PR_RTF_IN_SYNC** 或 **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)) ，则非 RTF 感知邮件存储必须在调用邮件 [的 IMAPIProp：：SaveChanges](imapiprop-savechanges.md)方法期间删除 **PR_RTF_IN_SYNC** (PidTagRtfInSync) 属性。 [](pidtagrtfinsync-canonical-property.md)</span><span class="sxs-lookup"><span data-stu-id="0185c-110">A non-RTF-aware message store must delete the **PR_RTF_IN_SYNC** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) property during a call to the message's [IMAPIProp::SaveChanges](imapiprop-savechanges.md) method if a client has changed **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) without updating either **PR_RTF_IN_SYNC** or **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)).</span></span> <span data-ttu-id="0185c-111">删除 **PR_RTF_IN_SYNC** 将导致PR_RTF_COMPRESSED RTF感知客户端下次调用 [RTFSync](rtfsync.md)时，从 **PR_BODY** 属性重新计算属性。</span><span class="sxs-lookup"><span data-stu-id="0185c-111">Deleting **PR_RTF_IN_SYNC** causes the **PR_RTF_COMPRESSED** property to be recomputed from the **PR_BODY** property the next time an RTF-aware client calls [RTFSync](rtfsync.md).</span></span> 
  
<span data-ttu-id="0185c-112">大多数 RTF 感知邮件存储不由客户端提供消息文本;必须根据请求计算。</span><span class="sxs-lookup"><span data-stu-id="0185c-112">Most RTF-aware message stores are not given the message text by clients; it must be computed on request.</span></span> <span data-ttu-id="0185c-113">由于此计算非常耗时且成本较高，因此客户端应尽可能 **PR_RTF_COMPRESSED** 此计算。</span><span class="sxs-lookup"><span data-stu-id="0185c-113">Because this computation is time consuming and expensive, clients should use **PR_RTF_COMPRESSED** whenever possible.</span></span> <span data-ttu-id="0185c-114">若要计算 **PR_BODY** 属性，邮件存储提供程序必须取消压缩 **PR_RTF_COMPRESSED** 属性的内容并删除格式文本。</span><span class="sxs-lookup"><span data-stu-id="0185c-114">To compute the **PR_BODY** property, the message store provider must uncompress the contents of the **PR_RTF_COMPRESSED** property and remove the rich text formatting.</span></span> <span data-ttu-id="0185c-115">不支持属性的 **客户端PR_RTF_COMPRESSED需要** 针对每封邮件进行此计算。</span><span class="sxs-lookup"><span data-stu-id="0185c-115">Clients that do not support the **PR_RTF_COMPRESSED** property require this computation to take place for every message.</span></span> 
  
<span data-ttu-id="0185c-116">复制邮件时，不使用 **IMAPISupport：:D oCopyProps** 或 **IMAPISupport：:D oCopyTo** 方法的邮件存储提供程序会面临创建不包含任何内容的邮件的风险，如果它们的实现排除 **PR_BODY** 属性并依赖于 **PR_RTF_COMPRESSED**。</span><span class="sxs-lookup"><span data-stu-id="0185c-116">When copying messages, message store providers that do not use the **IMAPISupport::DoCopyProps** or **IMAPISupport::DoCopyTo** methods run the risk of creating a message with no content if their implementation excludes the **PR_BODY** property and relies on **PR_RTF_COMPRESSED**.</span></span> <span data-ttu-id="0185c-117">PR_RTF_COMPRESSED **中数据** 可能已损坏。</span><span class="sxs-lookup"><span data-stu-id="0185c-117">It is possible for the data in the **PR_RTF_COMPRESSED** property to be corrupt.</span></span> <span data-ttu-id="0185c-118">在复制操作中排除这些邮件内容属性之一之前，请检查是否损坏，如下所示：</span><span class="sxs-lookup"><span data-stu-id="0185c-118">Before excluding either of these message content properties in the copy operation, check for corruption as follows:</span></span> 
  
1. <span data-ttu-id="0185c-119">如果属性 **PR_RTF_COMPRESSED** 压缩 RTF，则该属性已损坏。</span><span class="sxs-lookup"><span data-stu-id="0185c-119">If the value of **PR_RTF_COMPRESSED** is not larger than the compressed RTF, the property is corrupt.</span></span> 
    
2. <span data-ttu-id="0185c-120">如果 RTF 标头中的神奇值不是  _dwMagicCompressedRTF_ 或  _dwMagicUncompressedRTF，_ 则该属性已损坏。</span><span class="sxs-lookup"><span data-stu-id="0185c-120">If the magic value in the RTF header is not  _dwMagicCompressedRTF_ or  _dwMagicUncompressedRTF_, the property is corrupt.</span></span>
    
<span data-ttu-id="0185c-121">使用支持方法的邮件存储提供程序无需考虑实现对邮件损坏 **PR_RTF_COMPRESSED检查;** MAPI 确保相应的属性存在且有效。</span><span class="sxs-lookup"><span data-stu-id="0185c-121">Message store providers using the support methods need not be concerned with implementing a check for **PR_RTF_COMPRESSED** corruption; MAPI ensures that the appropriate properties exist and are valid.</span></span> 
  
<span data-ttu-id="0185c-122">邮件存储提供程序可以实施三种不同级别的 RTF 支持;MAPI 建议 RTF 感知邮件存储提供程序在中间或最高级别实现支持。</span><span class="sxs-lookup"><span data-stu-id="0185c-122">There are three different levels of RTF support that message store providers can implement; MAPI recommends that RTF-aware message store providers implement their support at the middle or highest level.</span></span> <span data-ttu-id="0185c-123">所有 RTF 感知邮件存储提供程序负责从传出邮件的 **PR_RTF_COMPRESSED** 中包含的数据生成 **PR_BODY，** 并调用 **RTFSync** 以同步传入邮件的文本和格式。</span><span class="sxs-lookup"><span data-stu-id="0185c-123">All RTF-aware message store providers take care of generating **PR_BODY** from the data included in **PR_RTF_COMPRESSED** on outgoing messages and make a call to **RTFSync** to synchronize text and formatting on incoming messages.</span></span> 
  
<span data-ttu-id="0185c-124">下表介绍了这三个级别之间的差异。</span><span class="sxs-lookup"><span data-stu-id="0185c-124">The differences between these three levels are described in the following table.</span></span> 
  
|<span data-ttu-id="0185c-125">**支持级别**</span><span class="sxs-lookup"><span data-stu-id="0185c-125">**Level of support**</span></span>|<span data-ttu-id="0185c-126">**说明**</span><span class="sxs-lookup"><span data-stu-id="0185c-126">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="0185c-127">低</span><span class="sxs-lookup"><span data-stu-id="0185c-127">Low</span></span>  <br/> |<span data-ttu-id="0185c-128">只要将更改保存到邮件，邮件存储提供程序就会调用 **RTFSync，** 并从 PR_RTF_COMPRESSED 中提取 **PR_BODY** 属性的数据 **，** 而不是要求客户端进行设置。</span><span class="sxs-lookup"><span data-stu-id="0185c-128">Message store provider calls **RTFSync** whenever changes are saved to a message and extracts the data for the **PR_BODY** property from **PR_RTF_COMPRESSED** rather than requiring clients to set it.</span></span> <span data-ttu-id="0185c-129">存储 **PR_BODY PR_RTF_COMPRESSED** 和库。</span><span class="sxs-lookup"><span data-stu-id="0185c-129">Both **PR_BODY** and **PR_RTF_COMPRESSED** are stored.</span></span>  <br/> |
|<span data-ttu-id="0185c-130">中间</span><span class="sxs-lookup"><span data-stu-id="0185c-130">Middle</span></span>  <br/> |<span data-ttu-id="0185c-131">邮件存储提供程序仅存储 PR_RTF_COMPRESSED **属性，\*\*\*\*并在必要时** PR_BODY计算数据。</span><span class="sxs-lookup"><span data-stu-id="0185c-131">Message store provider stores only the **PR_RTF_COMPRESSED** property, computing **PR_BODY** when necessary.</span></span>  <br/> |
|<span data-ttu-id="0185c-132">高</span><span class="sxs-lookup"><span data-stu-id="0185c-132">High</span></span>  <br/> |<span data-ttu-id="0185c-133">邮件存储提供程序既不 **存储PR_BODY** RTF 属性，也不存储辅助 RTF 属性。</span><span class="sxs-lookup"><span data-stu-id="0185c-133">Message store provider stores neither **PR_BODY** or the auxiliary RTF properties.</span></span> <span data-ttu-id="0185c-134">当邮件文本已更改且格式保持不变或传输提供程序下载新邮件时，将调用 **RTFSync。**</span><span class="sxs-lookup"><span data-stu-id="0185c-134">**RTFSync** is called when the message text has changed and the formatting remains unchanged or when a new message is downloaded by a transport provider.</span></span>  <br/> |
   

