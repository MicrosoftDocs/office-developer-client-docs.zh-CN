---
title: 支持格式化文本呈现附件
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 68abe85b-5dc0-40d0-8917-30ea002aa816
description: 上次修改时间：2011 年 7 月 23 日
ms.openlocfilehash: 5f03530f994fd13e7dc4c7eaa4124900c28e613b
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "33405294"
---
# <a name="supporting-formatted-text-rendering-attachments"></a><span data-ttu-id="c2bf7-103">支持格式化文本：呈现附件</span><span class="sxs-lookup"><span data-stu-id="c2bf7-103">Supporting Formatted Text: Rendering Attachments</span></span>

  
  
<span data-ttu-id="c2bf7-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="c2bf7-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="c2bf7-105">关注邮件附件呈现位置的客户端应用程序在邮件撰写期间为这些附件设置 **PR_RENDERING_POSITION** ([PidTagRenderingPosition](pidtagrenderingposition-canonical-property.md)) 属性。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-105">A client application that cares about where in a message its attachments are rendered sets the **PR_RENDERING_POSITION** ([PidTagRenderingPosition](pidtagrenderingposition-canonical-property.md)) property for these attachments during message composition.</span></span> <span data-ttu-id="c2bf7-106">不需要呈现放置的客户端会取消设置此属性。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-106">A client that does not care about rendering placement leaves this property unset.</span></span>
  
<span data-ttu-id="c2bf7-107">当客户端打开带有附件的邮件时，它会尝试检索每个附件的 **PR_RENDERING_POSITION** 属性，以确定附件应在邮件文本中的哪个位置呈现。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-107">When a client opens a message with attachments, it attempts to retrieve each attachment's **PR_RENDERING_POSITION** property to determine where in the message text the attachment should be rendered.</span></span> <span data-ttu-id="c2bf7-108">客户端可以使用下列方法之一来 **检索PR_RENDERING_POSITION：**</span><span class="sxs-lookup"><span data-stu-id="c2bf7-108">A client can use one of the following methods to retrieve **PR_RENDERING_POSITION**:</span></span>
  
- <span data-ttu-id="c2bf7-109">[打开的附件上的 IMAPIProp：：GetProps](imapiprop-getprops.md)检索 PR_RENDERING_POSITION **属性。**</span><span class="sxs-lookup"><span data-stu-id="c2bf7-109">[IMAPIProp::GetProps](imapiprop-getprops.md) on the open attachment to retrieve the **PR_RENDERING_POSITION** property.</span></span> 
    
- <span data-ttu-id="c2bf7-110">[打开的邮件上的 IMessage：：GetAttachmentTable](imessage-getattachmenttable.md) 检索其附件表。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-110">[IMessage::GetAttachmentTable](imessage-getattachmenttable.md) on the open message to retrieve its attachment table.</span></span> <span data-ttu-id="c2bf7-111">**PR_RENDERING_POSITION** 是所有附件表中的必需列。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-111">**PR_RENDERING_POSITION** is a required column in all attachment tables.</span></span> <span data-ttu-id="c2bf7-112">这是首选方法，因为它可提高性能。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-112">This is the preferred method because it results in better performance.</span></span> 
    
<span data-ttu-id="c2bf7-113">RTF 感知邮件存储可以选择是返回邮件的精确值还是近似 **PR_RENDERING_POSITION。**</span><span class="sxs-lookup"><span data-stu-id="c2bf7-113">RTF-aware message stores can choose whether to return an accurate or approximate value for **PR_RENDERING_POSITION**.</span></span> <span data-ttu-id="c2bf7-114">由于当请求邮件 **的 PR_BODY** 属性时，邮件存储会重新计算附件的 **PR_RENDERING_POSITION** 值，因此某些 RTF 感知邮件存储仅保证客户端首先请求 PR_BODY 时呈现位置的准确性。 </span><span class="sxs-lookup"><span data-stu-id="c2bf7-114">Because message stores recalculate an attachment's **PR_RENDERING_POSITION** value when asked for the message's **PR_BODY** property, some RTF-aware message stores only guarantee the accuracy of rendering positions when a client asks first for **PR_BODY**.</span></span> <span data-ttu-id="c2bf7-115">允许 RTF 感知邮件存储向客户端提供近似呈现位置值，以提高性能。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-115">RTF-aware message stores are allowed to provide clients with approximate rendering position values to enhance performance.</span></span> <span data-ttu-id="c2bf7-116">提供近似而不是准确的呈现位置可节省时间，并且足以满足大多数情况。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-116">Providing an approximate rather than an accurate rendering position saves time and is sufficient for most situations.</span></span> 
  
<span data-ttu-id="c2bf7-117">RTF 感知邮件存储的近似值应基于负责创建附件的客户端指定的值。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-117">RTF-aware message stores should base their approximation on the value specified by the client responsible for creating the attachment.</span></span> <span data-ttu-id="c2bf7-118">尽管所有客户端都应 **PR_RENDERING_POSITION，** 但邮件存储提供程序应准备好处理其不存在的可能性。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-118">Although all clients should set **PR_RENDERING_POSITION**, message store providers should be prepared to deal with the possibility of its absence.</span></span> <span data-ttu-id="c2bf7-119">当客户端未设置PR_RENDERING_POSITION时，邮件存储可以设置为 -1，以指示呈现位置不在消息文本中。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-119">When the client does not set **PR_RENDERING_POSITION**, a message store can set it to -1 to indicate that the rendering position is not within the message text.</span></span> <span data-ttu-id="c2bf7-120">呈现位置为 -1 的附件可以显示在邮件内的任何位置，具体取决于客户端。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-120">Attachments with a rendering position of -1 can be displayed at any place within the message depending on the client.</span></span> <span data-ttu-id="c2bf7-121">许多客户端将这些类型的附件放在邮件顶部。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-121">Many clients position these types of attachments at the top of the message.</span></span>
  
<span data-ttu-id="c2bf7-122">PR_RENDERING_POSITION 属性的准确性 **取决于** 邮件存储是同时保存邮件的 **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) 和 **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)) 属性还是仅保存 **PR_RTF_COMPRESSED**。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-122">The degree of accuracy for a **PR_RENDERING_POSITION** property depends on whether or not a message store saves both a message's **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) and **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)) properties or only **PR_RTF_COMPRESSED**.</span></span> <span data-ttu-id="c2bf7-123">如果客户端 **生成PR_BODY且** 邮件存储会随格式化文本一起保存它，则呈现位置将准确。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-123">If the client generates **PR_BODY** and the message store saves it along with the formatted text, the rendering positions will be accurate.</span></span> <span data-ttu-id="c2bf7-124">但是，如果邮件存储 **必须** 生成其自己的 PR_BODY因为它仅保存 PR_RTF_COMPRESSED ，则呈现位置可能有些不准确。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-124">However, if the message store must generate its own version of **PR_BODY** because it only saves **PR_RTF_COMPRESSED**, it is probable that the rendering positions will be somewhat inaccurate.</span></span> <span data-ttu-id="c2bf7-125">这是因为客户端和邮件存储提供程序生成 PR_BODY **属性的方式** 不同。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-125">This is because of the differences in the way that clients and message store providers generate the **PR_BODY** property.</span></span> 
  
<span data-ttu-id="c2bf7-126">为了计算准确的 **PR_RENDERING_POSITION** 值，RTF 感知存储使用格式文本中嵌入的标记。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-126">To calculate an accurate **PR_RENDERING_POSITION** value, an RTF-aware store uses a tag embedded in the formatted text.</span></span> <span data-ttu-id="c2bf7-127">可以调用实用工具函数 **RTFSync** 来执行此计算并更新附件的呈现位置。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-127">The utility function **RTFSync** can be called to perform this calculation and update an attachment's rendering position.</span></span> <span data-ttu-id="c2bf7-128">根据可用的状态信息量，邮件存储可以将两个值RTF_SYNC_BODY_CHANGED、RTF_SYNC_RTF_CHANGED或两个值传递到 [RTFSync](rtfsync.md)。</span><span class="sxs-lookup"><span data-stu-id="c2bf7-128">Depending on the amount of state information available, the message store can pass either RTF_SYNC_BODY_CHANGED, RTF_SYNC_RTF_CHANGED, or both values to [RTFSync](rtfsync.md).</span></span>
  

