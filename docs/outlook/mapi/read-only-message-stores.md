---
title: 只读邮件存储
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 752ff2d6-ca64-4507-adf1-4c054c321203
description: 上次修改时间：2011 年 7 月 23 日
ms.openlocfilehash: 957a7f92963b97e5421bc801a3b046f098d6a08e
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "32328453"
---
# <a name="read-only-message-stores"></a><span data-ttu-id="010a1-103">只读邮件存储</span><span class="sxs-lookup"><span data-stu-id="010a1-103">Read-Only Message Stores</span></span>

  
  
<span data-ttu-id="010a1-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="010a1-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="010a1-105">只读邮件存储区是 mapi 客户端和 mapi 后台处理程序都不能创建、修改或删除邮件存储区中的对象。</span><span class="sxs-lookup"><span data-stu-id="010a1-105">A read-only message store is one in which neither the MAPI client nor the MAPI spooler can create, modify, or delete the objects in the message store.</span></span> <span data-ttu-id="010a1-106">您可能希望实现只读邮件存储区的原因有很多。</span><span class="sxs-lookup"><span data-stu-id="010a1-106">There are many reasons why you might want to implement a read-only message store.</span></span> <span data-ttu-id="010a1-107">例如, 信用报告公司可以使用只读存储, 以允许其客户或员工看到但不能更改单个信用报告。</span><span class="sxs-lookup"><span data-stu-id="010a1-107">For example, a credit reporting firm could use a read-only store to allow its customers or employees to see but not change individual credit reports.</span></span> <span data-ttu-id="010a1-108">选择使只读邮件存储区具有对存储提供程序的结构和存储本身的影响。</span><span class="sxs-lookup"><span data-stu-id="010a1-108">Choosing to make a read-only message store has implications for the structure of the store provider and for the store itself.</span></span> <span data-ttu-id="010a1-109">例如, 只读邮件存储区不能有 "发件箱" 文件夹, 因为 MAPI 客户端会请求在该文件夹中创建新的传出邮件。</span><span class="sxs-lookup"><span data-stu-id="010a1-109">For example, a read-only message store cannot have an Outbox folder, because then MAPI clients would request that new outgoing messages be created in that folder.</span></span> <span data-ttu-id="010a1-110">同样, 存储提供程序负责确保基础存储机制的完整性。</span><span class="sxs-lookup"><span data-stu-id="010a1-110">Similarly, it is the store provider's responsibility to ensure the integrity of the underlying storage mechanism.</span></span>
  
<span data-ttu-id="010a1-111">可以在邮件存储区的**PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) 属性中设置三个标志, 这些标志支持不同的只读访问级别。</span><span class="sxs-lookup"><span data-stu-id="010a1-111">There are three flags that can be set in the message store's **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property that support different levels of read-only access.</span></span> <span data-ttu-id="010a1-112">STORE_READONLY 标志指示邮件存储区中的对象上的所有[IMAPIProp: IUnknown](imapipropiunknown.md)接口都是只读的。</span><span class="sxs-lookup"><span data-stu-id="010a1-112">The STORE_READONLY flag indicates that all [IMAPIProp : IUnknown](imapipropiunknown.md) interfaces on objects in the message store are read-only.</span></span> <span data-ttu-id="010a1-113">STORE_MODIFY_OK 标志指示可以修改邮件存储区中的现有邮件, 但可能不会创建新的文件夹和邮件。</span><span class="sxs-lookup"><span data-stu-id="010a1-113">The STORE_MODIFY_OK flag indicates that existing messages in the message store may be modified, but new folders and messages may not be created.</span></span> <span data-ttu-id="010a1-114">STORE_CREATE_OK 标志指示可以创建新的邮件和文件夹, 但不会指示是否可以修改现有对象。</span><span class="sxs-lookup"><span data-stu-id="010a1-114">The STORE_CREATE_OK flag indicates that new messages and folders may be created, but indicates nothing about whether existing objects may be modified.</span></span> 
  
<span data-ttu-id="010a1-115">mapi 客户端和 mapi 后台处理程序可能无法在邮件存储区中创建、修改或删除对象, 这并不意味着基础存储机制的内容永远不会发生变化。</span><span class="sxs-lookup"><span data-stu-id="010a1-115">The fact that MAPI clients and the MAPI spooler may not be able to create, modify, or delete objects in the message store does not mean that the contents of the underlying storage mechanism never change.</span></span> <span data-ttu-id="010a1-116">也不意味着您的存储提供程序永远不需要对基础存储机制的写入权限。</span><span class="sxs-lookup"><span data-stu-id="010a1-116">Nor does it mean that your store provider never needs write permission to the underlying storage mechanism.</span></span> <span data-ttu-id="010a1-117">在某些情况下, 可能会应用这两个条件, 但不是只读邮件存储区的常规情况。</span><span class="sxs-lookup"><span data-stu-id="010a1-117">In some circumstances those two conditions may apply, but not in the general case of a read-only message store.</span></span> <span data-ttu-id="010a1-118">您的存储提供程序所需的访问级别, 以及您的存储提供程序是否曾在基础存储机制中更改数据, 这主要取决于您的存储提供程序的特定性质。</span><span class="sxs-lookup"><span data-stu-id="010a1-118">The level of access that your store provider requires and whether or not your store provider ever changes data in the underlying storage mechanism depends mainly on the specific nature of your store provider.</span></span>
  
<span data-ttu-id="010a1-119">例如, 如果您要编写存储提供程序以向 MAPI 客户端授予对存储在 cd-rom 设备上的数据库的访问权限, 则基础存储机制将无法更改, 并且您的存储提供程序可以对其具有只读权限。</span><span class="sxs-lookup"><span data-stu-id="010a1-119">For example, if you are writing a store provider to give MAPI clients access to a database stored on a CD-ROM device, the underlying storage mechanism cannot change and your store provider can have read-only permission for it.</span></span> <span data-ttu-id="010a1-120">但是, 如果您要编写存储提供程序以向 MAPI 客户端授予对公用文件夹数据库的只读访问权限, 但存储提供程序需要跟踪每个用户的邮件的已读/未读状态, 则存储提供程序将需要将新数据写入到基础存储机制。</span><span class="sxs-lookup"><span data-stu-id="010a1-120">If, however, you are writing a store provider to give MAPI clients read-only access to a public folder database, but the store provider needs to keep track of the read/unread status of messages for each user, the store provider will need to write new data to the underlying storage mechanism.</span></span> <span data-ttu-id="010a1-121">但是, 在任何示例中, 存储提供程序都不需要在 mapi 客户端或 mapi 后台处理程序的请求中创建、修改或删除文件夹或邮件。</span><span class="sxs-lookup"><span data-stu-id="010a1-121">However, in neither example does the store provider ever have to create, modify, or delete folders or messages at the request of MAPI clients or the MAPI spooler.</span></span>
  
<span data-ttu-id="010a1-122">存储提供程序将数据写入到基础存储机制的简单原因 (如其他只读) 的简短列表如下所示:</span><span class="sxs-lookup"><span data-stu-id="010a1-122">The short list of reasons that a store provider would need to write data to an underlying storage mechanism that is otherwise read-only is as follows:</span></span>
  
- <span data-ttu-id="010a1-123">存储邮件的已读/未读状态。</span><span class="sxs-lookup"><span data-stu-id="010a1-123">To store the read/unread status of messages.</span></span>
    
- <span data-ttu-id="010a1-124">实现读取/未读通知。</span><span class="sxs-lookup"><span data-stu-id="010a1-124">To implement read/nonread notifications.</span></span> 
    
- <span data-ttu-id="010a1-125">以存储视图。</span><span class="sxs-lookup"><span data-stu-id="010a1-125">To store views.</span></span>
    
- <span data-ttu-id="010a1-126">为用户定义的文件夹排序顺序缓存持久索引。</span><span class="sxs-lookup"><span data-stu-id="010a1-126">To cache persistent indexes for user-defined folder sort orders.</span></span>
    
- <span data-ttu-id="010a1-127">存储文件夹内容的排序顺序 (支持[IMAPIFolder:: SaveContentsSort](imapifolder-savecontentssort.md))。</span><span class="sxs-lookup"><span data-stu-id="010a1-127">To store the sort order of a folder's contents (supporting [IMAPIFolder::SaveContentsSort](imapifolder-savecontentssort.md)).</span></span>
    
- <span data-ttu-id="010a1-128">如果邮件存储区提供程序支持搜索 (支持[IMAPIContainer:: SetSearchCriteria](imapicontainer-setsearchcriteria.md)), 则存储搜索条件、搜索状态和结果。</span><span class="sxs-lookup"><span data-stu-id="010a1-128">To store search criteria, search state, and results, if the message store provider supports searches (supporting [IMAPIContainer::SetSearchCriteria](imapicontainer-setsearchcriteria.md)).</span></span>
    
<span data-ttu-id="010a1-129">如果您的邮件存储区提供程序永远无法向基础存储机制写入数据, 则需要在基础存储机制之外使用单独的存储机制来实现这些功能。</span><span class="sxs-lookup"><span data-stu-id="010a1-129">If your message store provider can never write data to the underlying storage mechanism, it will need to implement these features by using a separate storage mechanism outside of the underlying storage mechanism.</span></span> <span data-ttu-id="010a1-130">例如, 只读邮件存储提供程序可以将存储中的邮件的已读/未读状态存储在用户计算机上的文件中。</span><span class="sxs-lookup"><span data-stu-id="010a1-130">For example, a read-only message store provider could store the read/unread status of messages in the store in a file on the user's computer.</span></span> <span data-ttu-id="010a1-131">此策略带来了其他困难, 但可能是只读邮件存储提供程序实现某些功能的唯一 feasable 方式。</span><span class="sxs-lookup"><span data-stu-id="010a1-131">This strategy presents additional difficulties but may be the only feasable way for read-only message store providers to implement some features.</span></span> <span data-ttu-id="010a1-132">例如, 保持与邮件存储区中的对象同步的单独存储机制的内容比直接在邮件存储本身中存储已读/未读状态更难。</span><span class="sxs-lookup"><span data-stu-id="010a1-132">For example, keeping the contents of the separate storage mechanism synchronized with the objects in the message store is more difficult than storing the read/unread status directly in the message store itself.</span></span>
  
<span data-ttu-id="010a1-133">搜索为只读邮件存储提供程序带来了额外的更复杂之处。</span><span class="sxs-lookup"><span data-stu-id="010a1-133">Searching presents an additional complication for read-only message store providers.</span></span> <span data-ttu-id="010a1-134">客户端使用邮件存储对象的**PR_FINDER_ENTRYID** ([PidTagFinderEntryId](pidtagfinderentryid-canonical-property.md)) 属性中指定的文件夹查找用于搜索结果的文件夹。</span><span class="sxs-lookup"><span data-stu-id="010a1-134">Clients use the folder specified in the message store object's **PR_FINDER_ENTRYID** ([PidTagFinderEntryId](pidtagfinderentryid-canonical-property.md)) property to locate the folder used for search results.</span></span> <span data-ttu-id="010a1-135">只读邮件存储提供程序通常无法将永久搜索结果文件夹安装到邮件存储中。</span><span class="sxs-lookup"><span data-stu-id="010a1-135">Read-only message store providers often cannot install a permanent search-results folder into the message store.</span></span> <span data-ttu-id="010a1-136">在这种情况下, 邮件存储提供程序应将条目标识符存储在**PR_FINDER_ENTRYID**属性中, 当客户端打开文件夹时它可以识别, 以便它可以动态创建搜索结果文件夹, 而不是从基础存储机制。</span><span class="sxs-lookup"><span data-stu-id="010a1-136">In that situation, the message store provider should store an entry identifier in the **PR_FINDER_ENTRYID** property that it can recognize when clients open folders so that it can dynamically create a search-results folder instead of reading one from the underlying storage mechanism.</span></span> <span data-ttu-id="010a1-137">但是, 由于许多只读邮件存储区提供程序动态地创建所有文件夹, 这通常不是太多的负担。</span><span class="sxs-lookup"><span data-stu-id="010a1-137">However, because many read-only message store providers create all their folders dynamically, this is usually not too much of a burden.</span></span> 
  
<span data-ttu-id="010a1-138">您的邮件存储提供程序为只读这一事实将在存储提供程序对象的**PR_STORE_SUPPORT_MASK**属性中公布。</span><span class="sxs-lookup"><span data-stu-id="010a1-138">The fact that your message store provider is read-only is advertised in the store provider object's **PR_STORE_SUPPORT_MASK** property.</span></span> <span data-ttu-id="010a1-139">但是, 不要在客户端上计数以遵守该属性;您的存储提供程序的代码应强制实施基础存储机制的只读状态。</span><span class="sxs-lookup"><span data-stu-id="010a1-139">However, do not count on clients to respect that property; your store provider's code should enforce the read-only status of the underlying storage mechanism.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="010a1-140">另请参阅</span><span class="sxs-lookup"><span data-stu-id="010a1-140">See also</span></span>



[<span data-ttu-id="010a1-141">开发 MAPI 邮件存储提供程序</span><span class="sxs-lookup"><span data-stu-id="010a1-141">Developing a MAPI Message Store Provider</span></span>](developing-a-mapi-message-store-provider.md)

