---
title: 开发 MAPI 邮件存储提供程序
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 83692674-0b5a-468d-9cd7-a2ac3d140bda
description: 上次修改时间：2011 年 7 月 23 日
ms.openlocfilehash: 76332b57b2957b5682efb415121ea6db42409c30
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "32316756"
---
# <a name="developing-a-mapi-message-store-provider"></a><span data-ttu-id="51874-103">开发 MAPI 邮件存储提供程序</span><span class="sxs-lookup"><span data-stu-id="51874-103">Developing a MAPI message store provider</span></span>
  
<span data-ttu-id="51874-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="51874-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="51874-105">与其他 MAPI 服务提供程序一样, 邮件存储是向 mapi 客户端应用程序和 mapi 后台处理程序提供基础存储机制的服务的动态链接库 (dll)。</span><span class="sxs-lookup"><span data-stu-id="51874-105">Like other MAPI service providers, message stores are dynamic-link libraries (DLLs) that present the services of an underlying storage mechanism to MAPI client applications and the MAPI spooler.</span></span> <span data-ttu-id="51874-106">邮件存储区提供程序将基础存储机制显示为 mapi 客户端和 mapi 后台处理程序可以使用的一组分层文件夹和邮件。</span><span class="sxs-lookup"><span data-stu-id="51874-106">The message store provider presents the underlying storage mechanism as a hierarchical set of folders and messages that MAPI clients and the MAPI spooler can use.</span></span>
  
<span data-ttu-id="51874-107">下图显示了基本 MAPI 邮件存储库体系结构。</span><span class="sxs-lookup"><span data-stu-id="51874-107">The following illustration shows the basic MAPI message store architecture.</span></span>
  
<span data-ttu-id="51874-108">**消息存储体系结构**</span><span class="sxs-lookup"><span data-stu-id="51874-108">**Message store architecture**</span></span>
  
<span data-ttu-id="51874-109">![邮件存储区体系结构](media/storearc.gif "邮件存储区体系结构")</span><span class="sxs-lookup"><span data-stu-id="51874-109">![Message store architecture](media/storearc.gif "Message store architecture")</span></span>
  
<span data-ttu-id="51874-110">您可以使用所需的任何种类的基础存储机制来实现邮件存储区提供程序。</span><span class="sxs-lookup"><span data-stu-id="51874-110">You can implement a message store provider by using any sort of underlying storage mechanism you like.</span></span> <span data-ttu-id="51874-111">但是, 您需要注意性能方面的问题。</span><span class="sxs-lookup"><span data-stu-id="51874-111">However, you need to be aware of performance concerns.</span></span> <span data-ttu-id="51874-112">此外, 基础存储机制必须显示为 MAPI 对象的分层集合。</span><span class="sxs-lookup"><span data-stu-id="51874-112">In addition, the underlying storage mechanism must be presented as a hierarchical collection of MAPI objects.</span></span> <span data-ttu-id="51874-113">这些要求意味着邮件存储通常是使用现有的数据库产品实现的, 该产品支持数据库中的对象的分层存储, 并且具有编程接口或定义完善的文件结构。</span><span class="sxs-lookup"><span data-stu-id="51874-113">These requirements mean that message stores are typically implemented by using an existing database product that supports hierarchical storage of objects in the database and that has a programming interface or well-defined file structure.</span></span> <span data-ttu-id="51874-114">例如, Microsoft Office Access、SQL 和 Oracle 数据库可用作基础存储机制。</span><span class="sxs-lookup"><span data-stu-id="51874-114">For example, Microsoft Office Access, SQL, and Oracle databases can be used as the underlying storage mechanism.</span></span> <span data-ttu-id="51874-115">某些数据库产品的功能集更易于实现 MAPI 功能, 因此您的数据库产品选择可能会受到您的邮件存储提供程序所需支持的功能的影响。</span><span class="sxs-lookup"><span data-stu-id="51874-115">Some database products have feature sets that make it easier to implement MAPI features, so your choice of database product may be affected by the features that your message store provider needs to support.</span></span>
  
<span data-ttu-id="51874-116">使用现有数据库作为基础存储机制可节省您的工作, 因为将数据库对象作为 mapi 对象提供给 mapi 对象通常要比实施自己的分层存储机制更容易。</span><span class="sxs-lookup"><span data-stu-id="51874-116">Using an existing database as the underlying storage mechanism saves you work because it is usually easier to present database objects to MAPI clients as MAPI objects than to implement your own hierarchical storage mechanism.</span></span> <span data-ttu-id="51874-117">这样一来, 可以将 MAPI 操作视为比实施自己的分层存储机制更高的级别。</span><span class="sxs-lookup"><span data-stu-id="51874-117">Doing this enables you to treat MAPI operations at a higher level than if you implement your own hierarchical storage mechanism.</span></span> <span data-ttu-id="51874-118">例如, 搜索带有特定主题行的邮件会非常简单, 那就是构建和提交适当的数据库查询, 而不是实施复杂的例程来搜索分层存储机制。</span><span class="sxs-lookup"><span data-stu-id="51874-118">For example, searching for a message with a particular subject line becomes a fairly simple matter of constructing and submitting an appropriate database query, rather than implementing complex routines to search your hierarchical storage mechanism.</span></span>
  
<span data-ttu-id="51874-119">邮件存储提供程序与 mapi 客户端和 mapi 后台处理程序通信, 以对文件夹和对象执行操作。</span><span class="sxs-lookup"><span data-stu-id="51874-119">Message store providers communicate with MAPI clients and the MAPI spooler to perform operations on folders and objects.</span></span> <span data-ttu-id="51874-120">邮件存储提供程序将这些操作转换为对基础存储机制的较低级别操作。</span><span class="sxs-lookup"><span data-stu-id="51874-120">The message store provider translates those operations into lower level operations on the underlying storage mechanism.</span></span> <span data-ttu-id="51874-121">MAPI 后台处理程序通常会在发送和接收邮件时与邮件存储提供程序进行通信。</span><span class="sxs-lookup"><span data-stu-id="51874-121">The MAPI spooler typically communicates with the message store provider while sending and receiving messages.</span></span> <span data-ttu-id="51874-122">MAPI 客户端通常与邮件存储提供程序通信, 以处理文件夹层次结构以及读取、编辑、删除和发送邮件。</span><span class="sxs-lookup"><span data-stu-id="51874-122">MAPI clients typically communicate with message store providers to manipulate the folder hierarchy and to read, edit, delete, and send messages.</span></span>
  
<span data-ttu-id="51874-123">mapi 后台处理程序和 mapi 客户端都与邮件存储提供程序通信, 以创建新邮件。</span><span class="sxs-lookup"><span data-stu-id="51874-123">Both the MAPI spooler and MAPI clients communicate with the message store provider to create new messages.</span></span> <span data-ttu-id="51874-124">当用户撰写邮件时, 客户端应用程序将执行此操作。</span><span class="sxs-lookup"><span data-stu-id="51874-124">Client applications do this when users compose a message.</span></span> <span data-ttu-id="51874-125">MAPI 后台处理程序在收到传入邮件时执行此工作。</span><span class="sxs-lookup"><span data-stu-id="51874-125">The MAPI spooler does this when it receives an incoming message.</span></span> <span data-ttu-id="51874-126">无论是哪种情况, 通常都会在邮件存储区 (如果有) 的 "收件箱" 文件夹中创建新邮件。</span><span class="sxs-lookup"><span data-stu-id="51874-126">In either case, the new message is usually created in the Inbox folder of the message store, if there is one.</span></span>
  
<span data-ttu-id="51874-127">邮件存储提供程序大量使用 MAPI 表、文件夹、邮件和属性。</span><span class="sxs-lookup"><span data-stu-id="51874-127">Message store providers make heavy use of MAPI tables, folders, messages, and properties.</span></span> <span data-ttu-id="51874-128">这些对象的实现详细信息记录在[mapi 表](mapi-tables.md)、 [mapi 文件夹](mapi-folders.md)、 [mapi 邮件](mapi-messages.md)和[mapi 属性概述](mapi-property-overview.md)中。</span><span class="sxs-lookup"><span data-stu-id="51874-128">The implementation details for those objects are documented in [MAPI Tables](mapi-tables.md), [MAPI Folders](mapi-folders.md), [MAPI Messages](mapi-messages.md), and [MAPI Property Overview](mapi-property-overview.md).</span></span> <span data-ttu-id="51874-129">在尝试实现邮件存储提供程序之前, 您应熟悉该资料。</span><span class="sxs-lookup"><span data-stu-id="51874-129">You should familiarize yourself with that material before attempting to implement a message store provider.</span></span>
  
<span data-ttu-id="51874-130">有两种重要的邮件存储提供程序: 它们可以充当用户的默认邮件存储, 不能作为用户的默认邮件存储。</span><span class="sxs-lookup"><span data-stu-id="51874-130">There are two important types of message store providers: those that can act as a user's default message store and those that cannot.</span></span> <span data-ttu-id="51874-131">默认邮件存储是指客户端应用程序和 MAPI 后台处理程序可以执行任何邮件任务 (如接收邮件或创建文件夹) 的邮件存储。</span><span class="sxs-lookup"><span data-stu-id="51874-131">A default message store is one in which client applications and the MAPI spooler can perform any messaging task, such as receiving messages or creating folders.</span></span> <span data-ttu-id="51874-132">默认邮件存储提供程序必须支持的功能数多于所有邮件存储提供程序所需的最小数量。</span><span class="sxs-lookup"><span data-stu-id="51874-132">A default message store provider must support several more features than the minimum number required for all message store providers.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="51874-133">另请参阅</span><span class="sxs-lookup"><span data-stu-id="51874-133">See also</span></span>

- [<span data-ttu-id="51874-134">MAPI 概念</span><span class="sxs-lookup"><span data-stu-id="51874-134">MAPI concepts</span></span>](mapi-concepts.md)

