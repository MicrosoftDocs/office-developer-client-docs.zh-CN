---
title: 开发 MAPI 邮件存储提供程序
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 83692674-0b5a-468d-9cd7-a2ac3d140bda
description: 上次修改时间：2011 年 7 月 23 日
ms.openlocfilehash: 76332b57b2957b5682efb415121ea6db42409c30
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "33412609"
---
# <a name="developing-a-mapi-message-store-provider"></a><span data-ttu-id="27b89-103">开发 MAPI 邮件存储提供程序</span><span class="sxs-lookup"><span data-stu-id="27b89-103">Developing a MAPI message store provider</span></span>
  
<span data-ttu-id="27b89-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="27b89-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="27b89-105">与其他 MAPI 服务提供程序一样，邮件存储是动态链接库 (DLL) ，用于向 MAPI 客户端应用程序和 MAPI 后台处理程序提供基础存储机制的服务。</span><span class="sxs-lookup"><span data-stu-id="27b89-105">Like other MAPI service providers, message stores are dynamic-link libraries (DLLs) that present the services of an underlying storage mechanism to MAPI client applications and the MAPI spooler.</span></span> <span data-ttu-id="27b89-106">邮件存储提供程序将基础存储机制呈现为 MAPI 客户端和 MAPI 后台处理程序可以使用的一组分层文件夹和邮件。</span><span class="sxs-lookup"><span data-stu-id="27b89-106">The message store provider presents the underlying storage mechanism as a hierarchical set of folders and messages that MAPI clients and the MAPI spooler can use.</span></span>
  
<span data-ttu-id="27b89-107">下图显示了基本 MAPI 邮件存储体系结构。</span><span class="sxs-lookup"><span data-stu-id="27b89-107">The following illustration shows the basic MAPI message store architecture.</span></span>
  
<span data-ttu-id="27b89-108">**消息存储体系结构**</span><span class="sxs-lookup"><span data-stu-id="27b89-108">**Message store architecture**</span></span>
  
<span data-ttu-id="27b89-109">![邮件存储体系结构](media/storearc.gif "邮件存储体系结构")</span><span class="sxs-lookup"><span data-stu-id="27b89-109">![Message store architecture](media/storearc.gif "Message store architecture")</span></span>
  
<span data-ttu-id="27b89-110">可以使用您喜欢的任何一种基础存储机制来实现邮件存储提供程序。</span><span class="sxs-lookup"><span data-stu-id="27b89-110">You can implement a message store provider by using any sort of underlying storage mechanism you like.</span></span> <span data-ttu-id="27b89-111">但是，您需要了解性能问题。</span><span class="sxs-lookup"><span data-stu-id="27b89-111">However, you need to be aware of performance concerns.</span></span> <span data-ttu-id="27b89-112">此外，基础存储机制必须呈现为 MAPI 对象的分层集合。</span><span class="sxs-lookup"><span data-stu-id="27b89-112">In addition, the underlying storage mechanism must be presented as a hierarchical collection of MAPI objects.</span></span> <span data-ttu-id="27b89-113">这些要求意味着邮件存储通常通过使用支持数据库中对象的分层存储且具有编程接口或明确定义的文件结构的现有数据库产品实现。</span><span class="sxs-lookup"><span data-stu-id="27b89-113">These requirements mean that message stores are typically implemented by using an existing database product that supports hierarchical storage of objects in the database and that has a programming interface or well-defined file structure.</span></span> <span data-ttu-id="27b89-114">例如，Microsoft Office Access、SQL 和 Oracle 数据库可以用作基础存储机制。</span><span class="sxs-lookup"><span data-stu-id="27b89-114">For example, Microsoft Office Access, SQL, and Oracle databases can be used as the underlying storage mechanism.</span></span> <span data-ttu-id="27b89-115">某些数据库产品具有使 MAPI 功能更易于实现的功能集，因此您的数据库产品选择可能会受邮件存储提供程序需要支持的功能的影响。</span><span class="sxs-lookup"><span data-stu-id="27b89-115">Some database products have feature sets that make it easier to implement MAPI features, so your choice of database product may be affected by the features that your message store provider needs to support.</span></span>
  
<span data-ttu-id="27b89-116">使用现有数据库作为基础存储机制可节省工作，因为与实现自己的分层存储机制不同，将数据库对象作为 MAPI 对象呈现给 MAPI 客户端通常更容易。</span><span class="sxs-lookup"><span data-stu-id="27b89-116">Using an existing database as the underlying storage mechanism saves you work because it is usually easier to present database objects to MAPI clients as MAPI objects than to implement your own hierarchical storage mechanism.</span></span> <span data-ttu-id="27b89-117">这样做可使你在比实现自己的分层存储机制时更高级别地处理 MAPI 操作。</span><span class="sxs-lookup"><span data-stu-id="27b89-117">Doing this enables you to treat MAPI operations at a higher level than if you implement your own hierarchical storage mechanism.</span></span> <span data-ttu-id="27b89-118">例如，搜索具有特定主题行的邮件成为构造和提交适当的数据库查询的相当简单的问题，而不是实现复杂的例程来搜索分层存储机制。</span><span class="sxs-lookup"><span data-stu-id="27b89-118">For example, searching for a message with a particular subject line becomes a fairly simple matter of constructing and submitting an appropriate database query, rather than implementing complex routines to search your hierarchical storage mechanism.</span></span>
  
<span data-ttu-id="27b89-119">邮件存储提供程序与 MAPI 客户端和 MAPI 后台处理程序通信，以对文件夹和对象执行操作。</span><span class="sxs-lookup"><span data-stu-id="27b89-119">Message store providers communicate with MAPI clients and the MAPI spooler to perform operations on folders and objects.</span></span> <span data-ttu-id="27b89-120">邮件存储提供程序将这些操作转换为基础存储机制上的较低级别的操作。</span><span class="sxs-lookup"><span data-stu-id="27b89-120">The message store provider translates those operations into lower level operations on the underlying storage mechanism.</span></span> <span data-ttu-id="27b89-121">MAPI 后台处理程序通常在发送和接收邮件时与邮件存储提供程序通信。</span><span class="sxs-lookup"><span data-stu-id="27b89-121">The MAPI spooler typically communicates with the message store provider while sending and receiving messages.</span></span> <span data-ttu-id="27b89-122">MAPI 客户端通常与邮件存储提供程序通信，以操作文件夹层次结构以及读取、编辑、删除和发送邮件。</span><span class="sxs-lookup"><span data-stu-id="27b89-122">MAPI clients typically communicate with message store providers to manipulate the folder hierarchy and to read, edit, delete, and send messages.</span></span>
  
<span data-ttu-id="27b89-123">MAPI 后台处理程序和 MAPI 客户端与邮件存储提供程序通信以创建新邮件。</span><span class="sxs-lookup"><span data-stu-id="27b89-123">Both the MAPI spooler and MAPI clients communicate with the message store provider to create new messages.</span></span> <span data-ttu-id="27b89-124">客户端应用程序在用户撰写邮件时执行此操作。</span><span class="sxs-lookup"><span data-stu-id="27b89-124">Client applications do this when users compose a message.</span></span> <span data-ttu-id="27b89-125">MAPI 后台处理程序在接收传入消息时会这样做。</span><span class="sxs-lookup"><span data-stu-id="27b89-125">The MAPI spooler does this when it receives an incoming message.</span></span> <span data-ttu-id="27b89-126">在任一情况下，新邮件通常会在邮件存储的"收件箱"文件夹中创建（如果有）。</span><span class="sxs-lookup"><span data-stu-id="27b89-126">In either case, the new message is usually created in the Inbox folder of the message store, if there is one.</span></span>
  
<span data-ttu-id="27b89-127">邮件存储提供程序大量使用 MAPI 表、文件夹、邮件和属性。</span><span class="sxs-lookup"><span data-stu-id="27b89-127">Message store providers make heavy use of MAPI tables, folders, messages, and properties.</span></span> <span data-ttu-id="27b89-128">这些对象的实现详细信息记录在 [MAPI Tables](mapi-tables.md)、 [MAPI Folders](mapi-folders.md)、 [MAPI Messages](mapi-messages.md)和 [MAPI Property Overview 中](mapi-property-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="27b89-128">The implementation details for those objects are documented in [MAPI Tables](mapi-tables.md), [MAPI Folders](mapi-folders.md), [MAPI Messages](mapi-messages.md), and [MAPI Property Overview](mapi-property-overview.md).</span></span> <span data-ttu-id="27b89-129">在尝试实现邮件存储提供程序之前，您应熟悉该材料。</span><span class="sxs-lookup"><span data-stu-id="27b89-129">You should familiarize yourself with that material before attempting to implement a message store provider.</span></span>
  
<span data-ttu-id="27b89-130">有两种重要的邮件存储提供程序类型：可以充当用户的默认邮件存储的提供程序和无法执行的邮件存储提供程序。</span><span class="sxs-lookup"><span data-stu-id="27b89-130">There are two important types of message store providers: those that can act as a user's default message store and those that cannot.</span></span> <span data-ttu-id="27b89-131">默认邮件存储是客户端应用程序和 MAPI 后台处理程序可以执行任何邮件任务（如接收邮件或创建文件夹）的邮件存储。</span><span class="sxs-lookup"><span data-stu-id="27b89-131">A default message store is one in which client applications and the MAPI spooler can perform any messaging task, such as receiving messages or creating folders.</span></span> <span data-ttu-id="27b89-132">默认邮件存储提供程序必须支持比所有邮件存储提供程序所需的最小数量更多的功能。</span><span class="sxs-lookup"><span data-stu-id="27b89-132">A default message store provider must support several more features than the minimum number required for all message store providers.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="27b89-133">另请参阅</span><span class="sxs-lookup"><span data-stu-id="27b89-133">See also</span></span>

- [<span data-ttu-id="27b89-134">MAPI 概念</span><span class="sxs-lookup"><span data-stu-id="27b89-134">MAPI concepts</span></span>](mapi-concepts.md)

