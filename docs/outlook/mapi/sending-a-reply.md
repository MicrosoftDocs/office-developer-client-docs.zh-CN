---
title: 发送答复
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 90dafeae-6b61-40e3-8341-d6a11799d0f2
description: 上次修改时间：2015 年 3 月 9 日
ms.openlocfilehash: f47741369b1091c0dd24358e063de8f4675000fa
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "33437446"
---
# <a name="sending-a-reply"></a><span data-ttu-id="99014-103">发送答复</span><span class="sxs-lookup"><span data-stu-id="99014-103">Sending a reply</span></span>

<span data-ttu-id="99014-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="99014-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="99014-105">客户端应用程序通常支持两种类型的答复：一种仅发送给原始邮件的发件人，另一种发送给原始邮件的收件人列表中包括的所有其他收件人以及发件人。</span><span class="sxs-lookup"><span data-stu-id="99014-105">Client applications typically support two types of replies: one that is sent only to the sender of the original message and one that is sent to all other recipients included in the recipient list of the original message in addition to the sender.</span></span> <span data-ttu-id="99014-106">此第二种类型的答复通常称为"全部答复"邮件。</span><span class="sxs-lookup"><span data-stu-id="99014-106">This second type of reply is commonly referred to as a reply all message.</span></span>
  
<span data-ttu-id="99014-107">若要发送任一类型的答复，您可以实现发送原始邮件时执行某些相同的任务。</span><span class="sxs-lookup"><span data-stu-id="99014-107">To send a reply of either type, you implement some of the same tasks that you would when you send an original message.</span></span> <span data-ttu-id="99014-108">例如，打开默认邮件存储和传出邮件文件夹（通常为发件箱）并调用传出文件夹的 [IMAPIFolder：：CreateMessage](imapifolder-createmessage.md) 方法创建回复。</span><span class="sxs-lookup"><span data-stu-id="99014-108">For example, you open the default message store and the outgoing message folder, typically the Outbox, and call the outgoing folder's [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) method to create the reply.</span></span> <span data-ttu-id="99014-109">此外，打开保存原始邮件的文件夹，通常为"收件箱"。</span><span class="sxs-lookup"><span data-stu-id="99014-109">Also, you open the folder that holds the original message, typically the Inbox.</span></span> <span data-ttu-id="99014-110">有关打开不同文件夹的信息，请参阅 [打开邮件存储文件夹](opening-a-message-store-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="99014-110">For information about opening different folders, see [Opening a Message Store Folder](opening-a-message-store-folder.md).</span></span>
  
<span data-ttu-id="99014-111">创建答复和创建原始邮件之间的主要区别在于，使用答复时，大多数属性要么基于原始邮件的属性，要么直接从原始邮件的属性中复制。</span><span class="sxs-lookup"><span data-stu-id="99014-111">The main difference between creating a reply and creating an original message is that with a reply, most of the properties are either based on or copied directly from properties of the original message.</span></span> <span data-ttu-id="99014-112">附件（邮件的 **PR_MESSAGE_ATTACHMENTS (** [PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) 属性）被明确排除。</span><span class="sxs-lookup"><span data-stu-id="99014-112">Attachments — a message's **PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) property — are specifically excluded.</span></span> <span data-ttu-id="99014-113">回复所有邮件的收件人列表都是从原始邮件的列表中创建的，收件人由 PR_RECEIVED_BY_SEARCH_KEY ([PidTagReceivedBySearchKey](pidtagreceivedbysearchkey-canonical-property.md) **)** 属性表示，并且已删除所有盲信副本收件人。</span><span class="sxs-lookup"><span data-stu-id="99014-113">The recipient list for a reply all message is created from the original message's list with the recipient represented by the **PR_RECEIVED_BY_SEARCH_KEY** ([PidTagReceivedBySearchKey](pidtagreceivedbysearchkey-canonical-property.md)) property and all blind carbon copy recipients removed.</span></span> <span data-ttu-id="99014-114">the **PR_RECEIVED_BY_SEARCH_KEY** property represents the current user.</span><span class="sxs-lookup"><span data-stu-id="99014-114">The **PR_RECEIVED_BY_SEARCH_KEY** property represents the current user.</span></span> 
  
### <a name="to-send-a-reply"></a><span data-ttu-id="99014-115">发送答复</span><span class="sxs-lookup"><span data-stu-id="99014-115">To send a reply</span></span>
  
1. <span data-ttu-id="99014-116">打开默认邮件存储。</span><span class="sxs-lookup"><span data-stu-id="99014-116">Open the default message store.</span></span> <span data-ttu-id="99014-117">有关详细信息，请参阅 [打开默认邮件存储](opening-the-default-message-store.md)。</span><span class="sxs-lookup"><span data-stu-id="99014-117">For more information, see [Opening the Default Message Store](opening-the-default-message-store.md).</span></span>
    
2. <span data-ttu-id="99014-118">打开发件箱文件夹。</span><span class="sxs-lookup"><span data-stu-id="99014-118">Open the Outbox folder.</span></span> <span data-ttu-id="99014-119">有关详细信息，请参阅打开 [邮件存储文件夹](opening-a-message-store-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="99014-119">For more information, see [Opening a Message Store Folder](opening-a-message-store-folder.md).</span></span>
    
3. <span data-ttu-id="99014-120">调用发件箱的 [IMAPIFolder：：CreateMessage](imapifolder-createmessage.md) 方法来创建回复。</span><span class="sxs-lookup"><span data-stu-id="99014-120">Call the Outbox's [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) method to create the reply.</span></span> 
    
4. <span data-ttu-id="99014-121">调用原始邮件的 [IMAPIProp：：CopyTo](imapiprop-copyto.md) 方法将以下属性复制到回复邮件：</span><span class="sxs-lookup"><span data-stu-id="99014-121">Call the original message's [IMAPIProp::CopyTo](imapiprop-copyto.md) method to copy the following properties to the reply message:</span></span> 
    
   - <span data-ttu-id="99014-122">**PR \_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)) ，具体取决于你是否支持格式文本格式。</span><span class="sxs-lookup"><span data-stu-id="99014-122">**PR\_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) or **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)), depending on whether or not you support Rich Text Format.</span></span>
    
   - <span data-ttu-id="99014-123">**PR \_MESSAGE_RECIPIENTS (** [PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) ，如果答复将转到整个收件人列表。</span><span class="sxs-lookup"><span data-stu-id="99014-123">**PR\_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)), if the reply will go to the entire recipient list.</span></span>
    
   - <span data-ttu-id="99014-124">**PR \_NORMALIZED_SUBJECT (** [PidTagNormalizedSubject) 。](pidtagnormalizedsubject-canonical-property.md)</span><span class="sxs-lookup"><span data-stu-id="99014-124">**PR\_NORMALIZED_SUBJECT** ([PidTagNormalizedSubject](pidtagnormalizedsubject-canonical-property.md)).</span></span>
    
5. <span data-ttu-id="99014-125">请勿在 **IMAPIProp：：CopyTo 调用中包括以下属性**：</span><span class="sxs-lookup"><span data-stu-id="99014-125">Do not include the following properties in your call to **IMAPIProp::CopyTo**:</span></span>
    
    |||
    |:-----|:-----|
    |<span data-ttu-id="99014-126">**PR \_ 客户端 \_ 提交 \_ 时间**</span><span class="sxs-lookup"><span data-stu-id="99014-126">**PR\_CLIENT\_SUBMIT\_TIME**</span></span> <br/> |<span data-ttu-id="99014-127">**PR \_ 邮件 \_ 传递 \_ 时间**</span><span class="sxs-lookup"><span data-stu-id="99014-127">**PR\_MESSAGE\_DELIVERY\_TIME**</span></span> <br/> |
    |<span data-ttu-id="99014-128">**PR \_ 邮件 \_ 下载 \_ 时间**</span><span class="sxs-lookup"><span data-stu-id="99014-128">**PR\_MESSAGE\_DOWNLOAD\_TIME**</span></span> <br/> |<span data-ttu-id="99014-129">**PR \_ 邮件 \_ 标志**</span><span class="sxs-lookup"><span data-stu-id="99014-129">**PR\_MESSAGE\_FLAGS**</span></span> <br/> |
    |<span data-ttu-id="99014-130">**PR \_ ORIGINATOR \_ DELIVERY \_ REPORT\REQUESTED**</span><span class="sxs-lookup"><span data-stu-id="99014-130">**PR\_ORIGINATOR\_DELIVERY\_ REPORT\REQUESTED**</span></span> <br/> |<span data-ttu-id="99014-131">**PR \_RCVD \_ 表示** 属性</span><span class="sxs-lookup"><span data-stu-id="99014-131">**PR\_RCVD\_REPRESENTING** properties</span></span>  <br/> |
    |<span data-ttu-id="99014-132">**PR \_ 已 \_ 读回 \_ 执 ENTRYID**</span><span class="sxs-lookup"><span data-stu-id="99014-132">**PR\_READ\_RECEIPT\_ENTRYID**</span></span> <br/> |<span data-ttu-id="99014-133">**请求的 PR \_ \_ \_ 已读回执**</span><span class="sxs-lookup"><span data-stu-id="99014-133">**PR\_READ\_RECEIPT\_REQUESTED**</span></span> <br/> |
    |<span data-ttu-id="99014-134">**PR \_RECEIVED \_ BY** 属性</span><span class="sxs-lookup"><span data-stu-id="99014-134">**PR\_RECEIVED\_BY** properties</span></span>  <br/> |<span data-ttu-id="99014-135">**PR \_REPLY \_ RECIPIENT** 属性</span><span class="sxs-lookup"><span data-stu-id="99014-135">**PR\_REPLY\_RECIPIENT** properties</span></span>  <br/> |
    |<span data-ttu-id="99014-136">**PR \_ REPORT \_ ENTRYID**</span><span class="sxs-lookup"><span data-stu-id="99014-136">**PR\_REPORT\_ENTRYID**</span></span> <br/> |<span data-ttu-id="99014-137">**PR \_SENDER** 属性</span><span class="sxs-lookup"><span data-stu-id="99014-137">**PR\_SENDER** properties</span></span>  <br/> |
    |<span data-ttu-id="99014-138">**PR \_已 \_ 发送表示** 属性</span><span class="sxs-lookup"><span data-stu-id="99014-138">**PR\_SENT\_REPRESENTING** properties</span></span>  <br/> |<span data-ttu-id="99014-139">**PR \_ SENTMAIL \_ ENTRYID**</span><span class="sxs-lookup"><span data-stu-id="99014-139">**PR\_SENTMAIL\_ENTRYID**</span></span> <br/> |
    |<span data-ttu-id="99014-140">**PR \_ 主题 \_ 前缀**</span><span class="sxs-lookup"><span data-stu-id="99014-140">**PR\_SUBJECT\_PREFIX**</span></span> <br/> | <br/> |
   
6. <span data-ttu-id="99014-141">将分隔符文本添加到您支持的任何邮件正文属性 — **PR_BODY** **、PR_HTM** L 或 **PR_RTF_COMPRESSED**。</span><span class="sxs-lookup"><span data-stu-id="99014-141">Add separator text to whichever message body property you support — **PR_BODY**, **PR_HTM** L, or **PR_RTF_COMPRESSED**.</span></span>
    
7. <span data-ttu-id="99014-142">调用 [ScCreateConversationIndex](sccreateconversationindex.md)，将原始邮件的 **PR_CONVERSATION_INDEX** ([PidTagConversationIndex](pidtagconversationindex-canonical-property.md)) 值。</span><span class="sxs-lookup"><span data-stu-id="99014-142">Call [ScCreateConversationIndex](sccreateconversationindex.md), passing in the value of the original message's **PR_CONVERSATION_INDEX** ([PidTagConversationIndex](pidtagconversationindex-canonical-property.md)) property.</span></span>
    
8. <span data-ttu-id="99014-143">设置答复的前缀。</span><span class="sxs-lookup"><span data-stu-id="99014-143">Set a prefix for the reply.</span></span> <span data-ttu-id="99014-144">如果使用的是标准"RE："，请连接这些字符到 PR_NORMALIZED_SUBJECT 开头 **，PR_SUBJECT (**  [PidTagSubject](pidtagsubject-canonical-property.md)) 设置为此新字符串。</span><span class="sxs-lookup"><span data-stu-id="99014-144">If you are using the standard "RE:", concatenate these characters onto the beginning of **PR_NORMALIZED_SUBJECT** and set **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)) to this new string.</span></span> <span data-ttu-id="99014-145">请勿将 PR_SUBJECT_PREFIX **(** [PidTagSubjectPrefix](pidtagsubjectprefix-canonical-property.md)) 。</span><span class="sxs-lookup"><span data-stu-id="99014-145">Do not set **PR_SUBJECT_PREFIX** ([PidTagSubjectPrefix](pidtagsubjectprefix-canonical-property.md)).</span></span> <span data-ttu-id="99014-146">如果使用非标准前缀（如长度超过三个字符的字符串），请存储在 **PR_SUBJECT_PREFIX。**</span><span class="sxs-lookup"><span data-stu-id="99014-146">If you are using a nonstandard prefix, such as a string longer than three characters, store it in **PR_SUBJECT_PREFIX**.</span></span> 
    
9. <span data-ttu-id="99014-147">将 **PR_SENT_REPRESENTING** 属性设置为活动属性 **中的PR_RCVD_REPRESENTING值** 。</span><span class="sxs-lookup"><span data-stu-id="99014-147">Set the **PR_SENT_REPRESENTING** properties to the corresponding values in the **PR_RCVD_REPRESENTING** properties.</span></span> 
    
10. <span data-ttu-id="99014-148">将 **PR \_ REPLY_RECIPIENT_ENTRIES** ([PidTagReplyRecipientEntries](pidtagreplyrecipiententries-canonical-property.md)) 和 **PR_REPLY \_ RECIPIENT_NAMES** ([PidTagReplyRecipientNames](pidtagreplyrecipientnames-canonical-property.md)) 中的每个条目设置为主要收件人（其类型为 MAPI_TO 的收件人）的条目标识符和 显示名称。</span><span class="sxs-lookup"><span data-stu-id="99014-148">Set each of the entries in **PR\_REPLY_RECIPIENT_ENTRIES** ([PidTagReplyRecipientEntries](pidtagreplyrecipiententries-canonical-property.md)) and **PR_REPLY\_RECIPIENT_NAMES** ([PidTagReplyRecipientNames](pidtagreplyrecipientnames-canonical-property.md)) to the entry identifier and display name of a primary recipient — a recipient whose type is MAPI_TO.</span></span> <span data-ttu-id="99014-149">保持这些属性同步。</span><span class="sxs-lookup"><span data-stu-id="99014-149">Keep these properties synchronized.</span></span> <span data-ttu-id="99014-150">也就是说 **，PR_REPLY_RECIPIENT \_ 条目** 和 **PR_REPLY_RECIPIENT_NAMES** 必须包含相同数量的条目，并且其中一个属性中位于特定位置的条目必须对应于另一个属性中位于同一位置的条目。</span><span class="sxs-lookup"><span data-stu-id="99014-150">That is, **PR_REPLY_RECIPIENT\_ENTRIES** and **PR_REPLY_RECIPIENT_NAMES** must contain the same number of entries, and an entry at a particular position in one of the properties must correspond to an entry at the same position in the other property.</span></span> 
    
11. <span data-ttu-id="99014-151">如果答复仅发送给原始邮件的发件人，请创建一个条目收件人列表，该收件人由原始邮件的 **PR_SENT_REPRESENTING** 属性表示。</span><span class="sxs-lookup"><span data-stu-id="99014-151">If the reply is being sent only to the sender of the original message, create a single entry recipient list with the recipient represented by the original message's **PR_SENT_REPRESENTING** property.</span></span> <span data-ttu-id="99014-152">有关创建收件人列表的信息，请参阅 [创建收件人列表](creating-a-recipient-list.md)。</span><span class="sxs-lookup"><span data-stu-id="99014-152">For more information about creating a recipient list, see [Creating a Recipient List](creating-a-recipient-list.md).</span></span>
    
12. <span data-ttu-id="99014-153">如果答复全部答复，请创建收件人列表，如下所示：</span><span class="sxs-lookup"><span data-stu-id="99014-153">If the reply is a reply all, create a recipient list as follows:</span></span>
    
    1. <span data-ttu-id="99014-154">调用原始邮件的 [IMessage：：GetRecipientTable](imessage-getrecipienttable.md) 方法以访问其收件人表。</span><span class="sxs-lookup"><span data-stu-id="99014-154">Call the original message's [IMessage::GetRecipientTable](imessage-getrecipienttable.md) method to access its recipient table.</span></span> 
        
    2. <span data-ttu-id="99014-155">调用 [HrQueryAllRows](hrqueryallrows.md) 以检索表中的所有行。</span><span class="sxs-lookup"><span data-stu-id="99014-155">Call [HrQueryAllRows](hrqueryallrows.md) to retrieve all of the rows in the table.</span></span> <span data-ttu-id="99014-156">确定每一行是代表主要收件人还是抄稿收件人，并且应保留在列表中，或者是否代表"抄用副本"收件人或用户，并且应从列表中删除。</span><span class="sxs-lookup"><span data-stu-id="99014-156">Determine if each row represents a primary or carbon copy recipient and should remain in the list or if it represents a blind carbon copy recipient or the user and should be removed from the list.</span></span> 
        
    3. <span data-ttu-id="99014-157">通过查看[PidTagRecipientType](pidtagrecipienttype-canonical-property.md) PR_RECIPIENT_TYPE (列来区分) 类型。 </span><span class="sxs-lookup"><span data-stu-id="99014-157">Differentiate between recipient types by looking at the **PR_RECIPIENT_TYPE** ([PidTagRecipientType](pidtagrecipienttype-canonical-property.md)) column.</span></span> <span data-ttu-id="99014-158">此列将设置为MAPI_TO收件人、MAPI_CC的收件人和MAPI_BCC收件人的收件人。</span><span class="sxs-lookup"><span data-stu-id="99014-158">This column will be set to MAPI_TO for primary recipients, MAPI_CC for carbon copy recipients, and MAPI_BCC for blind carbon copy recipients.</span></span> 
        
    4. <span data-ttu-id="99014-159">比较 **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) 列与原始邮件的 **PR_RECEIVED_BY_SEARCH_KEY** 属性以确定该行是否表示用户。</span><span class="sxs-lookup"><span data-stu-id="99014-159">Compare the **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) column with the **PR_RECEIVED_BY_SEARCH_KEY** property of the original message to determine if the row represents the user.</span></span> 
        
    5. <span data-ttu-id="99014-160">通过调用 [MAPIFreeBuffer](mapifreebuffer.md) 释放与收件人表 [的 SRowSet](srowset.md) 结构中的相应条目关联的内存，从收件人列表中删除不需要的行。</span><span class="sxs-lookup"><span data-stu-id="99014-160">Remove unwanted rows from the recipient list by calling [MAPIFreeBuffer](mapifreebuffer.md) to free the memory associated with the corresponding entries in the recipient table's [SRowSet](srowset.md) structure.</span></span> <span data-ttu-id="99014-161">将属性值数组中所有值设置为零，将 **所有 cValues** 成员设置为零，将 **SRowSet** 中每个 [SRow](srow.md)结构的所有 **lpProps** 成员设置为 NULL。</span><span class="sxs-lookup"><span data-stu-id="99014-161">Set all of the values in the property value array to zero, all of the **cValues** members to zero, and all of the **lpProps** members in each [SRow](srow.md) structure in the **SRowSet** to NULL.</span></span> 
        
    6. <span data-ttu-id="99014-162">将发件人添加到收件人列表中，如原始邮件的 **PR \_ SENT_REPRESENTING_NAME** ([PidTagSentRepresentingName](pidtagsentrepresentingname-canonical-property.md)) 和 **PR_SENT_REPRESENTING_ENTRYID** ([PidTagSentRepresentingEntryId](pidtagsentrepresentingentryid-canonical-property.md)) 属性表示。</span><span class="sxs-lookup"><span data-stu-id="99014-162">Add the sender to the recipient list, as represented by the original message's **PR\_SENT_REPRESENTING_NAME** ([PidTagSentRepresentingName](pidtagsentrepresentingname-canonical-property.md)) and **PR_SENT_REPRESENTING_ENTRYID** ([PidTagSentRepresentingEntryId](pidtagsentrepresentingentryid-canonical-property.md)) properties.</span></span> <span data-ttu-id="99014-163">检查发件人在列表中是否重复。</span><span class="sxs-lookup"><span data-stu-id="99014-163">Check that the sender is not duplicated in the list.</span></span>
        
    7. <span data-ttu-id="99014-164">调用回复邮件 [的 IMessage：：ModifyRecipients](imessage-modifyrecipients.md) 方法，将  _ulFlags_ 参数设置为零，以基于原始邮件中的列表为答复或转发的邮件创建新的收件人列表。</span><span class="sxs-lookup"><span data-stu-id="99014-164">Call the reply message's [IMessage::ModifyRecipients](imessage-modifyrecipients.md) method, setting the  _ulFlags_ parameter to zero, to create a new recipient list for the reply or forwarded message based on the list from the original message.</span></span> 
    
13. <span data-ttu-id="99014-165">调用回复的 [IMAPIProp：：SaveChanges](imapiprop-savechanges.md) 方法来保存消息，或调用 [IMessage：：SubmitMessage](imessage-submitmessage.md) 保存并发送邮件。</span><span class="sxs-lookup"><span data-stu-id="99014-165">Call the reply's [IMAPIProp::SaveChanges](imapiprop-savechanges.md) method to save the message or [IMessage::SubmitMessage](imessage-submitmessage.md) to save and send it.</span></span> 
    
> [!NOTE]
> <span data-ttu-id="99014-166">在调用 **IMessage：：ModifyRecipients** 以将更改存储在收件人列表中之前，您可以允许用户通过邮件窗体进行修改。</span><span class="sxs-lookup"><span data-stu-id="99014-166">Before calling **IMessage::ModifyRecipients** to store changes in the recipient list, you can allow users to make modifications through the message form.</span></span> <span data-ttu-id="99014-167">用户可以添加到列表或删除特定成员。</span><span class="sxs-lookup"><span data-stu-id="99014-167">Users can add to the list or remove particular members.</span></span> <span data-ttu-id="99014-168">允许用户对收件人列表进行更改是一项可选的客户端功能。</span><span class="sxs-lookup"><span data-stu-id="99014-168">Allowing users to make changes to a recipient list is an optional client feature.</span></span> 
  

