---
title: 发送答复
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 90dafeae-6b61-40e3-8341-d6a11799d0f2
description: 上次修改时间：2015 年 3 月 9 日
ms.openlocfilehash: f47741369b1091c0dd24358e063de8f4675000fa
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "33437446"
---
# <a name="sending-a-reply"></a><span data-ttu-id="c4606-103">发送答复</span><span class="sxs-lookup"><span data-stu-id="c4606-103">Sending a reply</span></span>

<span data-ttu-id="c4606-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="c4606-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="c4606-105">客户端应用程序通常支持两种类型的答复: 一个只发送给原始邮件的发件人, 另一个发送给原始邮件的收件人列表中包含的其他所有收件人以及发件人。</span><span class="sxs-lookup"><span data-stu-id="c4606-105">Client applications typically support two types of replies: one that is sent only to the sender of the original message and one that is sent to all other recipients included in the recipient list of the original message in addition to the sender.</span></span> <span data-ttu-id="c4606-106">第二种类型的回复通常称为 "答复所有邮件"。</span><span class="sxs-lookup"><span data-stu-id="c4606-106">This second type of reply is commonly referred to as a reply all message.</span></span>
  
<span data-ttu-id="c4606-107">若要发送这两种类型的答复, 您需要执行一些与发送原始邮件时相同的任务。</span><span class="sxs-lookup"><span data-stu-id="c4606-107">To send a reply of either type, you implement some of the same tasks that you would when you send an original message.</span></span> <span data-ttu-id="c4606-108">例如, 打开默认邮件存储和 "传出邮件" 文件夹 (通常为 "发件箱"), 并调用传出文件夹的[IMAPIFolder:: CreateMessage](imapifolder-createmessage.md)方法来创建答复。</span><span class="sxs-lookup"><span data-stu-id="c4606-108">For example, you open the default message store and the outgoing message folder, typically the Outbox, and call the outgoing folder's [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) method to create the reply.</span></span> <span data-ttu-id="c4606-109">此外, 还可以打开保存原始邮件的文件夹 (通常为 "收件箱")。</span><span class="sxs-lookup"><span data-stu-id="c4606-109">Also, you open the folder that holds the original message, typically the Inbox.</span></span> <span data-ttu-id="c4606-110">有关打开不同文件夹的信息, 请参阅[打开邮件存储文件夹](opening-a-message-store-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="c4606-110">For information about opening different folders, see [Opening a Message Store Folder](opening-a-message-store-folder.md).</span></span>
  
<span data-ttu-id="c4606-111">创建答复和创建原始邮件的主要区别在于, 使用答复时, 大部分属性是基于原始邮件的属性, 还是直接从原始邮件的属性复制。</span><span class="sxs-lookup"><span data-stu-id="c4606-111">The main difference between creating a reply and creating an original message is that with a reply, most of the properties are either based on or copied directly from properties of the original message.</span></span> <span data-ttu-id="c4606-112">附件—特别排除的是邮件的**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) 属性。</span><span class="sxs-lookup"><span data-stu-id="c4606-112">Attachments — a message's **PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) property — are specifically excluded.</span></span> <span data-ttu-id="c4606-113">答复全部邮件的收件人列表是从原始邮件的列表中创建的, 收件人由**PR_RECEIVED_BY_SEARCH_KEY** ([PidTagReceivedBySearchKey](pidtagreceivedbysearchkey-canonical-property.md)) 属性和删除的所有密件抄送收件人。</span><span class="sxs-lookup"><span data-stu-id="c4606-113">The recipient list for a reply all message is created from the original message's list with the recipient represented by the **PR_RECEIVED_BY_SEARCH_KEY** ([PidTagReceivedBySearchKey](pidtagreceivedbysearchkey-canonical-property.md)) property and all blind carbon copy recipients removed.</span></span> <span data-ttu-id="c4606-114">**PR_RECEIVED_BY_SEARCH_KEY**属性表示当前用户。</span><span class="sxs-lookup"><span data-stu-id="c4606-114">The **PR_RECEIVED_BY_SEARCH_KEY** property represents the current user.</span></span> 
  
### <a name="to-send-a-reply"></a><span data-ttu-id="c4606-115">发送答复</span><span class="sxs-lookup"><span data-stu-id="c4606-115">To send a reply</span></span>
  
1. <span data-ttu-id="c4606-116">打开默认邮件存储。</span><span class="sxs-lookup"><span data-stu-id="c4606-116">Open the default message store.</span></span> <span data-ttu-id="c4606-117">有关详细信息, 请参阅[打开默认邮件存储](opening-the-default-message-store.md)。</span><span class="sxs-lookup"><span data-stu-id="c4606-117">For more information, see [Opening the Default Message Store](opening-the-default-message-store.md).</span></span>
    
2. <span data-ttu-id="c4606-118">打开 "发件箱" 文件夹。</span><span class="sxs-lookup"><span data-stu-id="c4606-118">Open the Outbox folder.</span></span> <span data-ttu-id="c4606-119">有关详细信息, 请参阅[打开邮件存储文件夹](opening-a-message-store-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="c4606-119">For more information, see [Opening a Message Store Folder](opening-a-message-store-folder.md).</span></span>
    
3. <span data-ttu-id="c4606-120">调用发件箱的[IMAPIFolder:: CreateMessage](imapifolder-createmessage.md)方法以创建答复。</span><span class="sxs-lookup"><span data-stu-id="c4606-120">Call the Outbox's [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) method to create the reply.</span></span> 
    
4. <span data-ttu-id="c4606-121">调用原始邮件的[IMAPIProp:: CopyTo](imapiprop-copyto.md)方法将以下属性复制到答复邮件:</span><span class="sxs-lookup"><span data-stu-id="c4606-121">Call the original message's [IMAPIProp::CopyTo](imapiprop-copyto.md) method to copy the following properties to the reply message:</span></span> 
    
   - <span data-ttu-id="c4606-122">**PR\_主体**([PidTagBody](pidtagbody-canonical-property.md)) 或**PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)), 具体取决于是否支持 rtf 格式。</span><span class="sxs-lookup"><span data-stu-id="c4606-122">**PR\_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) or **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)), depending on whether or not you support Rich Text Format.</span></span>
    
   - <span data-ttu-id="c4606-123">**PR\_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) (如果答复将转到整个收件人列表)。</span><span class="sxs-lookup"><span data-stu-id="c4606-123">**PR\_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)), if the reply will go to the entire recipient list.</span></span>
    
   - <span data-ttu-id="c4606-124">**PR\_NORMALIZED_SUBJECT** ([PidTagNormalizedSubject](pidtagnormalizedsubject-canonical-property.md))。</span><span class="sxs-lookup"><span data-stu-id="c4606-124">**PR\_NORMALIZED_SUBJECT** ([PidTagNormalizedSubject](pidtagnormalizedsubject-canonical-property.md)).</span></span>
    
5. <span data-ttu-id="c4606-125">请勿在调用**IMAPIProp:: CopyTo**中包含以下属性:</span><span class="sxs-lookup"><span data-stu-id="c4606-125">Do not include the following properties in your call to **IMAPIProp::CopyTo**:</span></span>
    
    |||
    |:-----|:-----|
    |<span data-ttu-id="c4606-126">**PR\_客户\_端\_提交时间**</span><span class="sxs-lookup"><span data-stu-id="c4606-126">**PR\_CLIENT\_SUBMIT\_TIME**</span></span> <br/> |<span data-ttu-id="c4606-127">**PR\_邮件\_传递\_时间**</span><span class="sxs-lookup"><span data-stu-id="c4606-127">**PR\_MESSAGE\_DELIVERY\_TIME**</span></span> <br/> |
    |<span data-ttu-id="c4606-128">**PR\_邮件\_下载\_时间**</span><span class="sxs-lookup"><span data-stu-id="c4606-128">**PR\_MESSAGE\_DOWNLOAD\_TIME**</span></span> <br/> |<span data-ttu-id="c4606-129">**PR\_邮件\_标志**</span><span class="sxs-lookup"><span data-stu-id="c4606-129">**PR\_MESSAGE\_FLAGS**</span></span> <br/> |
    |<span data-ttu-id="c4606-130">**PR\_发起\_人\_传递 REPORT\REQUESTED**</span><span class="sxs-lookup"><span data-stu-id="c4606-130">**PR\_ORIGINATOR\_DELIVERY\_ REPORT\REQUESTED**</span></span> <br/> |<span data-ttu-id="c4606-131">**PR\_RCVD\_表示**属性</span><span class="sxs-lookup"><span data-stu-id="c4606-131">**PR\_RCVD\_REPRESENTING** properties</span></span>  <br/> |
    |<span data-ttu-id="c4606-132">**PR\_阅读\_回执\_条目 ID**</span><span class="sxs-lookup"><span data-stu-id="c4606-132">**PR\_READ\_RECEIPT\_ENTRYID**</span></span> <br/> |<span data-ttu-id="c4606-133">**请求\_PR\_已\_读回执**</span><span class="sxs-lookup"><span data-stu-id="c4606-133">**PR\_READ\_RECEIPT\_REQUESTED**</span></span> <br/> |
    |<span data-ttu-id="c4606-134">**通过\_属性\_接收的 PR**</span><span class="sxs-lookup"><span data-stu-id="c4606-134">**PR\_RECEIVED\_BY** properties</span></span>  <br/> |<span data-ttu-id="c4606-135">**"\_PR\_答复收件人**" 属性</span><span class="sxs-lookup"><span data-stu-id="c4606-135">**PR\_REPLY\_RECIPIENT** properties</span></span>  <br/> |
    |<span data-ttu-id="c4606-136">**PR\_报告\_条目 ID**</span><span class="sxs-lookup"><span data-stu-id="c4606-136">**PR\_REPORT\_ENTRYID**</span></span> <br/> |<span data-ttu-id="c4606-137">**PR\_发件人**属性</span><span class="sxs-lookup"><span data-stu-id="c4606-137">**PR\_SENDER** properties</span></span>  <br/> |
    |<span data-ttu-id="c4606-138">**PR\_发送\_表示**属性</span><span class="sxs-lookup"><span data-stu-id="c4606-138">**PR\_SENT\_REPRESENTING** properties</span></span>  <br/> |<span data-ttu-id="c4606-139">**PR\_SENTMAIL\_ENTRYID**</span><span class="sxs-lookup"><span data-stu-id="c4606-139">**PR\_SENTMAIL\_ENTRYID**</span></span> <br/> |
    |<span data-ttu-id="c4606-140">**PR\_主题\_前缀**</span><span class="sxs-lookup"><span data-stu-id="c4606-140">**PR\_SUBJECT\_PREFIX**</span></span> <br/> | <br/> |
   
6. <span data-ttu-id="c4606-141">向您支持的任何邮件正文属性添加分隔符文本, 即**PR_BODY**、 **PR_HTM**L 或**PR_RTF_COMPRESSED**。</span><span class="sxs-lookup"><span data-stu-id="c4606-141">Add separator text to whichever message body property you support — **PR_BODY**, **PR_HTM**L, or **PR_RTF_COMPRESSED**.</span></span>
    
7. <span data-ttu-id="c4606-142">调用[ScCreateConversationIndex](sccreateconversationindex.md), 并传入原始邮件的**PR_CONVERSATION_INDEX** ([PidTagConversationIndex](pidtagconversationindex-canonical-property.md)) 属性的值。</span><span class="sxs-lookup"><span data-stu-id="c4606-142">Call [ScCreateConversationIndex](sccreateconversationindex.md), passing in the value of the original message's **PR_CONVERSATION_INDEX** ([PidTagConversationIndex](pidtagconversationindex-canonical-property.md)) property.</span></span>
    
8. <span data-ttu-id="c4606-143">为答复设置前缀。</span><span class="sxs-lookup"><span data-stu-id="c4606-143">Set a prefix for the reply.</span></span> <span data-ttu-id="c4606-144">如果您使用的是标准的 "RE:", 请将这些字符连接到**PR_NORMALIZED_SUBJECT**的开头, 并将**PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)) 设置为此新字符串。</span><span class="sxs-lookup"><span data-stu-id="c4606-144">If you are using the standard "RE:", concatenate these characters onto the beginning of **PR_NORMALIZED_SUBJECT** and set **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)) to this new string.</span></span> <span data-ttu-id="c4606-145">请勿设置**PR_SUBJECT_PREFIX** ([PidTagSubjectPrefix](pidtagsubjectprefix-canonical-property.md))。</span><span class="sxs-lookup"><span data-stu-id="c4606-145">Do not set **PR_SUBJECT_PREFIX** ([PidTagSubjectPrefix](pidtagsubjectprefix-canonical-property.md)).</span></span> <span data-ttu-id="c4606-146">如果您使用非标准前缀 (例如字符串超过三个字符的字符串), 则将其存储在**PR_SUBJECT_PREFIX**中。</span><span class="sxs-lookup"><span data-stu-id="c4606-146">If you are using a nonstandard prefix, such as a string longer than three characters, store it in **PR_SUBJECT_PREFIX**.</span></span> 
    
9. <span data-ttu-id="c4606-147">将**PR_SENT_REPRESENTING**属性设置为**PR_RCVD_REPRESENTING**属性中对应的值。</span><span class="sxs-lookup"><span data-stu-id="c4606-147">Set the **PR_SENT_REPRESENTING** properties to the corresponding values in the **PR_RCVD_REPRESENTING** properties.</span></span> 
    
10. <span data-ttu-id="c4606-148">将 " **PR\_REPLY_RECIPIENT_ENTRIES** ([PidTagReplyRecipientEntries](pidtagreplyrecipiententries-canonical-property.md))" 和 " **\_PR_REPLY RECIPIENT_NAMES** ([PidTagReplyRecipientNames](pidtagreplyrecipientnames-canonical-property.md))" 中的每个条目设置为 "条目标识符" 和 "显示名称"主要收件人—类型为 "MAPI_TO" 的收件人。</span><span class="sxs-lookup"><span data-stu-id="c4606-148">Set each of the entries in **PR\_REPLY_RECIPIENT_ENTRIES** ([PidTagReplyRecipientEntries](pidtagreplyrecipiententries-canonical-property.md)) and **PR_REPLY\_RECIPIENT_NAMES** ([PidTagReplyRecipientNames](pidtagreplyrecipientnames-canonical-property.md)) to the entry identifier and display name of a primary recipient — a recipient whose type is MAPI_TO.</span></span> <span data-ttu-id="c4606-149">保持这些属性同步。</span><span class="sxs-lookup"><span data-stu-id="c4606-149">Keep these properties synchronized.</span></span> <span data-ttu-id="c4606-150">也就是说, **PR_REPLY_RECIPIENT\_** entry 和**PR_REPLY_RECIPIENT_NAMES**必须包含相同的条目数, 并且其中一个属性中的特定位置的条目必须与其他项目中的同一位置的条目相对应财产.</span><span class="sxs-lookup"><span data-stu-id="c4606-150">That is, **PR_REPLY_RECIPIENT\_ENTRIES** and **PR_REPLY_RECIPIENT_NAMES** must contain the same number of entries, and an entry at a particular position in one of the properties must correspond to an entry at the same position in the other property.</span></span> 
    
11. <span data-ttu-id="c4606-151">如果答复仅发送给原始邮件的发件人, 请使用原始邮件的**PR_SENT_REPRESENTING**属性的收件人创建单个条目收件人列表。</span><span class="sxs-lookup"><span data-stu-id="c4606-151">If the reply is being sent only to the sender of the original message, create a single entry recipient list with the recipient represented by the original message's **PR_SENT_REPRESENTING** property.</span></span> <span data-ttu-id="c4606-152">有关创建收件人列表的详细信息, 请参阅[创建收件人列表](creating-a-recipient-list.md)。</span><span class="sxs-lookup"><span data-stu-id="c4606-152">For more information about creating a recipient list, see [Creating a Recipient List](creating-a-recipient-list.md).</span></span>
    
12. <span data-ttu-id="c4606-153">如果答复是 "全部答复", 请按如下所示创建收件人列表:</span><span class="sxs-lookup"><span data-stu-id="c4606-153">If the reply is a reply all, create a recipient list as follows:</span></span>
    
    1. <span data-ttu-id="c4606-154">调用原始邮件的[IMessage:: GetRecipientTable](imessage-getrecipienttable.md)方法以访问其收件人表。</span><span class="sxs-lookup"><span data-stu-id="c4606-154">Call the original message's [IMessage::GetRecipientTable](imessage-getrecipienttable.md) method to access its recipient table.</span></span> 
        
    2. <span data-ttu-id="c4606-155">调用[HrQueryAllRows](hrqueryallrows.md)以检索表中的所有行。</span><span class="sxs-lookup"><span data-stu-id="c4606-155">Call [HrQueryAllRows](hrqueryallrows.md) to retrieve all of the rows in the table.</span></span> <span data-ttu-id="c4606-156">确定每行是否表示主收件人或抄送收件人, 并且应保留在列表中, 或者如果它表示密件抄送收件人或用户, 应将其从列表中删除。</span><span class="sxs-lookup"><span data-stu-id="c4606-156">Determine if each row represents a primary or carbon copy recipient and should remain in the list or if it represents a blind carbon copy recipient or the user and should be removed from the list.</span></span> 
        
    3. <span data-ttu-id="c4606-157">通过查看**PR_RECIPIENT_TYPE** ([PidTagRecipientType](pidtagrecipienttype-canonical-property.md)) 列来区分收件人类型。</span><span class="sxs-lookup"><span data-stu-id="c4606-157">Differentiate between recipient types by looking at the **PR_RECIPIENT_TYPE** ([PidTagRecipientType](pidtagrecipienttype-canonical-property.md)) column.</span></span> <span data-ttu-id="c4606-158">对于主要收件人, MAPI_CC 将设置为 MAPI_TO, 对于抄送收件人, 此列将设置为 MAPI_BCC, 对于密件抄送收件人, 此列将设置为。</span><span class="sxs-lookup"><span data-stu-id="c4606-158">This column will be set to MAPI_TO for primary recipients, MAPI_CC for carbon copy recipients, and MAPI_BCC for blind carbon copy recipients.</span></span> 
        
    4. <span data-ttu-id="c4606-159">将**PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) 列与原始邮件的**PR_RECEIVED_BY_SEARCH_KEY**属性进行比较, 以确定该行是否代表用户。</span><span class="sxs-lookup"><span data-stu-id="c4606-159">Compare the **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) column with the **PR_RECEIVED_BY_SEARCH_KEY** property of the original message to determine if the row represents the user.</span></span> 
        
    5. <span data-ttu-id="c4606-160">通过调用[MAPIFreeBuffer](mapifreebuffer.md) , 从收件人列表中删除不需要的行, 以释放与收件人表的[SRowSet](srowset.md)结构中的相应条目相关联的内存。</span><span class="sxs-lookup"><span data-stu-id="c4606-160">Remove unwanted rows from the recipient list by calling [MAPIFreeBuffer](mapifreebuffer.md) to free the memory associated with the corresponding entries in the recipient table's [SRowSet](srowset.md) structure.</span></span> <span data-ttu-id="c4606-161">将属性值数组中的所有值都设置为零, 将所有**cValues**成员设置为零, 并将**SRowSet**中的每个[SRow](srow.md)结构中的所有**lpProps**成员设置为 NULL。</span><span class="sxs-lookup"><span data-stu-id="c4606-161">Set all of the values in the property value array to zero, all of the **cValues** members to zero, and all of the **lpProps** members in each [SRow](srow.md) structure in the **SRowSet** to NULL.</span></span> 
        
    6. <span data-ttu-id="c4606-162">将发件人添加到收件人列表, 由原始邮件的**PR\_SENT_REPRESENTING_NAME** ([PidTagSentRepresentingName](pidtagsentrepresentingname-canonical-property.md)) 和**PR_SENT_REPRESENTING_ENTRYID** ([PidTagSentRepresentingEntryId](pidtagsentrepresentingentryid-canonical-property.md)) 表示属性.</span><span class="sxs-lookup"><span data-stu-id="c4606-162">Add the sender to the recipient list, as represented by the original message's **PR\_SENT_REPRESENTING_NAME** ([PidTagSentRepresentingName](pidtagsentrepresentingname-canonical-property.md)) and **PR_SENT_REPRESENTING_ENTRYID** ([PidTagSentRepresentingEntryId](pidtagsentrepresentingentryid-canonical-property.md)) properties.</span></span> <span data-ttu-id="c4606-163">检查列表中的发件人是否不重复。</span><span class="sxs-lookup"><span data-stu-id="c4606-163">Check that the sender is not duplicated in the list.</span></span>
        
    7. <span data-ttu-id="c4606-164">调用答复邮件的[IMessage:: ModifyRecipients](imessage-modifyrecipients.md)方法, 将_ulFlags_参数设置为零, 以根据原始邮件中的列表创建答复邮件或转发邮件的新收件人列表。</span><span class="sxs-lookup"><span data-stu-id="c4606-164">Call the reply message's [IMessage::ModifyRecipients](imessage-modifyrecipients.md) method, setting the  _ulFlags_ parameter to zero, to create a new recipient list for the reply or forwarded message based on the list from the original message.</span></span> 
    
13. <span data-ttu-id="c4606-165">调用答复的[IMAPIProp:: SaveChanges](imapiprop-savechanges.md)方法以保存消息或[IMessage:: SubmitMessage](imessage-submitmessage.md)以保存并发送它。</span><span class="sxs-lookup"><span data-stu-id="c4606-165">Call the reply's [IMAPIProp::SaveChanges](imapiprop-savechanges.md) method to save the message or [IMessage::SubmitMessage](imessage-submitmessage.md) to save and send it.</span></span> 
    
> [!NOTE]
> <span data-ttu-id="c4606-166">在调用**IMessage:: ModifyRecipients**以将更改存储在收件人列表中之前, 您可以允许用户通过邮件窗体进行修改。</span><span class="sxs-lookup"><span data-stu-id="c4606-166">Before calling **IMessage::ModifyRecipients** to store changes in the recipient list, you can allow users to make modifications through the message form.</span></span> <span data-ttu-id="c4606-167">用户可以向列表中添加或删除特定成员。</span><span class="sxs-lookup"><span data-stu-id="c4606-167">Users can add to the list or remove particular members.</span></span> <span data-ttu-id="c4606-168">允许用户对收件人列表进行更改是可选的客户端功能。</span><span class="sxs-lookup"><span data-stu-id="c4606-168">Allowing users to make changes to a recipient list is an optional client feature.</span></span> 
  

