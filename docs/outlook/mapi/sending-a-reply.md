---
title: 发送答复 （英文）
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 90dafeae-6b61-40e3-8341-d6a11799d0f2
description: 上次修改时间：2015 年 3 月 9 日
ms.openlocfilehash: d83fce761afb4673b71df9d620ac3fd794d6009f
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/11/2018
ms.locfileid: "19778712"
---
# <a name="sending-a-reply"></a><span data-ttu-id="900bb-103">发送答复 （英文）</span><span class="sxs-lookup"><span data-stu-id="900bb-103">Sending a reply</span></span>

<span data-ttu-id="900bb-104">**适用于**： Outlook</span><span class="sxs-lookup"><span data-stu-id="900bb-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="900bb-105">客户端应用程序通常支持两种类型的答复： 一个仅发送给原始邮件和一个发送给所有发件人除了原始邮件的收件人列表中包含其他收件人的发件人。</span><span class="sxs-lookup"><span data-stu-id="900bb-105">Client applications typically support two types of replies: one that is sent only to the sender of the original message and one that is sent to all other recipients included in the recipient list of the original message in addition to the sender.</span></span> <span data-ttu-id="900bb-106">通常，此第二个类型的答复称为所有邮件的答复。</span><span class="sxs-lookup"><span data-stu-id="900bb-106">This second type of reply is commonly referred to as a reply all message.</span></span>
  
<span data-ttu-id="900bb-107">若要发送的答复任一类型，您实现一些即可发送原始邮件时的相同任务。</span><span class="sxs-lookup"><span data-stu-id="900bb-107">To send a reply of either type, you implement some of the same tasks that you would when you send an original message.</span></span> <span data-ttu-id="900bb-108">例如，您打开默认的邮件存储和传出邮件文件夹，通常是发件箱，并调用传出文件夹的[IMAPIFolder::CreateMessage](imapifolder-createmessage.md)方法创建答复。</span><span class="sxs-lookup"><span data-stu-id="900bb-108">For example, you open the default message store and the outgoing message folder, typically the Outbox, and call the outgoing folder's [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) method to create the reply.</span></span> <span data-ttu-id="900bb-109">此外，您打开保留原始邮件，通常收件箱文件夹。</span><span class="sxs-lookup"><span data-stu-id="900bb-109">Also, you open the folder that holds the original message, typically the Inbox.</span></span> <span data-ttu-id="900bb-110">有关打开不同的文件夹的信息，请参阅[打开邮件存储文件夹](opening-a-message-store-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="900bb-110">For information about opening different folders, see [Opening a Message Store Folder](opening-a-message-store-folder.md).</span></span>
  
<span data-ttu-id="900bb-111">创建答复并创建原始邮件的主要区别是，使用答复大部分属性是基于或复制直接从原始邮件的属性。</span><span class="sxs-lookup"><span data-stu-id="900bb-111">The main difference between creating a reply and creating an original message is that with a reply, most of the properties are either based on or copied directly from properties of the original message.</span></span> <span data-ttu-id="900bb-112">附件 — 一条消息**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) 属性 — 明确排除。</span><span class="sxs-lookup"><span data-stu-id="900bb-112">Attachments — a message's **PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) property — are specifically excluded.</span></span> <span data-ttu-id="900bb-113">所有邮件从原始消息的列表都创建由**PR_RECEIVED_BY_SEARCH_KEY** ([PidTagReceivedBySearchKey](pidtagreceivedbysearchkey-canonical-property.md)) 属性收件人和删除所有密件抄送副本收件人的答复收件人列表。</span><span class="sxs-lookup"><span data-stu-id="900bb-113">The recipient list for a reply all message is created from the original message's list with the recipient represented by the **PR_RECEIVED_BY_SEARCH_KEY** ([PidTagReceivedBySearchKey](pidtagreceivedbysearchkey-canonical-property.md)) property and all blind carbon copy recipients removed.</span></span> <span data-ttu-id="900bb-114">**PR_RECEIVED_BY_SEARCH_KEY**属性表示当前用户。</span><span class="sxs-lookup"><span data-stu-id="900bb-114">The **PR_RECEIVED_BY_SEARCH_KEY** property represents the current user.</span></span> 
  
### <a name="to-send-a-reply"></a><span data-ttu-id="900bb-115">发送答复</span><span class="sxs-lookup"><span data-stu-id="900bb-115">To send a reply</span></span>
  
1. <span data-ttu-id="900bb-116">打开默认邮件存储区。</span><span class="sxs-lookup"><span data-stu-id="900bb-116">Open the default message store.</span></span> <span data-ttu-id="900bb-117">有关详细信息，请参阅[打开默认邮件存储区](opening-the-default-message-store.md)。</span><span class="sxs-lookup"><span data-stu-id="900bb-117">For more information, see [Opening the Default Message Store](opening-the-default-message-store.md).</span></span>
    
2. <span data-ttu-id="900bb-118">打开发件箱文件夹。</span><span class="sxs-lookup"><span data-stu-id="900bb-118">Open the Outbox folder.</span></span> <span data-ttu-id="900bb-119">有关详细信息，请参阅[打开邮件存储文件夹](opening-a-message-store-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="900bb-119">For more information, see [Opening a Message Store Folder](opening-a-message-store-folder.md).</span></span>
    
3. <span data-ttu-id="900bb-120">调用发件箱的[IMAPIFolder::CreateMessage](imapifolder-createmessage.md)方法创建答复。</span><span class="sxs-lookup"><span data-stu-id="900bb-120">Call the Outbox's [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) method to create the reply.</span></span> 
    
4. <span data-ttu-id="900bb-121">调用原始消息的[IMAPIProp::CopyTo](imapiprop-copyto.md)方法，将以下属性复制到答复消息：</span><span class="sxs-lookup"><span data-stu-id="900bb-121">Call the original message's [IMAPIProp::CopyTo](imapiprop-copyto.md) method to copy the following properties to the reply message:</span></span> 
    
   - <span data-ttu-id="900bb-122">**PR\_正文**([PidTagBody](pidtagbody-canonical-property.md)) 或**PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md))，具体取决于是否支持富文本格式。</span><span class="sxs-lookup"><span data-stu-id="900bb-122">**PR\_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) or **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)), depending on whether or not you support Rich Text Format.</span></span>
    
   - <span data-ttu-id="900bb-123">**PR\_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md))，如果答复将转到整个收件人列表。</span><span class="sxs-lookup"><span data-stu-id="900bb-123">**PR\_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)), if the reply will go to the entire recipient list.</span></span>
    
   - <span data-ttu-id="900bb-124">**PR\_NORMALIZED_SUBJECT** ([PidTagNormalizedSubject](pidtagnormalizedsubject-canonical-property.md))。</span><span class="sxs-lookup"><span data-stu-id="900bb-124">**PR\_NORMALIZED_SUBJECT** ([PidTagNormalizedSubject](pidtagnormalizedsubject-canonical-property.md)).</span></span>
    
5. <span data-ttu-id="900bb-125">**IMAPIProp::CopyTo**到呼叫中不包括以下属性：</span><span class="sxs-lookup"><span data-stu-id="900bb-125">Do not include the following properties in your call to **IMAPIProp::CopyTo**:</span></span>
    
    |||
    |:-----|:-----|
    |<span data-ttu-id="900bb-126">**PR\_客户端\_提交\_时间**</span><span class="sxs-lookup"><span data-stu-id="900bb-126">**PR\_CLIENT\_SUBMIT\_TIME**</span></span> <br/> |<span data-ttu-id="900bb-127">**PR\_消息\_传递\_时间**</span><span class="sxs-lookup"><span data-stu-id="900bb-127">**PR\_MESSAGE\_DELIVERY\_TIME**</span></span> <br/> |
    |<span data-ttu-id="900bb-128">**PR\_消息\_下载\_时间**</span><span class="sxs-lookup"><span data-stu-id="900bb-128">**PR\_MESSAGE\_DOWNLOAD\_TIME**</span></span> <br/> |<span data-ttu-id="900bb-129">**PR\_消息\_标志**</span><span class="sxs-lookup"><span data-stu-id="900bb-129">**PR\_MESSAGE\_FLAGS**</span></span> <br/> |
    |<span data-ttu-id="900bb-130">**PR\_原始发件人\_传递\_REPORT\REQUESTED**</span><span class="sxs-lookup"><span data-stu-id="900bb-130">**PR\_ORIGINATOR\_DELIVERY\_ REPORT\REQUESTED**</span></span> <br/> |<span data-ttu-id="900bb-131">**PR\_接收的\_REPRESENTING**属性</span><span class="sxs-lookup"><span data-stu-id="900bb-131">**PR\_RCVD\_REPRESENTING** properties</span></span>  <br/> |
    |<span data-ttu-id="900bb-132">**PR\_读取\_回执\_ENTRYID**</span><span class="sxs-lookup"><span data-stu-id="900bb-132">**PR\_READ\_RECEIPT\_ENTRYID**</span></span> <br/> |<span data-ttu-id="900bb-133">**PR\_读取\_回执\_申请**</span><span class="sxs-lookup"><span data-stu-id="900bb-133">**PR\_READ\_RECEIPT\_REQUESTED**</span></span> <br/> |
    |<span data-ttu-id="900bb-134">**PR\_RECEIVED\_BY**属性</span><span class="sxs-lookup"><span data-stu-id="900bb-134">**PR\_RECEIVED\_BY** properties</span></span>  <br/> |<span data-ttu-id="900bb-135">**PR\_答复\_收件人**属性</span><span class="sxs-lookup"><span data-stu-id="900bb-135">**PR\_REPLY\_RECIPIENT** properties</span></span>  <br/> |
    |<span data-ttu-id="900bb-136">**PR\_报告\_ENTRYID**</span><span class="sxs-lookup"><span data-stu-id="900bb-136">**PR\_REPORT\_ENTRYID**</span></span> <br/> |<span data-ttu-id="900bb-137">**PR\_发件人**属性</span><span class="sxs-lookup"><span data-stu-id="900bb-137">**PR\_SENDER** properties</span></span>  <br/> |
    |<span data-ttu-id="900bb-138">**PR\_发送\_REPRESENTING**属性</span><span class="sxs-lookup"><span data-stu-id="900bb-138">**PR\_SENT\_REPRESENTING** properties</span></span>  <br/> |<span data-ttu-id="900bb-139">**PR\_SENTMAIL\_ENTRYID**</span><span class="sxs-lookup"><span data-stu-id="900bb-139">**PR\_SENTMAIL\_ENTRYID**</span></span> <br/> |
    |<span data-ttu-id="900bb-140">**PR\_主题\_前缀**</span><span class="sxs-lookup"><span data-stu-id="900bb-140">**PR\_SUBJECT\_PREFIX**</span></span> <br/> | <br/> |
   
6. <span data-ttu-id="900bb-141">将分隔符文本添加到您支持无论消息正文属性 — **PR_BODY**、 **PR_HTM**L、 或**PR_RTF_COMPRESSED**。</span><span class="sxs-lookup"><span data-stu-id="900bb-141">Add separator text to whichever message body property you support — **PR_BODY**, **PR_HTM**L, or **PR_RTF_COMPRESSED**.</span></span>
    
7. <span data-ttu-id="900bb-142">调用[ScCreateConversationIndex](sccreateconversationindex.md)，传递中原始消息的**PR_CONVERSATION_INDEX** ([PidTagConversationIndex](pidtagconversationindex-canonical-property.md)) 属性的值。</span><span class="sxs-lookup"><span data-stu-id="900bb-142">Call [ScCreateConversationIndex](sccreateconversationindex.md), passing in the value of the original message's **PR_CONVERSATION_INDEX** ([PidTagConversationIndex](pidtagconversationindex-canonical-property.md)) property.</span></span>
    
8. <span data-ttu-id="900bb-143">设置回复前缀。</span><span class="sxs-lookup"><span data-stu-id="900bb-143">Set a prefix for the reply.</span></span> <span data-ttu-id="900bb-144">如果您使用的是标准"RE:"连接到的**PR_NORMALIZED_SUBJECT**开头这些字符和将**PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)) 设置为此新字符串。</span><span class="sxs-lookup"><span data-stu-id="900bb-144">If you are using the standard "RE:", concatenate these characters onto the beginning of **PR_NORMALIZED_SUBJECT** and set **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)) to this new string.</span></span> <span data-ttu-id="900bb-145">未设置**PR_SUBJECT_PREFIX** ([PidTagSubjectPrefix](pidtagsubjectprefix-canonical-property.md))。</span><span class="sxs-lookup"><span data-stu-id="900bb-145">Do not set **PR_SUBJECT_PREFIX** ([PidTagSubjectPrefix](pidtagsubjectprefix-canonical-property.md)).</span></span> <span data-ttu-id="900bb-146">如果您使用非标准前缀，例如 string 超过三个字符，则将其存储在**PR_SUBJECT_PREFIX**。</span><span class="sxs-lookup"><span data-stu-id="900bb-146">If you are using a nonstandard prefix, such as a string longer than three characters, store it in **PR_SUBJECT_PREFIX**.</span></span> 
    
9. <span data-ttu-id="900bb-147">设置为**PR_RCVD_REPRESENTING**属性中的相应值的**PR_SENT_REPRESENTING**属性。</span><span class="sxs-lookup"><span data-stu-id="900bb-147">Set the **PR_SENT_REPRESENTING** properties to the corresponding values in the **PR_RCVD_REPRESENTING** properties.</span></span> 
    
10. <span data-ttu-id="900bb-148">设置中的条目的每个**PR\_REPLY_RECIPIENT_ENTRIES** ([PidTagReplyRecipientEntries](pidtagreplyrecipiententries-canonical-property.md)) 和**PR_REPLY\_RECIPIENT_NAMES** ([PidTagReplyRecipientNames](pidtagreplyrecipientnames-canonical-property.md)) 的项标识符和显示名称主收件人 — 其类型是 MAPI_TO 收件人。</span><span class="sxs-lookup"><span data-stu-id="900bb-148">Set each of the entries in **PR\_REPLY_RECIPIENT_ENTRIES** ([PidTagReplyRecipientEntries](pidtagreplyrecipiententries-canonical-property.md)) and **PR_REPLY\_RECIPIENT_NAMES** ([PidTagReplyRecipientNames](pidtagreplyrecipientnames-canonical-property.md)) to the entry identifier and display name of a primary recipient — a recipient whose type is MAPI_TO.</span></span> <span data-ttu-id="900bb-149">保持同步这些属性。</span><span class="sxs-lookup"><span data-stu-id="900bb-149">Keep these properties synchronized.</span></span> <span data-ttu-id="900bb-150">即**PR_REPLY_RECIPIENT\_条目**和**PR_REPLY_RECIPIENT_NAMES**必须包含相同数量的条目，条目中的属性之一的特定位置必须对应的条目中其他的相同位置属性。</span><span class="sxs-lookup"><span data-stu-id="900bb-150">That is, **PR_REPLY_RECIPIENT\_ENTRIES** and **PR_REPLY_RECIPIENT_NAMES** must contain the same number of entries, and an entry at a particular position in one of the properties must correspond to an entry at the same position in the other property.</span></span> 
    
11. <span data-ttu-id="900bb-151">如果仅对原始邮件的发件人发送答复，与原始消息的**PR_SENT_REPRESENTING**属性表示收件人创建单输入收件人列表。</span><span class="sxs-lookup"><span data-stu-id="900bb-151">If the reply is being sent only to the sender of the original message, create a single entry recipient list with the recipient represented by the original message's **PR_SENT_REPRESENTING** property.</span></span> <span data-ttu-id="900bb-152">有关创建收件人列表的详细信息，请参阅[创建收件人列表](creating-a-recipient-list.md)。</span><span class="sxs-lookup"><span data-stu-id="900bb-152">For more information about creating a recipient list, see [Creating a Recipient List](creating-a-recipient-list.md).</span></span>
    
12. <span data-ttu-id="900bb-153">如果答复，所有答复创建收件人列表，如下所示：</span><span class="sxs-lookup"><span data-stu-id="900bb-153">If the reply is a reply all, create a recipient list as follows:</span></span>
    
    1. <span data-ttu-id="900bb-154">调用原始消息的[IMessage::GetRecipientTable](imessage-getrecipienttable.md)方法，以访问其收件人的表。</span><span class="sxs-lookup"><span data-stu-id="900bb-154">Call the original message's [IMessage::GetRecipientTable](imessage-getrecipienttable.md) method to access its recipient table.</span></span> 
        
    2. <span data-ttu-id="900bb-155">调用[HrQueryAllRows](hrqueryallrows.md)检索所有表中的行。</span><span class="sxs-lookup"><span data-stu-id="900bb-155">Call [HrQueryAllRows](hrqueryallrows.md) to retrieve all of the rows in the table.</span></span> <span data-ttu-id="900bb-156">确定每个行表示主索引器还是抄送收件人，并应保持在列表中还是如果它表示密件抄送副本收件人或用户，并应从列表中删除。</span><span class="sxs-lookup"><span data-stu-id="900bb-156">Determine if each row represents a primary or carbon copy recipient and should remain in the list or if it represents a blind carbon copy recipient or the user and should be removed from the list.</span></span> 
        
    3. <span data-ttu-id="900bb-157">区分通过查看**PR_RECIPIENT_TYPE** ([PidTagRecipientType](pidtagrecipienttype-canonical-property.md)) 列的收件人类型。</span><span class="sxs-lookup"><span data-stu-id="900bb-157">Differentiate between recipient types by looking at the **PR_RECIPIENT_TYPE** ([PidTagRecipientType](pidtagrecipienttype-canonical-property.md)) column.</span></span> <span data-ttu-id="900bb-158">此列将设置为 MAPI_TO 主收件人、 MAPI_CC 抄送副本收件人和 MAPI_BCC 的密件抄送副本收件人。</span><span class="sxs-lookup"><span data-stu-id="900bb-158">This column will be set to MAPI_TO for primary recipients, MAPI_CC for carbon copy recipients, and MAPI_BCC for blind carbon copy recipients.</span></span> 
        
    4. <span data-ttu-id="900bb-159">将原始邮件以确定该行是否代表用户的**PR_RECEIVED_BY_SEARCH_KEY**属性的**PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) 列进行比较。</span><span class="sxs-lookup"><span data-stu-id="900bb-159">Compare the **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) column with the **PR_RECEIVED_BY_SEARCH_KEY** property of the original message to determine if the row represents the user.</span></span> 
        
    5. <span data-ttu-id="900bb-160">通过调用[MAPIFreeBuffer](mapifreebuffer.md)以释放与收件人表[SRowSet](srowset.md)结构中的相应条目关联的内存，从收件人列表中删除不必要的行。</span><span class="sxs-lookup"><span data-stu-id="900bb-160">Remove unwanted rows from the recipient list by calling [MAPIFreeBuffer](mapifreebuffer.md) to free the memory associated with the corresponding entries in the recipient table's [SRowSet](srowset.md) structure.</span></span> <span data-ttu-id="900bb-161">将所有为零，所有**cValues**成员为零，属性值数组中的值和**SRowSet**中每个[SRow](srow.md)结构中的**lpProps**成员的所有设置为 NULL。</span><span class="sxs-lookup"><span data-stu-id="900bb-161">Set all of the values in the property value array to zero, all of the **cValues** members to zero, and all of the **lpProps** members in each [SRow](srow.md) structure in the **SRowSet** to NULL.</span></span> 
        
    6. <span data-ttu-id="900bb-162">将发件人添加到的收件人列表中，由原始消息的**PR\_SENT_REPRESENTING_NAME** ([PidTagSentRepresentingName](pidtagsentrepresentingname-canonical-property.md)) 和**PR_SENT_REPRESENTING_ENTRYID** ([PidTagSentRepresentingEntryId](pidtagsentrepresentingentryid-canonical-property.md))属性。</span><span class="sxs-lookup"><span data-stu-id="900bb-162">Add the sender to the recipient list, as represented by the original message's **PR\_SENT_REPRESENTING_NAME** ([PidTagSentRepresentingName](pidtagsentrepresentingname-canonical-property.md)) and **PR_SENT_REPRESENTING_ENTRYID** ([PidTagSentRepresentingEntryId](pidtagsentrepresentingentryid-canonical-property.md)) properties.</span></span> <span data-ttu-id="900bb-163">检查发件人不会重复列表中。</span><span class="sxs-lookup"><span data-stu-id="900bb-163">Check that the sender is not duplicated in the list.</span></span>
        
    7. <span data-ttu-id="900bb-164">呼叫答复邮件[IMessage::ModifyRecipients](imessage-modifyrecipients.md)方法，将_ulFlags_参数设置为零，创建新的收件人列表的答复或转发的基于从原始邮件列表的邮件。</span><span class="sxs-lookup"><span data-stu-id="900bb-164">Call the reply message's [IMessage::ModifyRecipients](imessage-modifyrecipients.md) method, setting the  _ulFlags_ parameter to zero, to create a new recipient list for the reply or forwarded message based on the list from the original message.</span></span> 
    
13. <span data-ttu-id="900bb-165">呼叫答复[IMAPIProp::SaveChanges](imapiprop-savechanges.md)方法保存[IMessage::SubmitMessage](imessage-submitmessage.md)保存，并将其发送的消息。</span><span class="sxs-lookup"><span data-stu-id="900bb-165">Call the reply's [IMAPIProp::SaveChanges](imapiprop-savechanges.md) method to save the message or [IMessage::SubmitMessage](imessage-submitmessage.md) to save and send it.</span></span> 
    
> [!NOTE]
> <span data-ttu-id="900bb-166">调用之前**IMessage::ModifyRecipients**存储的收件人列表中的更改，您可以允许用户通过邮件窗体的修改。</span><span class="sxs-lookup"><span data-stu-id="900bb-166">Before calling **IMessage::ModifyRecipients** to store changes in the recipient list, you can allow users to make modifications through the message form.</span></span> <span data-ttu-id="900bb-167">用户可以向列表中添加或删除特定的成员。</span><span class="sxs-lookup"><span data-stu-id="900bb-167">Users can add to the list or remove particular members.</span></span> <span data-ttu-id="900bb-168">允许用户对收件人列表进行更改是一个可选的客户端功能。</span><span class="sxs-lookup"><span data-stu-id="900bb-168">Allowing users to make changes to a recipient list is an optional client feature.</span></span> 
  

