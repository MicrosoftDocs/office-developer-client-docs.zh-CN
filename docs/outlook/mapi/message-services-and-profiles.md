---
title: 邮件服务和配置文件
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: df0db1e4-69c8-44ec-bb2a-d31fc8a564b9
description: 上次修改时间：2011 年 7 月 23 日
ms.openlocfilehash: 78a13bacf13b019bbf9436830ad66db7fdfaf425
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "33415465"
---
# <a name="message-services-and-profiles"></a><span data-ttu-id="3a482-103">邮件服务和配置文件</span><span class="sxs-lookup"><span data-stu-id="3a482-103">Message services and profiles</span></span>
  
<span data-ttu-id="3a482-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="3a482-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="3a482-105">有些用户需要多个邮件系统的服务, 每个系统都有一个或多个服务提供商。</span><span class="sxs-lookup"><span data-stu-id="3a482-105">Some users require the services of several messaging systems, each with one or more service providers.</span></span> <span data-ttu-id="3a482-106">由于需要单独安装和配置每个服务提供程序, 因此, 如果邮件服务器通常需要一组相关提供程序来公开其所有功能, 则 MAPI 包括邮件服务的概念, 这一点非常麻烦。</span><span class="sxs-lookup"><span data-stu-id="3a482-106">Because it is cumbersome to install and configure each of these service providers individually, and because a messaging server usually requires a group of related providers to expose all its functionality, MAPI includes the concept of a message service.</span></span> <span data-ttu-id="3a482-107">邮件服务可帮助用户安装和配置其服务提供商。</span><span class="sxs-lookup"><span data-stu-id="3a482-107">Message services help users install and configure their service providers.</span></span>
  
<span data-ttu-id="3a482-108">若要创建邮件服务, 开发人员需要编写消息服务入口点程序来处理服务中的每个提供程序的配置和安装程序, 以执行以下操作:</span><span class="sxs-lookup"><span data-stu-id="3a482-108">To create a message service, a developer writes a message-service entry point program to handle the configuration of each provider in the service and a setup program to do the following:</span></span>
  
- <span data-ttu-id="3a482-109">在服务中安装每个提供程序。</span><span class="sxs-lookup"><span data-stu-id="3a482-109">Install each provider in the service.</span></span>
    
- <span data-ttu-id="3a482-110">创建注册表和初始化文件项。</span><span class="sxs-lookup"><span data-stu-id="3a482-110">Create registry and initialization file entries.</span></span>
    
- <span data-ttu-id="3a482-111">在 MAPI 配置文件 mapisvc.inf 中创建条目。</span><span class="sxs-lookup"><span data-stu-id="3a482-111">Create entries in the MAPI configuration file, Mapisvc.inf.</span></span>
    
<span data-ttu-id="3a482-112">mapisvc.inf 文件包含与计算机上安装的所有邮件服务和服务提供程序的配置相关的信息。</span><span class="sxs-lookup"><span data-stu-id="3a482-112">The Mapisvc.inf file contains information that relates to the configuration of all message services and service providers installed on the computer.</span></span> <span data-ttu-id="3a482-113">它在层次结构部分中进行组织, 每个级别都链接到下一个。</span><span class="sxs-lookup"><span data-stu-id="3a482-113">It is organized in hierarchical sections, with each level linked to the next.</span></span> <span data-ttu-id="3a482-114">顶部包括三个部分, 其中包含以下内容:</span><span class="sxs-lookup"><span data-stu-id="3a482-114">At the top are three sections that contain the following:</span></span> 
  
- <span data-ttu-id="3a482-115">邮件服务帮助文件的列表。</span><span class="sxs-lookup"><span data-stu-id="3a482-115">A list of message service Help files.</span></span>
    
- <span data-ttu-id="3a482-116">最重要的或默认的邮件服务的列表。</span><span class="sxs-lookup"><span data-stu-id="3a482-116">A list of the most important, or default, message services.</span></span>
    
- <span data-ttu-id="3a482-117">计算机上所有服务的列表。</span><span class="sxs-lookup"><span data-stu-id="3a482-117">A list of all the services on the computer.</span></span>
    
<span data-ttu-id="3a482-118">下一个级别包含每个邮件服务的部分, 最后一个级别包含服务中每个服务提供程序的部分。</span><span class="sxs-lookup"><span data-stu-id="3a482-118">The next level contains sections for each message service, and the last level contains sections for each service provider in a service.</span></span> <span data-ttu-id="3a482-119">MAPI 要求服务提供商和邮件服务的开发人员向 mapisvc.inf 中添加某些项;开发人员可以自行决定添加其他项。</span><span class="sxs-lookup"><span data-stu-id="3a482-119">MAPI requires that developers of service providers and message services add certain entries to Mapisvc.inf; developers can add other entries at their own discretion.</span></span> <span data-ttu-id="3a482-120">mapisvc.inf 中的大多数信息在一个或多个配置文件中结束, 后者是用户首选的一组邮件服务的配置信息集合。</span><span class="sxs-lookup"><span data-stu-id="3a482-120">Most of the information in Mapisvc.inf ends up in one or more profiles, a collection of configuration information for a user's preferred set of message services.</span></span> <span data-ttu-id="3a482-121">由于计算机可以拥有多个用户, 并且一个用户可以有多个首选项集, 因此计算机上可能存在许多配置文件。</span><span class="sxs-lookup"><span data-stu-id="3a482-121">Because a computer can have multiple users and a single user can have multiple sets of preferences, many profiles can exist on a computer.</span></span> <span data-ttu-id="3a482-122">每个配置文件描述一组不同的邮件服务。</span><span class="sxs-lookup"><span data-stu-id="3a482-122">Each profile describes a different set of message services.</span></span> <span data-ttu-id="3a482-123">通过使用多个配置文件, 用户可以在家庭中使用一组邮件服务, 并在办公室上使用不同的组来工作。</span><span class="sxs-lookup"><span data-stu-id="3a482-123">Having multiple profiles enables a user to work, for example, at home with one set of message services and at the office with a different set.</span></span>
  
<span data-ttu-id="3a482-124">配置文件是通过提供配置支持的客户端应用程序在邮件服务安装或登录时创建的。</span><span class="sxs-lookup"><span data-stu-id="3a482-124">Profiles are created at message service installation or logon time by a client application that provides configuration support.</span></span> <span data-ttu-id="3a482-125">MAPI 提供了两种客户端应用程序: "控制面板" 项和 "配置文件向导"。</span><span class="sxs-lookup"><span data-stu-id="3a482-125">MAPI provides two such client applications: a Control Panel item and the Profile Wizard.</span></span> <span data-ttu-id="3a482-126">"控制面板" 项是一个完整的服务配置应用程序, 用户可以在其中创建、删除、编辑和复制配置文件, 还可以对配置文件中的条目进行修改。</span><span class="sxs-lookup"><span data-stu-id="3a482-126">The Control Panel item is a full-service configuration application with which users can create, delete, edit, and copy profiles, as well as make modifications to the entries in a profile.</span></span> <span data-ttu-id="3a482-127">配置文件向导是一个简单的应用程序, 旨在尽可能简化将邮件服务添加到配置文件中的工作。</span><span class="sxs-lookup"><span data-stu-id="3a482-127">The Profile Wizard is a simple application designed to make adding a message service to a profile as easy as possible.</span></span> <span data-ttu-id="3a482-128">[! 注意] 配置文件向导包含一系列称为 "属性页" 的对话框, 提示用户完成安装和配置服务的过程。</span><span class="sxs-lookup"><span data-stu-id="3a482-128">The Profile Wizard consists of a series of dialog boxes, called property pages, that prompt the user through the process of installing and configuring a service.</span></span> <span data-ttu-id="3a482-129">系统仅提示用户输入最关键设置的值;所有其他设置都会继承默认值。</span><span class="sxs-lookup"><span data-stu-id="3a482-129">The user is prompted only for values for the most critical settings; all other settings inherit default values.</span></span> <span data-ttu-id="3a482-130">创建配置文件后, 不允许用户进行更改。</span><span class="sxs-lookup"><span data-stu-id="3a482-130">Once the profile has been created, users are not allowed to make changes.</span></span> 
  
<span data-ttu-id="3a482-131">尽管 "控制面板" 项总是通过 "控制面板" 调用, 但有多种可能会导致调用配置文件向导的方案。</span><span class="sxs-lookup"><span data-stu-id="3a482-131">Whereas the Control Panel item is always invoked through the Control Panel, there are a variety of scenarios that can cause the Profile Wizard to be called.</span></span> <span data-ttu-id="3a482-132">客户端应用程序可以调用配置文件向导在登录时创建默认配置文件 (如果尚未创建的话)。</span><span class="sxs-lookup"><span data-stu-id="3a482-132">Client applications can call the Profile Wizard to create a default profile at logon time when one has not yet been created.</span></span> <span data-ttu-id="3a482-133">"控制面板" 项或其他客户端应用程序可以依赖于 "配置文件向导" 中已有的功能, 而不是 reimplementing 代码来添加配置文件。</span><span class="sxs-lookup"><span data-stu-id="3a482-133">Rather than reimplementing code to add a profile, the Control Panel item or another client application can rely on the functionality already in the Profile Wizard.</span></span> <span data-ttu-id="3a482-134">如果需要将服务添加到默认配置文件中, 则在其入口点函数中的邮件服务可以调用配置文件向导。</span><span class="sxs-lookup"><span data-stu-id="3a482-134">A message service, in its entry point function, can call the Profile Wizard when the service needs to be added to the default profile.</span></span> <span data-ttu-id="3a482-135">使用 "配置文件向导" 的邮件服务必须编写额外的入口点函数和标准 Windows 对话框过程。</span><span class="sxs-lookup"><span data-stu-id="3a482-135">Message services that use the Profile Wizard must write an extra entry point function and a standard Windows dialog box procedure.</span></span> <span data-ttu-id="3a482-136">[! 注意] 配置文件向导调用入口点函数来检索服务的配置对话框, 而对话框过程将处理在使用此对话框时生成的消息。</span><span class="sxs-lookup"><span data-stu-id="3a482-136">The Profile Wizard calls the entry point function to retrieve the service's configuration dialog box while the dialog box procedure handles the messages that are generated when this dialog box is in use.</span></span> 
  
<span data-ttu-id="3a482-137">配置文件的组织方式类似于 mapisvc.inf 文件。</span><span class="sxs-lookup"><span data-stu-id="3a482-137">Profiles are organized in a similar way to the Mapisvc.inf file.</span></span> <span data-ttu-id="3a482-138">配置文件具有链接的层次结构部分;服务提供商拥有最低级别的部分, 邮件服务拥有中间级别的部分, MAPI 在最高级别中拥有部分。</span><span class="sxs-lookup"><span data-stu-id="3a482-138">Profiles have linked hierarchical sections; service providers own sections in the lowest level, message services own sections in the middle level, and MAPI owns sections in the highest level.</span></span> <span data-ttu-id="3a482-139">每个部分都用称为 " [MAPIUID](mapiuid.md)" 的唯一标识符标识。</span><span class="sxs-lookup"><span data-stu-id="3a482-139">Each section is identified with a unique identifier known as a [MAPIUID](mapiuid.md).</span></span> <span data-ttu-id="3a482-140">mapi 部分包含 mapi 的内部信息, 如所有邮件服务配置文件部分的标识符以及指向每个其他部分的链接。</span><span class="sxs-lookup"><span data-stu-id="3a482-140">The MAPI sections contain information internal to MAPI, such as the identifiers of all of the message service profile sections and links to each of the other sections.</span></span> <span data-ttu-id="3a482-141">每个邮件服务部分将链接存储到其提供程序部分, 每个提供程序部分存储指向其服务部分的链接。</span><span class="sxs-lookup"><span data-stu-id="3a482-141">Each message service section stores links to its provider sections, and each provider section stores a link to its service section.</span></span> 
  
<span data-ttu-id="3a482-142">下图显示了两个典型配置文件的内容。</span><span class="sxs-lookup"><span data-stu-id="3a482-142">The following illustration shows the contents of two typical profiles.</span></span> <span data-ttu-id="3a482-143">Sam 在自己的计算机上有两个配置文件, 一个供家庭使用, 一个用于办公室使用。</span><span class="sxs-lookup"><span data-stu-id="3a482-143">Sam has two profiles on his computer, one for home use and one for office use.</span></span> <span data-ttu-id="3a482-144">主配置文件包含三种邮件服务。</span><span class="sxs-lookup"><span data-stu-id="3a482-144">The home profile contains three message services.</span></span> <span data-ttu-id="3a482-145">邮件服务 X 是通讯簿管理的单个提供程序服务。</span><span class="sxs-lookup"><span data-stu-id="3a482-145">Message Service X is a single provider service for address book management.</span></span> <span data-ttu-id="3a482-146">邮件服务 Y 和 Z 具有三个提供程序: 一个通讯簿提供程序、一个邮件存储提供程序和一个传输提供程序。</span><span class="sxs-lookup"><span data-stu-id="3a482-146">Message Services Y and Z have three providers — an address book provider, a message store provider, and a transport provider.</span></span> <span data-ttu-id="3a482-147">Sam 的工作配置文件包含两个不同的邮件服务, 每个服务都有一个通讯簿提供程序、一个邮件存储提供程序和一个传输提供程序。</span><span class="sxs-lookup"><span data-stu-id="3a482-147">Sam's Work Profile contains two different message services, each of which has an address book provider, a message store provider, and a transport provider.</span></span> 
  
<span data-ttu-id="3a482-148">**配置文件示例**</span><span class="sxs-lookup"><span data-stu-id="3a482-148">**Profile example**</span></span>
  
<span data-ttu-id="3a482-149">![配置文件示例](media/amapi_56.gif "配置文件示例")</span><span class="sxs-lookup"><span data-stu-id="3a482-149">![Profile example](media/amapi_56.gif "Profile example")</span></span>
  
<span data-ttu-id="3a482-150">下图显示了包含两个邮件服务的配置文件。</span><span class="sxs-lookup"><span data-stu-id="3a482-150">The following illustration shows a profile that includes two message services.</span></span> <span data-ttu-id="3a482-151">安装和配置属于邮件服务的服务提供程序的代码与提供程序的代码驻留在同一 DLL 中。</span><span class="sxs-lookup"><span data-stu-id="3a482-151">The code for installing and configuring the service providers that belong to the message service resides in the same DLL as the code for the providers.</span></span> <span data-ttu-id="3a482-152">此代码在登录时读取配置文件中的信息以配置服务提供程序, 并在必要时向用户提示缺少的信息 (如果可能)。</span><span class="sxs-lookup"><span data-stu-id="3a482-152">This code reads information from the profile at logon time to configure the service providers, and it prompts the user, if possible and necessary, for missing information.</span></span> <span data-ttu-id="3a482-153">来自客户端的请求, 以查看或更改任何提供程序的配置设置也由此通用代码处理。</span><span class="sxs-lookup"><span data-stu-id="3a482-153">Requests from a client to view or change configuration settings for any of the providers are also handled by this common code.</span></span>
  
<span data-ttu-id="3a482-154">**安装和配置服务提供程序**</span><span class="sxs-lookup"><span data-stu-id="3a482-154">**Installing and configuring service providers**</span></span>
  
<span data-ttu-id="3a482-155">![安装和配置服务提供程序](media/amapi_55.gif "安装和配置服务提供程序")</span><span class="sxs-lookup"><span data-stu-id="3a482-155">![Installing and configuring service providers](media/amapi_55.gif "Installing and configuring service providers")</span></span>
  
## <a name="see-also"></a><span data-ttu-id="3a482-156">另请参阅</span><span class="sxs-lookup"><span data-stu-id="3a482-156">See also</span></span>

- [<span data-ttu-id="3a482-157">MAPIUID</span><span class="sxs-lookup"><span data-stu-id="3a482-157">MAPIUID</span></span>](mapiuid.md)
- [<span data-ttu-id="3a482-158">MAPI 编程概述</span><span class="sxs-lookup"><span data-stu-id="3a482-158">MAPI Programming Overview</span></span>](mapi-programming-overview.md)

