---
title: 消息服务和配置文件
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: df0db1e4-69c8-44ec-bb2a-d31fc8a564b9
description: 上次修改时间： 2011 年 7 月 23 日
ms.openlocfilehash: 60a102a68ee11cd6002be9edf47d0cee93ed2e15
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/23/2018
ms.locfileid: "22581431"
---
# <a name="message-services-and-profiles"></a><span data-ttu-id="ea390-103">消息服务和配置文件</span><span class="sxs-lookup"><span data-stu-id="ea390-103">Message services and profiles</span></span>
  
<span data-ttu-id="ea390-104">**适用于**： Outlook 2013 |Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="ea390-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="ea390-105">某些用户需要多个邮件系统，每个都与一个或多个服务提供商的服务。</span><span class="sxs-lookup"><span data-stu-id="ea390-105">Some users require the services of several messaging systems, each with one or more service providers.</span></span> <span data-ttu-id="ea390-106">由于麻烦安装和配置这些服务提供商的每个单独，且 MAPI 因为消息服务器通常需要一组相关的提供程序公开其所有功能，包括消息服务的概念。</span><span class="sxs-lookup"><span data-stu-id="ea390-106">Because it is cumbersome to install and configure each of these service providers individually, and because a messaging server usually requires a group of related providers to expose all its functionality, MAPI includes the concept of a message service.</span></span> <span data-ttu-id="ea390-107">消息服务帮助用户在安装和配置其服务提供商。</span><span class="sxs-lookup"><span data-stu-id="ea390-107">Message services help users install and configure their service providers.</span></span>
  
<span data-ttu-id="ea390-108">若要创建的消息服务，开发人员编写的消息服务项点程序处理服务中的每个提供程序的配置和安装程序执行下列操作：</span><span class="sxs-lookup"><span data-stu-id="ea390-108">To create a message service, a developer writes a message-service entry point program to handle the configuration of each provider in the service and a setup program to do the following:</span></span>
  
- <span data-ttu-id="ea390-109">安装服务中的每个提供程序。</span><span class="sxs-lookup"><span data-stu-id="ea390-109">Install each provider in the service.</span></span>
    
- <span data-ttu-id="ea390-110">创建注册表和初始化文件项。</span><span class="sxs-lookup"><span data-stu-id="ea390-110">Create registry and initialization file entries.</span></span>
    
- <span data-ttu-id="ea390-111">MAPI 配置文件，Mapisvc.inf 中创建项。</span><span class="sxs-lookup"><span data-stu-id="ea390-111">Create entries in the MAPI configuration file, Mapisvc.inf.</span></span>
    
<span data-ttu-id="ea390-112">Mapisvc.inf 文件包含与所有消息服务和服务提供商的计算机上安装的配置信息。</span><span class="sxs-lookup"><span data-stu-id="ea390-112">The Mapisvc.inf file contains information that relates to the configuration of all message services and service providers installed on the computer.</span></span> <span data-ttu-id="ea390-113">它是与链接到下每个级别组织层次结构的各节中。</span><span class="sxs-lookup"><span data-stu-id="ea390-113">It is organized in hierarchical sections, with each level linked to the next.</span></span> <span data-ttu-id="ea390-114">在顶部是包含以下三个部分：</span><span class="sxs-lookup"><span data-stu-id="ea390-114">At the top are three sections that contain the following:</span></span> 
  
- <span data-ttu-id="ea390-115">消息服务帮助文件的列表。</span><span class="sxs-lookup"><span data-stu-id="ea390-115">A list of message service Help files.</span></span>
    
- <span data-ttu-id="ea390-116">最重要的是，或者默认情况下，消息服务的列表。</span><span class="sxs-lookup"><span data-stu-id="ea390-116">A list of the most important, or default, message services.</span></span>
    
- <span data-ttu-id="ea390-117">在计算机上的所有服务的列表。</span><span class="sxs-lookup"><span data-stu-id="ea390-117">A list of all the services on the computer.</span></span>
    
<span data-ttu-id="ea390-118">下一级包含为每个邮件服务，各节，最后一个级别的每个服务提供商服务中包括几节。</span><span class="sxs-lookup"><span data-stu-id="ea390-118">The next level contains sections for each message service, and the last level contains sections for each service provider in a service.</span></span> <span data-ttu-id="ea390-119">MAPI 需要的服务提供商和消息服务的开发人员将某些条目添加到 Mapisvc.inf;开发人员可以自己决定添加其他项。</span><span class="sxs-lookup"><span data-stu-id="ea390-119">MAPI requires that developers of service providers and message services add certain entries to Mapisvc.inf; developers can add other entries at their own discretion.</span></span> <span data-ttu-id="ea390-120">大多数最终 Mapisvc.inf 之一中的信息或多个配置文件的用户的配置信息的集合首选的消息服务的设置。</span><span class="sxs-lookup"><span data-stu-id="ea390-120">Most of the information in Mapisvc.inf ends up in one or more profiles, a collection of configuration information for a user's preferred set of message services.</span></span> <span data-ttu-id="ea390-121">因为一台计算机可以有多个用户，单个用户可以有多组的首选项，可以计算机上存在许多配置文件。</span><span class="sxs-lookup"><span data-stu-id="ea390-121">Because a computer can have multiple users and a single user can have multiple sets of preferences, many profiles can exist on a computer.</span></span> <span data-ttu-id="ea390-122">每个配置文件介绍一组不同的消息服务。</span><span class="sxs-lookup"><span data-stu-id="ea390-122">Each profile describes a different set of message services.</span></span> <span data-ttu-id="ea390-123">具有多个配置文件允许用户使用，例如，在家里与一组不同的一组的消息服务和办公室。</span><span class="sxs-lookup"><span data-stu-id="ea390-123">Having multiple profiles enables a user to work, for example, at home with one set of message services and at the office with a different set.</span></span>
  
<span data-ttu-id="ea390-124">通过提供配置支持的客户端应用程序，在消息服务安装或登录时创建配置文件。</span><span class="sxs-lookup"><span data-stu-id="ea390-124">Profiles are created at message service installation or logon time by a client application that provides configuration support.</span></span> <span data-ttu-id="ea390-125">MAPI 提供两个此类的客户端应用程序： 某个控制面板项目和配置文件向导。</span><span class="sxs-lookup"><span data-stu-id="ea390-125">MAPI provides two such client applications: a Control Panel item and the Profile Wizard.</span></span> <span data-ttu-id="ea390-126">控制面板项目是一个全面服务的配置应用程序与用户可以创建、 删除、 编辑和复制配置文件，以及配置文件中进行修改的项。</span><span class="sxs-lookup"><span data-stu-id="ea390-126">The Control Panel item is a full-service configuration application with which users can create, delete, edit, and copy profiles, as well as make modifications to the entries in a profile.</span></span> <span data-ttu-id="ea390-127">配置文件向导是一个简单的应用程序，旨在使邮件服务向尽可能轻松地配置文件。</span><span class="sxs-lookup"><span data-stu-id="ea390-127">The Profile Wizard is a simple application designed to make adding a message service to a profile as easy as possible.</span></span> <span data-ttu-id="ea390-128">配置文件向导包含的对话框中，调用属性页面，提示用户安装和配置服务的过程通过一系列。</span><span class="sxs-lookup"><span data-stu-id="ea390-128">The Profile Wizard consists of a series of dialog boxes, called property pages, that prompt the user through the process of installing and configuring a service.</span></span> <span data-ttu-id="ea390-129">只需为值的最重要的设置; 提示用户所有其他设置继承默认值。</span><span class="sxs-lookup"><span data-stu-id="ea390-129">The user is prompted only for values for the most critical settings; all other settings inherit default values.</span></span> <span data-ttu-id="ea390-130">一旦创建配置文件，不允许用户进行更改。</span><span class="sxs-lookup"><span data-stu-id="ea390-130">Once the profile has been created, users are not allowed to make changes.</span></span> 
  
<span data-ttu-id="ea390-131">通过控制面板始终调用控制面板项目，而有多种可能会导致配置文件向导来调用的方案。</span><span class="sxs-lookup"><span data-stu-id="ea390-131">Whereas the Control Panel item is always invoked through the Control Panel, there are a variety of scenarios that can cause the Profile Wizard to be called.</span></span> <span data-ttu-id="ea390-132">客户端应用程序可以调用配置文件向导以创建在当一个具有尚未创建登录时的默认配置文件。</span><span class="sxs-lookup"><span data-stu-id="ea390-132">Client applications can call the Profile Wizard to create a default profile at logon time when one has not yet been created.</span></span> <span data-ttu-id="ea390-133">而不是重新实现代码添加配置文件，控制面板项目或另一个客户端应用程序可以利用已在配置文件向导的功能。</span><span class="sxs-lookup"><span data-stu-id="ea390-133">Rather than reimplementing code to add a profile, the Control Panel item or another client application can rely on the functionality already in the Profile Wizard.</span></span> <span data-ttu-id="ea390-134">消息服务，在其入口点函数，可以调用配置文件向导时需要添加到默认配置文件服务。</span><span class="sxs-lookup"><span data-stu-id="ea390-134">A message service, in its entry point function, can call the Profile Wizard when the service needs to be added to the default profile.</span></span> <span data-ttu-id="ea390-135">使用配置文件向导的消息服务必须编写额外的入口点函数和标准 Windows 对话框过程。</span><span class="sxs-lookup"><span data-stu-id="ea390-135">Message services that use the Profile Wizard must write an extra entry point function and a standard Windows dialog box procedure.</span></span> <span data-ttu-id="ea390-136">配置文件向导调用入口点函数检索服务的配置对话框时的对话框过程处理在使用此对话框时生成的消息。</span><span class="sxs-lookup"><span data-stu-id="ea390-136">The Profile Wizard calls the entry point function to retrieve the service's configuration dialog box while the dialog box procedure handles the messages that are generated when this dialog box is in use.</span></span> 
  
<span data-ttu-id="ea390-137">Mapisvc.inf 文件以类似方式组织配置文件。</span><span class="sxs-lookup"><span data-stu-id="ea390-137">Profiles are organized in a similar way to the Mapisvc.inf file.</span></span> <span data-ttu-id="ea390-138">配置文件具有链接分层部分;中的最低级别的服务提供程序自己节，消息服务拥有各节中的中间级和 MAPI 主管最高级别中的部分。</span><span class="sxs-lookup"><span data-stu-id="ea390-138">Profiles have linked hierarchical sections; service providers own sections in the lowest level, message services own sections in the middle level, and MAPI owns sections in the highest level.</span></span> <span data-ttu-id="ea390-139">每节用称为[MAPIUID](mapiuid.md)的唯一标识符标识。</span><span class="sxs-lookup"><span data-stu-id="ea390-139">Each section is identified with a unique identifier known as a [MAPIUID](mapiuid.md).</span></span> <span data-ttu-id="ea390-140">MAPI 各节包含内部到 MAPI，例如的所有消息服务配置文件部分和指向其他各节的标识符信息。</span><span class="sxs-lookup"><span data-stu-id="ea390-140">The MAPI sections contain information internal to MAPI, such as the identifiers of all of the message service profile sections and links to each of the other sections.</span></span> <span data-ttu-id="ea390-141">消息服务的每一部分存储链接到其提供程序部分中，并提供程序的每一部分将存储到其服务部分的链接。</span><span class="sxs-lookup"><span data-stu-id="ea390-141">Each message service section stores links to its provider sections, and each provider section stores a link to its service section.</span></span> 
  
<span data-ttu-id="ea390-142">下图显示了两个典型的配置文件的内容。</span><span class="sxs-lookup"><span data-stu-id="ea390-142">The following illustration shows the contents of two typical profiles.</span></span> <span data-ttu-id="ea390-143">Sam 对其计算机，供家庭使用的一个，一个用于 office 使用两个配置文件。</span><span class="sxs-lookup"><span data-stu-id="ea390-143">Sam has two profiles on his computer, one for home use and one for office use.</span></span> <span data-ttu-id="ea390-144">主页的配置文件包含三个消息服务。</span><span class="sxs-lookup"><span data-stu-id="ea390-144">The home profile contains three message services.</span></span> <span data-ttu-id="ea390-145">消息服务 X 是用于通讯簿管理的单个提供程序服务。</span><span class="sxs-lookup"><span data-stu-id="ea390-145">Message Service X is a single provider service for address book management.</span></span> <span data-ttu-id="ea390-146">消息服务 Y 和 Z 有三种提供商 — 通讯簿提供程序、 消息存储提供程序，和传输提供程序。</span><span class="sxs-lookup"><span data-stu-id="ea390-146">Message Services Y and Z have three providers — an address book provider, a message store provider, and a transport provider.</span></span> <span data-ttu-id="ea390-147">Sam 的工作配置文件包含两个不同的消息服务，其中每个具有通讯簿提供程序、 消息存储提供程序，和传输提供程序。</span><span class="sxs-lookup"><span data-stu-id="ea390-147">Sam's Work Profile contains two different message services, each of which has an address book provider, a message store provider, and a transport provider.</span></span> 
  
<span data-ttu-id="ea390-148">**配置文件示例**</span><span class="sxs-lookup"><span data-stu-id="ea390-148">**Profile example**</span></span>
  
<span data-ttu-id="ea390-149">![配置文件示例](media/amapi_56.gif "配置文件示例")</span><span class="sxs-lookup"><span data-stu-id="ea390-149">![Profile example](media/amapi_56.gif "Profile example")</span></span>
  
<span data-ttu-id="ea390-150">下图显示了包含两个消息服务的配置文件。</span><span class="sxs-lookup"><span data-stu-id="ea390-150">The following illustration shows a profile that includes two message services.</span></span> <span data-ttu-id="ea390-151">安装和配置属于邮件服务的服务提供程序的代码位于同一个 DLL 的代码中的提供程序。</span><span class="sxs-lookup"><span data-stu-id="ea390-151">The code for installing and configuring the service providers that belong to the message service resides in the same DLL as the code for the providers.</span></span> <span data-ttu-id="ea390-152">此代码中读取信息从配置文件在登录时配置服务提供程序，并提示用户，如果可能并根据需要，查找丢失的信息。</span><span class="sxs-lookup"><span data-stu-id="ea390-152">This code reads information from the profile at logon time to configure the service providers, and it prompts the user, if possible and necessary, for missing information.</span></span> <span data-ttu-id="ea390-153">通过此常见的代码还处理来自客户端可以查看或更改的任何提供程序的配置设置的请求。</span><span class="sxs-lookup"><span data-stu-id="ea390-153">Requests from a client to view or change configuration settings for any of the providers are also handled by this common code.</span></span>
  
<span data-ttu-id="ea390-154">**安装和配置服务提供程序**</span><span class="sxs-lookup"><span data-stu-id="ea390-154">**Installing and configuring service providers**</span></span>
  
<span data-ttu-id="ea390-155">![安装和配置服务提供程序](media/amapi_55.gif "安装和配置服务提供程序")</span><span class="sxs-lookup"><span data-stu-id="ea390-155">![Installing and configuring service providers](media/amapi_55.gif "Installing and configuring service providers")</span></span>
  
## <a name="see-also"></a><span data-ttu-id="ea390-156">另请参阅</span><span class="sxs-lookup"><span data-stu-id="ea390-156">See also</span></span>

- [<span data-ttu-id="ea390-157">MAPIUID</span><span class="sxs-lookup"><span data-stu-id="ea390-157">MAPIUID</span></span>](mapiuid.md)
- [<span data-ttu-id="ea390-158">MAPI 编程概述</span><span class="sxs-lookup"><span data-stu-id="ea390-158">MAPI Programming Overview</span></span>](mapi-programming-overview.md)

