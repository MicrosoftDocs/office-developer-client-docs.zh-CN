---
title: 邮件服务和配置文件
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: df0db1e4-69c8-44ec-bb2a-d31fc8a564b9
description: 上次修改时间：2011 年 7 月 23 日
ms.openlocfilehash: 78a13bacf13b019bbf9436830ad66db7fdfaf425
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "33415465"
---
# <a name="message-services-and-profiles"></a><span data-ttu-id="5e348-103">邮件服务和配置文件</span><span class="sxs-lookup"><span data-stu-id="5e348-103">Message services and profiles</span></span>
  
<span data-ttu-id="5e348-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="5e348-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="5e348-105">某些用户需要多个邮件系统（每个都有一个或多个服务提供商）的服务。</span><span class="sxs-lookup"><span data-stu-id="5e348-105">Some users require the services of several messaging systems, each with one or more service providers.</span></span> <span data-ttu-id="5e348-106">由于单独安装和配置其中每个服务提供程序比较麻烦，并且邮件服务器通常需要一组相关提供程序来公开其所有功能，因此 MAPI 包含邮件服务的概念。</span><span class="sxs-lookup"><span data-stu-id="5e348-106">Because it is cumbersome to install and configure each of these service providers individually, and because a messaging server usually requires a group of related providers to expose all its functionality, MAPI includes the concept of a message service.</span></span> <span data-ttu-id="5e348-107">邮件服务可帮助用户安装和配置其服务提供程序。</span><span class="sxs-lookup"><span data-stu-id="5e348-107">Message services help users install and configure their service providers.</span></span>
  
<span data-ttu-id="5e348-108">若要创建邮件服务，开发人员编写邮件服务入口点程序来处理服务中每个提供程序的配置，并编写安装程序以执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="5e348-108">To create a message service, a developer writes a message-service entry point program to handle the configuration of each provider in the service and a setup program to do the following:</span></span>
  
- <span data-ttu-id="5e348-109">安装服务中的每个提供程序。</span><span class="sxs-lookup"><span data-stu-id="5e348-109">Install each provider in the service.</span></span>
    
- <span data-ttu-id="5e348-110">创建注册表和初始化文件条目。</span><span class="sxs-lookup"><span data-stu-id="5e348-110">Create registry and initialization file entries.</span></span>
    
- <span data-ttu-id="5e348-111">在 MAPI 配置文件 Mapisvc.inf 中创建条目。</span><span class="sxs-lookup"><span data-stu-id="5e348-111">Create entries in the MAPI configuration file, Mapisvc.inf.</span></span>
    
<span data-ttu-id="5e348-112">Mapisvc.inf 文件包含与计算机上安装的所有邮件服务和服务提供程序的配置有关的信息。</span><span class="sxs-lookup"><span data-stu-id="5e348-112">The Mapisvc.inf file contains information that relates to the configuration of all message services and service providers installed on the computer.</span></span> <span data-ttu-id="5e348-113">它按层次结构分区进行组织，每个级别链接到下一个级别。</span><span class="sxs-lookup"><span data-stu-id="5e348-113">It is organized in hierarchical sections, with each level linked to the next.</span></span> <span data-ttu-id="5e348-114">顶部的三个部分包含以下内容：</span><span class="sxs-lookup"><span data-stu-id="5e348-114">At the top are three sections that contain the following:</span></span> 
  
- <span data-ttu-id="5e348-115">邮件服务帮助文件的列表。</span><span class="sxs-lookup"><span data-stu-id="5e348-115">A list of message service Help files.</span></span>
    
- <span data-ttu-id="5e348-116">最重要的（或默认）邮件服务的列表。</span><span class="sxs-lookup"><span data-stu-id="5e348-116">A list of the most important, or default, message services.</span></span>
    
- <span data-ttu-id="5e348-117">计算机上所有服务的列表。</span><span class="sxs-lookup"><span data-stu-id="5e348-117">A list of all the services on the computer.</span></span>
    
<span data-ttu-id="5e348-118">下一个级别包含每个邮件服务的节，最后一个级别包含服务中每个服务提供程序的节。</span><span class="sxs-lookup"><span data-stu-id="5e348-118">The next level contains sections for each message service, and the last level contains sections for each service provider in a service.</span></span> <span data-ttu-id="5e348-119">MAPI 要求服务提供商和邮件服务的开发人员将某些条目添加到 Mapisvc.inf;开发人员可以自行决定添加其他条目。</span><span class="sxs-lookup"><span data-stu-id="5e348-119">MAPI requires that developers of service providers and message services add certain entries to Mapisvc.inf; developers can add other entries at their own discretion.</span></span> <span data-ttu-id="5e348-120">Mapisvc.inf 中的大部分信息最终在一个或多个配置文件中，即用户的首选邮件服务集的配置信息集合。</span><span class="sxs-lookup"><span data-stu-id="5e348-120">Most of the information in Mapisvc.inf ends up in one or more profiles, a collection of configuration information for a user's preferred set of message services.</span></span> <span data-ttu-id="5e348-121">由于一台计算机可以有多个用户，并且一个用户可以具有多组首选项，因此计算机上可以存在许多配置文件。</span><span class="sxs-lookup"><span data-stu-id="5e348-121">Because a computer can have multiple users and a single user can have multiple sets of preferences, many profiles can exist on a computer.</span></span> <span data-ttu-id="5e348-122">每个配置文件描述一组不同的邮件服务。</span><span class="sxs-lookup"><span data-stu-id="5e348-122">Each profile describes a different set of message services.</span></span> <span data-ttu-id="5e348-123">通过拥有多个配置文件，用户可以在家使用一组邮件服务，在办公室使用一组不同的邮件服务。</span><span class="sxs-lookup"><span data-stu-id="5e348-123">Having multiple profiles enables a user to work, for example, at home with one set of message services and at the office with a different set.</span></span>
  
<span data-ttu-id="5e348-124">配置文件是在邮件服务安装时或登录时由提供配置支持的客户端应用程序创建的。</span><span class="sxs-lookup"><span data-stu-id="5e348-124">Profiles are created at message service installation or logon time by a client application that provides configuration support.</span></span> <span data-ttu-id="5e348-125">MAPI 提供两个此类客户端应用程序：控制面板项和配置文件向导。</span><span class="sxs-lookup"><span data-stu-id="5e348-125">MAPI provides two such client applications: a Control Panel item and the Profile Wizard.</span></span> <span data-ttu-id="5e348-126">"控制面板"项是一个全服务配置应用程序，用户可以使用该应用程序创建、删除、编辑和复制配置文件，以及修改配置文件中的条目。</span><span class="sxs-lookup"><span data-stu-id="5e348-126">The Control Panel item is a full-service configuration application with which users can create, delete, edit, and copy profiles, as well as make modifications to the entries in a profile.</span></span> <span data-ttu-id="5e348-127">配置文件向导是一个简单的应用程序，旨在尽可能轻松地向配置文件添加邮件服务。</span><span class="sxs-lookup"><span data-stu-id="5e348-127">The Profile Wizard is a simple application designed to make adding a message service to a profile as easy as possible.</span></span> <span data-ttu-id="5e348-128">配置文件向导由一系列对话框（称为属性页）组成，这些对话框将提示用户完成安装和配置服务的过程。</span><span class="sxs-lookup"><span data-stu-id="5e348-128">The Profile Wizard consists of a series of dialog boxes, called property pages, that prompt the user through the process of installing and configuring a service.</span></span> <span data-ttu-id="5e348-129">系统仅提示用户输入最重要的设置的值;所有其他设置继承默认值。</span><span class="sxs-lookup"><span data-stu-id="5e348-129">The user is prompted only for values for the most critical settings; all other settings inherit default values.</span></span> <span data-ttu-id="5e348-130">创建配置文件后，不允许用户进行更改。</span><span class="sxs-lookup"><span data-stu-id="5e348-130">Once the profile has been created, users are not allowed to make changes.</span></span> 
  
<span data-ttu-id="5e348-131">"控制面板"项始终通过"控制面板"调用，但有多种方案可能导致调用配置文件向导。</span><span class="sxs-lookup"><span data-stu-id="5e348-131">Whereas the Control Panel item is always invoked through the Control Panel, there are a variety of scenarios that can cause the Profile Wizard to be called.</span></span> <span data-ttu-id="5e348-132">客户端应用程序可以调用配置文件向导，以在尚未创建配置文件时在登录时创建默认配置文件。</span><span class="sxs-lookup"><span data-stu-id="5e348-132">Client applications can call the Profile Wizard to create a default profile at logon time when one has not yet been created.</span></span> <span data-ttu-id="5e348-133">控制面板项或其他客户端应用程序可以依赖配置文件向导中已有的功能，而不是重新实现代码来添加配置文件。</span><span class="sxs-lookup"><span data-stu-id="5e348-133">Rather than reimplementing code to add a profile, the Control Panel item or another client application can rely on the functionality already in the Profile Wizard.</span></span> <span data-ttu-id="5e348-134">当需要将服务添加到默认配置文件时，邮件服务在其入口点功能中可以调用配置文件向导。</span><span class="sxs-lookup"><span data-stu-id="5e348-134">A message service, in its entry point function, can call the Profile Wizard when the service needs to be added to the default profile.</span></span> <span data-ttu-id="5e348-135">使用配置文件向导的邮件服务必须编写一个额外的入口点函数和一个标准 Windows对话框过程。</span><span class="sxs-lookup"><span data-stu-id="5e348-135">Message services that use the Profile Wizard must write an extra entry point function and a standard Windows dialog box procedure.</span></span> <span data-ttu-id="5e348-136">配置文件向导调用入口点函数以检索服务的配置对话框，而对话框过程处理使用此对话框时生成的消息。</span><span class="sxs-lookup"><span data-stu-id="5e348-136">The Profile Wizard calls the entry point function to retrieve the service's configuration dialog box while the dialog box procedure handles the messages that are generated when this dialog box is in use.</span></span> 
  
<span data-ttu-id="5e348-137">配置文件的组织方式与 Mapisvc.inf 文件类似。</span><span class="sxs-lookup"><span data-stu-id="5e348-137">Profiles are organized in a similar way to the Mapisvc.inf file.</span></span> <span data-ttu-id="5e348-138">配置文件具有链接的分层分区;服务提供商在最低级别拥有分区，邮件服务在中间级别拥有分区，MAPI 拥有最高级别的分区。</span><span class="sxs-lookup"><span data-stu-id="5e348-138">Profiles have linked hierarchical sections; service providers own sections in the lowest level, message services own sections in the middle level, and MAPI owns sections in the highest level.</span></span> <span data-ttu-id="5e348-139">每个部分都用一个称为 [MAPIUID 的唯一标识符进行标识](mapiuid.md)。</span><span class="sxs-lookup"><span data-stu-id="5e348-139">Each section is identified with a unique identifier known as a [MAPIUID](mapiuid.md).</span></span> <span data-ttu-id="5e348-140">MAPI 部分包含 MAPI 内部的信息，例如所有邮件服务配置文件节的标识符以及指向其他每个部分的链接。</span><span class="sxs-lookup"><span data-stu-id="5e348-140">The MAPI sections contain information internal to MAPI, such as the identifiers of all of the message service profile sections and links to each of the other sections.</span></span> <span data-ttu-id="5e348-141">每个邮件服务节存储指向其提供程序分区的链接，而每个提供程序节存储指向其服务节的链接。</span><span class="sxs-lookup"><span data-stu-id="5e348-141">Each message service section stores links to its provider sections, and each provider section stores a link to its service section.</span></span> 
  
<span data-ttu-id="5e348-142">下图显示了两个典型配置文件的内容。</span><span class="sxs-lookup"><span data-stu-id="5e348-142">The following illustration shows the contents of two typical profiles.</span></span> <span data-ttu-id="5e348-143">Sam 的计算机上有两个配置文件，一个供家庭使用，一个供办公室使用。</span><span class="sxs-lookup"><span data-stu-id="5e348-143">Sam has two profiles on his computer, one for home use and one for office use.</span></span> <span data-ttu-id="5e348-144">主配置文件包含三个邮件服务。</span><span class="sxs-lookup"><span data-stu-id="5e348-144">The home profile contains three message services.</span></span> <span data-ttu-id="5e348-145">邮件服务 X 是一种用于通讯簿管理的提供程序服务。</span><span class="sxs-lookup"><span data-stu-id="5e348-145">Message Service X is a single provider service for address book management.</span></span> <span data-ttu-id="5e348-146">邮件服务 Y 和 Z 有三个提供程序 — 通讯簿提供程序、邮件存储提供程序和传输提供程序。</span><span class="sxs-lookup"><span data-stu-id="5e348-146">Message Services Y and Z have three providers — an address book provider, a message store provider, and a transport provider.</span></span> <span data-ttu-id="5e348-147">Sam 的工作配置文件包含两个不同的邮件服务，每个服务都有一个通讯簿提供程序、一个邮件存储提供程序和一个传输提供程序。</span><span class="sxs-lookup"><span data-stu-id="5e348-147">Sam's Work Profile contains two different message services, each of which has an address book provider, a message store provider, and a transport provider.</span></span> 
  
<span data-ttu-id="5e348-148">**配置文件示例**</span><span class="sxs-lookup"><span data-stu-id="5e348-148">**Profile example**</span></span>
  
<span data-ttu-id="5e348-149">![配置文件示例](media/amapi_56.gif "配置文件示例")</span><span class="sxs-lookup"><span data-stu-id="5e348-149">![Profile example](media/amapi_56.gif "Profile example")</span></span>
  
<span data-ttu-id="5e348-150">下图显示了包含两个邮件服务的配置文件。</span><span class="sxs-lookup"><span data-stu-id="5e348-150">The following illustration shows a profile that includes two message services.</span></span> <span data-ttu-id="5e348-151">用于安装和配置属于邮件服务的服务提供程序的代码与提供程序的代码驻留在同一 DLL 中。</span><span class="sxs-lookup"><span data-stu-id="5e348-151">The code for installing and configuring the service providers that belong to the message service resides in the same DLL as the code for the providers.</span></span> <span data-ttu-id="5e348-152">此代码在登录时从配置文件中读取信息以配置服务提供程序，并在必要时提示用户缺少信息。</span><span class="sxs-lookup"><span data-stu-id="5e348-152">This code reads information from the profile at logon time to configure the service providers, and it prompts the user, if possible and necessary, for missing information.</span></span> <span data-ttu-id="5e348-153">来自客户端的查看或更改任何提供程序的配置设置的请求也由此通用代码处理。</span><span class="sxs-lookup"><span data-stu-id="5e348-153">Requests from a client to view or change configuration settings for any of the providers are also handled by this common code.</span></span>
  
<span data-ttu-id="5e348-154">**安装和配置服务提供程序**</span><span class="sxs-lookup"><span data-stu-id="5e348-154">**Installing and configuring service providers**</span></span>
  
<span data-ttu-id="5e348-155">![安装和配置服务提供程序](media/amapi_55.gif "安装和配置服务提供程序")</span><span class="sxs-lookup"><span data-stu-id="5e348-155">![Installing and configuring service providers](media/amapi_55.gif "Installing and configuring service providers")</span></span>
  
## <a name="see-also"></a><span data-ttu-id="5e348-156">另请参阅</span><span class="sxs-lookup"><span data-stu-id="5e348-156">See also</span></span>

- [<span data-ttu-id="5e348-157">MAPIUID</span><span class="sxs-lookup"><span data-stu-id="5e348-157">MAPIUID</span></span>](mapiuid.md)
- [<span data-ttu-id="5e348-158">MAPI 编程概述</span><span class="sxs-lookup"><span data-stu-id="5e348-158">MAPI Programming Overview</span></span>](mapi-programming-overview.md)

