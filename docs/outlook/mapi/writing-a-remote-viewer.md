---
title: 编写远程查看器
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: f4d7d42f-688a-4199-b972-dd42528c0cdf
description: 上次修改时间：2015 年 3 月 9 日
ms.openlocfilehash: 554f98f7bda8c6616ce06b86142213c18bff1f69
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/11/2018
ms.locfileid: "19779111"
---
# <a name="writing-a-remote-viewer"></a><span data-ttu-id="1e66c-103">编写远程查看器</span><span class="sxs-lookup"><span data-stu-id="1e66c-103">Writing a remote viewer</span></span>

<span data-ttu-id="1e66c-104">**适用于**： Outlook</span><span class="sxs-lookup"><span data-stu-id="1e66c-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="1e66c-105">远程查看器是提供控制的访问存储在另一台计算机上的电子邮件客户端应用程序中的窗口。</span><span class="sxs-lookup"><span data-stu-id="1e66c-105">A remote viewer is a window in a client application that provides controlled access to messages stored on another computer.</span></span> <span data-ttu-id="1e66c-106">此控制的访问可能较慢的通讯链接上运行。</span><span class="sxs-lookup"><span data-stu-id="1e66c-106">This controlled access might operate on a slow communications link.</span></span> <span data-ttu-id="1e66c-107">而不是每次用户打开一个文件夹，则检索可用的消息的完整选定内容，远程查看器将首先显示仅邮件头。</span><span class="sxs-lookup"><span data-stu-id="1e66c-107">Rather than retrieve a complete selection of available messages every time a user opens a folder, the remote viewer first displays only the headers.</span></span> <span data-ttu-id="1e66c-108">用户然后选择 from 标头的完整中显示的消息。</span><span class="sxs-lookup"><span data-stu-id="1e66c-108">The user then selects from the headers which of the messages to display in full.</span></span> <span data-ttu-id="1e66c-109">远程查看器客户端可以允许他们他们下载程序之前删除邮件的用户。</span><span class="sxs-lookup"><span data-stu-id="1e66c-109">Remote viewer clients can allow their users to delete messages before they are ever downloaded.</span></span> 
  
## <a name="to-retrieve-the-headers-of-messages-stored-remotely"></a><span data-ttu-id="1e66c-110">若要检索的远程存储的邮件头</span><span class="sxs-lookup"><span data-stu-id="1e66c-110">To retrieve the headers of messages stored remotely</span></span>
  
1. <span data-ttu-id="1e66c-111">调用[IMAPISession::GetStatusTable](imapisession-getstatustable.md)访问状态表。</span><span class="sxs-lookup"><span data-stu-id="1e66c-111">Call [IMAPISession::GetStatusTable](imapisession-getstatustable.md) to access the status table.</span></span> 
    
2. <span data-ttu-id="1e66c-112">调用[IMAPITable::Restrict](imapitable-restrict.md)限制状态表中包含的行到其**PR\_资源\_类型**([PidTagResourceType](pidtagresourcetype-canonical-property.md)) 列设置为 MAPI\_传输\_提供程序。</span><span class="sxs-lookup"><span data-stu-id="1e66c-112">Call [IMAPITable::Restrict](imapitable-restrict.md) to limit the status table to only those rows that have their **PR\_RESOURCE\_TYPE** ([PidTagResourceType](pidtagresourcetype-canonical-property.md)) column set to MAPI\_TRANSPORT\_PROVIDER.</span></span> 
    
3. <span data-ttu-id="1e66c-113">呼叫[IMAPITable::SetColumns](imapitable-setcolumns.md)状态表中包括以下各列：</span><span class="sxs-lookup"><span data-stu-id="1e66c-113">Call [IMAPITable::SetColumns](imapitable-setcolumns.md) to include the following columns in the status table:</span></span> 
   - <span data-ttu-id="1e66c-114">**PR\_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-114">**PR\_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md))</span></span>
   - <span data-ttu-id="1e66c-115">**PR\_资源\_方法**([PidTagResourceMethods](pidtagresourcemethods-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-115">**PR\_RESOURCE\_METHODS** ([PidTagResourceMethods](pidtagresourcemethods-canonical-property.md))</span></span>
   - <span data-ttu-id="1e66c-116">**PR\_资源\_类型**， **PR\_提供程序\_显示**([PidTagProviderDisplay](pidtagproviderdisplay-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-116">**PR\_RESOURCE\_TYPE**, **PR\_PROVIDER\_DISPLAY** ([PidTagProviderDisplay](pidtagproviderdisplay-canonical-property.md))</span></span>
   - <span data-ttu-id="1e66c-117">**PR\_状态\_代码**([PidTagStatusCode](pidtagstatuscode-canonical-property.md))。</span><span class="sxs-lookup"><span data-stu-id="1e66c-117">**PR\_STATUS\_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)).</span></span>
    
4. <span data-ttu-id="1e66c-118">调用[HrQueryAllRows](hrqueryallrows.md)检索状态表中的所有行。</span><span class="sxs-lookup"><span data-stu-id="1e66c-118">Call [HrQueryAllRows](hrqueryallrows.md) to retrieve all the rows in the status table.</span></span> 
    
5. <span data-ttu-id="1e66c-119">传递[IMAPISession::OpenEntry](imapisession-openentry.md)将调用表中的每一行的项标识符。</span><span class="sxs-lookup"><span data-stu-id="1e66c-119">Pass the entry identifier for each row in the table in a call to [IMAPISession::OpenEntry](imapisession-openentry.md).</span></span> <span data-ttu-id="1e66c-120">因为此接口从 MAPI 后台处理程序的过程上下文封送到客户端的过程上下文 — 与接口从通讯簿或消息通常获取不同存储提供程序 — 关于多线程是多个重要的问题。</span><span class="sxs-lookup"><span data-stu-id="1e66c-120">Because this interface is marshaled from the MAPI spooler's process context to the client's process context — unlike interfaces typically obtained from address book or message store providers — issues concerning multithreading are of more importance.</span></span> 
    
6. <span data-ttu-id="1e66c-121">呼叫状态对象的[IUnknown::QueryInterface](http://msdn.microsoft.com/library/54d5ff80-18db-43f2-b636-f93ac053146d.aspx)方法，传递 IID_IMAPIFolder 接口标识，以检索远程文件夹。</span><span class="sxs-lookup"><span data-stu-id="1e66c-121">Call the status object's [IUnknown::QueryInterface](http://msdn.microsoft.com/library/54d5ff80-18db-43f2-b636-f93ac053146d.aspx) method, passing IID_IMAPIFolder as the interface identifier, to retrieve the remote folder.</span></span> <span data-ttu-id="1e66c-122">远程文件夹不是整个文件夹实现;它支持仅 folder 方法和属性的子集。</span><span class="sxs-lookup"><span data-stu-id="1e66c-122">The remote folder is not a complete folder implementation; it supports only a subset of folder methods and properties.</span></span> <span data-ttu-id="1e66c-123">支持以下属性检索所需的方法， [IMAPIProp::GetProps](imapiprop-getprops.md)，之一：</span><span class="sxs-lookup"><span data-stu-id="1e66c-123">One of the required methods, [IMAPIProp::GetProps](imapiprop-getprops.md), supports the retrieval of the following properties:</span></span>
    
    |||
    |:-----|:-----|
    |<span data-ttu-id="1e66c-124">**PR\_访问**([PidTagAccess](pidtagaccess-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-124">**PR\_ACCESS** ([PidTagAccess](pidtagaccess-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-125">**PR_ACCESS_LEVEL**([PidTagAccessLevel](pidtagaccesslevel-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-125">**PR_ACCESS_LEVEL** ([PidTagAccessLevel](pidtagaccesslevel-canonical-property.md))</span></span>  <br/> |
    |<span data-ttu-id="1e66c-126">**PR_CONTENT_COUNT**([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-126">**PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-127">**PR_ASSOC_CONTENT_COUNT**([PidTagAssociatedContentCount](pidtagassociatedcontentcount-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-127">**PR_ASSOC_CONTENT_COUNT** ([PidTagAssociatedContentCount](pidtagassociatedcontentcount-canonical-property.md))</span></span>  <br/> |
    |<span data-ttu-id="1e66c-128">**PR_FOLDER_TYPE**([PidTagFolderType](pidtagfoldertype-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-128">**PR_FOLDER_TYPE** ([PidTagFolderType](pidtagfoldertype-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-129">**PR_OBJECT_TYPE**([PidTagObjectType](pidtagobjecttype-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-129">**PR_OBJECT_TYPE** ([PidTagObjectType](pidtagobjecttype-canonical-property.md))</span></span>  <br/> |
    |<span data-ttu-id="1e66c-130">**PR\_子文件夹**([PidTagSubfolders](pidtagsubfolders-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-130">**PR\_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-131">**PR_CREATION_TIME**([PidTagCreationTime](pidtagcreationtime-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-131">**PR_CREATION_TIME** ([PidTagCreationTime](pidtagcreationtime-canonical-property.md))</span></span>  <br/> |
    |<span data-ttu-id="1e66c-132">**PR_DISPLAY_NAME**([PidTagDisplayName](pidtagdisplayname-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-132">**PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-133">**PR_DISPLAY_TYPE**([PidTagDisplayType](pidtagdisplaytype-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-133">**PR_DISPLAY_TYPE** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md))</span></span>  <br/> |
    
    <span data-ttu-id="1e66c-134">远程文件夹还必须支持[IMAPIProp::GetPropList](imapiprop-getproplist.md)、 [IMAPIContainer::GetContentsTable](imapicontainer-getcontentstable.md)和[IMAPIFolder::SetMessageStatus](imapifolder-setmessagestatus.md)方法。</span><span class="sxs-lookup"><span data-stu-id="1e66c-134">Remote folders must also support the [IMAPIProp::GetPropList](imapiprop-getproplist.md), [IMAPIContainer::GetContentsTable](imapicontainer-getcontentstable.md), and [IMAPIFolder::SetMessageStatus](imapifolder-setmessagestatus.md) methods.</span></span> <span data-ttu-id="1e66c-135">远程文件夹内容表通常支持下列：</span><span class="sxs-lookup"><span data-stu-id="1e66c-135">Remote folder contents tables typically support the following columns:</span></span> 
        
    |||
    |:-----|:-----|
    |<span data-ttu-id="1e66c-136">**PR\_显示\_收件人**([PidTagDisplayTo](pidtagdisplayto-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-136">**PR\_DISPLAY\_TO** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-137">**PR\_ENTRYID**</span><span class="sxs-lookup"><span data-stu-id="1e66c-137">**PR\_ENTRYID**</span></span> <br/> |
    |<span data-ttu-id="1e66c-138">**PR\_HASATTACH** ([PidTagHasAttachments](pidtaghasattachments-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-138">**PR\_HASATTACH** ([PidTagHasAttachments](pidtaghasattachments-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-139">**PR_IMPORTANCE**([PidTagImportance](pidtagimportance-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-139">**PR_IMPORTANCE** ([PidTagImportance](pidtagimportance-canonical-property.md))</span></span>  <br/> |
    |<span data-ttu-id="1e66c-140">**PR_INSTANCE_KEY**([PidTagInstanceKey](pidtaginstancekey-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-140">**PR_INSTANCE_KEY** ([PidTagInstanceKey](pidtaginstancekey-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-141">**PR_MESSAGE_CLASS**([PidTagMessageClass](pidtagmessageclass-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-141">**PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md))</span></span>  <br/> |
    |<span data-ttu-id="1e66c-142">**PR\_MESSAGE_DELIVERY_TIME** ([PidTagMessageDeliveryTime](pidtagmessagedeliverytime-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-142">**PR\_MESSAGE_DELIVERY_TIME** ([PidTagMessageDeliveryTime](pidtagmessagedeliverytime-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-143">**PR_MESSAGE_FLAGS**([PidTagMessageFlags](pidtagmessageflags-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-143">**PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md))</span></span>  <br/> |
    |<span data-ttu-id="1e66c-144">**PR\_MESSAGE_DOWNLOAD_TIME** ([PidTagMessageDownloadTime](pidtagmessagedownloadtime-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-144">**PR\_MESSAGE_DOWNLOAD_TIME** ([PidTagMessageDownloadTime](pidtagmessagedownloadtime-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-145">**PR_MESSAGE_SIZE**([PidTagMessageSize](pidtagmessagesize-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-145">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md))</span></span>  <br/> |
    |<span data-ttu-id="1e66c-146">**PR_MSG_STATUS**([PidTagMessageStatus](pidtagmessagestatus-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-146">**PR_MSG_STATUS** ([PidTagMessageStatus](pidtagmessagestatus-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-147">**PR_OBJECT_TYPE**</span><span class="sxs-lookup"><span data-stu-id="1e66c-147">**PR_OBJECT_TYPE**</span></span> <br/> |
    |<span data-ttu-id="1e66c-148">**PR_NORMALIZED_SUBJECT**([PidTagNormalizedSubject](pidtagnormalizedsubject-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-148">**PR_NORMALIZED_SUBJECT** ([PidTagNormalizedSubject](pidtagnormalizedsubject-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-149">**PR_PRIORITY**([PidTagPriority](pidtagpriority-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-149">**PR_PRIORITY** ([PidTagPriority](pidtagpriority-canonical-property.md))</span></span>  <br/> |
    |<span data-ttu-id="1e66c-150">**PR_SENDER_NAME**([PidTagSenderName](pidtagsendername-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-150">**PR_SENDER_NAME** ([PidTagSenderName](pidtagsendername-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-151">**PR_SENSITIVITY**([PidTagSensitivity](pidtagsensitivity-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-151">**PR_SENSITIVITY** ([PidTagSensitivity](pidtagsensitivity-canonical-property.md))</span></span>  <br/> |
    |<span data-ttu-id="1e66c-152">**PR\_SENT_REPRESENTING_NAME** ([PidTagSentRepresentingName](pidtagsentrepresentingname-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-152">**PR\_SENT_REPRESENTING_NAME** ([PidTagSentRepresentingName](pidtagsentrepresentingname-canonical-property.md))</span></span>  <br/> |<span data-ttu-id="1e66c-153">**PR_SUBJECT**([PidTagSubject](pidtagsubject-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="1e66c-153">**PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md))</span></span>  <br/> |
   
7. <span data-ttu-id="1e66c-154">呼叫转接选项之一选取的传输提供程序的[IMAPIStatus::ValidateState](imapistatus-validatestate.md)方法第一个时间。</span><span class="sxs-lookup"><span data-stu-id="1e66c-154">Call the transport provider's [IMAPIStatus::ValidateState](imapistatus-validatestate.md) method the first time that one of the transfer options is picked.</span></span> <span data-ttu-id="1e66c-155">REFRESH_XP_HEADER_CACHE 或 PROCESS_XP_HEADER_CACHE 过程标志应以及 SHOW_XP_SSESSION_UI 标志设置，以允许用户界面以显示。</span><span class="sxs-lookup"><span data-stu-id="1e66c-155">Either the REFRESH_XP_HEADER_CACHE or PROCESS_XP_HEADER_CACHE process flag should be set as well as the SHOW_XP_SSESSION_UI flag to allow the user interface to be shown.</span></span> 
    
   > [!NOTE]
   > <span data-ttu-id="1e66c-156">若要标记下载或删除的特定邮件头，客户端调用[IMAPIFolder::SetMessageStatus](imapifolder-setmessagestatus.md) ，并设置 MSGSTATUS_REMOTE_DOWNLOAD 或 MSGSTATUS_REMOTE_DELETE 标志。</span><span class="sxs-lookup"><span data-stu-id="1e66c-156">To mark a particular message header for downloading or deletion, a client calls [IMAPIFolder::SetMessageStatus](imapifolder-setmessagestatus.md) and sets either the MSGSTATUS_REMOTE_DOWNLOAD or MSGSTATUS_REMOTE_DELETE flag.</span></span> 
  

