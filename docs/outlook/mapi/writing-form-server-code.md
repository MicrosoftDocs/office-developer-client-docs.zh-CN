---
title: 编写表单服务器代码
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: ff33badc-ceed-4364-b99c-8af3af83ceb6
description: 上次修改时间：2015 年 3 月 9 日
ms.openlocfilehash: a93e53261d56e452f38e38da427585cecccba405
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "32325790"
---
# <a name="writing-form-server-code"></a><span data-ttu-id="e4ceb-103">编写表单服务器代码</span><span class="sxs-lookup"><span data-stu-id="e4ceb-103">Writing Form Server Code</span></span>

  
  
<span data-ttu-id="e4ceb-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="e4ceb-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="e4ceb-105">您可以将窗体服务器视为以下内容:</span><span class="sxs-lookup"><span data-stu-id="e4ceb-105">You can think of a form server as the following:</span></span> 
  
- <span data-ttu-id="e4ceb-106">一个 Win32 程序, 它显示一个接口并通过标准 windows 消息泵机制处理 windows 消息。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-106">A Win32 program that displays an interface and handles windows messages by way of the standard Windows message pump mechanisms.</span></span>
    
- <span data-ttu-id="e4ceb-107">一个对象, 用于将其类工厂注册为 ole 并由 ole 自动化方法激活。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-107">An object that registers its class factory with OLE and is activated by OLE automation methods.</span></span>
    
- <span data-ttu-id="e4ceb-108">遵循 mapi 规则的 mapi 对象与其他 MAPI 组件的交互。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-108">A MAPI object that follows the MAPI rules for interactions with other MAPI components.</span></span>
    
 <span data-ttu-id="e4ceb-109">您的代码必须同时处理所有这三个这些广泛的要求。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-109">Your code has to handle all three of those broad requirements simultaneously.</span></span> 
  
<span data-ttu-id="e4ceb-110">有关注册表单服务器的类工厂的详细信息, 请参阅 Windows SDK 中的 COM 和 ActiveX 对象服务部分。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-110">See the COM and ActiveX Object Services section in the Windows SDK for details about registering your form server's class factory.</span></span> <span data-ttu-id="e4ceb-111">处理 windows 消息和显示接口是标准的 windows 编程技术, 它们对 MAPI 表单没有任何特殊的要求。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-111">Handling windows messages and displaying an interface are standard Windows programming techniques that do not have any special requirements with respect to MAPI forms.</span></span> <span data-ttu-id="e4ceb-112">此外, windows SDK 还提供了有关 Windows 编程的详细信息。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-112">Again, the Windows SDK has details about Windows programming.</span></span> <span data-ttu-id="e4ceb-113">本文档包含为实现必需和可选 mapi 表单接口而需要了解的内容, 以便它们遵循与其他 mapi 组件 (主要是 mapi 表单管理器和邮件客户端应用程序) 进行交互的 mapi 规则。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-113">This document contains what you need to know to implement the required and optional MAPI form interfaces so that they follow the MAPI rules for interactions with other MAPI components — primarily the MAPI form manager and messaging client applications.</span></span>
  
<span data-ttu-id="e4ceb-114">在实现窗体服务器时可使用的所有接口都是从 OLE 基类[IUnknown](https://msdn.microsoft.com/library/33f1d79a-33fc-4ce5-a372-e08bda378332%28Office.15%29.aspx)直接或间接地派生而来的。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-114">All of the interfaces that you can use when you implement form servers are derived — either directly or indirectly — from the OLE base class [IUnknown](https://msdn.microsoft.com/library/33f1d79a-33fc-4ce5-a372-e08bda378332%28Office.15%29.aspx).</span></span> <span data-ttu-id="e4ceb-115">这意味着, 这些接口的所有实现都需要使用**QueryInterface**、 **AddRef**和**Release**方法。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-115">This means that all your implementations of these interfaces will need to have **QueryInterface**, **AddRef**, and **Release** methods.</span></span> <span data-ttu-id="e4ceb-116">如果您使用多重继承在自己的一个新类中实现所有必需的接口, 以便您使用的所有接口都可以共享所需**IUnknown**方法的单个实现, 则可以节省大量工作。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-116">You can save yourself a lot of work if you use multiple inheritance to implement all of the required interfaces in one new class of your own, so that all the interfaces you use can share a single implementation of the required **IUnknown** methods.</span></span> <span data-ttu-id="e4ceb-117">有关详细信息, 请参阅[IUnknown:: AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx)、 [IUnknown:: QueryInterface](https://msdn.microsoft.com/library/54d5ff80-18db-43f2-b636-f93ac053146d%28Office.15%29.aspx)和[IUnknown:: Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx)方法。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-117">For more information, see the [IUnknown::AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx), [IUnknown::QueryInterface](https://msdn.microsoft.com/library/54d5ff80-18db-43f2-b636-f93ac053146d%28Office.15%29.aspx), and [IUnknown::Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) methods.</span></span> <span data-ttu-id="e4ceb-118">对于这些方法的 MAPI 表单服务器, 没有特殊的注意事项。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-118">There are no special considerations with respect to MAPI form servers for these methods.</span></span> 
  
<span data-ttu-id="e4ceb-119">虽然并非所有的 MAPI 表单接口对于所有表单服务器都是必需的, 但任何给定接口中的方法都是必需的。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-119">While not all of the MAPI form interfaces are mandatory for all form servers, the methods in any given interface are mandatory.</span></span> <span data-ttu-id="e4ceb-120">也就是说, 如果您选择实现特定接口, 则必须实现接口中的所有方法。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-120">That is, if you choose to implement a particular interface, you must implement all of the methods in the interface.</span></span> <span data-ttu-id="e4ceb-121">这与其他一些 MAPI 组件 (如邮件传输) 的情况不同。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-121">This is different from the situation with some other MAPI components, such as message transports.</span></span> <span data-ttu-id="e4ceb-122">幸运的是, MAPI 表单接口中的方法相对简单, 因此实现所有这些方法不会给开发人员带来极大的负担。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-122">Fortunately, the methods in the MAPI form interfaces are relatively straightforward, so implementing all of them does not put a great burden on developers.</span></span>
  
<span data-ttu-id="e4ceb-123">MAPI 表单接口与用于创建表单服务器的开发工具的类型无关。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-123">The MAPI form interfaces are independent of the type of development tool used to create a form server.</span></span> <span data-ttu-id="e4ceb-124">这样, 就可以使用不同的开发工具创建表单。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-124">This allows forms to be created by using different development tools.</span></span> <span data-ttu-id="e4ceb-125">唯一的要求是所有表单服务器都必须支持所需的 MAPI 表单接口。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-125">The only requirement is that all form servers must support the required MAPI form interfaces.</span></span>
  
<span data-ttu-id="e4ceb-126">并非所有表单服务器都需要与表单相关的所有 MAPI 接口。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-126">Not all of the MAPI interfaces that relate to forms are required by all form servers.</span></span> <span data-ttu-id="e4ceb-127">可选接口允许您实现大多数表单服务器不需要的一些高级表单功能。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-127">The optional interfaces allow you to implement some advanced form functions that are not needed by most form servers.</span></span> <span data-ttu-id="e4ceb-128">下表列出了接口、它们的用途以及是否必须实现这些接口。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-128">The following table lists the interfaces, what they are for, and whether you must implement them.</span></span>
  
|<span data-ttu-id="e4ceb-129">**接口**</span><span class="sxs-lookup"><span data-stu-id="e4ceb-129">**Interface**</span></span>|<span data-ttu-id="e4ceb-130">**说明**</span><span class="sxs-lookup"><span data-stu-id="e4ceb-130">**Description**</span></span>|<span data-ttu-id="e4ceb-131">**状态**</span><span class="sxs-lookup"><span data-stu-id="e4ceb-131">**Status**</span></span>|
|:-----|:-----|:-----|
|[<span data-ttu-id="e4ceb-132">IMAPIForm : IUnknown</span><span class="sxs-lookup"><span data-stu-id="e4ceb-132">IMAPIForm : IUnknown</span></span>](imapiformiunknown.md) <br/> |<span data-ttu-id="e4ceb-133">客户端用于加载表单服务器、执行表单谓词和关闭表单服务器的主接口。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-133">The primary interface that clients use to load form servers, execute form verbs, and shut down form servers.</span></span> <span data-ttu-id="e4ceb-134">这也是从 OLE **IUnknown**派生的接口, 用于通知其他 ole 组件有关 form 对象实现的接口。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-134">This is also the interface derived from the OLE **IUnknown** that is used to inform other OLE components regarding what interfaces a form object implements.</span></span>  <br/> |<span data-ttu-id="e4ceb-135">必需</span><span class="sxs-lookup"><span data-stu-id="e4ceb-135">Required</span></span>  <br/> |
|[<span data-ttu-id="e4ceb-136">IPersistMessage : IUnknown</span><span class="sxs-lookup"><span data-stu-id="e4ceb-136">IPersistMessage : IUnknown</span></span>](ipersistmessageiunknown.md) <br/> |<span data-ttu-id="e4ceb-137">在将邮件加载到表单对象中并保存邮件时使用。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-137">Used when loading messages into and saving messages from form objects.</span></span>  <br/> |<span data-ttu-id="e4ceb-138">必需</span><span class="sxs-lookup"><span data-stu-id="e4ceb-138">Required</span></span>  <br/> |
|[<span data-ttu-id="e4ceb-139">IMAPIFormAdviseSink : IUnknown</span><span class="sxs-lookup"><span data-stu-id="e4ceb-139">IMAPIFormAdviseSink : IUnknown</span></span>](imapiformadvisesinkiunknown.md) <br/> |<span data-ttu-id="e4ceb-140">由 form 对象用来跟踪邮件客户端状态, 并确定 form 对象是否能够显示文件夹中的下一封或上一封邮件。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-140">Used by form objects to keep track of messaging client status and to find out whether the form object is capable of displaying the next or previous message in a folder.</span></span>  <br/> |<span data-ttu-id="e4ceb-141">可选</span><span class="sxs-lookup"><span data-stu-id="e4ceb-141">Optional</span></span>  <br/> |
|[<span data-ttu-id="e4ceb-142">IClassFactory</span><span class="sxs-lookup"><span data-stu-id="e4ceb-142">IClassFactory</span></span>](https://msdn.microsoft.com/library/f624f833-2b69-43bc-92cd-c4ecbe6051c5%28Office.15%29.aspx) <br/> |<span data-ttu-id="e4ceb-143">form 对象使用的 ole 类工厂接口, 用于符合 OLE 类工厂机制。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-143">The OLE class factory interface used by form objects for compliance with the OLE class factory mechanism.</span></span>  <br/> |<span data-ttu-id="e4ceb-144">必需</span><span class="sxs-lookup"><span data-stu-id="e4ceb-144">Required</span></span>  <br/> |
|[<span data-ttu-id="e4ceb-145">IMAPIFormFactory : IUnknown</span><span class="sxs-lookup"><span data-stu-id="e4ceb-145">IMAPIFormFactory : IUnknown</span></span>](imapiformfactoryiunknown.md) <br/> |<span data-ttu-id="e4ceb-146">如果窗体服务器支持多种类型的窗体, 则使用此项。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-146">Used if your form server supports more than one type of form.</span></span> <span data-ttu-id="e4ceb-147">在这种情况下, **IMAPIFormFactory**接口允许客户端应用程序访问您的表单服务器还必须实现的多个**IClassFactory**接口 (每种类型的表单服务器支持一个表单)。</span><span class="sxs-lookup"><span data-stu-id="e4ceb-147">In this case, the **IMAPIFormFactory** interface allows client applications to access the multiple **IClassFactory** interfaces (one per type of form that your form server supports) that your form server must also implement.</span></span>  <br/> |<span data-ttu-id="e4ceb-148">可选</span><span class="sxs-lookup"><span data-stu-id="e4ceb-148">Optional</span></span>  <br/> |
   
## <a name="see-also"></a><span data-ttu-id="e4ceb-149">另请参阅</span><span class="sxs-lookup"><span data-stu-id="e4ceb-149">See also</span></span>



[<span data-ttu-id="e4ceb-150">开发 MAPI 表单服务器</span><span class="sxs-lookup"><span data-stu-id="e4ceb-150">Developing MAPI Form Servers</span></span>](developing-mapi-form-servers.md)

