---
title: 支持对象概述
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5b062891-39ab-4334-9706-5b376719d5e4
description: 上次修改时间： 2011 年 7 月 23 日
ms.openlocfilehash: ecc5439b4abbbfd920fba5456db7462f7967388f
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/11/2018
ms.locfileid: "19778891"
---
# <a name="support-object-overview"></a><span data-ttu-id="d118f-103">支持对象概述</span><span class="sxs-lookup"><span data-stu-id="d118f-103">Support Object Overview</span></span>

  
  
<span data-ttu-id="d118f-104">**适用于**： Outlook</span><span class="sxs-lookup"><span data-stu-id="d118f-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="d118f-105">MAPI 提供支持对象，实现的对象[IMAPISupport: IUnknown](imapisupportiunknown.md)界面，在登录时的所有服务提供程序和配置过程的所有邮件服务。</span><span class="sxs-lookup"><span data-stu-id="d118f-105">MAPI furnishes a support object, an object that implements the [IMAPISupport : IUnknown](imapisupportiunknown.md) interface, for all service providers during logon and for all message services during configuration.</span></span> 
  
<span data-ttu-id="d118f-106">支持对象都无法访问由客户端;它们都是通过 MAPI 实现，调用仅由服务提供商。</span><span class="sxs-lookup"><span data-stu-id="d118f-106">Support objects are not accessible by clients; they are implemented by MAPI and called only by service providers.</span></span> <span data-ttu-id="d118f-107">Mapispi.h 标头文件中指定的**IMAPISupport**接口。</span><span class="sxs-lookup"><span data-stu-id="d118f-107">The **IMAPISupport** interface is specified in the Mapispi.h header file.</span></span> <span data-ttu-id="d118f-108">其标识符 IID_IMAPISup 并且其指针类型 LPMAPISUP。</span><span class="sxs-lookup"><span data-stu-id="d118f-108">Its identifier is IID_IMAPISup and its pointer type is LPMAPISUP.</span></span> <span data-ttu-id="d118f-109">通过支持对象不公开任何 MAPI 属性。</span><span class="sxs-lookup"><span data-stu-id="d118f-109">No MAPI properties are exposed by support objects.</span></span> 
  
<span data-ttu-id="d118f-110">提供程序，可以指定一个或多个支持对象，具体取决于提供程序的消息服务条目函数调用次数或 MAPI 登录提供程序的次数。</span><span class="sxs-lookup"><span data-stu-id="d118f-110">A provider can be given one or more support objects, depending on the number of times MAPI logs the provider on or the number of times the provider's message service entry function is called.</span></span> <span data-ttu-id="d118f-111">通常情况下，提供程序将登录至少一次每个会话。</span><span class="sxs-lookup"><span data-stu-id="d118f-111">Typically, a provider will be logged on at least once per session.</span></span> <span data-ttu-id="d118f-112">每次客户端请求它们的配置文件条目的启动会话登录地址簿和传输提供程序。</span><span class="sxs-lookup"><span data-stu-id="d118f-112">Address book and transport providers are logged on every time a client starts a session with a profile entry that requests them.</span></span> <span data-ttu-id="d118f-113">每次[IMAPISession::OpenMsgStore](imapisession-openmsgstore.md)方法在客户端调用登录消息存储提供程序。</span><span class="sxs-lookup"><span data-stu-id="d118f-113">Message store providers are logged on every time a client calls the [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) method.</span></span> 
  
<span data-ttu-id="d118f-114">对于会话中的多个登录，您可以选择是保留和单独使用每个支持对象或保留和使用仅第一个、 放弃每个后续支持对象。</span><span class="sxs-lookup"><span data-stu-id="d118f-114">In the case of multiple logons in a session, you can choose either to retain and use each support object separately or to retain and use only the first, discarding each subsequent support object.</span></span> <span data-ttu-id="d118f-115">若要保留的支持对象调用其**IUnknown::AddRef**方法。</span><span class="sxs-lookup"><span data-stu-id="d118f-115">To retain a support object, call its **IUnknown::AddRef** method.</span></span> <span data-ttu-id="d118f-116">在您想要保留整个会话支持对象上调用**AddRef**是非常重要;如果未调用 MAPI 释放支持对象和释放其内存。</span><span class="sxs-lookup"><span data-stu-id="d118f-116">Calling **AddRef** on a support object that you want to retain throughout a session is extremely important; if the call is not made, MAPI releases the support object and frees its memory.</span></span> 
  
<span data-ttu-id="d118f-117">支持对象的目的是提供相当大数量由提供商提供常用的方法的实现。</span><span class="sxs-lookup"><span data-stu-id="d118f-117">The purpose of the support object is to provide implementations for a fairly large number of methods commonly used by the providers.</span></span> <span data-ttu-id="d118f-118">每个支持对象还包含特定于自身实例，如会话中，使用提供程序，配置文件一节提供程序正在运行和会话的错误信息的上下文数据。</span><span class="sxs-lookup"><span data-stu-id="d118f-118">Each support object also contains contextual data specific to its own instance, such as the session the provider is running in, the profile section the provider is using, and error information for the session.</span></span> 
  
<span data-ttu-id="d118f-119">有四种不同类型的支持对象： 一个用于每个主要的提供程序类型 （通讯簿、 消息存储和传输），另一个用于配置支持。</span><span class="sxs-lookup"><span data-stu-id="d118f-119">There are four different types of support objects: one for each major provider type (address book, message store, and transport) and one for configuration support.</span></span> 
  
<span data-ttu-id="d118f-120">MAPI 通过包括相关及其所使用的方法的实现自定义每个支持对象。</span><span class="sxs-lookup"><span data-stu-id="d118f-120">MAPI customizes each support object by including implementations of methods that are relevant for its usage.</span></span> <span data-ttu-id="d118f-121">实现的一些方法，例如[IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md)，包含在所有支持对象。</span><span class="sxs-lookup"><span data-stu-id="d118f-121">Implementations of some methods, such as [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md), are included in all support objects.</span></span> <span data-ttu-id="d118f-122">实现的其他方法，如[IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)，仅适用于特定支持对象。</span><span class="sxs-lookup"><span data-stu-id="d118f-122">Implementations of other methods, such as [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md), apply only to particular support objects.</span></span> <span data-ttu-id="d118f-123">仅消息存储和传输提供程序可以使用此方法。当通讯簿提供程序或消息服务尝试调用它，MAPI 返回 MAPI_E_NO_SUPPORT。</span><span class="sxs-lookup"><span data-stu-id="d118f-123">Only message store and transport providers can use this method; when an address book provider or a message service try to call it, MAPI returns MAPI_E_NO_SUPPORT.</span></span>
  
<span data-ttu-id="d118f-124">支持对象可用于完成许多任务，如下所示：</span><span class="sxs-lookup"><span data-stu-id="d118f-124">Support objects can be used to accomplish many tasks, such as the following:</span></span>
  
- <span data-ttu-id="d118f-125">访问配置文件一节。</span><span class="sxs-lookup"><span data-stu-id="d118f-125">Accessing a profile section.</span></span>
    
- <span data-ttu-id="d118f-126">复制文件夹或消息。</span><span class="sxs-lookup"><span data-stu-id="d118f-126">Copying folders or messages.</span></span> <span data-ttu-id="d118f-127">有关详细信息，请参阅[复制或移动邮件还是一个文件夹](copying-or-moving-a-message-or-a-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="d118f-127">For more information, see [Copying or Moving a Message or a Folder](copying-or-moving-a-message-or-a-folder.md).</span></span>
    
- <span data-ttu-id="d118f-128">属于其他提供程序的访问对象。</span><span class="sxs-lookup"><span data-stu-id="d118f-128">Accessing objects that belong to other providers.</span></span> <span data-ttu-id="d118f-129">有关详细信息，请参阅[支持对象访问和比较](supporting-object-access-and-comparison.md)。</span><span class="sxs-lookup"><span data-stu-id="d118f-129">For more information, see [Supporting Object Access and Comparison](supporting-object-access-and-comparison.md).</span></span> 
    
- <span data-ttu-id="d118f-130">处理事件通知。</span><span class="sxs-lookup"><span data-stu-id="d118f-130">Handling event notification.</span></span> <span data-ttu-id="d118f-131">有关详细信息，请参阅[支持的事件通知](supporting-event-notification.md)。</span><span class="sxs-lookup"><span data-stu-id="d118f-131">For more information, see [Supporting Event Notification](supporting-event-notification.md).</span></span>
    
- <span data-ttu-id="d118f-132">分配和释放内存。</span><span class="sxs-lookup"><span data-stu-id="d118f-132">Allocating and freeing memory.</span></span>
    
- <span data-ttu-id="d118f-133">获取的唯一标识符。</span><span class="sxs-lookup"><span data-stu-id="d118f-133">Obtaining a unique identifier.</span></span>
    
- <span data-ttu-id="d118f-134">使无效对象。</span><span class="sxs-lookup"><span data-stu-id="d118f-134">Invalidating objects.</span></span>
    
- <span data-ttu-id="d118f-135">处理错误。</span><span class="sxs-lookup"><span data-stu-id="d118f-135">Handling errors.</span></span>
    
- <span data-ttu-id="d118f-136">注册消息 preprocessors。</span><span class="sxs-lookup"><span data-stu-id="d118f-136">Registering message preprocessors.</span></span> 
    
- <span data-ttu-id="d118f-137">准备邮件送达报告。</span><span class="sxs-lookup"><span data-stu-id="d118f-137">Preparing message delivery reports.</span></span> 
    
<span data-ttu-id="d118f-138">在登录时，MAPI 调用每个服务提供商的提供商对象的登录方法。</span><span class="sxs-lookup"><span data-stu-id="d118f-138">At logon time, MAPI calls the logon method of each service provider's provider object.</span></span> <span data-ttu-id="d118f-139">对于通讯簿提供程序，MAPI 调用[IABProvider::Logon](iabprovider-logon.md)。</span><span class="sxs-lookup"><span data-stu-id="d118f-139">For address book providers, MAPI calls [IABProvider::Logon](iabprovider-logon.md).</span></span> <span data-ttu-id="d118f-140">对于消息存储提供程序，MAPI 调用[IMSProvider::Logon](imsprovider-logon.md)。</span><span class="sxs-lookup"><span data-stu-id="d118f-140">For message store providers, MAPI calls [IMSProvider::Logon](imsprovider-logon.md).</span></span> <span data-ttu-id="d118f-141">对于传输提供程序，MAPI 调用[IXPProvider::TransportLogon](ixpprovider-transportlogon.md)。</span><span class="sxs-lookup"><span data-stu-id="d118f-141">For transport providers, MAPI calls [IXPProvider::TransportLogon](ixpprovider-transportlogon.md).</span></span> <span data-ttu-id="d118f-142">MAPI 将指针传递到此方法的参数之一中的适当支持对象。</span><span class="sxs-lookup"><span data-stu-id="d118f-142">MAPI passes a pointer to the appropriate support object in one of the parameters to this method.</span></span> <span data-ttu-id="d118f-143">反过来，logon 方法实例化登录对象，将其传递支持对象指针。</span><span class="sxs-lookup"><span data-stu-id="d118f-143">The logon method in turn instantiates a logon object, passing it the support object pointer.</span></span> <span data-ttu-id="d118f-144">如有必要，登录对象将调用支持对象的**IUnknown::AddRef**方法来保留。</span><span class="sxs-lookup"><span data-stu-id="d118f-144">The logon object calls the support object's **IUnknown::AddRef** method to retain it, if necessary.</span></span> <span data-ttu-id="d118f-145">有关服务提供商的登录过程的详细信息，请参阅[启动服务提供商](starting-a-service-provider.md)。</span><span class="sxs-lookup"><span data-stu-id="d118f-145">For more information about the logon process for service providers, see [Starting a Service Provider](starting-a-service-provider.md).</span></span>
  
<span data-ttu-id="d118f-146">当客户端注销时，MAPI 调用登录对象的注销方法。</span><span class="sxs-lookup"><span data-stu-id="d118f-146">When a client logs off, MAPI calls the logon object's logoff method.</span></span> <span data-ttu-id="d118f-147">Logoff 方法调用支持对象的**IUnknown::Release**方法，以指示提供程序不再想要呼叫的任何支持方法。</span><span class="sxs-lookup"><span data-stu-id="d118f-147">The logoff method calls the support object's **IUnknown::Release** method to indicate that the provider no longer intends to call any of the support methods.</span></span> <span data-ttu-id="d118f-148">与登录，注销方法有稍微不同的名称。</span><span class="sxs-lookup"><span data-stu-id="d118f-148">As with logon, the logoff methods have slightly different names.</span></span> <span data-ttu-id="d118f-149">[IABLogon](iablogoniunknown.md)和[IMSLogon](imslogoniunknown.md)接口具有**注销**方法;[IXPLogon](ixplogoniunknown.md)接口具有[TransportLogoff](ixplogon-transportlogoff.md)方法。</span><span class="sxs-lookup"><span data-stu-id="d118f-149">The [IABLogon](iablogoniunknown.md) and [IMSLogon](imslogoniunknown.md) interfaces have **Logoff** methods; the [IXPLogon](ixplogoniunknown.md) interface has a [TransportLogoff](ixplogon-transportlogoff.md) method.</span></span> 
  
<span data-ttu-id="d118f-150">在登录尝试失败，错误 MAPI_E_UNCONFIGURED 或客户端启动配置请求时，会调用消息服务入口点函数。</span><span class="sxs-lookup"><span data-stu-id="d118f-150">Message service entry point functions are called when a logon attempt fails with the error MAPI_E_UNCONFIGURED or when a client initiates a configuration request.</span></span> <span data-ttu-id="d118f-151">MAPI 实例化配置支持对象，并为其配置即将更改的提供程序或未配置提供程序调用消息服务入口点函数。</span><span class="sxs-lookup"><span data-stu-id="d118f-151">MAPI instantiates a configuration support object and calls the message service entry point function for either the unconfigured provider or the provider whose configuration is about to change.</span></span> <span data-ttu-id="d118f-152">其他支持与对象不同，配置支持对象是有效仅之前的入口点函数返回值;消息服务不调用这些对象的**AddRef**方法保留它们。</span><span class="sxs-lookup"><span data-stu-id="d118f-152">Unlike the other support objects, configuration support objects are valid only until the entry point function returns; message services do not call these objects' **AddRef** methods to retain them.</span></span> 
  
<span data-ttu-id="d118f-153">通常，MAPI 调用的提供程序的消息服务入口点函数，但有时要求提供程序进行呼叫。</span><span class="sxs-lookup"><span data-stu-id="d118f-153">Typically, MAPI makes calls to a provider's message service entry point function, but sometimes a provider is asked to make the call.</span></span> <span data-ttu-id="d118f-154">客户端呼叫提供商的[IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md)方法，以提示要显示其配置属性表的提供程序时，发生这种。</span><span class="sxs-lookup"><span data-stu-id="d118f-154">This can occur when a client calls a provider's [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) method to prompt the provider to display its configuration property sheet.</span></span> <span data-ttu-id="d118f-155">**留待**应调用[IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md)来获得它可以将它们传递给消息服务入口点函数的配置支持对象。</span><span class="sxs-lookup"><span data-stu-id="d118f-155">**SettingsDialog** should call [IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md) to obtain a configuration support object that it can pass to the message service entry point function.</span></span> 
  
<span data-ttu-id="d118f-156">[IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md)方法，而无需与 MAPI 链接确定内存分配和释放函数的地址。</span><span class="sxs-lookup"><span data-stu-id="d118f-156">The [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) method is available for determining the addresses of the memory allocation and deallocation functions without having to link with MAPI.</span></span> <span data-ttu-id="d118f-157">使用**GetMemAllocRoutines**还使容易通过周围具有调试代码的分配函数调用跟踪内存泄漏。</span><span class="sxs-lookup"><span data-stu-id="d118f-157">Using **GetMemAllocRoutines** also makes it easier to trace memory leaks by surrounding the allocation function calls with debugging code.</span></span> <span data-ttu-id="d118f-158">如果您调用**GetMemAllocRoutines**，如建议，请执行此操作之前调用[CreateIProp](createiprop.md)函数，这需要分配函数地址作为参数。</span><span class="sxs-lookup"><span data-stu-id="d118f-158">If you call **GetMemAllocRoutines**, as is recommended, do so before calling the [CreateIProp](createiprop.md) function, which requires the allocation function addresses as parameters.</span></span> 
  
<span data-ttu-id="d118f-159">当您需要创建新通讯簿或消息存储对象、 创建和其**PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) 属性中设置对象的搜索键。</span><span class="sxs-lookup"><span data-stu-id="d118f-159">When you need to create a new address book or message store object, create and set a search key for the object in its **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) property.</span></span> <span data-ttu-id="d118f-160">调用[IMAPISupport::NewUID](imapisupport-newuid.md)获取用于构建搜索关键字的唯一标识符。</span><span class="sxs-lookup"><span data-stu-id="d118f-160">Call [IMAPISupport::NewUID](imapisupport-newuid.md) to obtain a unique identifier to use in building a search key.</span></span> <span data-ttu-id="d118f-161">不要使用[MAPIUID](mapiuid.md)自己硬编码。</span><span class="sxs-lookup"><span data-stu-id="d118f-161">Do not use your own hard-coded [MAPIUID](mapiuid.md).</span></span> <span data-ttu-id="d118f-162">提供程序的**MAPIUID**应仅用于条目标识符。</span><span class="sxs-lookup"><span data-stu-id="d118f-162">A provider's **MAPIUID** should be used only for entry identifiers.</span></span> <span data-ttu-id="d118f-163">有关构建搜索关键字的详细信息，请参阅[MAPI 记录和搜索键](mapi-record-and-search-keys.md)。</span><span class="sxs-lookup"><span data-stu-id="d118f-163">For more information about constructing search keys, see [MAPI Record and Search Keys](mapi-record-and-search-keys.md).</span></span>
  
<span data-ttu-id="d118f-164">有时，客户端应用程序可以释放对象，而不释放一个或多个其附属对象。</span><span class="sxs-lookup"><span data-stu-id="d118f-164">A client application can sometimes release an object without releasing one or more of its affiliated objects.</span></span> <span data-ttu-id="d118f-165">在这种情况下，提供程序可能需要将未发布的对象呈现不可用。</span><span class="sxs-lookup"><span data-stu-id="d118f-165">In such a case, a provider may need to render an unreleased object unusable.</span></span> <span data-ttu-id="d118f-166">若要执行此操作，提供程序释放的所有资源与对象连接，然后调用[IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md)使对象的 vtable 无效。</span><span class="sxs-lookup"><span data-stu-id="d118f-166">To do this, the provider frees all of the resources connected with the object and then calls [IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md) to invalidate the object's vtable.</span></span> <span data-ttu-id="d118f-167">**MakeInvalid**替换标准 MAPI 实现 vtable **IUnknown**方法 （**QueryInterface**、 **AddRef**和**发行版**），并使所有其他方法可返回 MAPI_E_INVALID_OBJECT。</span><span class="sxs-lookup"><span data-stu-id="d118f-167">**MakeInvalid** replaces the vtable's **IUnknown** methods (**QueryInterface**, **AddRef**, and **Release**) with standard MAPI implementations and causes all other methods to return MAPI_E_INVALID_OBJECT.</span></span> <span data-ttu-id="d118f-168">**MakeInvalid**还释放 vtable 之外的所有对象的内存。</span><span class="sxs-lookup"><span data-stu-id="d118f-168">**MakeInvalid** also frees all the object's memory other than the vtable.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="d118f-169">另请参阅</span><span class="sxs-lookup"><span data-stu-id="d118f-169">See also</span></span>



[<span data-ttu-id="d118f-170">MAPI 服务提供商</span><span class="sxs-lookup"><span data-stu-id="d118f-170">MAPI Service Providers</span></span>](mapi-service-providers.md)

