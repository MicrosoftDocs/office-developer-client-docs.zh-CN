---
title: 处理消息存储通知
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3e0cc2f9-a88d-4cec-bef5-b60f2ec80f1c
description: 上次修改时间：2015 年 3 月 9 日
ms.openlocfilehash: 33002f31c185262bf21b4e74095e0774f55e3bf5
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/23/2018
ms.locfileid: "22564589"
---
# <a name="handling-message-store-notification"></a><span data-ttu-id="a4d49-103">处理消息存储通知</span><span class="sxs-lookup"><span data-stu-id="a4d49-103">Handling message store notification</span></span>
  
<span data-ttu-id="a4d49-104">**适用于**： Outlook 2013 |Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="a4d49-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="a4d49-105">若要注册的消息存储通知，调用[IMAPISession::Advise](imapisession-advise.md)或[IMsgStore::Advise](imsgstore-advise.md)方法，并指定_lpEntryID_参数的内容中的消息存储库、 文件夹或消息条目标识符。</span><span class="sxs-lookup"><span data-stu-id="a4d49-105">To register for message store notifications, call either the [IMAPISession::Advise](imapisession-advise.md) or [IMsgStore::Advise](imsgstore-advise.md) method and specify a message store, folder, or message entry identifier in the contents of the  _lpEntryID_ parameter.</span></span> <span data-ttu-id="a4d49-106">消息存储提供程序支持对象和表格的通知。</span><span class="sxs-lookup"><span data-stu-id="a4d49-106">Message store providers support both object and table notifications.</span></span> <span data-ttu-id="a4d49-107">是否注册与特定的消息存储对象、 介绍这些对象的文件夹层次结构和内容表个或两个对象和表取决于您希望查看，请执行操作，您发出的呼叫通知以及如何升级消息存储提供程序支持通知。</span><span class="sxs-lookup"><span data-stu-id="a4d49-107">Whether you register with particular message store objects, with the folder hierarchy and contents tables that describe these objects, or with both objects and tables depends on the notifications you expect to see, the calls you make to perform operations, and how the message store provider supports notification.</span></span> 
  
<span data-ttu-id="a4d49-108">因为 MAPI 允许灵活的提供程序如何支持通知，请注意，不会始终收到通知的相同类型在特定事件响应来自所有消息存储提供程序。</span><span class="sxs-lookup"><span data-stu-id="a4d49-108">Because MAPI allows flexibility in how providers support notifications, be aware that you will not always receive the same type of notification in response to a particular event from all message store providers.</span></span> <span data-ttu-id="a4d49-109">某些消息存储提供程序根本不支持通知。</span><span class="sxs-lookup"><span data-stu-id="a4d49-109">Some message store providers do not support notifications at all.</span></span> <span data-ttu-id="a4d49-110">确定要使用的消息存储是否支持通知，其**PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) 属性中的 STORE_NOTIFY_OK 位的外观。</span><span class="sxs-lookup"><span data-stu-id="a4d49-110">To determine if the message store you are using supports notification, look for the STORE_NOTIFY_OK bit in its **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span>
  
<span data-ttu-id="a4d49-111">一端在多种消息存储提供程序支持通知是生成"丰富"的通知; 的提供程序这些提供程序发送的所有注册的描述性通知告知源。</span><span class="sxs-lookup"><span data-stu-id="a4d49-111">At one end of the spectrum of message store providers that support notification are the providers that generate "rich" notifications; these providers send descriptive notifications for all registered advise sources.</span></span> <span data-ttu-id="a4d49-112">在另一端是邮件支持有限的通知; 的存储提供程序这些提供商发送常规通知受限 advise 源数。</span><span class="sxs-lookup"><span data-stu-id="a4d49-112">At the other end are the message store providers that support limited notifications; these providers send general notifications for a restricted number of advise sources.</span></span> 
  
<span data-ttu-id="a4d49-113">例如，如果将邮件复制到文件夹与注册接收的这两个对象复制和移动通知对象，可能也可能不会收到复制对象通知。</span><span class="sxs-lookup"><span data-stu-id="a4d49-113">For example, if you copy a message to a folder with which you have registered to receive both object copied and object moved notifications, you may or may not receive the object copied notification.</span></span> <span data-ttu-id="a4d49-114">收到它依赖：</span><span class="sxs-lookup"><span data-stu-id="a4d49-114">Whether or not you receive it depends on:</span></span>
  
- <span data-ttu-id="a4d49-115">调用要进行复制的方法。</span><span class="sxs-lookup"><span data-stu-id="a4d49-115">The method that you called to perform the copy.</span></span> <span data-ttu-id="a4d49-116">这可能是[IMAPIFolder::CopyMessages](imapifolder-copymessages.md)、 [IMAPIProp::CopyTo](imapiprop-copyto.md)或[IMAPIProp::CopyProps](imapiprop-copyprops.md)。</span><span class="sxs-lookup"><span data-stu-id="a4d49-116">This could be [IMAPIFolder::CopyMessages](imapifolder-copymessages.md), [IMAPIProp::CopyTo](imapiprop-copyto.md), or [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span></span>
    
- <span data-ttu-id="a4d49-117">如何消息存储提供程序实现 copy 方法。</span><span class="sxs-lookup"><span data-stu-id="a4d49-117">How the message store provider implements the copy method.</span></span>
    
- <span data-ttu-id="a4d49-118">是否消息存储提供程序支持的文件夹对象复制通知。</span><span class="sxs-lookup"><span data-stu-id="a4d49-118">Whether or not the message store provider supports object copied notifications on folders.</span></span>
    
<span data-ttu-id="a4d49-119">由于有介绍了如何实现事件通知的消息不严格准则存储提供程序，客户端无法预想一致的行为。</span><span class="sxs-lookup"><span data-stu-id="a4d49-119">Because there are no strict guidelines that describe how to implement event notification for message store providers, clients cannot expect consistent behavior.</span></span> <span data-ttu-id="a4d49-120">MAPI 使建议如何消息存储提供程序实现事件通知和下表概括了这些建议。</span><span class="sxs-lookup"><span data-stu-id="a4d49-120">MAPI does make recommendations as to how message store providers implement event notification and the following table outlines these recommendations.</span></span> <span data-ttu-id="a4d49-121">读取表，如下所示： 中的第一列执行该操作后，希望接收通知的类型列出的第二列中，如果已注册第三列中列出的对象的类型。</span><span class="sxs-lookup"><span data-stu-id="a4d49-121">Read the table as follows: after you perform the operation in the first column, expect to receive a notification of the type listed in the second column if you have registered for that type with the object listed in the third column.</span></span> <span data-ttu-id="a4d49-122">例如，创建一个文件夹后，您将收到_fnevObjectCreated_通知，仅当您注册消息存储与_fnevObjectCreated_通知。</span><span class="sxs-lookup"><span data-stu-id="a4d49-122">For example, after you have created a folder, you will receive an  _fnevObjectCreated_ notification only if you have registered for  _fnevObjectCreated_ notifications with the message store.</span></span> 
  
|<span data-ttu-id="a4d49-123">**Operation**</span><span class="sxs-lookup"><span data-stu-id="a4d49-123">**Operation**</span></span>|<span data-ttu-id="a4d49-124">**事件类型**</span><span class="sxs-lookup"><span data-stu-id="a4d49-124">**Event type**</span></span>|<span data-ttu-id="a4d49-125">**建议源**</span><span class="sxs-lookup"><span data-stu-id="a4d49-125">**Advise source**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="a4d49-126">创建一个文件夹</span><span class="sxs-lookup"><span data-stu-id="a4d49-126">Create a folder</span></span>  <br/> | <span data-ttu-id="a4d49-127">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="a4d49-127">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="a4d49-128">消息存储库</span><span class="sxs-lookup"><span data-stu-id="a4d49-128">Message store</span></span>  <br/> |
|<span data-ttu-id="a4d49-129">删除文件夹</span><span class="sxs-lookup"><span data-stu-id="a4d49-129">Delete a folder</span></span>  <br/> | <span data-ttu-id="a4d49-130">_fnevObjectDeleted_</span><span class="sxs-lookup"><span data-stu-id="a4d49-130">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="a4d49-131">消息存储已删除文件夹</span><span class="sxs-lookup"><span data-stu-id="a4d49-131">Message store Deleted folder</span></span>  <br/> |
|<span data-ttu-id="a4d49-132">将文件夹从一个文件夹移到另一个</span><span class="sxs-lookup"><span data-stu-id="a4d49-132">Move a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="a4d49-133">_fnevObjectMoved_</span><span class="sxs-lookup"><span data-stu-id="a4d49-133">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="a4d49-134">消息存储移动文件夹</span><span class="sxs-lookup"><span data-stu-id="a4d49-134">Message store Moved folder</span></span>  <br/> |
|<span data-ttu-id="a4d49-135">将文件夹从一个文件夹复制到另一个</span><span class="sxs-lookup"><span data-stu-id="a4d49-135">Copy a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="a4d49-136">_fnevObjectCopied_</span><span class="sxs-lookup"><span data-stu-id="a4d49-136">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="a4d49-137">消息存储和复制文件夹 （没有新的文件夹的副本发送_fnevObjectCreated_通知）</span><span class="sxs-lookup"><span data-stu-id="a4d49-137">Message store and copied folder (no  _fnevObjectCreated_ notification sent for the new copy of the folder)</span></span>  <br/> |
|<span data-ttu-id="a4d49-138">在计算的文件夹属性 （**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md))、 **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md))、 **PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md)) 中更改</span><span class="sxs-lookup"><span data-stu-id="a4d49-138">Change in a computed folder property (**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)), **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span></span>  <br/> | <span data-ttu-id="a4d49-139">_fnevObjectModified_</span><span class="sxs-lookup"><span data-stu-id="a4d49-139">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="a4d49-140">消息存储 Changed 文件夹 （没有父文件夹的通知）</span><span class="sxs-lookup"><span data-stu-id="a4d49-140">Message store Changed folder (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="a4d49-141">创建邮件</span><span class="sxs-lookup"><span data-stu-id="a4d49-141">Create a message</span></span>  <br/> | <span data-ttu-id="a4d49-142">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="a4d49-142">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="a4d49-143">消息存储库</span><span class="sxs-lookup"><span data-stu-id="a4d49-143">Message store</span></span>  <br/> |
|<span data-ttu-id="a4d49-144">删除一条消息，更改导致父文件夹的**PR_CONTENT_COUNT**属性</span><span class="sxs-lookup"><span data-stu-id="a4d49-144">Delete a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="a4d49-145">_fnevObjectDeleted_</span><span class="sxs-lookup"><span data-stu-id="a4d49-145">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="a4d49-146">消息存储已删除邮件</span><span class="sxs-lookup"><span data-stu-id="a4d49-146">Message store Deleted message</span></span>  <br/> |
|<span data-ttu-id="a4d49-147">将一条消息从一个文件夹移至另一个</span><span class="sxs-lookup"><span data-stu-id="a4d49-147">Move a message from one folder to another</span></span>  <br/> | <span data-ttu-id="a4d49-148">_fnevObjectMoved_</span><span class="sxs-lookup"><span data-stu-id="a4d49-148">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="a4d49-149">消息存储移动消息</span><span class="sxs-lookup"><span data-stu-id="a4d49-149">Message store Moved message</span></span>  <br/> |
|<span data-ttu-id="a4d49-150">将一条消息从一个文件夹复制到另一个</span><span class="sxs-lookup"><span data-stu-id="a4d49-150">Copy a message from one folder to another</span></span>  <br/> | <span data-ttu-id="a4d49-151">_fnevObjectCopied_</span><span class="sxs-lookup"><span data-stu-id="a4d49-151">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="a4d49-152">消息存储库复制邮件 （没有_fnevObjectCreated_新副本的通知邮件）</span><span class="sxs-lookup"><span data-stu-id="a4d49-152">Message store Copied message (No  _fnevObjectCreated_ notification for new copy of the message)</span></span>  <br/> |
|<span data-ttu-id="a4d49-153">保存一条消息，更改导致父文件夹的**PR_CONTENT_COUNT**属性</span><span class="sxs-lookup"><span data-stu-id="a4d49-153">Save a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="a4d49-154">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="a4d49-154">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="a4d49-155">保存唯一的第一个邮件存储</span><span class="sxs-lookup"><span data-stu-id="a4d49-155">Message store on first save only</span></span>  <br/> |
|<span data-ttu-id="a4d49-156">保存一条消息</span><span class="sxs-lookup"><span data-stu-id="a4d49-156">Save a message</span></span>  <br/> | <span data-ttu-id="a4d49-157">_fnevObjectModified_</span><span class="sxs-lookup"><span data-stu-id="a4d49-157">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="a4d49-158">保存后保存 Changed 邮件 （发送给父文件夹没有通知） 的第一个邮件存储</span><span class="sxs-lookup"><span data-stu-id="a4d49-158">Message store on saves after the first save Changed message (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="a4d49-159">完成搜索操作</span><span class="sxs-lookup"><span data-stu-id="a4d49-159">Complete a search operation</span></span>  <br/> | <span data-ttu-id="a4d49-160">_fnevSearchComplete_</span><span class="sxs-lookup"><span data-stu-id="a4d49-160">_fnevSearchComplete_</span></span> <br/> |<span data-ttu-id="a4d49-161">消息存储搜索文件夹</span><span class="sxs-lookup"><span data-stu-id="a4d49-161">Message store Search folder</span></span>  <br/> |
|<span data-ttu-id="a4d49-162">新的邮件</span><span class="sxs-lookup"><span data-stu-id="a4d49-162">New message</span></span>  <br/> | <span data-ttu-id="a4d49-163">_fnevNewMail_</span><span class="sxs-lookup"><span data-stu-id="a4d49-163">_fnevNewMail_</span></span> <br/> |<span data-ttu-id="a4d49-164">消息存储库</span><span class="sxs-lookup"><span data-stu-id="a4d49-164">Message store</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="a4d49-165">当您收到对象修改通知时，请记住所指的**OnNotify**调用中_lpNotifications_参数[OBJECT_NOTIFICATION](object_notification.md)结构的属性标记数组部分可能，也可能不是 NULL。</span><span class="sxs-lookup"><span data-stu-id="a4d49-165">When you receive an object modified notification, remember that the property tag array portion of the [OBJECT_NOTIFICATION](object_notification.md) structure pointed to by the  _lpNotifications_ parameter in the **OnNotify** call may or may not be NULL.</span></span> <span data-ttu-id="a4d49-166">消息存储提供程序不需要在此数组中插入属性信息和最不。</span><span class="sxs-lookup"><span data-stu-id="a4d49-166">Message store providers are not required to insert property information in this array and most do not.</span></span> <span data-ttu-id="a4d49-167">请确保您**OnNotify**方法可以处理_lpPropTagArray_指针为 NULL 的情况。</span><span class="sxs-lookup"><span data-stu-id="a4d49-167">Make sure your **OnNotify** method can handle the case where the  _lpPropTagArray_ pointer is NULL.</span></span> 
  
<span data-ttu-id="a4d49-168">对于大多数，如果不是所有对象通知，更新受影响的文件夹或文件夹的视图。</span><span class="sxs-lookup"><span data-stu-id="a4d49-168">For most, if not all object notifications, update the view of the affected folder or folders.</span></span>
  

