---
title: 处理邮件存储通知
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3e0cc2f9-a88d-4cec-bef5-b60f2ec80f1c
description: 上次修改时间：2015 年 3 月 9 日
ms.openlocfilehash: d370603dc7cfc015fe7b2757d1cf0525b3092c5e
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428023"
---
# <a name="handling-message-store-notification"></a><span data-ttu-id="86f03-103">处理邮件存储通知</span><span class="sxs-lookup"><span data-stu-id="86f03-103">Handling message store notification</span></span>
  
<span data-ttu-id="86f03-104">**适用于**：Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="86f03-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="86f03-105">若要注册邮件存储通知，请调用 [IMAPISession：：Advise](imapisession-advise.md) 或 [IMsgStore：：Advise](imsgstore-advise.md) 方法，在  _lpEntryID_ 参数的内容中指定邮件存储、文件夹或邮件条目标识符。</span><span class="sxs-lookup"><span data-stu-id="86f03-105">To register for message store notifications, call either the [IMAPISession::Advise](imapisession-advise.md) or [IMsgStore::Advise](imsgstore-advise.md) method and specify a message store, folder, or message entry identifier in the contents of the  _lpEntryID_ parameter.</span></span> <span data-ttu-id="86f03-106">邮件存储提供程序支持对象和表通知。</span><span class="sxs-lookup"><span data-stu-id="86f03-106">Message store providers support both object and table notifications.</span></span> <span data-ttu-id="86f03-107">注册特定邮件存储对象、使用描述这些对象的文件夹层次结构和内容表，还是同时使用对象和表取决于预期看到的通知、您为执行的操作而进行调用以及邮件存储提供程序如何支持通知。</span><span class="sxs-lookup"><span data-stu-id="86f03-107">Whether you register with particular message store objects, with the folder hierarchy and contents tables that describe these objects, or with both objects and tables depends on the notifications you expect to see, the calls you make to perform operations, and how the message store provider supports notification.</span></span> 
  
<span data-ttu-id="86f03-108">由于 MAPI 允许提供程序支持通知的方式的灵活性，因此请注意，您不会始终收到同一类型的通知，以响应来自所有邮件存储提供程序的特定事件。</span><span class="sxs-lookup"><span data-stu-id="86f03-108">Because MAPI allows flexibility in how providers support notifications, be aware that you will not always receive the same type of notification in response to a particular event from all message store providers.</span></span> <span data-ttu-id="86f03-109">某些邮件存储提供程序完全不支持通知。</span><span class="sxs-lookup"><span data-stu-id="86f03-109">Some message store providers do not support notifications at all.</span></span> <span data-ttu-id="86f03-110">若要确定你使用的邮件存储是否支持通知，请在其 PR_STORE_SUPPORT_MASK ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) 查找 STORE_NOTIFY_OK 位。 </span><span class="sxs-lookup"><span data-stu-id="86f03-110">To determine if the message store you are using supports notification, look for the STORE_NOTIFY_OK bit in its **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span>
  
<span data-ttu-id="86f03-111">支持通知的邮件存储提供程序的一端是生成"丰富"通知的提供程序;这些提供程序会发送所有已注册的建议源的描述性通知。</span><span class="sxs-lookup"><span data-stu-id="86f03-111">At one end of the spectrum of message store providers that support notification are the providers that generate "rich" notifications; these providers send descriptive notifications for all registered advise sources.</span></span> <span data-ttu-id="86f03-112">另一端是支持有限通知的邮件存储提供程序;这些提供程序发送有限数量的通知源的常规通知。</span><span class="sxs-lookup"><span data-stu-id="86f03-112">At the other end are the message store providers that support limited notifications; these providers send general notifications for a restricted number of advise sources.</span></span> 
  
<span data-ttu-id="86f03-113">例如，如果将邮件复制到已注册接收对象复制通知和对象移动通知的文件夹，则您可以接收对象复制的通知，也可以不接收。</span><span class="sxs-lookup"><span data-stu-id="86f03-113">For example, if you copy a message to a folder with which you have registered to receive both object copied and object moved notifications, you may or may not receive the object copied notification.</span></span> <span data-ttu-id="86f03-114">是否收到它取决于：</span><span class="sxs-lookup"><span data-stu-id="86f03-114">Whether or not you receive it depends on:</span></span>
  
- <span data-ttu-id="86f03-115">您为执行复制而调用的方法。</span><span class="sxs-lookup"><span data-stu-id="86f03-115">The method that you called to perform the copy.</span></span> <span data-ttu-id="86f03-116">这可以是 [IMAPIFolder：：CopyMessages](imapifolder-copymessages.md) [、IMAPIProp：：CopyTo](imapiprop-copyto.md)或 [IMAPIProp：：CopyProps](imapiprop-copyprops.md)。</span><span class="sxs-lookup"><span data-stu-id="86f03-116">This could be [IMAPIFolder::CopyMessages](imapifolder-copymessages.md), [IMAPIProp::CopyTo](imapiprop-copyto.md), or [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span></span>
    
- <span data-ttu-id="86f03-117">邮件存储提供程序如何实现 copy 方法。</span><span class="sxs-lookup"><span data-stu-id="86f03-117">How the message store provider implements the copy method.</span></span>
    
- <span data-ttu-id="86f03-118">邮件存储提供程序是否支持文件夹上的对象复制通知。</span><span class="sxs-lookup"><span data-stu-id="86f03-118">Whether or not the message store provider supports object copied notifications on folders.</span></span>
    
<span data-ttu-id="86f03-119">因为没有严格的准则可描述如何为邮件存储提供程序实现事件通知，客户端无法期望一致的行为。</span><span class="sxs-lookup"><span data-stu-id="86f03-119">Because there are no strict guidelines that describe how to implement event notification for message store providers, clients cannot expect consistent behavior.</span></span> <span data-ttu-id="86f03-120">MAPI 对邮件存储提供程序如何实施事件通知提供了建议，下表概述了这些建议。</span><span class="sxs-lookup"><span data-stu-id="86f03-120">MAPI does make recommendations as to how message store providers implement event notification and the following table outlines these recommendations.</span></span> <span data-ttu-id="86f03-121">按如下方式阅读该表：在您执行第一列中的操作后，如果已使用第三列中列出的对象为类型注册，则预期会收到第二列中列出的类型的通知。</span><span class="sxs-lookup"><span data-stu-id="86f03-121">Read the table as follows: after you perform the operation in the first column, expect to receive a notification of the type listed in the second column if you have registered for that type with the object listed in the third column.</span></span> <span data-ttu-id="86f03-122">例如，创建文件夹后，只有在邮件存储中注册  _了 fnevObjectCreated_ 通知时，你才能收到  _fnevObjectCreated_ 通知。</span><span class="sxs-lookup"><span data-stu-id="86f03-122">For example, after you have created a folder, you will receive an  _fnevObjectCreated_ notification only if you have registered for  _fnevObjectCreated_ notifications with the message store.</span></span> 
  
|<span data-ttu-id="86f03-123">**操作**</span><span class="sxs-lookup"><span data-stu-id="86f03-123">**Operation**</span></span>|<span data-ttu-id="86f03-124">**事件类型**</span><span class="sxs-lookup"><span data-stu-id="86f03-124">**Event type**</span></span>|<span data-ttu-id="86f03-125">**建议源**</span><span class="sxs-lookup"><span data-stu-id="86f03-125">**Advise source**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="86f03-126">创建文件夹</span><span class="sxs-lookup"><span data-stu-id="86f03-126">Create a folder</span></span>  <br/> | <span data-ttu-id="86f03-127">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="86f03-127">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="86f03-128">邮件存储</span><span class="sxs-lookup"><span data-stu-id="86f03-128">Message store</span></span>  <br/> |
|<span data-ttu-id="86f03-129">删除文件夹</span><span class="sxs-lookup"><span data-stu-id="86f03-129">Delete a folder</span></span>  <br/> | <span data-ttu-id="86f03-130">_fnevObjectDeleted_</span><span class="sxs-lookup"><span data-stu-id="86f03-130">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="86f03-131">邮件存储 已删除文件夹</span><span class="sxs-lookup"><span data-stu-id="86f03-131">Message store Deleted folder</span></span>  <br/> |
|<span data-ttu-id="86f03-132">将文件夹从一个文件夹移动到另一个文件夹</span><span class="sxs-lookup"><span data-stu-id="86f03-132">Move a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="86f03-133">_fnevObjectMoved_</span><span class="sxs-lookup"><span data-stu-id="86f03-133">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="86f03-134">邮件存储已移动文件夹</span><span class="sxs-lookup"><span data-stu-id="86f03-134">Message store Moved folder</span></span>  <br/> |
|<span data-ttu-id="86f03-135">将文件夹从一个文件夹复制到另一个文件夹</span><span class="sxs-lookup"><span data-stu-id="86f03-135">Copy a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="86f03-136">_fnevObjectCopied_</span><span class="sxs-lookup"><span data-stu-id="86f03-136">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="86f03-137">邮件存储和复制的文件夹 (没有为文件夹的新副本发送  _的 fnevObjectCreated_) </span><span class="sxs-lookup"><span data-stu-id="86f03-137">Message store and copied folder (no  _fnevObjectCreated_ notification sent for the new copy of the folder)</span></span>  <br/> |
|<span data-ttu-id="86f03-138"> ( PR_SUBFOLDERS ([PidTagSubfolders](pidtagsubfolders-canonical-property.md) **) 、PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md) **) 、PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md)) 中的计算文件夹属性更改</span><span class="sxs-lookup"><span data-stu-id="86f03-138">Change in a computed folder property (**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)), **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span></span>  <br/> | <span data-ttu-id="86f03-139">_fnevObjectModified_</span><span class="sxs-lookup"><span data-stu-id="86f03-139">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="86f03-140">邮件存储 更改 (没有通知到父文件夹) </span><span class="sxs-lookup"><span data-stu-id="86f03-140">Message store Changed folder (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="86f03-141">创建邮件</span><span class="sxs-lookup"><span data-stu-id="86f03-141">Create a message</span></span>  <br/> | <span data-ttu-id="86f03-142">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="86f03-142">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="86f03-143">邮件存储</span><span class="sxs-lookup"><span data-stu-id="86f03-143">Message store</span></span>  <br/> |
|<span data-ttu-id="86f03-144">删除邮件，导致父文件夹的 PR_CONTENT_COUNT **属性更改**</span><span class="sxs-lookup"><span data-stu-id="86f03-144">Delete a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="86f03-145">_fnevObjectDeleted_</span><span class="sxs-lookup"><span data-stu-id="86f03-145">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="86f03-146">邮件存储 已删除邮件</span><span class="sxs-lookup"><span data-stu-id="86f03-146">Message store Deleted message</span></span>  <br/> |
|<span data-ttu-id="86f03-147">将邮件从一个文件夹移动到另一个文件夹</span><span class="sxs-lookup"><span data-stu-id="86f03-147">Move a message from one folder to another</span></span>  <br/> | <span data-ttu-id="86f03-148">_fnevObjectMoved_</span><span class="sxs-lookup"><span data-stu-id="86f03-148">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="86f03-149">邮件存储 已移动邮件</span><span class="sxs-lookup"><span data-stu-id="86f03-149">Message store Moved message</span></span>  <br/> |
|<span data-ttu-id="86f03-150">将邮件从一个文件夹复制到另一个文件夹</span><span class="sxs-lookup"><span data-stu-id="86f03-150">Copy a message from one folder to another</span></span>  <br/> | <span data-ttu-id="86f03-151">_fnevObjectCopied_</span><span class="sxs-lookup"><span data-stu-id="86f03-151">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="86f03-152">邮件存储 已复制 (没有  _fnevObjectCreated_ 新邮件副本的通知) </span><span class="sxs-lookup"><span data-stu-id="86f03-152">Message store Copied message (No  _fnevObjectCreated_ notification for new copy of the message)</span></span>  <br/> |
|<span data-ttu-id="86f03-153">保存邮件，导致父文件夹的 PR_CONTENT_COUNT **属性更改**</span><span class="sxs-lookup"><span data-stu-id="86f03-153">Save a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="86f03-154">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="86f03-154">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="86f03-155">仅在首次保存时存储邮件</span><span class="sxs-lookup"><span data-stu-id="86f03-155">Message store on first save only</span></span>  <br/> |
|<span data-ttu-id="86f03-156">保存邮件</span><span class="sxs-lookup"><span data-stu-id="86f03-156">Save a message</span></span>  <br/> | <span data-ttu-id="86f03-157">_fnevObjectModified_</span><span class="sxs-lookup"><span data-stu-id="86f03-157">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="86f03-158">第一次保存更改的邮件后保存的邮件存储 (没有通知到父文件夹) </span><span class="sxs-lookup"><span data-stu-id="86f03-158">Message store on saves after the first save Changed message (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="86f03-159">完成搜索操作</span><span class="sxs-lookup"><span data-stu-id="86f03-159">Complete a search operation</span></span>  <br/> | <span data-ttu-id="86f03-160">_fnevSearchComplete_</span><span class="sxs-lookup"><span data-stu-id="86f03-160">_fnevSearchComplete_</span></span> <br/> |<span data-ttu-id="86f03-161">邮件存储搜索文件夹</span><span class="sxs-lookup"><span data-stu-id="86f03-161">Message store Search folder</span></span>  <br/> |
|<span data-ttu-id="86f03-162">新邮件</span><span class="sxs-lookup"><span data-stu-id="86f03-162">New message</span></span>  <br/> | <span data-ttu-id="86f03-163">_fnevNewMail_</span><span class="sxs-lookup"><span data-stu-id="86f03-163">_fnevNewMail_</span></span> <br/> |<span data-ttu-id="86f03-164">邮件存储</span><span class="sxs-lookup"><span data-stu-id="86f03-164">Message store</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="86f03-165">当您收到对象修改通知时，请记住 **OnNotify** 调用中的 _lpNotifications_ 参数指向 [的 OBJECT_NOTIFICATION](object_notification.md)结构的属性标记数组部分可能为 NULL，也可能不为 NULL。</span><span class="sxs-lookup"><span data-stu-id="86f03-165">When you receive an object modified notification, remember that the property tag array portion of the [OBJECT_NOTIFICATION](object_notification.md) structure pointed to by the  _lpNotifications_ parameter in the **OnNotify** call may or may not be NULL.</span></span> <span data-ttu-id="86f03-166">邮件存储提供程序不需要在此数组中插入属性信息，大多数提供程序不需要。</span><span class="sxs-lookup"><span data-stu-id="86f03-166">Message store providers are not required to insert property information in this array and most do not.</span></span> <span data-ttu-id="86f03-167">确保 **OnNotify** 方法可以处理  _lpPropTagArray_ 指针为 NULL 的情况。</span><span class="sxs-lookup"><span data-stu-id="86f03-167">Make sure your **OnNotify** method can handle the case where the  _lpPropTagArray_ pointer is NULL.</span></span> 
  
<span data-ttu-id="86f03-168">对于大多数对象通知（如果不是所有对象通知）更新受影响文件夹的视图。</span><span class="sxs-lookup"><span data-stu-id="86f03-168">For most, if not all object notifications, update the view of the affected folder or folders.</span></span>
  

